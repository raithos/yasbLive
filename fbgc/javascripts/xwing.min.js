var DFL_LANGUAGE,GenericAddon,SERIALIZATION_CODE_TO_CLASS,SHOW_DEBUG_OUT_MISSING_TRANSLATIONS,SPEC_URL,SQUAD_DISPLAY_NAME_MAX_LENGTH,SQUAD_TO_XWS_URL,Ship,TYPES,URL_BASE,all,builders,byName,byPoints,conditionToHTML,exportObj,getPrimaryFaction,statAndEffectiveStat,__slice=[].slice,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__indexOf=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};window.iced={Deferrals:function(){function a(a){this.continuation=a,this.count=1,this.ret=null}return a.prototype._fulfill=function(){if(!--this.count)return this.continuation(this.ret)},a.prototype.defer=function(a){return++this.count,function(b){return function(){var c,d;return c=1<=arguments.length?__slice.call(arguments,0):[],null!=a&&null!=(d=a.assign_fn)&&d.apply(null,c),b._fulfill()}}(this)},a}(),findDeferral:function(){return null},trampoline:function(a){return a()}},window.__iced_k=window.__iced_k_noop=function(){},exportObj="undefined"!=typeof exports&&null!==exports?exports:this,exportObj.SquadBuilderBackend=function(){function a(a){this.getCollectionCheck=__bind(this.getCollectionCheck,this),this.getLanguagePreference=__bind(this.getLanguagePreference,this),this.nameCheck=__bind(this.nameCheck,this),this.maybeAuthenticationChanged=__bind(this.maybeAuthenticationChanged,this);var b,c,d,e;for($.ajaxSetup({dataType:"json",xhrFields:{withCredentials:!0}}),this.server=a.server,this.builders=a.builders,this.login_logout_button=$(a.login_logout_button),this.auth_status=$(a.auth_status),this.authenticated=!1,this.ui_ready=!1,this.oauth_window=null,this.method_metadata={google_oauth2:{icon:"fab fa-google",text:"Google"},facebook:{icon:"fab fa-facebook",text:"Facebook"},twitter:{icon:"fab fa-twitter",text:"Twitter"},discord:{icon:"fab fa-discord",text:"Discord"}},this.squad_display_mode="all",this.show_archived=!1,this.collection_save_timer=null,this.setupHandlers(),this.setupUI(),this.authenticate(function(a){return function(){return a.auth_status.hide(),a.login_logout_button.removeClass("d-none")}}(this)),e=this.builders,c=0,d=e.length;c<d;c++)b=e[c],b.setBackend(this);this.updateAuthenticationVisibility()}return a.prototype.updateAuthenticationVisibility=function(){return this.authenticated?($(".show-authenticated").show(),$(".hide-authenticated").hide()):($(".show-authenticated").hide(),$(".hide-authenticated").show())},a.prototype.save=function(a,b,c,d,e,f){var g,h;if(null==b&&(b=null),null==e&&(e={}),""===a)return f({id:null,success:!1,error:"You cannot save an empty squad"});if(""===$.trim(c))return f({id:null,success:!1,error:"Squad name cannot be empty"});if(null==d||""===d)throw"Faction unspecified to save()";return g={name:$.trim(c),faction:$.trim(d),serialized:a,additional_data:e},null!=b?h=""+this.server+"/squads/"+b:(h=""+this.server+"/squads/new",g._method="put"),$.post(h,g,function(a){return function(a,b,c){return f({id:a.id,success:a.success,error:a.error})}}(this))},a.prototype["delete"]=function(a,b){var c;return c={_method:"delete"},$.post(""+this.server+"/squads/"+a,c,function(a){return function(a,c,d){return b({success:a.success,error:a.error})}}(this))},a.prototype.archive=function(a,b,c){return a.additional_data.archived=!0,this.save(a.serialized,a.id,a.name,b,a.additional_data,c)},a.prototype.list=function(a){var b,c,d,e;return this.squad_list_modal.find(".modal-header .squad-list-header-placeholder").text(exportObj.translate("ui","yourXYsquads",a.faction)),b=$(this.squad_list_modal.find("ul.squad-list")),b.text(""),b.hide(),c=$(this.squad_list_modal.find("p.squad-list-loading")),c.show(),this.show_all_squads_button.click(),this.squad_list_modal.modal("show"),this.number_of_selected_squads_to_be_deleted=0,d=[],e=""+this.server+"/squads/list",$.get(e,function(e){return function(f,g,h){var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;for(i=!1,w=f[a.faction],q=0,t=w.length;q<t;q++){if(k=w[q],j=$(document.createElement("LI")),j.addClass("squad-summary"),j.data("squad",k),j.data("builder",a),j.data("selectedForDeletion",!1),b.append(j),null!=(null!=(x=k.additional_data)?x.tag:void 0)&&""!==(null!=(y=k.additional_data)?y.tag:void 0)&&d.indexOf(k.additional_data.tag)===-1)for(m=null!=(z=k.additional_data)?z.tag.split(","):void 0,r=0,u=m.length;r<u;r++)o=m[r],d.push(o);null!=(null!=(A=k.additional_data)?A.archived:void 0)?j.hide():i=!0,j.append($.trim('<div class="row">\n    <div class="col-md-9">\n        <h4>'+k.name+'</h4>\n    </div>\n    <div class="col-md-3">\n        <h5>'+(null!=(B=k.additional_data)?B.points:void 0)+" "+exportObj.translate("ui","Points")+'</h5>\n    </div>\n</div>\n<div class="row squad-description">\n    <div class="col-md-9">\n        '+(null!=(C=k.additional_data)?C.description:void 0)+'\n    </div>\n    <div class="squad-buttons col-md-3">\n        <button class="btn btn-modal convert-squad"><i class="xwing-miniatures-font xwing-miniatures-font-first-player-1"></i></button>\n        &nbsp;\n        <button class="btn btn-modal load-squad"><i class="fa fa-download"></i></button>\n        &nbsp;\n        <button class="btn btn-danger delete-squad"><i class="fa fa-times"></i></button>\n    </div>\n</div>\n<div class="row squad-convert-confirm">\n    <div class="col-md-9 translated" defaultText="Convert to Extended?">\n    </div>\n    <div class="squad-buttons col-md-3">\n        <button class="btn btn-danger confirm-convert-squad translated" defaultText="Convert"></button>\n        &nbsp;\n        <button class="btn btn-modal cancel-convert-squad translated" defaultText="Cancel"></button>\n    </div>\n</div>\n<div class="row squad-delete-confirm">\n    <div class="col-md-9">\n        '+exportObj.translate("ui","reallyDeleteSquadXY","<em>"+k.name+"</em>")+'\n    </div>\n    <div class="col-md-3">\n        <button class="btn btn-danger confirm-delete-squad translated" defaultText="Delete"></button>\n        &nbsp;\n        <button class="btn btn-modal cancel-delete-squad translated" defaultText="Cancel"></button>\n    </div>\n</div>')),j.find(".squad-convert-confirm").hide(),j.find(".squad-delete-confirm").hide(),k.serialized.search(/v\d+Zh/)===-1&&j.find("button.convert-squad").hide(),j.find("button.convert-squad").click(function(b){var c;return b.preventDefault(),c=$(b.target),j=c.closest("li"),a=j.data("builder"),j.data("selectedToConvert",!0),function(a){return a.find(".squad-description").fadeOut("fast",function(){return a.find(".squad-convert-confirm").fadeIn("fast")})}(j)}),j.find("button.cancel-convert-squad").click(function(b){var c;return b.preventDefault(),c=$(b.target),j=c.closest("li"),a=j.data("builder"),j.data("selectedToConvert",!1),function(a){return a.find(".squad-convert-confirm").fadeOut("fast",function(){return a.find(".squad-description").fadeIn("fast")})}(j)}),j.find("button.confirm-convert-squad").click(function(b){var c,d;return b.preventDefault(),c=$(b.target),j=c.closest("li"),a=j.data("builder"),j.find(".cancel-convert-squad").fadeOut("fast"),j.find(".confirm-convert-squad").addClass("disabled"),j.find(".confirm-convert-squad").text("Converting..."),d=j.data("squad").serialized.replace("Zh","Zs"),e.save(d,j.data("squad").id,j.data("squad").name,j.data("builder").faction,j.data("squad").additional_data,function(a){return a.success?(j.data("squad").serialized=d,j.find(".squad-convert-confirm").fadeOut("fast",function(){return j.find(".squad-description").fadeIn("fast"),j.find("button.convert-squad").fadeOut("fast")})):j.html($.trim("Error converting "+j.data("squad").name+": <em>"+a.error+"</em>"))})}),j.find("button.load-squad").click(function(b){var c;return b.preventDefault(),c=$(b.target),j=c.closest("li"),a=j.data("builder"),e.squad_list_modal.modal("hide"),a.current_squad.dirty?e.warnUnsaved(a,function(){return a.container.trigger("xwing-backend:squadLoadRequested",j.data("squad"))}):a.container.trigger("xwing-backend:squadLoadRequested",j.data("squad"))}),j.find("button.delete-squad").click(function(b){var c;return b.preventDefault(),c=$(b.target),j=c.closest("li"),a=j.data("builder"),j.data("selectedForDeletion",!0),function(a){if(a.find(".squad-description").fadeOut("fast",function(){return a.find(".squad-delete-confirm").fadeIn("fast")}),!e.number_of_selected_squads_to_be_deleted)return e.squad_list_modal.find("div.delete-multiple-squads").show()}(j),e.number_of_selected_squads_to_be_deleted+=1}),j.find("button.cancel-delete-squad").click(function(b){var c;return b.preventDefault(),c=$(b.target),j=c.closest("li"),a=j.data("builder"),j.data("selectedForDeletion",!1),e.number_of_selected_squads_to_be_deleted-=1,function(a){if(a.find(".squad-delete-confirm").fadeOut("fast",function(){return a.find(".squad-description").fadeIn("fast")}),!e.number_of_selected_squads_to_be_deleted)return e.squad_list_modal.find("div.delete-multiple-squads").hide()}(j)}),j.find("button.confirm-delete-squad").click(function(b){var c;return b.preventDefault(),c=$(b.target),j=c.closest("li"),a=j.data("builder"),j.find(".cancel-delete-squad").fadeOut("fast"),j.find(".confirm-delete-squad").addClass("disabled"),j.find(".confirm-delete-squad").text("Deleting..."),e["delete"](j.data("squad").id,function(a){return a.success?(j.slideUp("fast",function(){return $(j).remove()}),e.number_of_selected_squads_to_be_deleted-=1,e.number_of_selected_squads_to_be_deleted?void 0:e.squad_list_modal.find("div.delete-multiple-squads").hide()):j.html($.trim("Error deleting "+j.data("squad").name+": <em>"+a.error+"</em>"))})})}for(i||b.append($.trim('<li class="translated" defaultText="No saved squads"></li>')),e.squad_list_tags.empty(),s=0,v=d.length;s<v;s++)l=d[s],p=l.toLowerCase().replace(/[^a-z0-9]/g,"").replace(/\s+/g,"-"),e.squad_list_tags.append($.trim(' \n<button class="btn '+p+'">'+l+"</button>")),n=$(e.squad_list_tags.find("."+p)),n.click(function(a){var b,c;return b=$(a.target),c=b.attr("class").replace("btn ","").replace("btn-inverse ",""),e.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),e.squad_list_tags.find(".btn").removeClass("btn-inverse"),b.addClass("btn-inverse"),e.squad_list_modal.find(".squad-list li").each(function(a,b){var d,e,f;if(null!=$(b).data().squad.additional_data.tag){for(m=$(b).data().squad.additional_data.tag.split(","),d=!1,e=0,f=m.length;e<f;e++)l=m[e],c===l.toLowerCase().replace(/[^a-z0-9]/g,"").replace(/\s+/g,"-")&&(d=!0);return d?$(b).show():$(b).hide()}return $(b).hide()})});return exportObj.translateUIElements(b),c.fadeOut("fast"),b.fadeIn("fast")}}(this))},a.prototype.authenticate=function(a){var b;return null==a&&(a=$.noop),b=this.authenticated},a.prototype.maybeAuthenticationChanged=function(a,b){return a!==this.authenticated&&$(window).trigger("xwing-backend:authenticationChanged",[this.authenticated,this]),this.oauth_window=null,this.auth_status.hide(),b(this.authenticated),this.authenticated},a.prototype.login=function(){if(this.ui_ready)return this.login_modal.modal("show")},a.prototype.logout=function(a){return null==a&&(a=$.noop),$(this.auth_status.find(".payload")).text(exportObj.translate("ui","Logging out...")),this.auth_status.show(),$.get(""+this.server+"/auth/logout",function(b){return function(c,d,e){return b.authenticated=!1,$(window).trigger("xwing-backend:authenticationChanged",[b.authenticated,b]),b.auth_status.hide(),a()}}(this))},a.prototype.showSaveAsModal=function(a){return this.save_as_modal.data("builder",a),this.save_as_input.val(a.current_squad.name),this.save_as_save_button.addClass("disabled"),this.nameCheck(),this.save_as_modal.modal("show")},a.prototype.showDeleteModal=function(a){return this.delete_modal.data("builder",a),this.delete_name_container.text(a.current_squad.name),this.delete_modal.modal("show")},a.prototype.nameCheck=function(){var a;return window.clearInterval(this.save_as_modal.data("timer")),a=$.trim(this.save_as_input.val()),0===a.length?(this.name_availability_container.text(""),this.name_availability_container.append($.trim('<i class="fa fa-thumbs-down"></i> '+exportObj.translate("ui","name required")))):$.post(""+this.server+"/squads/namecheck",{name:a},function(a){return function(b){return a.name_availability_container.text(""),b.available?(a.name_availability_container.append($.trim('<i class="fa fa-thumbs-up"></i> '+exportObj.translate("ui","Name is available"))),a.save_as_save_button.removeClass("disabled")):(a.name_availability_container.append($.trim('<i class="fa fa-thumbs-down"></i> '+exportObj.translate("ui","Name in use"))),a.save_as_save_button.addClass("disabled"))}}(this))},a.prototype.warnUnsaved=function(a,b){return this.unsaved_modal.data("builder",a),this.unsaved_modal.data("callback",b),this.unsaved_modal.modal("show")},a.prototype.setupUI=function(){var a;return this.auth_status.addClass("disabled"),this.auth_status.click(function(a){return function(a){return!1}}(this)),this.login_modal=$(document.createElement("DIV")),this.login_modal.addClass("modal fade d-print-none"),this.login_modal.tabindex="-1",this.login_modal.role="dialog",$(document.body).append(this.login_modal),this.login_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="Log in with OAuth"></h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <p>\n                <span class="translated" defaultText="select OAuth provider"></span>\n                <a class="login-help translated" href="#" defaultText="What\'s this?"></a>\n            </p>\n            <div class="well well-small oauth-explanation">\n                <span class="translated" defaultText="OAuth explanation"></span>\n                <button class="btn btn-modal translated" defaultText="Got it!"></button>\n            </div>\n            <ul class="login-providers inline"></ul>\n            <p class="translated" defaultText="Continue to OAuth provider"></p>\n            <p class="translated" defaultText="iOS requires cross-site control"></p>\n            <p class="login-in-progress">\n                <em class="translated" defaultText="login in progress"></em>\n            </p>\n        </div>\n    </div>\n</div>')),a=$(this.login_modal.find(".oauth-explanation")),a.hide(),this.login_modal.find(".login-in-progress").hide(),this.login_modal.find("a.login-help").click(function(b){return function(b){if(b.preventDefault(),!a.is(":visible"))return a.slideDown("fast")}}(this)),a.find("button").click(function(b){return function(b){return b.preventDefault(),a.slideUp("fast")}}(this)),$.get(""+this.server+"/methods",function(a){return function(b,c,d){var e,f,g,h,i,j,k;for(h=$(a.login_modal.find("ul.login-providers")),k=b.methods,i=0,j=k.length;i<j;i++)g=k[i],e=$(document.createElement("A")),e.addClass("btn btn-modal"),e.data("url",""+a.server+"/auth/"+g),e.append('<i class="'+a.method_metadata[g].icon+'"></i>&nbsp;'+a.method_metadata[g].text),e.click(function(b){return b.preventDefault(),h.slideUp("fast"),a.login_modal.find(".login-in-progress").slideDown("fast"),a.oauth_window=window.open($(b.target).data("url"),"xwing_login")}),f=$(document.createElement("LI")),f.append(e),h.append(f);return a.ui_ready=!0}}(this)),exportObj.translateUIElements(this.login_modal),this.reload_done_modal=$(document.createElement("DIV")),this.reload_done_modal.addClass("modal fade d-print-none"),this.reload_done_modal.tabindex="-1",this.reload_done_modal.role="dialog",$(document.body).append(this.reload_done_modal),this.reload_done_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3>Reload Done</h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <p class="translated" defaultText="Squads reloaded"></p>\n        </div>\n        <div class="modal-footer">\n            <button class="btn btn-modal btn-primary translated" aria-hidden="true" data-dismiss="modal" defaultText="Well done!"></button>\n        </div>\n    </div>\n</div>')),exportObj.translateUIElements(this.reload_done_modal),this.squad_list_modal=$(document.createElement("DIV")),this.squad_list_modal.addClass("modal fade d-print-none squad-list"),this.squad_list_modal.tabindex="-1",this.squad_list_modal.role="dialog",$(document.body).append(this.squad_list_modal),this.squad_list_modal.append($.trim('<div class="modal-dialog modal-lg modal-dialog-scrollable modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="squad-list-header-placeholder d-none d-lg-block"></h3>\n            <h4 class="squad-list-header-placeholder d-lg-none"></h4>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <ul class="squad-list"></ul>\n            <p class="pagination-centered squad-list-loading">\n                <i class="fa fa-spinner fa-spin fa-3x"></i>\n                <br />\n                <span class="translated" defaultText="Fetching squads..."></span>\n            </p>\n        </div>\n        <div class="modal-footer">\n            <div class="btn-group delete-multiple-squads full-row">\n                <button class="btn btn-modal select-all translated" defaultText="Select All"></button>\n                <button class="btn btn-modal archive-selected translated" defaultText="Archive Selected"></button>\n                <button class="btn btn-modal btn-danger delete-selected translated" defaultText="Delete Selected"></button>\n            </div>\n            <div class="btn-group squad-display-mode full-row">\n                <button class="btn btn-modal btn-inverse show-all-squads translated" defaultText="All"></button>\n                <button class="btn btn-modal show-standard-squads"><span class="d-none d-lg-block translated" defaultText="Standard"></span><span class="d-lg-none translated" defaultText="Hyper"></span></button>\n                <button class="btn btn-modal show-extended-squads"><span class="d-none d-lg-block translated" defaultText="Extended"></span><span class="d-lg-none translated" defaultText="Ext"></span></button>\n                <button class="btn btn-modal show-quickbuild-squads"><span class="d-none d-lg-block translated" defaultText="Quickbuild"></span><span class="d-lg-none translated" defaultText="QB"></span></button>\n                <button class="btn btn-modal show-epic-squads translated" defaultText="Epic"></button>\n                <button class="btn btn-modal show-archived-squads translated" defaultText="Archived"></button>\n                <button class="btn btn-modal reload-all translated" defaultText="Recalculate Points"></button>\n            </div>\n            <div class="btn-group tags-display full-row">\n            </div>\n        </div>\n    </div>\n</div>')),this.squad_list_modal.find("ul.squad-list").hide(),this.squad_list_tags=$(this.squad_list_modal.find("div.tags-display")),this.squad_list_modal.find("div.delete-multiple-squads").hide(),exportObj.translateUIElements(this.squad_list_modal),this.delete_selected_button=$(this.squad_list_modal.find("button.delete-selected")),this.delete_selected_button.click(function(a){return function(b){var c,d,e,f,g,h;for(d=a.squad_list_modal.find("ul.squad-list"),g=d.find("li"),h=[],e=0,f=g.length;e<f;e++)c=g[e],c=$(c),c.data("selectedForDeletion")?h.push(function(b){return b.find(".cancel-delete-squad").fadeOut("fast"),b.find(".confirm-delete-squad").addClass("disabled"),b.find(".confirm-delete-squad").text(exportObj.translate("ui","Deleting...")),a["delete"](b.data("squad").id,function(c){return c.success?(b.slideUp("fast",function(){return $(b).remove()}),a.number_of_selected_squads_to_be_deleted-=1,a.number_of_selected_squads_to_be_deleted?void 0:a.squad_list_modal.find("div.delete-multiple-squads").hide()):b.html($.trim("Error deleting "+b.data("squad").name+": <em>"+c.error+"</em>"))})}(c)):h.push(void 0);return h}}(this)),this.archive_selected_button=$(this.squad_list_modal.find("button.archive-selected")),this.archive_selected_button.click(function(a){return function(b){var c,d,e,f,g,h;for(d=a.squad_list_modal.find("ul.squad-list"),g=d.find("li"),h=[],e=0,f=g.length;e<f;e++)c=g[e],c=$(c),c.data("selectedForDeletion")?h.push(function(b){return b.find(".confirm-delete-squad").addClass("disabled"),b.find(".confirm-delete-squad").text(exportObj.translate("ui","Archiving...")),a.archive(b.data("squad"),b.data("builder").faction,function(c){return c.success?(b.slideUp("fast",function(){return $(b).hide(),$(b).find(".confirm-delete-squad").removeClass("disabled"),$(b).find(".confirm-delete-squad").text(exportObj.translate("ui","Delete")),$(b).data("selectedForDeletion",!1),$(b).find(".squad-delete-confirm").fadeOut("fast",function(){return $(b).find(".squad-description").fadeIn("fast")})}),a.number_of_selected_squads_to_be_deleted-=1,a.number_of_selected_squads_to_be_deleted?void 0:a.squad_list_modal.find("div.delete-multiple-squads").hide()):b.html($.trim("Error archiving "+b.data("squad").name+": <em>"+c.error+"</em>"))})}(c)):h.push(void 0);return h}}(this)),this.squad_list_modal.find("button.reload-all").click(function(a){return function(b){var c,d,e,f,g,h,i,j;for(g=a.squad_list_modal.find("ul.squad-list"),f=[function(){return a.reload_done_modal.modal("show")}],e=[],j=g.find("li"),h=0,i=j.length;h<i;h++)d=j[h],d=$(d),e.push(d.data("squad")),c=d.data("builder"),f.push(function(){var b;return b=e.pop(),c.container.trigger("xwing-backend:squadLoadRequested",[b,function(){var b;return b={points:c.total_points,description:c.describeSquad(),cards:c.listCards(),notes:c.notes.val().substr(0,1024),obstacles:c.getObstacles(),tag:c.tag.val().substr(0,1024)},a.save(c.serialize(),c.current_squad.id,c.current_squad.name,c.faction,b,f.pop())}])});return a.squad_list_modal.modal("hide"),c.current_squad.dirty?a.warnUnsaved(c,f.pop()):f.pop()()}}(this)),this.select_all_button=$(this.squad_list_modal.find("button.select-all")),this.select_all_button.click(function(a){return function(b){var c,d,e,f,g,h;for(d=a.squad_list_modal.find("ul.squad-list"),g=d.find("li"),h=[],e=0,f=g.length;e<f;e++)c=g[e],c=$(c),c.data("selectedForDeletion")?h.push(void 0):(c.data("selectedForDeletion",!0),function(a){return a.find(".squad-description").fadeOut("fast",function(){return a.find(".squad-delete-confirm").fadeIn("fast")})}(c),h.push(a.number_of_selected_squads_to_be_deleted+=1));return h}}(this)),this.show_all_squads_button=$(this.squad_list_modal.find(".show-all-squads")),this.show_all_squads_button.click(function(a){return function(b){if("all"!==a.squad_display_mode)return a.squad_display_mode="all",a.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),a.squad_list_tags.find(".btn").removeClass("btn-inverse"),a.show_all_squads_button.addClass("btn-inverse"),a.squad_list_modal.find(".squad-list li").show()}}(this)),this.show_extended_squads_button=$(this.squad_list_modal.find(".show-extended-squads")),this.show_extended_squads_button.click(function(a){return function(b){if("extended"!==a.squad_display_mode)return a.squad_display_mode="extended",a.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),a.squad_list_tags.find(".btn").removeClass("btn-inverse"),a.show_extended_squads_button.addClass("btn-inverse"),a.squad_list_modal.find(".squad-list li").each(function(a,b){return $(b).toggle($(b).data().squad.serialized.search(/v\d+Zs/)!==-1)})}}(this)),this.show_epic_squads_button=$(this.squad_list_modal.find(".show-epic-squads")),this.show_epic_squads_button.click(function(a){return function(b){if("epic"!==a.squad_display_mode)return a.squad_display_mode="epic",a.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),a.squad_list_tags.find(".btn").removeClass("btn-inverse"),a.show_epic_squads_button.addClass("btn-inverse"),a.squad_list_modal.find(".squad-list li").each(function(a,b){return $(b).toggle($(b).data().squad.serialized.search(/v\d+Ze/)!==-1)})}}(this)),this.show_standard_squads_button=$(this.squad_list_modal.find(".show-standard-squads")),this.show_standard_squads_button.click(function(a){return function(b){if("standard"!==a.squad_display_mode)return a.squad_display_mode="standard",a.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),a.squad_list_tags.find(".btn").removeClass("btn-inverse"),a.show_standard_squads_button.addClass("btn-inverse"),a.squad_list_modal.find(".squad-list li").each(function(a,b){return $(b).toggle($(b).data().squad.serialized.search(/v\d+Zh/)!==-1)})}}(this)),this.show_quickbuild_squads_button=$(this.squad_list_modal.find(".show-quickbuild-squads")),this.show_quickbuild_squads_button.click(function(a){return function(b){if("quickbuild"!==a.squad_display_mode)return a.squad_display_mode="quickbuild",a.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),a.squad_list_tags.find(".btn").removeClass("btn-inverse"),a.show_quickbuild_squads_button.addClass("btn-inverse"),a.squad_list_modal.find(".squad-list li").each(function(a,b){return $(b).toggle($(b).data().squad.serialized.search(/v\d+Zq/)!==-1)})}}(this)),this.show_archived_squads_button=$(this.squad_list_modal.find(".show-archived-squads")),this.show_archived_squads_button.click(function(a){return function(b){return a.show_archived=!a.show_archived,a.show_archived?a.show_archived_squads_button.addClass("btn-inverse"):a.show_archived_squads_button.removeClass("btn-inverse"),a.squad_list_tags.find(".btn").removeClass("btn-inverse"),a.squad_list_modal.find(".squad-list li").each(function(b,c){return $(c).toggle(null!=$(c).data().squad.additional_data.archived===a.show_archived)})}}(this)),this.save_as_modal=$(document.createElement("DIV")),this.save_as_modal.addClass("modal fade d-print-none"),this.save_as_modal.tabindex="-1",this.save_as_modal.role="dialog",$(document.body).append(this.save_as_modal),this.save_as_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="Save Squad As..."></h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <label for="xw-be-squad-save-as">\n                <span class="translated" defaultText="New Squad Name"></span>\n                <input id="xw-be-squad-save-as"></input>\n            </label>\n            <span class="name-availability"></span>\n        </div>\n        <div class="modal-footer">\n            <button class="btn btn-primary save translated" aria-hidden="true" defaultText="Save"></button>\n        </div>\n    </div>\n</div>')),this.save_as_modal.on("shown",function(a){return function(){return window.setTimeout(function(){return a.save_as_input.focus(),a.save_as_input.select()},100)}}(this)),this.save_as_save_button=this.save_as_modal.find("button.save"),this.save_as_save_button.click(function(a){return function(b){var c,d,e,f;if(b.preventDefault(),!a.save_as_save_button.hasClass("disabled"))return f=a.save_as_modal.data("timer"),null!=f&&window.clearInterval(f),a.save_as_modal.modal("hide"),d=a.save_as_modal.data("builder"),c={points:d.total_points,description:d.describeSquad(),cards:d.listCards(),notes:d.getNotes(),obstacles:d.getObstacles(),tag:d.getTag()},d.backend_save_list_as_button.addClass("disabled"),d.backend_status.html($.trim('<i class="fa fa-sync fa-spin"></i>&nbsp;'+exportObj.translate("ui","Saving squad..."))),d.backend_status.show(),e=$.trim(a.save_as_input.val()),a.save(d.serialize(),null,e,d.faction,c,function(a){return a.success?(d.current_squad.id=a.id,d.current_squad.name=e,d.current_squad.dirty=!1,d.container.trigger("xwing-backend:squadNameChanged"),d.container.trigger("xwing-backend:squadDirtinessChanged"),d.backend_status.html($.trim('<i class="fa fa-check"></i>&nbsp;'+exportObj.translate("ui","New squad saved successfully.")))):d.backend_status.html($.trim('<i class="fa fa-exclamation-circle"></i>&nbsp;'+a.error)),d.backend_save_list_as_button.removeClass("disabled")})}}(this)),this.save_as_input=$(this.save_as_modal.find("input")),this.save_as_input.keypress(function(a){return function(b){var c;return 13===b.which?(a.save_as_save_button.click(),!1):(a.name_availability_container.text(""),a.name_availability_container.append($.trim('<i class="fa fa-spin fa-spinner"></i> '+exportObj.translate("ui","Checking name availability..."))),c=a.save_as_modal.data("timer"),null!=c&&window.clearInterval(c),a.save_as_modal.data("timer",window.setInterval(a.nameCheck,500)))}}(this)),this.name_availability_container=$(this.save_as_modal.find(".name-availability")),exportObj.translateUIElements(this.squad_list_modal),this.delete_modal=$(document.createElement("DIV")),this.delete_modal.addClass("modal fade d-print-none"),this.delete_modal.tabindex="-1",this.delete_modal.role="dialog",$(document.body).append(this.delete_modal),this.delete_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3><span class="translated" defaultText="Really Delete"></span> <span class="squad-name-placeholder"></span>?</h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <p class="translated" defaultText="Sure to delete?"></p>\n        </div>\n        <div class="modal-footer">\n            <button class="btn btn-danger delete" aria-hidden="true"><span class="translated" defaultText="Yes, Delete"></span> <i class="squad-name-placeholder"></i></button>\n            <button class="btn btn-modal translated" data-dismiss="modal" aria-hidden="true" defaultText="Never Mind"></button>\n        </div>\n    </div>\n</div>')),this.delete_name_container=$(this.delete_modal.find(".squad-name-placeholder")),this.delete_button=$(this.delete_modal.find("button.delete")),this.delete_button.click(function(a){return function(b){var c;return b.preventDefault(),c=a.delete_modal.data("builder"),c.backend_status.html($.trim('<i class="fa fa-sync fa-spin"></i>&nbsp;'+exportObj.translate("ui","Deleting squad..."))),c.backend_status.show(),c.backend_delete_list_button.addClass("disabled"),a.delete_modal.modal("hide"),a["delete"](c.current_squad.id,function(a){return a.success?(c.resetCurrentSquad(),c.current_squad.dirty=!0,c.container.trigger("xwing-backend:squadDirtinessChanged"),c.backend_status.html($.trim('<i class="fa fa-check"></i>&nbsp;'+exportObj.translate("ui","Squad deleted.")))):(c.backend_status.html($.trim('<i class="fa fa-exclamation-circle"></i>&nbsp;'+a.error)),c.backend_delete_list_button.removeClass("disabled"))})}}(this)),exportObj.translateUIElements(this.delete_modal),this.unsaved_modal=$(document.createElement("DIV")),this.unsaved_modal.addClass("modal fade d-print-none"),this.unsaved_modal.tabindex="-1",this.unsaved_modal.role="dialog",$(document.body).append(this.unsaved_modal),this.unsaved_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="Unsaved Changes"></h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <p class="translated" defaultText="Unsaved Changes Warning"></p>\n        </div>\n        <div class="modal-footer">\n            <button class="btn btn-modal btn-primary translated" aria-hidden="true" data-dismiss="modal" defaultText="Go Back"></button>\n            <button class="btn btn-danger discard translated" aria-hidden="true" defaultText="Discard Changes"></button>\n        </div>\n    </div>\n</div>')),
this.unsaved_discard_button=$(this.unsaved_modal.find("button.discard")),this.unsaved_discard_button.click(function(a){return function(b){return b.preventDefault(),a.unsaved_modal.data("builder").current_squad.dirty=!1,a.unsaved_modal.data("callback")(),a.unsaved_modal.modal("hide")}}(this)),exportObj.translateUIElements(this.unsaved_modal)},a.prototype.setupHandlers=function(){return $(window).on("xwing-backend:authenticationChanged",function(a){return function(b,c,d){if(a.updateAuthenticationVisibility(),c)return a.loadCollection()}}(this)),this.login_logout_button.click(function(a){return function(b){return b.preventDefault(),a.authenticated?a.logout():a.login()}}(this)),$(window).on("message",function(a){return function(b){var c,d,e;if(c=b.originalEvent,c.origin!==a.server)return console.log("Message received from unapproved origin "+c.origin),window.last_ev=b;switch(null!=(d=c.data)?d.command:void 0){case"auth_successful":return a.authenticate(),a.login_modal.modal("hide"),a.login_modal.find(".login-in-progress").hide(),a.login_modal.find("ul.login-providers").show(),c.source.close();default:return console.log("Unexpected command "+(null!=(e=c.data)?e.command:void 0))}}}(this)).on("xwing-collection:changed",function(a){return function(b,c){return null!=a.collection_save_timer&&clearTimeout(a.collection_save_timer),a.collection_save_timer=setTimeout(function(){return a.saveCollection(c,function(a){if(a)return $(window).trigger("xwing-collection:saved",c)})},1e3)}}(this))},a.prototype.getSettings=function(a){return null==a&&(a=$.noop),$.get(""+this.server+"/settings").done(function(b){return function(b,c,d){return a(b.settings)}}(this))},a.prototype.set=function(a,b,c){var d;return null==c&&(c=$.noop),d={_method:"PUT"},d[a]=b,$.post(""+this.server+"/settings",d).done(function(a){return function(a,b,d){return c(a.set)}}(this))},a.prototype.deleteSetting=function(a,b){return null==b&&(b=$.noop),$.post(""+this.server+"/settings/"+a,{_method:"DELETE"}).done(function(a){return function(a,c,d){return b(a.deleted)}}(this))},a.prototype.getHeaders=function(a){return null==a&&(a=$.noop),$.get(""+this.server+"/headers").done(function(b){return function(b,c,d){return a(b.headers)}}(this))},a.prototype.getLanguagePreference=function(a,b){var c,d,e,f,g,h,i,j;return j=__iced_k_noop,h=iced.findDeferral(arguments),null==b&&(b=$.noop),null!=(null!=a?a.language:void 0)?j(b(a.language,10)):void!function(a){return function(b){i=new iced.Deferrals(b,{parent:h,funcname:"SquadBuilderBackend.getLanguagePreference"}),a.getHeaders(i.defer({assign_fn:function(){return function(){return c=arguments[0]}}(),lineno:945})),i._fulfill()}}(this)(function(a){return function(){var a,h,i,k;if(null!=("undefined"!=typeof c&&null!==c?c.HTTP_ACCEPT_LANGUAGE:void 0))for(i=c.HTTP_ACCEPT_LANGUAGE.split(","),a=0,h=i.length;a<h;a++){e=i[a],k=e.split(";"),f=k[0],g=k[1],"*"===f?b("English",-.5):(d=f.split("-")[0],d in exportObj.codeToLanguage?b(exportObj.codeToLanguage[d],8):b("English",-1));break}else b("English",-1);return j()}}(this))},a.prototype.getCollectionCheck=function(a,b){return null==b&&(b=$.noop),null!=(null!=a?a.collectioncheck:void 0)?b(a.collectioncheck):(this.collectioncheck=!0,b(!0))},a.prototype.saveCollection=function(a,b){var c;return null==b&&(b=$.noop),c={expansions:a.expansions,singletons:a.singletons,checks:a.checks},$.post(""+this.server+"/collection",c).done(function(a,c,d){return b(a.success)})},a.prototype.loadCollection=function(){return $.get(""+this.server+"/collection").done(function(a,b,c){var d;return d=a.collection,new exportObj.Collection({expansions:d.expansions,singletons:d.singletons,checks:d.checks})})},a}(),exportObj="undefined"!=typeof exports&&null!==exports?exports:this,TYPES=["pilots","upgrades","ships"],byName=function(a,b){var c,d;return c=a.display_name?a.display_name.toLowerCase().replace(/[^a-zA-Z0-9]/g,""):a.name.toLowerCase().replace(/[^a-zA-Z0-9]/g,""),d=b.display_name?b.display_name.toLowerCase().replace(/[^a-zA-Z0-9]/g,""):b.name.toLowerCase().replace(/[^a-zA-Z0-9]/g,""),c<d?-1:d<c?1:0},byPoints=function(a,b){return a.data.points<b.data.points?-1:b.data.points<a.data.points?1:byName(a,b)},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},exportObj.CardBrowser=function(){function a(a){var b;this.container=$(a.container),this.currently_selected=null,this.language=null!=(b=exportObj.currentLanguage)?b:"English",this.prepareData(),this.setupUI(),this.setupHandlers()}return a.prototype.setupUI=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;this.container.append($.trim('<div class="container-fluid xwing-card-browser">\n    <div class="row">\n        <div class="col-md-4">\n            <div class="card card-search-container">\n            <h5 class="card-title translated" defaultText="Card Search"></h5>\n                <div class="advanced-search-container">\n                    <div class = "card search-container general-search-container">\n                        <h6 class="card-subtitle mb-3 text-muted version translated" defaultText="General"></h6>\n                        <label class = "text-search advanced-search-label">\n                        <strong class="translated" defaultText="Textsearch:"></strong>\n                            <input type="search" placeholder="'+exportObj.translate("ui","Placeholder Textsearch Browser")+'" class = "card-search-text">\n                        </label>\n                        <div class= "advanced-search-faction-selection-container">\n                            <label class = "advanced-search-label select-available-slots">\n                                <strong class="translated" defaultText="Factions:"></strong>\n                                <select class="advanced-search-selection faction-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","All factions")+'"></select>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-point-selection-container">\n                            <strong class="translated" defaultText="Point cost:"></strong>\n                            <label class = "advanced-search-label set-minimum-points">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-point-cost advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-points">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-point-cost advanced-search-number-input" value="20" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-loadout-selection-container">\n                            <strong class="translated" defaultText="Loadout cost:"></strong>\n                            <label class = "advanced-search-label set-minimum-loadout">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-loadout-cost advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-loadout">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-loadout-cost advanced-search-number-input" value="99" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-collection-container">\n                            <strong class="translated" defaultText="Owned copies:"></strong>\n                            <label class = "advanced-search-label set-minimum-owned-copies">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-owned-copies advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-owened-copies">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-owned-copies advanced-search-number-input" value="99" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-misc-container">\n                            <strong class="translated" defaultText="Misc:"></strong>\n                            <label class = "advanced-search-label toggle-unique">\n                                <input type="checkbox" class="unique-checkbox advanced-search-checkbox" /> <span class="translated" defaultText="Is unique"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-non-unique">\n                                <input type="checkbox" class="non-unique-checkbox advanced-search-checkbox" /> <span class="translated" defaultText="Is not unique"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-standard">\n                                <input type="checkbox" class="standard-checkbox advanced-search-checkbox" />  <span class="translated" defaultText="Standard legal"></span>\n                            </label>\n                        </div>\n                    </div>\n                    <div class = "card search-container ship-search-container">\n                        <h6 class="card-subtitle mb-3 text-muted version translated" defaultText="Ships and Pilots"></h6>\n                        <div class = "advanced-search-slot-available-container">\n                            <label class = "advanced-search-label select-available-slots">\n                                <strong class="translated" defaultText="Slots:"></strong>\n                                <select class="advanced-search-selection slot-available-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","slots")+'"></select>\n                            </label>\n                            <br />\n                            <label class = "advanced-search-label toggle-unique">\n                                <input type="checkbox" class="duplicate-slots-checkbox advanced-search-checkbox" /> '+exportObj.translate("ui","Has multiple of the chosen slots")+'\n                            </label>\n                        </div>\n                        <div class = "advanced-search-keyword-available-container">\n                            <label class = "advanced-search-label select-available-keywords">\n                                <strong class="translated" defaultText="Keywords:"></strong>\n                                <select class="advanced-search-selection keyword-available-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","keywords")+'"></select>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-actions-available-container">\n                            <label class = "advanced-search-label select-available-actions">\n                                <strong class="translated" defaultText="Actions:"></strong>\n                                <select class="advanced-search-selection action-available-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","actions")+'"></select>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-linkedactions-available-container">\n                            <label class = "advanced-search-label select-available-linkedactions">\n                                <strong class="translated" defaultText="Linked actions:"></strong>\n                                <select class="advanced-search-selection linkedaction-available-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","actions")+'"></select>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-ini-container">\n                            <strong class="translated" defaultText="Initiative:"></strong>\n                            <label class = "advanced-search-label set-minimum-ini">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-ini advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-ini">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-ini advanced-search-number-input" value="6" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-hull-container">\n                            <strong class="translated" defaultText="Hull:"></strong>\n                            <label class = "advanced-search-label set-minimum-hull">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-hull advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-hull">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-hull advanced-search-number-input" value="12" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-shields-container">\n                            <strong class="translated" defaultText="Shields:"></strong>\n                            <label class = "advanced-search-label set-minimum-shields">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-shields advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-shields">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-shields advanced-search-number-input" value="6" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-agility-container">\n                            <strong class="translated" defaultText="Agility:"></strong>\n                            <label class = "advanced-search-label set-minimum-agility">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-agility advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-agility">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-agility advanced-search-number-input" value="3" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-base-size-container">\n                            <strong class="translated" defaultText="Base size:"></strong>\n                            <label class = "advanced-search-label toggle-small-base">\n                                <input type="checkbox" class="small-base-checkbox advanced-search-checkbox" checked="checked"/> <span class="translated" defaultText="Small"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-medium-base">\n                                <input type="checkbox" class="medium-base-checkbox advanced-search-checkbox" checked="checked"/> <span class="translated" defaultText="Medium"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-large-base">\n                                <input type="checkbox" class="large-base-checkbox advanced-search-checkbox" checked="checked"/> <span class="translated" defaultText="Large"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-large-base">\n                                <input type="checkbox" class="huge-base-checkbox advanced-search-checkbox" checked="checked"/> <span class="translated" defaultText="Huge"></span>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-attack-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-frontarc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attack">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attack advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attack">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attack advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-attackt-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-singleturretarc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attackt">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackt advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attackt">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackt advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-attackdt-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-doubleturretarc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attackdt">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackdt advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attackdt">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackdt advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-attackf-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-fullfrontarc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attackf">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackf advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attackf">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackf advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-attackb-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-reararc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attackb">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackb advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attackb">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackb advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-attackbull-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-bullseyearc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attackbull">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackbull advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attackbull">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackbull advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                    </div>\n                    <div class = "card search-container other-stuff-search-container">\n                        <h6 class="card-subtitle mb-3 text-muted version translated" defaultText="Other Stuff"></h6>\n                        <div class = "advanced-search-slot-used-container">\n                            <label class = "advanced-search-label select-used-slots">\n                                <strong class="translated" defaultText="Used slot:"></strong>\n                                <select class="advanced-search-selection slot-used-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","slots")+'"></select>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-slot-used-second-slot-container">\n                            <label class = "advanced-search-label select-used-second-slots">\n                                <strong class="translated" defaultText="Used double-slot:"></strong>\n                                <select class="advanced-search-selection slot-used-second-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","slots")+'"></select>\n                            </label>\n                            <br />\n                            <label class = "advanced-search-label has-a-second-slot">\n                                <input type="checkbox" class="advanced-search-checkbox has-a-second-slot-checkbox" /> <span class="translated" defaultText="Only upgrades requiring multiple slots"></span>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-charge-container">\n                            <strong class="translated" defaultText="Charges:"></strong>\n                            <label class = "advanced-search-label set-minimum-charge">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-charge advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-charge">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-charge advanced-search-number-input" value="5" /> \n                            </label>\n                            <br />\n                            <label class = "advanced-search-label has-recurring-charge">\n                                <input type="checkbox" class="advanced-search-checkbox has-recurring-charge-checkbox" checked="checked"/> <span class="translated" defaultText="Recurring"></span>\n                            </label>\n                            <label class = "advanced-search-label has-not-recurring-charge">\n                                <input type="checkbox" class="advanced-search-checkbox has-not-recurring-charge-checkbox" checked="checked"/> <span class="translated" defaultText="Not recurring"></span>\n                            </label>\n                        <div class = "advanced-search-force-container">\n                            <strong class="translated" defaultText="Force:"></strong>\n                            <label class = "advanced-search-label set-minimum-force">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-force advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-force">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-force advanced-search-number-input" value="3" /> \n                            </label>\n                        </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="col-md-4 card-selecting-area">\n            <span class="translate sort-cards-by" defaultText="Sort cards by"></span><span class="translated" defaultText="Sort by">:</span> <select class="sort-by">\n                <option value="name" class="translated" defaultText="Name"></option>\n                <option value="source" class="translated" defaultText="Source"></option>\n                <option value="type-by-points" class="translated" defaultText="Type (by Points)"></option>\n                <option value="type-by-name" selected="1" class="translated" defaultText="Type (by Name)" selected="selected">'+exportObj.translate("ui","Type (by Name)")+'</option>\n            </select>\n            <div class="card-selector-container">\n\n            </div>\n            <br>\n            <div class="card-viewer-conditions-container">\n            </div>\n        </div>\n        <div class="col-md-4">\n            <div class="card-viewer-container">\n            </div>\n        </div>\n    </div>\n</div>')),this.card_selector_container=$(this.container.find(".xwing-card-browser .card-selector-container")),this.card_viewer_container=$(this.container.find(".xwing-card-browser .card-viewer-container")),this.card_viewer_container.append($.trim(exportObj.builders[7].createInfoContainerUI(!1))),this.card_viewer_container.hide(),this.card_viewer_conditions_container=$(this.container.find(".xwing-card-browser .card-viewer-conditions-container")),this.card_viewer_conditions_container.hide(),this.advanced_search_container=$(this.container.find(".xwing-card-browser .advanced-search-container")),this.sort_selector=$(this.container.find("select.sort-by")),this.sort_selector.select2({minimumResultsForSearch:-1}),this.card_search_text=$(this.container.find(".xwing-card-browser .card-search-text"))[0],this.faction_selection=$(this.container.find(".xwing-card-browser select.faction-selection")),u=exportObj.pilotsByFactionXWS;for(b in u)k=u[b],j=$(document.createElement("OPTION")),j.val(b),j.text(exportObj.translate("faction",b)),this.faction_selection.append(j);c=$(document.createElement("OPTION")),c.val("Factionless"),c.text(exportObj.translate("faction","Factionless")),this.faction_selection.append(c),this.faction_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.minimum_point_costs=$(this.container.find(".xwing-card-browser .minimum-point-cost"))[0],this.maximum_point_costs=$(this.container.find(".xwing-card-browser .maximum-point-cost"))[0],this.minimum_loadout_costs=$(this.container.find(".xwing-card-browser .minimum-loadout-cost"))[0],this.maximum_loadout_costs=$(this.container.find(".xwing-card-browser .maximum-loadout-cost"))[0],this.standard_checkbox=$(this.container.find(".xwing-card-browser .standard-checkbox"))[0],this.unique_checkbox=$(this.container.find(".xwing-card-browser .unique-checkbox"))[0],this.non_unique_checkbox=$(this.container.find(".xwing-card-browser .non-unique-checkbox"))[0],this.base_size_checkboxes={huge:$(this.container.find(".xwing-card-browser .huge-base-checkbox"))[0],large:$(this.container.find(".xwing-card-browser .large-base-checkbox"))[0],medium:$(this.container.find(".xwing-card-browser .medium-base-checkbox"))[0],small:$(this.container.find(".xwing-card-browser .small-base-checkbox"))[0]},this.slot_available_selection=$(this.container.find(".xwing-card-browser select.slot-available-selection"));for(l in exportObj.upgradesBySlotCanonicalName)j=$(document.createElement("OPTION")),j.val(l),j.text(exportObj.translate("slot",l)),this.slot_available_selection.append(j);this.slot_available_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.keyword_available_selection=$(this.container.find(".xwing-card-browser select.keyword-available-selection")),g=[];for(h in exportObj.pilotsByKeyword)for(f=h.split(","),m=0,q=f.length;m<q;m++)d=f[m],g.indexOf(d)<0&&"undefined"!==d&&g.push(d);for(g.sort(),n=0,r=g.length;n<r;n++)e=g[n],j=$(document.createElement("OPTION")),j.val(e),j.text(exportObj.translate("keyword",e)),this.keyword_available_selection.append(j);for(this.keyword_available_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.duplicateslots=$(this.container.find(".xwing-card-browser .duplicate-slots-checkbox"))[0],this.action_available_selection=$(this.container.find(".xwing-card-browser select.action-available-selection")),v=["Evade","Focus","Lock","Boost","Barrel Roll","Calculate","Reinforce","Rotate Arc","Coordinate","Slam","Reload","Jam","Cloak"].sort(),o=0,s=v.length;o<s;o++)a=v[o],j=$(document.createElement("OPTION")),j.text(exportObj.translate("action",a)),j.val(a),this.action_available_selection.append(j);for(this.action_available_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.linkedaction_available_selection=$(this.container.find(".xwing-card-browser select.linkedaction-available-selection")),w=["Evade","Focus","Lock","Boost","Barrel Roll","Calculate","Reinforce","Rotate Arc","Coordinate","Slam","Reload","Jam","Cloak"].sort(),p=0,t=w.length;p<t;p++)i=w[p],j=$(document.createElement("OPTION")),j.text(exportObj.translate("action",i)),j.val(i),this.linkedaction_available_selection.append(j);this.linkedaction_available_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.slot_used_selection=$(this.container.find(".xwing-card-browser select.slot-used-selection"));for(l in exportObj.upgradesBySlotCanonicalName)j=$(document.createElement("OPTION")),j.text(exportObj.translate("slot",l)),j.val(l),this.slot_used_selection.append(j);this.slot_used_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.slot_used_second_selection=$(this.container.find(".xwing-card-browser select.slot-used-second-selection"));for(l in exportObj.upgradesBySlotCanonicalName)j=$(document.createElement("OPTION")),j.text(exportObj.translate("slot",l)),j.val(l),this.slot_used_second_selection.append(j);return this.slot_used_second_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.minimum_charge=$(this.container.find(".xwing-card-browser .minimum-charge"))[0],this.maximum_charge=$(this.container.find(".xwing-card-browser .maximum-charge"))[0],this.minimum_ini=$(this.container.find(".xwing-card-browser .minimum-ini"))[0],
this.maximum_ini=$(this.container.find(".xwing-card-browser .maximum-ini"))[0],this.minimum_force=$(this.container.find(".xwing-card-browser .minimum-force"))[0],this.maximum_force=$(this.container.find(".xwing-card-browser .maximum-force"))[0],this.minimum_hull=$(this.container.find(".xwing-card-browser .minimum-hull"))[0],this.maximum_hull=$(this.container.find(".xwing-card-browser .maximum-hull"))[0],this.minimum_shields=$(this.container.find(".xwing-card-browser .minimum-shields"))[0],this.maximum_shields=$(this.container.find(".xwing-card-browser .maximum-shields"))[0],this.minimum_agility=$(this.container.find(".xwing-card-browser .minimum-agility"))[0],this.maximum_agility=$(this.container.find(".xwing-card-browser .maximum-agility"))[0],this.minimum_attack=$(this.container.find(".xwing-card-browser .minimum-attack"))[0],this.maximum_attack=$(this.container.find(".xwing-card-browser .maximum-attack"))[0],this.minimum_attackt=$(this.container.find(".xwing-card-browser .minimum-attackt"))[0],this.maximum_attackt=$(this.container.find(".xwing-card-browser .maximum-attackt"))[0],this.minimum_attackdt=$(this.container.find(".xwing-card-browser .minimum-attackdt"))[0],this.maximum_attackdt=$(this.container.find(".xwing-card-browser .maximum-attackdt"))[0],this.minimum_attackf=$(this.container.find(".xwing-card-browser .minimum-attackf"))[0],this.maximum_attackf=$(this.container.find(".xwing-card-browser .maximum-attackf"))[0],this.minimum_attackb=$(this.container.find(".xwing-card-browser .minimum-attackb"))[0],this.maximum_attackb=$(this.container.find(".xwing-card-browser .maximum-attackb"))[0],this.minimum_attackbull=$(this.container.find(".xwing-card-browser .minimum-attackbull"))[0],this.maximum_attackbull=$(this.container.find(".xwing-card-browser .maximum-attackbull"))[0],this.hassecondslot=$(this.container.find(".xwing-card-browser .has-a-second-slot-checkbox"))[0],this.recurring_charge=$(this.container.find(".xwing-card-browser .has-recurring-charge-checkbox"))[0],this.not_recurring_charge=$(this.container.find(".xwing-card-browser .has-not-recurring-charge-checkbox"))[0],this.minimum_owned_copies=$(this.container.find(".xwing-card-browser .minimum-owned-copies"))[0],this.maximum_owned_copies=$(this.container.find(".xwing-card-browser .maximum-owned-copies"))[0],exportObj.translateUIElements(this.container)},a.prototype.setupHandlers=function(){var a,b,c;this.sort_selector.change(function(a){return function(b){return a.renderList(a.sort_selector.val())}}(this)),$("#browserTab").on("click",function(a){return function(b){return a.renderList(a.sort_selector.val())}}(this)),$(window).on("xwing:afterLanguageLoad",function(a){return function(b,c,d){return null==d&&(d=$.noop),a.language=c,a.prepareData()}}(this)).on("xwing-collection:created",function(a){return function(b,c){return a.collection=c}}(this)).on("xwing-collection:destroyed",function(a){return function(b,c){return a.collection=null}}(this)),this.card_search_text.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.faction_selection[0].onchange=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),c=this.base_size_checkboxes;for(a in c)b=c[a],b.onclick=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this);return this.minimum_point_costs.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.maximum_point_costs.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.minimum_loadout_costs.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.maximum_loadout_costs.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.standard_checkbox.onclick=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.unique_checkbox.onclick=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.non_unique_checkbox.onclick=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.slot_available_selection[0].onchange=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.keyword_available_selection[0].onchange=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.duplicateslots.onclick=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.action_available_selection[0].onchange=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.linkedaction_available_selection[0].onchange=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.slot_used_selection[0].onchange=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.slot_used_second_selection[0].onchange=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.not_recurring_charge.onclick=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.recurring_charge.onclick=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.hassecondslot.onclick=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.minimum_charge.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.maximum_charge.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.minimum_ini.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.maximum_ini.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.minimum_hull.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.maximum_hull.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.minimum_force.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.maximum_force.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.minimum_shields.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.maximum_shields.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.minimum_agility.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.maximum_agility.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.minimum_attack.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.maximum_attack.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.minimum_attackt.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.maximum_attackt.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.minimum_attackdt.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.maximum_attackdt.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.minimum_attackf.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.maximum_attackf.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.minimum_attackb.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.maximum_attackb.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.minimum_attackbull.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.maximum_attackbull.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.minimum_owned_copies.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this),this.maximum_owned_copies.oninput=function(a){return function(){return a.renderList(a.sort_selector.val())}}(this)},a.prototype.prepareData=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;for(this.all_cards=[],i=0,m=TYPES.length;i<m;i++)g=TYPES[i],"upgrades"===g?this.all_cards=this.all_cards.concat(function(){var a,d;a=exportObj[g],d=[];for(c in a)b=a[c],d.push({name:b.name,display_name:b.display_name,type:exportObj.translate("ui","upgradeHeader",b.slot),data:b,orig_type:b.slot});return d}()):this.all_cards=this.all_cards.concat(function(){var a,d;a=exportObj[g],d=[];for(c in a)b=a[c],d.push({name:b.name,display_name:b.display_name,type:exportObj.translate("singular",g),data:b,orig_type:exportObj.translateToLang("English","singular",g)});return d}());this.types=function(){var a,b,c,d;for(c=["Pilot","Ship"],d=[],a=0,b=c.length;a<b;a++)g=c[a],d.push(exportObj.translate("types",g));return d}(),u=exportObj.upgrades;for(c in u)b=u[c],h=exportObj.translate("ui","upgradeHeader",b.slot),__indexOf.call(this.types,h)<0&&this.types.push(h);for(this.all_cards.sort(byName),this.sources=[],v=this.all_cards,j=0,n=v.length;j<n;j++)for(a=v[j],w=a.data.sources,k=0,o=w.length;k<o;k++)f=w[k],__indexOf.call(this.sources,f)<0&&this.sources.push(f);for(e=this.types.sort(),d=this.sources.sort(),this.cards_by_type_name={},l=0,p=e.length;l<p;l++)g=e[l],this.cards_by_type_name[g]=function(){var b,c,d,e;for(d=this.all_cards,e=[],c=0,b=d.length;c<b;c++)a=d[c],a.type===g&&e.push(a);return e}.call(this).sort(byName);for(this.cards_by_type_points={},s=0,q=e.length;s<q;s++)g=e[s],this.cards_by_type_points[g]=function(){var b,c,d,e;for(d=this.all_cards,e=[],c=0,b=d.length;c<b;c++)a=d[c],a.type===g&&e.push(a);return e}.call(this).sort(byPoints);for(this.cards_by_source={},x=[],t=0,r=d.length;t<r;t++)f=d[t],x.push(this.cards_by_source[f]=function(){var b,c,d,e;for(d=this.all_cards,e=[],c=0,b=d.length;c<b;c++)a=d[c],__indexOf.call(a.data.sources,f)>=0&&e.push(a);return e}.call(this).sort(byName));return x},a.prototype.renderList=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;switch(null==a&&(a="name"),null!=this.card_selector?this.card_selector.empty():(this.card_selector=$(document.createElement("SELECT")),this.card_selector.addClass("card-selector"),this.card_selector.attr("size",25),this.card_selector_container.append(this.card_selector)),a){case"type-by-name":for(u=this.types,g=0,k=u.length;g<k;g++){for(f=u[g],d=$(document.createElement("OPTGROUP")),d.attr("label",f),c=!1,v=this.cards_by_type_name[f],h=0,l=v.length;h<l;h++)b=v[h],this.checkSearchCriteria(b)&&(this.addCardTo(d,b),c=!0);c&&this.card_selector.append(d)}break;case"type-by-points":for(w=this.types,i=0,m=w.length;i<m;i++){for(f=w[i],d=$(document.createElement("OPTGROUP")),d.attr("label",f),c=!1,x=this.cards_by_type_points[f],j=0,n=x.length;j<n;j++)b=x[j],this.checkSearchCriteria(b)&&(this.addCardTo(d,b),c=!0);c&&this.card_selector.append(d)}break;case"source":for(y=this.sources,r=0,o=y.length;r<o;r++){for(e=y[r],d=$(document.createElement("OPTGROUP")),d.attr("label",exportObj.translate("sources",e)),c=!1,z=this.cards_by_source[e],s=0,p=z.length;s<p;s++)b=z[s],this.checkSearchCriteria(b)&&(this.addCardTo(d,b),c=!0);c&&this.card_selector.append(d)}break;default:for(A=this.all_cards,t=0,q=A.length;t<q;t++)b=A[t],this.checkSearchCriteria(b)&&this.addCardTo(this.card_selector,b)}return this.card_selector.change(function(a){return function(b){return a.renderCard($(a.card_selector.find(":selected")))}}(this))},a.prototype.renderCard=function(a){var b,c,d,e,f,g,h,i,j,k;if(f=a.data("display_name"),g=a.data("name"),e=a.data("card"),h=a.data("orig_type"),"Pilot"!==h&&"Ship"!==h&&"Quickbuild"!==h&&(b={addon_type:h},h="Addon"),"Pilot"===h&&this.card_viewer_container.find("tr.info-faction").show(),this.card_viewer_container.show(),exportObj.builders[7].showTooltip(h,e,null!=b?b:{},this.card_viewer_container),null!=(null!=e?e.applies_condition:void 0)){if(d=new Set,e.applies_condition instanceof Array)for(k=e.applies_condition,i=0,j=k.length;i<j;i++)c=k[i],d.add(exportObj.conditionsByCanonicalName[c]);else d.add(exportObj.conditionsByCanonicalName[e.applies_condition]);return this.card_viewer_conditions_container.text(""),d.forEach(function(a){return function(b){var c;return c=$(document.createElement("div")),c.addClass("conditions-container d-flex flex-wrap"),c.append(conditionToHTML(b)),a.card_viewer_conditions_container.append(c)}}(this)),this.card_viewer_conditions_container.show()}return this.card_viewer_conditions_container.hide()},a.prototype.addCardTo=function(a,b){var c;return c=$(document.createElement("OPTION")),c.text(""+(b.display_name?b.display_name:b.name)+" ("+(null!=b.data.points?b.data.points:"*")+(null!=b.data.loadout?"/"+b.data.loadout:"")+")"),c.data("name",b.name),c.data("display_name",b.display_name),c.data("type",b.type),c.data("card",b.data),c.data("orig_type",b.orig_type),0===this.getCollectionNumber(b)&&c[0].classList.add("result-not-in-collection"),$(a).append(c)},a.prototype.getCollectionNumber=function(a){var b,c,d,e,f,g,h;if(null==exportObj.builders[7].collection||null==exportObj.builders[7].collection.counts)return-1;switch(b=0,a.orig_type){case"Pilot":b=null!=(c=null!=(d=exportObj.builders[7].collection.counts.pilot)?d[a.name]:void 0)?c:0;break;case"Ship":b=null!=(e=null!=(f=exportObj.builders[7].collection.counts.ship)?f[a.name]:void 0)?e:0;break;default:b=null!=(g=null!=(h=exportObj.builders[7].collection.counts.upgrade)?h[a.name]:void 0)?g:0}return b},a.prototype.checkSearchCriteria=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia;if(y=this.card_search_text.value.toLowerCase(),G=a.name.toLowerCase().indexOf(y)>-1||a.data.text&&a.data.text.toLowerCase().indexOf(y)>-1||a.display_name&&a.display_name.toLowerCase().indexOf(y)>-1,!G){if(!a.data.ship)return!1;if(A=a.data.ship,A instanceof Array){for(F=!1,J=0,N=A.length;J<N;J++)if(x=A[J],x.toLowerCase().indexOf(y)>-1||exportObj.ships[x].display_name&&exportObj.ships[x].display_name.toLowerCase().indexOf(y)>-1){F=!0;break}if(!F)return!1}else if(!(A.toLowerCase().indexOf(y)>-1||exportObj.ships[A].display_name&&exportObj.ships[A].display_name.toLowerCase().indexOf(y)>-1))return!1}if(e=function(){var a,b;a=exportObj.pilotsByFactionXWS,b=[];for(f in a)q=a[f],b.push(f);return b}(),z=this.faction_selection.val(),z.length>0){if(__indexOf.call(z,"Factionless")>=0&&z.push(void 0),ia=a.data.faction,!(__indexOf.call(z,ia)>=0||"Ship"===a.orig_type||a.data.faction instanceof Array))return!1;if(a.data.faction instanceof Array){for(g=!1,ja=a.data.faction,K=0,O=ja.length;K<O;K++)if(f=ja[K],__indexOf.call(z,f)>=0){g=!0;break}if(!g)return!1}if("Ship"===a.orig_type){for(g=!1,ua=a.data.factions,L=0,W=ua.length;L<W;L++)if(f=ua[L],__indexOf.call(z,f)>=0){g=!0;break}if(!g)return!1}}else z=e;if(this.standard_checkbox.checked){for(va=null!=a.data.faction?Array.isArray(a.data.faction)?a.data.faction:[a.data.faction]:z,M=0,X=va.length;M<X;M++)f=va[M],__indexOf.call(z,f)<0||(E=E||exportObj.standardCheckBrowser(a.data,f,a.orig_type));if(!E)return!1}if(w=this.slot_available_selection.val(),w.length>0)for(D=a.data.slots,ca=0,Y=w.length;ca<Y;ca++){if(C=w[ca],!(("Torpedo"===C||"Missile"===C||"Cannon"===C)&&null!=D&&__indexOf.call(D,"HardpointShip")>=0||null!=D&&__indexOf.call(D,C)>=0))return!1;if(this.duplicateslots.checked&&(h=D.filter(function(a,b,c){return c.indexOf(a)===b&&b!==c.lastIndexOf(a)&&a===C}),0===h.length))return!1}if(u=this.keyword_available_selection.val(),u.length>0)for(j=a.data.keyword,da=0,Z=u.length;da<Z;da++)if(i=u[da],!(null!=j&&__indexOf.call(j,i)>=0))return!1;if(t=this.action_available_selection.val(),v=this.linkedaction_available_selection.val(),(t.length>0||v.length>0)&&(c=null!=(wa=a.data.actions)?wa:[],"Pilot"===a.orig_type&&(c=null!=(xa=null!=(ya=a.data.ship_override)?ya.actions:void 0)?xa:exportObj.ships[a.data.ship].actions,c=c.concat(null!=(za=null!=(Aa=a.data.ship_override)?Aa.actionsred:void 0)?za:exportObj.ships[a.data.ship].actionsred),null!=a.data.keyword&&__indexOf.call(a.data.keyword,"Droid")>=0))){for(o=[],ea=0,$=c.length;ea<$;ea++)b=c[ea],null!=b&&o.push(b.replace("Focus","Calculate"));c=o}for(Ba=null!=t?t:[],fa=0,_=Ba.length;fa<_;fa++)if(b=Ba[fa],null==c||!(__indexOf.call(c,b)>=0||(ka="F-"+b,__indexOf.call(c,ka)>=0)||(la="R-"+b,__indexOf.call(c,la)>=0)))return!1;for(ma=null!=v?v:[],ga=0,aa=ma.length;ga<aa;ga++)if(b=ma[ga],!(null!=c&&(na="R> "+b,__indexOf.call(c,na)>=0||(oa="> "+b,__indexOf.call(c,oa)>=0))))return!1;if(this.minimum_point_costs.value>0||this.maximum_point_costs.value<20){if(!(a.data.points>=this.minimum_point_costs.value&&a.data.points<=this.maximum_point_costs.value||null!=a.data.variablepoints))return!1;if(null!=a.data.variablepoints){for(m=!1,pa=a.data.pointsarray,ha=0,ba=pa.length;ha<ba;ha++)if(s=pa[ha],s>=this.minimum_point_costs.value&&s<=this.maximum_point_costs.value){m=!0;break}if(!m)return!1}if("Ship"===a.orig_type){for(m=!1,Ca=0,P=z.length;Ca<P;Ca++){f=z[Ca],qa=exportObj.pilotsByFactionCanonicalName[f];for(n in qa){for(r=qa[n],Da=0,Q=r.length;Da<Q;Da++)if(q=r[Da],q.ship===a.data.name&&q.points>=this.minimum_point_costs.value&&q.points<=this.maximum_point_costs.value){m=!0;break}if(m)break}if(m)break}if(!m)return!1}}if(this.minimum_loadout_costs.value>0||this.maximum_loadout_costs.value<99){if(!(a.data.loadout>=this.minimum_loadout_costs.value&&a.data.loadout<=this.maximum_loadout_costs.value))return!1;if("Ship"===a.orig_type){for(l=!1,Ea=0,R=z.length;Ea<R;Ea++){f=z[Ea],ra=exportObj.pilotsByFactionCanonicalName[f];for(n in ra){for(r=ra[n],Fa=0,S=r.length;Fa<S;Fa++)if(q=r[Fa],q.ship===a.data.name&&q.loadout>=this.minimum_point_costs.value&&q.loadout<=this.maximum_loadout_costs.value){l=!0;break}if(l)break}if(l)break}if(!l)return!1}}if(I=this.slot_used_selection.val(),I.length>0){if(null==a.data.slot)return!1;for(k=!1,Ga=0,T=I.length;Ga<T;Ga++)if(C=I[Ga],a.data.slot===C){k=!0;break}if(!k)return!1}if(H=this.slot_used_second_selection.val(),H.length>0){if(null==a.data.also_occupies_upgrades)return!1;for(k=!1,Ha=0,U=H.length;Ha<U;Ha++)for(C=H[Ha],sa=a.data.also_occupies_upgrades,Ia=0,V=sa.length;Ia<V;Ia++)if(d=sa[Ia],d===C){k=!0;break}if(!k)return!1}if(null==a.data.also_occupies_upgrades&&this.hassecondslot.checked)return!1;if(this.unique_checkbox.checked&&!a.data.unique)return!1;if(this.non_unique_checkbox.checked&&a.data.unique)return!1;if(!(null!=a.data.charge&&a.data.charge<=this.maximum_charge.value&&a.data.charge>=this.minimum_charge.value||this.minimum_charge.value<=0&&null==a.data.charge))return!1;if(a.data.recurring&&!this.recurring_charge.checked)return!1;if(a.data.charge&&!a.data.recurring&&!this.not_recurring_charge.checked)return!1;if(null!=(null!=(ta=exportObj.builders[7].collection)?ta.counts:void 0)&&(p=this.getCollectionNumber(a),!(p>=this.minimum_owned_copies.value&&p<=this.maximum_owned_copies.value)))return!1;if(null!=a.data.skill){if(!(a.data.skill>=this.minimum_ini.value&&a.data.skill<=this.maximum_ini.value))return!1}else if(!(this.minimum_ini.value<=0&&this.maximum_ini.value>=6))return!1;return!!(this.base_size_checkboxes.small.checked&&this.base_size_checkboxes.medium.checked&&this.base_size_checkboxes.large.checked||(B=!1,"Ship"===a.orig_type?B=null!=a.data.base?B||this.base_size_checkboxes[a.data.base.toLowerCase()].checked:B||this.base_size_checkboxes.small.checked:"Pilot"===a.orig_type&&(A=exportObj.ships[a.data.ship],B=null!=A.base?B||this.base_size_checkboxes[A.base.toLowerCase()].checked:B||this.base_size_checkboxes.small.checked),B))&&(("0"===this.minimum_hull.value&&"12"===this.maximum_hull.value||null!=a.data.hull&&a.data.hull>=this.minimum_hull.value&&a.data.hull<=this.maximum_hull.value||"Pilot"===a.orig_type&&exportObj.ships[a.data.ship].hull>=this.minimum_hull.value&&exportObj.ships[a.data.ship].hull<=this.maximum_hull.value)&&(("0"===this.minimum_shields.value&&"6"===this.maximum_shields.value||null!=a.data.shields&&a.data.shields>=this.minimum_shields.value&&a.data.shields<=this.maximum_shields.value||"Pilot"===a.orig_type&&exportObj.ships[a.data.ship].shields>=this.minimum_shields.value&&exportObj.ships[a.data.ship].shields<=this.maximum_shields.value)&&(("0"===this.minimum_agility.value&&"3"===this.maximum_agility.value||null!=a.data.agility&&a.data.agility>=this.minimum_agility.value&&a.data.agility<=this.maximum_agility.value||"Pilot"===a.orig_type&&exportObj.ships[a.data.ship].agility>=this.minimum_agility.value&&exportObj.ships[a.data.ship].agility<=this.maximum_agility.value)&&(("0"===this.minimum_attack.value&&"5"===this.maximum_attack.value||null!=a.data.attack&&a.data.attack>=this.minimum_attack.value&&a.data.attack<=this.maximum_attack.value||"Pilot"===a.orig_type&&(null!=exportObj.ships[a.data.ship].attack&&exportObj.ships[a.data.ship].attack>=this.minimum_attack.value&&exportObj.ships[a.data.ship].attack<=this.maximum_attack.value||null==exportObj.ships[a.data.ship].attack&&this.minimum_attack.value<=0)||"Ship"===a.orig_type&&null==a.data.attack&&this.minimum_attack.value<=0)&&(("0"===this.minimum_attackt.value&&"5"===this.maximum_attackt.value||null!=a.data.attackt&&a.data.attackt>=this.minimum_attackt.value&&a.data.attackt<=this.maximum_attackt.value||"Pilot"===a.orig_type&&(null!=exportObj.ships[a.data.ship].attackt&&exportObj.ships[a.data.ship].attackt>=this.minimum_attackt.value&&exportObj.ships[a.data.ship].attackt<=this.maximum_attackt.value||null==exportObj.ships[a.data.ship].attackt&&this.minimum_attackt.value<=0)||"Ship"===a.orig_type&&null==a.data.attackt&&this.minimum_attackt.value<=0)&&(("0"===this.minimum_attackdt.value&&"5"===this.maximum_attackdt.value||null!=a.data.attackdt&&a.data.attackdt>=this.minimum_attackdt.value&&a.data.attackdt<=this.maximum_attackdt.value||"Pilot"===a.orig_type&&(null!=exportObj.ships[a.data.ship].attackdt&&exportObj.ships[a.data.ship].attackdt>=this.minimum_attackdt.value&&exportObj.ships[a.data.ship].attackdt<=this.maximum_attackdt.value||null==exportObj.ships[a.data.ship].attackdt&&this.minimum_attackdt.value<=0)||"Ship"===a.orig_type&&null==a.data.attackdt&&this.minimum_attackdt.value<=0)&&(("0"===this.minimum_attackf.value&&"5"===this.maximum_attackf.value||null!=a.data.attackf&&a.data.attackf>=this.minimum_attackf.value&&a.data.attackf<=this.maximum_attackf.value||"Pilot"===a.orig_type&&(null!=exportObj.ships[a.data.ship].attackf&&exportObj.ships[a.data.ship].attackf>=this.minimum_attackf.value&&exportObj.ships[a.data.ship].attackf<=this.maximum_attackf.value||null==exportObj.ships[a.data.ship].attackf&&this.minimum_attackf.value<=0)||"Ship"===a.orig_type&&null==a.data.attackf&&this.minimum_attackf.value<=0)&&(("0"===this.minimum_attackb.value&&"5"===this.maximum_attackb.value||null!=a.data.attackb&&a.data.attackb>=this.minimum_attackb.value&&a.data.attackb<=this.maximum_attackb.value||"Pilot"===a.orig_type&&(null!=exportObj.ships[a.data.ship].attackb&&exportObj.ships[a.data.ship].attackb>=this.minimum_attackb.value&&exportObj.ships[a.data.ship].attackb<=this.maximum_attackb.value||null==exportObj.ships[a.data.ship].attackb&&this.minimum_attackb.value<=0)||"Ship"===a.orig_type&&null==a.data.attackb&&this.minimum_attackb.value<=0)&&(("0"===this.minimum_attackbull.value&&"5"===this.maximum_attackbull.value||null!=a.data.attackbull&&a.data.attackbull>=this.minimum_attackbull.value&&a.data.attackbull<=this.maximum_attackbull.value||"Pilot"===a.orig_type&&(null!=exportObj.ships[a.data.ship].attackbull&&exportObj.ships[a.data.ship].attackbull>=this.minimum_attackbull.value&&exportObj.ships[a.data.ship].attackbull<=this.maximum_attackbull.value||null==exportObj.ships[a.data.ship].attackbull&&this.minimum_attackbull.value<=0)||"Ship"===a.orig_type&&null==a.data.attackbull&&this.minimum_attackbull.value<=0)&&("0"===this.minimum_force.value&&"3"===this.maximum_force.value||null!=a.data.force&&a.data.force>=this.minimum_force.value&&a.data.force<=this.maximum_force.value||"Pilot"===a.orig_type&&exportObj.ships[a.data.ship].force>=this.minimum_force.value&&exportObj.ships[a.data.ship].force<=this.maximum_force.value||null==a.data.force&&"0"===this.minimum_force.value))))))))))},a}(),exportObj="undefined"!=typeof exports&&null!==exports?exports:this,exportObj.RulesBrowser=function(){function a(a){var b;this.container=$(a.container),this.language=null!=(b=exportObj.currentLanguage)?b:"English",this.prepareRulesData(),this.setupRuleUI(),this.setupRulesHandlers()}return a.prototype.setupRuleUI=function(){var a,b;return this.container.append($.trim('<div class="container-fluid xwing-rules-browser">\n    <div class="row">\n        <div class="col-md-4">\n            <div class="card card-search-container">\n                <h5 class="card-title translated" defaultText="Rules Search"></h5>\n                <div class="advanced-search-container">\n                    <h6 class="card-subtitle mb-2 text-muted version"><span class="translated" defaultText="Version"></span>: </h6>\n                    <label class = "text-search advanced-search-label">\n                        <strong class="translated" defaultText="Term:"></strong>\n                        <input type="search" placeholder="'+exportObj.translate("ui","Search for game term or card")+'" class = "rule-search-text">\n                    </label>\n                </div>\n                <div class="rules-container card-selector-container">\n                </div>\n            </div>\n        </div>\n        <div class="col-md-8">\n            <div class="card card-viewer-container card-search-container">\n                <h4 class="card-title info-name"></h4>\n                <br />\n                <p class="info-text" />\n            </div>\n        </div>\n    </div>\n</div>')),this.versionlabel=$(this.container.find(".xwing-rules-browser .version")),this.rule_selector_container=$(this.container.find(".xwing-rules-browser .rules-container")),this.rule_viewer_container=$(this.container.find(".xwing-rules-browser .card-viewer-container")),this.rule_viewer_container.hide(),this.advanced_search_container=$(this.container.find(".xwing-rules-browser .advanced-search-container")),exportObj.translateUIElements(this.container),b=this.all_rules.version.number,a=this.all_rules.version.date,this.versionlabel.append(""+b+", "+a),this.rule_search_rules_text=$(this.container.find(".xwing-rules-browser .rule-search-text"))[0]},a.prototype.setupRulesHandlers=function(){return this.renderRulesList(),$(window).on("xwing:afterLanguageLoad",function(a){return function(b,c,d){return null==d&&(d=$.noop),a.language=c,a.prepareRulesData(),a.renderRulesList()}}(this)),this.rule_search_rules_text.oninput=function(a){return function(){return a.renderRulesList()}}(this)},a.prototype.prepareRulesData=function(){return this.all_rules=exportObj.rulesEntries(),this.ruletype=["glossary","faq"]},a.prototype.renderRulesList=function(){var a,b,c,d,e,f,g,h,i;for(null!=this.rule_selector&&this.rule_selector.remove(),this.rule_selector=$(document.createElement("SELECT")),this.rule_selector.addClass("card-selector"),this.rule_selector.attr("size",25),this.rule_selector_container.append(this.rule_selector),h=this.ruletype,f=0,g=h.length;f<g;f++){e=h[f],a=$(document.createElement("OPTGROUP")),a.attr("label",exportObj.translate("rulestypes",e)),b=!1,i=this.all_rules[e];for(d in i)c=i[d],this.checkRulesSearchCriteria(c)&&(this.addRulesTo(a,c),b=!0);b&&this.rule_selector.append(a)}return this.rule_selector.change(function(a){return function(b){return a.renderRules($(a.rule_selector.find(":selected")))}}(this))},a.prototype.renderRules=function(a){var b,c;return b={name:a.data("name"),text:a.data("text")},c="Rules",this.rule_viewer_container.show(),exportObj.builders[0].showTooltip(c,b,"undefined"!=typeof add_opts&&null!==add_opts?add_opts:{},this.rule_viewer_container)},a.prototype.addRulesTo=function(a,b){var c;return c=$(document.createElement("OPTION")),c.text(""+b.name),c.data("name",b.name),c.data("text",exportObj.fixIcons(b)),$(a).append(c)},a.prototype.checkRulesSearchCriteria=function(a){var b,c;return b=this.rule_search_rules_text.value.toLowerCase(),c=a.name.toLowerCase().indexOf(b)>-1||(a.text&&a.text.toLowerCase().indexOf(b))>-1,!!c},a}(),DFL_LANGUAGE="English",SHOW_DEBUG_OUT_MISSING_TRANSLATIONS=!1,builders=[],exportObj="undefined"!=typeof exports&&null!==exports?exports:this,exportObj.languagePriority=-1;try{!function(){var a,b,c,d,e;if(!(exportObj.languagePriority>3)&&(exportObj.currentLanguage=DFL_LANGUAGE,exportObj.languagePriority!==-1)){for(b=[navigator.language].concat(navigator.languages),e=[],c=0,d=b.length;c<d;c++){if(a=b[c],a=a.split("-")[0],a in exportObj.codeToLanguage){exportObj.currentLanguage=exportObj.codeToLanguage[a],exportObj.languagePriority=3;break}e.push(void 0)}return e}}()}catch(_error){all=_error,exportObj.currentLanguage=DFL_LANGUAGE}exportObj.loadCards=function(a){return exportObj.cardLoaders[a]()},exportObj.translate=function(){var a,b,c;return b=arguments[0],c=arguments[1],a=3<=arguments.length?__slice.call(arguments,2):[],exportObj.translateToLang.apply(exportObj,[exportObj.currentLanguage,b,c].concat(__slice.call(a)))},exportObj.translateToLang=function(){var a,b,c,d,e;c=arguments[0],b=arguments[1],e=arguments[2],a=4<=arguments.length?__slice.call(arguments,3):[];try{d=exportObj.translations[c][b][e]}catch(f){all=f,d=void 0}return null!=d?d instanceof Function?d.apply(null,[exportObj.translate].concat(__slice.call(a))):d:c!==DFL_LANGUAGE?(SHOW_DEBUG_OUT_MISSING_TRANSLATIONS&&console.log(c+" translation for "+String(e)+" (category "+String(b)+") missing"),exportObj.translateToLang.apply(exportObj,[DFL_LANGUAGE,b,e].concat(__slice.call(a)))):e},exportObj.setupTranslationSupport=function(){var a;return function(a){return $(exportObj).on("xwing:languageChanged",function(b){return function(b,c,d,e){var f,g,h,i,j;if(j=__iced_k_noop,h=iced.findDeferral(arguments),null==d&&(d=5),null==e&&(e=$.noop),"reload"===d);else{if(d<exportObj.languagePriority)return;exportObj.languagePriority=d,exportObj.currentLanguage=c}return c in exportObj.translations?($(".language-placeholder").text(c),g="",function(b){var c,d,e,j;e=a,d=e.length,c=0,(j=function(a){var b,k,l;return b=a,k=function(){return iced.trampoline(function(){return++c,j(a)})},l=k,c<d?(f=e[c],g=f.language,function(a){i=new iced.Deferrals(a,{parent:h}),f.container.trigger("xwing:beforeLanguageLoad",i.defer({lineno:2156})),i._fulfill()}(l),void 0):b()})(b)}(function(){var b,d;for(c!==g&&exportObj.loadCards(c),exportObj.translateUIElements(),b=0,d=a.length;b<d;b++)f=a[b],f.container.trigger("xwing:afterLanguageLoad",c);return j()}),void 0):j()}}(this))}(builders),a=exportObj.basicCardData(),exportObj.canonicalizeShipNames(a),exportObj.ships=a.ships,exportObj.setupCommonCardData(a),exportObj.loadCards(DFL_LANGUAGE),DFL_LANGUAGE!==exportObj.currentLanguage&&exportObj.loadCards(exportObj.currentLanguage),$(exportObj).trigger("xwing:languageChanged",[exportObj.currentLanguage,"reload"])},exportObj.translateUIElements=function(a){var b,c,d,e,f;for(null==a&&(a=void 0),e=$(".translated",a),f=[],c=0,d=e.length;c<d;c++)b=e[c],f.push(b.innerHTML=exportObj.translate("ui",b.getAttribute("defaultText")));return f},exportObj.setupTranslationUI=function(a){var b,c,d,e,f,g,h;for(g=Object.keys(exportObj.cardLoaders).sort(),d=function(a,b){return c.click(function(c){return null!=b&&b.set("language",a),$(exportObj).trigger("xwing:languageChanged",[a,100])})},h=[],e=0,f=g.length;e<f;e++)b=g[e],c=$(document.createElement("LI")),c.text(b),d(b,a),h.push($(".language-picker .dropdown-menu").append(c));return h},exportObj.registerBuilderForTranslation=function(a){if(__indexOf.call(builders,a)<0)return builders.push(a)},exportObj="undefined"!=typeof exports&&null!==exports?exports:this,exportObj.sortHelper=function(a,b){
var c,d;return a.points===b.points?(c=a.text.replace(/[^a-z0-9]/gi,""),d=b.text.replace(/[^a-z0-9]/gi,""),c===d?0:c>d?1:-1):"string"==typeof a.points?1:a.points>b.points?1:-1},exportObj.toTTS=function(a){return null==a?null:a.replace(/\(.*\)/g,"").replace("�",'"').replace("�",'"')},exportObj.slotsMatching=function(a,b){if(a===b)return!0;switch(a){case"HardpointShip":if("Torpedo"===b||"Cannon"===b||"Missile"===b)return!0;break;case"VersatileShip":if("Torpedo"===b||"Missile"===b)return!0}switch(b){case"HardpointShip":if("Torpedo"===a||"Cannon"===a||"Missile"===a)return!0;break;case"VersatileShip":if("Torpedo"===a||"Missile"===a)return!0}return!1},$.isMobile=function(){return!!(navigator.userAgent.match(/(iPhone|iPod|iPad|Android)/i)||navigator.maxTouchPoints>1)},$.randomInt=function(a){return Math.floor(Math.random()*a)},$.isElementInView=function(a,b){var c,d,e,f;return f=$(window).scrollTop(),e=f+$(window).height(),d=$(a).offset().top,c=d+$(a).height(),b?f<d&&e>c:d<=e&&c>=f},$.getParameterByName=function(a){var b,c,d;return a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),c="[\\?&]"+a+"=([^&#]*)",b=new RegExp(c),d=b.exec(window.location.search),null===d?"":decodeURIComponent(d[1].replace(/\+/g," "))},Array.prototype.intersects=function(a){var b,c,d;for(c=0,d=this.length;c<d;c++)if(b=this[c],__indexOf.call(a,b)>=0)return!0;return!1},Array.prototype.removeItem=function(a){var b;return b=this.indexOf(a),b!==-1&&this.splice(b,1),this},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.getXWSBaseName=function(){return this.split("-")[0]},URL_BASE=""+window.location.protocol+"//"+window.location.host+window.location.pathname,SQUAD_DISPLAY_NAME_MAX_LENGTH=24,statAndEffectiveStat=function(a,b,c){return null!=a?""+a+(null!=b&&null!=b[c]&&b[c]!==a?" ("+b[c]+")":""):null!=b&&null!=b[c]?"0 ("+b[c]+")":"0"},getPrimaryFaction=function(a){switch(a){case"Rebel Alliance":return"Rebel Alliance";case"Galactic Empire":return"Galactic Empire";default:return a}},conditionToHTML=function(a){var b;return b=$.trim('<div class="condition">\n    <div class="name">'+(a.unique?"&middot;&nbsp;":"")+(a.display_name?a.display_name:a.name)+'</div>\n    <div class="text">'+a.text+"</div>\n</div>")},exportObj.SquadBuilder=function(){function a(a){this._makeRandomizerLoopFunc=__bind(this._makeRandomizerLoopFunc,this),this._randomizerLoopBody=__bind(this._randomizerLoopBody,this),this.releaseUnique=__bind(this.releaseUnique,this),this.claimUnique=__bind(this.claimUnique,this),this.updatePrintAndExportTexts=__bind(this.updatePrintAndExportTexts,this),this.onSquadNameChanged=__bind(this.onSquadNameChanged,this),this.onSquadDirtinessChanged=__bind(this.onSquadDirtinessChanged,this),this.onSquadLoadRequested=__bind(this.onSquadLoadRequested,this),this.onPointsUpdated=__bind(this.onPointsUpdated,this),this.onGameTypeChanged=__bind(this.onGameTypeChanged,this),this.onNotesUpdated=__bind(this.onNotesUpdated,this),this.updatePermaLink=__bind(this.updatePermaLink,this),this.updateShipOrder=__bind(this.updateShipOrder,this),this.getPermaLink=__bind(this.getPermaLink,this),this.getPermaLinkParams=__bind(this.getPermaLinkParams,this);var b,c,d,e,f,g,h;this.container=$(a.container),this.faction=$.trim(a.faction),this.printable_container=$(a.printable_container),this.tab=$(a.tab),this.show_points_destroyed=!1,this.ships=[],this.uniques_in_use={Pilot:[],Upgrade:[],Slot:[]},this.standard_list={Upgrade:[],Ship:[]},this.suppress_automatic_new_ship=!1,this.tooltip_currently_displaying=null,this.randomizer_options={sources:null,points:20,ship_limit:0,collection_only:!0,fill_zero_pts:!1},this.total_points=0,this.isStandard=null==(b=null!=(c=exportObj.builders[0])?c.isStandard:void 0)||b,this.isEpic=null!=(d=null!=(e=exportObj.builders[0])?e.isEpic:void 0)&&d,this.isQuickbuild=null!=(f=null!=(g=exportObj.builders[0])?g.isQuickbuild:void 0)&&f,this.backend=null,this.current_squad={},this.language=null!=(h=exportObj.currentLanguage)?h:"English",this.collection=null,this.current_obstacles=[],this.setupUI(),this.setupEventHandlers(),window.setInterval(this.updatePermaLink,250),this.isUpdatingPoints=!1,$.getParameterByName("f")===this.faction?(this.resetCurrentSquad(!0),this.loadFromSerialized($.getParameterByName("d"))):(this.resetCurrentSquad(),this.addShip())}var b;return a.prototype.resetCurrentSquad=function(a){var b,c,d;return null==a&&(a=!1),b=this.uitranslation("Unnamed Squadron"),c=$.trim(this.squad_name_input.val())||b,a&&$.trim($.getParameterByName("sn"))&&(c=$.trim($.getParameterByName("sn"))),d=[],a&&$.trim($.getParameterByName("obs"))?(d=$.trim($.getParameterByName("obs")).split(",").slice(0,3),this.updateObstacleSelect(d)):this.current_obstacles&&(d=this.current_obstacles),this.current_squad={id:null,name:c,dirty:!1,additional_data:{points:this.total_points,description:"",cards:[],notes:"",obstacles:d,tag:""},faction:this.faction},this.total_points>0&&(c===b&&(this.current_squad.name=this.uitranslation("Unsaved Squadron")),this.current_squad.dirty=!0),this.old_version_container.toggleClass("d-none",!0),this.container.trigger("xwing-backend:squadNameChanged"),this.container.trigger("xwing-backend:squadDirtinessChanged")},a.prototype.newSquadFromScratch=function(a){return null==a&&(a=this.uitranslation("New Squadron")),this.squad_name_input.val(a),this.removeAllShips(),this.suppress_automatic_new_ship||this.addShip(),this.updateObstacleSelect([]),this.resetCurrentSquad(),this.notes.val(""),this.tag.val("")},a.prototype.uitranslation=function(){var a,b;return b=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],exportObj.translate("ui",b,a)},a.prototype.setupUI=function(){var a,b,c,d,e,f,g,h,i;for(a=20,c=4,b=0,this.status_container=$(document.createElement("DIV")),this.status_container.addClass("container-fluid"),this.status_container.append($.trim('<div class="row squad-name-and-points-row">\n    <div class="col-md-3 squad-name-container">\n        <div class="display-name">\n            <span class="squad-name"></span>\n            <i class="far fa-edit"></i>\n        </div>\n        <div class="input-append">\n            <input type="text" maxlength="64" placeholder="'+this.uitranslation("Name your squad...")+'" />\n            <button class="btn save"><i class="fa fa-pen-square"></i></button>\n        </div>\n        <br />\n    </div>\n    <div class="col-md-4 points-display-container">\n        Points: <span class="total-points">0</span> / <input type="number" class="desired-points" value="20">\n        <span class="points-remaining-container">(<span class="points-remaining"></span>&nbsp;left) <span class="points-destroyed red"></span></span>\n        <span class="content-warning loading-failed-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Broken squad link warning"></span></span>\n        <span class="content-warning old-version-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="This squad was created for an older version of X-Wing."></span></span>\n        <span class="content-warning collection-invalid d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Collection warning"></span></span>\n        <span class="content-warning ship-number-invalid-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Ship number warning"></span></span>\n        <span class="content-warning multi-faction-warning-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Multi-Faction warning"></span></span>\n    </div>\n    <div class="col-md-5 float-right button-container">\n        <div class="btn-group float-right">\n\n            <button class="btn btn-info view-as-text"><span class="d-none d-lg-block"><i class="fa fa-print"></i>&nbsp;<span class="translated" defaultText="Print/Export"></span></span><span class="d-lg-none"><i class="fa fa-print"></i></span></button>\n            <a class="btn btn-primary d-none collection"><span class="d-none d-lg-block"><i class="fa fa-folder-open"></i> <span class="translated" defaultText="Your Collection"></span></span><span class="d-lg-none"><i class="fa fa-folder-open"></i></span></a>\n            \n\n        </div>\n    </div>\n</div>\n\n<div class="row squad-save-buttons">\n    <div class="col-md-12">\n        <button class="show-authenticated btn btn-primary save-list"><i class="far fa-save"></i>&nbsp;<span class="translated" defaultText="Save"></span></button>\n        <button class="show-authenticated btn btn-primary save-list-as"><i class="far fa-file"></i>&nbsp;<span class="translated" defaultText="Save As..."></span></button>\n        <button class="show-authenticated btn btn-primary delete-list disabled"><i class="fa fa-trash"></i>&nbsp;<span class="translated" defaultText="Delete"></span></button>\n        <button class="show-authenticated btn btn-info backend-list-my-squads show-authenticated"><i class="fa fa-download"></i>&nbsp;<span class = "translated" defaultText="Load Squad"></span></button>\n        <button class="btn btn-info import-squad"><i class="fa fa-file-import"></i>&nbsp;<span class="translated" defaultText="Import"></span></button>\n        <button class="btn btn-info show-points-destroyed"><i class="fas fa-bullseye"></i>&nbsp;<span class="show-points-destroyed-span translated" defaultText="'+this.uitranslation("Show Points Destroyed")+'"></span></button>                    \n        <button class="btn btn-danger clear-squad"><i class="fa fa-plus-circle"></i>&nbsp;<span class="translated" defaultText="New Squad"></span></button>\n        <span class="show-authenticated backend-status"></span>\n    </div>\n</div>')),this.container.append(this.status_container),this.xws_import_modal=$(document.createElement("DIV")),this.xws_import_modal.addClass("modal fade import-modal d-print-none"),this.xws_import_modal.tabindex="-1",this.xws_import_modal.role="dialog",this.xws_import_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="XWS Import"></h3>\n            <button type="button" class="close d-print-none" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <span class="translated" defaultText="XWS Import Dialog"></span>\n            <div class="container-fluid">\n                <textarea class="xws-content" placeholder=\''+this.uitranslation("Paste XWS here")+'\'></textarea>\n            </div>\n        </div>\n        <div class="modal-footer d-print-none">\n            <span class="xws-import-status"></span>&nbsp;\n            <button class="btn btn-danger import-xws translated" defaultText="Import"></button>\n        </div>\n    </div>\n</div>')),this.from_xws_button=this.container.find("button.import-squad"),this.from_xws_button.click(function(a){return function(b){return b.preventDefault(),a.xws_import_modal.find(".xws-import-status").text(" "),a.xws_import_modal.modal("show")}}(this)),this.load_xws_button=$(this.xws_import_modal.find("button.import-xws")),this.load_xws_button.click(function(a){return function(b){return b.preventDefault(),exportObj.loadXWSButton(a.xws_import_modal)}}(this)),this.container.append(this.xws_import_modal),this.list_modal=$(document.createElement("DIV")),this.list_modal.addClass("modal fade text-list-modal"),this.list_modal.tabindex="-1",this.list_modal.role="dialog",this.container.append(this.list_modal),this.list_modal.append($.trim('<div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <div class="d-print-none">\n                <h4 class="modal-title"><span class="squad-name"></span> (<span class="total-points"></span>)</h4>\n            </div>\n            <div class="d-none d-print-block">\n                <div class="fancy-header">\n                    <div class="squad-name"></div>\n                    <div class="squad-faction"></div>\n                    <div class="mask">\n                        <div class="outer-circle">\n                            <div class="inner-circle">\n                                <span class="total-points"></span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="fancy-under-header"></div>\n            </div>\n            <button type="button" class="close d-print-none" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <div class="fancy-list"></div>\n            <div class="simple-list"></div>\n            <div class="simplecopy-list">\n                <span class="translated" defaultText="Copy below simple text"></span>\n                <textarea></textarea><button class="btn btn-modal btn-copy translated" defaultText="Copy"></button>\n            </div>\n            <div class="reddit-list">\n                <span class="translated" defaultText="Copy below markdown"></span>\n                <textarea></textarea><button class="btn btn-modal btn-copy translated" defaultText="Copy"></button>\n            </div>\n            <div class="tts-list">\n                <span class="translated" defaultText="Copy below TTS"></span>\n                <textarea></textarea><button class="btn btn-modal btn-copy translated" defaultText="Copy"></button>\n            </div>\n            <div class="xws-list">\n                <span class="translated" defaultText="Copy below XWS"></span>\n                <div class="row full-row">\n                    <div class="col d-inline-block d-none d-sm-block"><textarea></textarea><br /><button class="btn btn-modal btn-copy translated" defaultText="Copy"></button></div>\n                    <div class="col d-inline-block d-none d-sm-block qrcode-container" id="xws-qrcode-container"></div>\n                </div>\n            </div>\n        </div>\n        <div class="container-fluid modal-footer d-print-none">\n            <div class="row full-row">\n                <div class="col d-inline-block d-none d-sm-block right-col">\n                    <label class="color-skip-text-checkbox">\n                        <span class="translated" defaultText="Skip Card Text"></span> <input type="checkbox" class="toggle-skip-text-print" />\n                    </label><br />\n                    <label class="vertical-space-checkbox">\n                        <span class="translated" defaultText="Space for Cards"></span> <input type="checkbox" class="toggle-vertical-space" />\n                    </label><br />\n                    <label class="maneuver-print-checkbox">\n                        <span class="translated" defaultText="Include Maneuvers Chart"></span> <input type="checkbox" class="toggle-maneuver-print" />\n                    </label><br />\n                    <label class="expanded-shield-hull-print-checkbox">\n                        <span class="translated" defaultText="Expand Shield and Hull"></span> <input type="checkbox" class="toggle-expanded-shield-hull-print" />\n                    </label>\n                </div>\n                <div class="col d-inline-block d-none d-sm-block right-col">\n                    <label class="color-print-checkbox">\n                        <span class="translated" defaultText="Print Color"></span> <input type="checkbox" class="toggle-color-print" checked="checked" />\n                    </label><br />\n                    <label class="qrcode-checkbox">\n                        <span class="translated" defaultText="Include QR codes"></span> <input type="checkbox" class="toggle-juggler-qrcode" checked="checked" />\n                    </label><br />\n                    <label class="obstacles-checkbox">\n                        <span class="translated" defaultText="Include Obstacle Choices"></span> <input type="checkbox" class="toggle-obstacles" checked="checked" />\n                    </label>\n                </div>\n            </div>\n            <div class="row btn-group list-display-mode">\n                <button class="btn btn-modal select-simple-view translated" defaultText="Simple"></button>\n                <button class="btn btn-modal select-fancy-view d-none d-sm-block translated" defaultText="Fancy"></button>\n                <button class="btn btn-modal select-simplecopy-view translated" defaultText="Text"></button>\n                <button class="btn btn-modal select-reddit-view translated" defaultText="Reddit"></button>\n                <button class="btn btn-modal select-tts-view translated" defaultText="TTS"></button>\n                <button class="btn btn-modal select-xws-view translated" defaultText="XWS"></button>\n            </div>\n            <button class="btn btn-modal print-list d-none d-sm-block"><i class="fa fa-print"></i>&nbsp;<span class="translated" defaultText="Print"></span></button>\n        </div>\n    </div>\n</div>')),this.fancy_container=$(this.list_modal.find(".fancy-list")),this.fancy_total_points_container=$(this.list_modal.find("div.modal-header .total-points")),this.simple_container=$(this.list_modal.find("div.modal-body .simple-list")),this.reddit_container=$(this.list_modal.find("div.modal-body .reddit-list")),this.reddit_textarea=$(this.reddit_container.find("textarea")),this.reddit_textarea.attr("readonly","readonly"),this.simplecopy_container=$(this.list_modal.find("div.modal-body .simplecopy-list")),this.simplecopy_textarea=$(this.simplecopy_container.find("textarea")),this.simplecopy_textarea.attr("readonly","readonly"),this.tts_container=$(this.list_modal.find("div.modal-body .tts-list")),this.tts_textarea=$(this.tts_container.find("textarea")),this.tts_textarea.attr("readonly","readonly"),this.xws_container=$(this.list_modal.find("div.modal-body .xws-list")),this.xws_textarea=$(this.xws_container.find("textarea")),this.xws_textarea.attr("readonly","readonly"),this.toggle_vertical_space_container=$(this.list_modal.find(".vertical-space-checkbox")),this.toggle_color_print_container=$(this.list_modal.find(".color-print-checkbox")),this.toggle_color_skip_text=$(this.list_modal.find(".color-skip-text-checkbox")),this.toggle_maneuver_dial_container=$(this.list_modal.find(".maneuver-print-checkbox")),this.toggle_expanded_shield_hull_container=$(this.list_modal.find(".expanded-shield-hull-print-checkbox")),this.toggle_qrcode_container=$(this.list_modal.find(".qrcode-checkbox")),this.toggle_obstacle_container=$(this.list_modal.find(".obstacles-checkbox")),this.btn_print_list=$(this.list_modal.find(".print-list"))[0],this.list_modal.on("click","button.btn-copy",function(a){return function(b){if(a.self=$(b.currentTarget),a.self.siblings("textarea").select(),a.success=document.execCommand("copy"),a.success)return a.self.addClass("btn-success"),setTimeout(function(){return a.self.removeClass("btn-success")},1e3)}}(this)),this.select_simple_view_button=$(this.list_modal.find(".select-simple-view")),this.select_simple_view_button.click(function(a){return function(b){if(a.select_simple_view_button.blur(),"simple"!==a.list_display_mode)return a.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),a.select_simple_view_button.addClass("btn-inverse"),a.list_display_mode="simple",a.simple_container.show(),a.fancy_container.hide(),a.simplecopy_container.hide(),a.reddit_container.hide(),a.tts_container.hide(),a.xws_container.hide(),a.toggle_vertical_space_container.hide(),a.toggle_color_print_container.hide(),a.toggle_color_skip_text.hide(),a.toggle_maneuver_dial_container.hide(),a.toggle_expanded_shield_hull_container.hide(),a.toggle_qrcode_container.show(),a.toggle_obstacle_container.show(),a.btn_print_list.disabled=!1}}(this)),this.select_fancy_view_button=$(this.list_modal.find(".select-fancy-view")),this.select_fancy_view_button.click(function(a){return function(b){if(a.select_fancy_view_button.blur(),"fancy"!==a.list_display_mode)return a.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),a.select_fancy_view_button.addClass("btn-inverse"),a.list_display_mode="fancy",a.fancy_container.show(),a.simple_container.hide(),a.simplecopy_container.hide(),a.reddit_container.hide(),a.tts_container.hide(),a.xws_container.hide(),a.toggle_vertical_space_container.show(),a.toggle_color_print_container.show(),a.toggle_color_skip_text.show(),a.toggle_maneuver_dial_container.show(),a.toggle_expanded_shield_hull_container.show(),a.toggle_qrcode_container.show(),a.toggle_obstacle_container.show(),a.btn_print_list.disabled=!1}}(this)),this.select_reddit_view_button=$(this.list_modal.find(".select-reddit-view")),this.select_reddit_view_button.click(function(a){return function(b){if(a.select_reddit_view_button.blur(),"reddit"!==a.list_display_mode)return a.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),a.select_reddit_view_button.addClass("btn-inverse"),a.list_display_mode="reddit",a.reddit_container.show(),a.simplecopy_container.hide(),a.tts_container.hide(),a.xws_container.hide(),a.simple_container.hide(),a.fancy_container.hide(),a.reddit_textarea.select(),a.reddit_textarea.focus(),a.toggle_vertical_space_container.hide(),a.toggle_color_print_container.hide(),a.toggle_color_skip_text.hide(),a.toggle_maneuver_dial_container.hide(),a.toggle_expanded_shield_hull_container.hide(),a.toggle_qrcode_container.hide(),a.toggle_obstacle_container.hide(),a.btn_print_list.disabled=!0}}(this)),this.select_simplecopy_view_button=$(this.list_modal.find(".select-simplecopy-view")),this.select_simplecopy_view_button.click(function(a){return function(b){if(a.select_simplecopy_view_button.blur(),"simplecopy"!==a.list_display_mode)return a.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),a.select_simplecopy_view_button.addClass("btn-inverse"),a.list_display_mode="simplecopy",a.reddit_container.hide(),a.simplecopy_container.show(),a.tts_container.hide(),a.xws_container.hide(),a.simple_container.hide(),a.fancy_container.hide(),a.simplecopy_textarea.select(),a.simplecopy_textarea.focus(),a.toggle_vertical_space_container.hide(),a.toggle_color_print_container.hide(),a.toggle_color_skip_text.hide(),a.toggle_maneuver_dial_container.hide(),a.toggle_expanded_shield_hull_container.hide(),a.toggle_qrcode_container.hide(),a.toggle_obstacle_container.hide(),a.btn_print_list.disabled=!0}}(this)),this.select_tts_view_button=$(this.list_modal.find(".select-tts-view")),this.select_tts_view_button.click(function(a){return function(b){if(a.select_tts_view_button.blur(),"tts"!==a.list_display_mode)return a.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),a.select_tts_view_button.addClass("btn-inverse"),a.list_display_mode="tts",a.tts_container.show(),a.xws_container.hide(),a.simple_container.hide(),a.simplecopy_container.hide(),a.reddit_container.hide(),a.fancy_container.hide(),a.tts_textarea.select(),a.tts_textarea.focus(),a.toggle_vertical_space_container.hide(),a.toggle_color_print_container.hide(),a.toggle_color_skip_text.hide(),a.toggle_maneuver_dial_container.hide(),a.toggle_expanded_shield_hull_container.hide(),a.toggle_qrcode_container.hide(),a.toggle_obstacle_container.hide(),a.btn_print_list.disabled=!0}}(this)),this.select_xws_view_button=$(this.list_modal.find(".select-xws-view")),this.select_xws_view_button.click(function(a){return function(b){return a.select_xws_view()}}(this)),$(window).width()>=768?(this.simple_container.hide(),this.select_fancy_view_button.click()):this.select_simple_view_button.click(),this.clear_squad_button=$(this.status_container.find(".clear-squad")),this.clear_squad_button.click(function(a){return function(b){return a.current_squad.dirty&&null!=a.backend?a.backend.warnUnsaved(a,function(){return a.newSquadFromScratch()}):a.newSquadFromScratch()}}(this)),this.show_points_destroyed_button=$(this.status_container.find(".show-points-destroyed")),this.show_points_destroyed_button_span=$(this.status_container.find(".show-points-destroyed-span")),this.show_points_destroyed_button.click(function(a){return function(b){var c,d,e,f,g;for(a.show_points_destroyed=!a.show_points_destroyed,a.show_points_destroyed===!1?a.points_destroyed_span.hide():a.points_destroyed_span.show(),f=a.ships,g=[],d=0,e=f.length;d<e;d++)c=f[d],null!=c.pilot?a.show_points_destroyed===!1?(a.show_points_destroyed_button_span.text(a.uitranslation("Show Points Destroyed")),g.push(c.points_destroyed_button.hide())):(a.show_points_destroyed_button_span.text(a.uitranslation("Hide Points Destroyed")),g.push(c.points_destroyed_button.show())):g.push(void 0);return g}}(this)),this.squad_name_container=$(this.status_container.find("div.squad-name-container")),this.squad_name_display=$(this.container.find(".display-name")),this.squad_name_placeholder=$(this.container.find(".squad-name")),this.squad_name_input=$(this.squad_name_container.find("input")),this.squad_name_save_button=$(this.squad_name_container.find("button.save")),this.squad_name_input.closest("div").hide(),this.points_container=$(this.status_container.find("div.points-display-container")),this.total_points_span=$(this.points_container.find(".total-points")),this.desired_points_input=$(this.points_container.find(".desired-points")),this.desired_points_input.change(function(a){return function(b){return a.onPointsUpdated($.noop)}}(this)),this.points_remaining_span=$(this.points_container.find(".points-remaining")),this.points_destroyed_span=$(this.points_container.find(".points-destroyed")),this.points_remaining_container=$(this.points_container.find(".points-remaining-container")),this.unreleased_content_used_container=$(this.points_container.find(".unreleased-content-used")),this.loading_failed_container=$(this.points_container.find(".loading-failed-container")),this.old_version_container=$(this.points_container.find(".old-version-container")),this.ship_number_invalid_container=$(this.points_container.find(".ship-number-invalid-container")),this.multi_faction_warning_container=$(this.points_container.find(".multi-faction-warning-container")),this.collection_invalid_container=$(this.points_container.find(".collection-invalid")),this.view_list_button=$(this.status_container.find("div.button-container button.view-as-text")),this.randomize_button=$(this.status_container.find("div.button-container button.randomize")),this.customize_randomizer=$(this.status_container.find("div.button-container a.randomize-options")),this.misc_settings=$(this.status_container.find("div.button-container a.misc-settings")),this.backend_status=$(this.status_container.find(".backend-status")),this.backend_status.hide(),this.collection_button=$(this.status_container.find("div.button-container a.collection")),this.collection_button.click(function(a){return function(b){if(b.preventDefault(),!a.collection_button.prop("disabled"))return a.collection.modal.modal("show")}}(this)),this.squad_name_input.keypress(function(a){return function(b){if(13===b.which)return a.squad_name_save_button.click(),!1}}(this)),this.squad_name_input.change(function(a){return function(b){return a.backend_status.fadeOut("slow")}}(this)),this.squad_name_input.blur(function(a){return function(b){return a.squad_name_input.change(),a.squad_name_save_button.click()}}(this)),this.squad_name_display.click(function(a){return function(b){return b.preventDefault(),a.squad_name_display.hide(),a.squad_name_input.val($.trim(a.current_squad.name)),window.setTimeout(function(){return a.squad_name_input.focus(),a.squad_name_input.select()},100),a.squad_name_input.closest("div").show()}}(this)),this.squad_name_save_button.click(function(a){return function(b){var c;if(b.preventDefault(),a.current_squad.dirty=!0,a.container.trigger("xwing-backend:squadDirtinessChanged"),c=a.current_squad.name=$.trim(a.squad_name_input.val()),c.length>0)return a.squad_name_display.show(),a.container.trigger("xwing-backend:squadNameChanged"),a.squad_name_input.closest("div").hide()}}(this)),this.randomizer_options_modal=$(document.createElement("DIV")),this.randomizer_options_modal.addClass("modal fade randomizer-modal"),this.randomizer_options_modal.tabindex="-1",this.randomizer_options_modal.role="dialog",$("body").append(this.randomizer_options_modal),this.randomizer_options_modal.append($.trim('<div class="modal-dialog modal-dialog-scrollable modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="Random Squad Builder Options"></h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <form>\n                <label>\n                    <span class="translated" defaultText="Maximum Ship Count"></span>\n                    <input type="number" class="randomizer-ship-limit" value="'+b+'" placeholder="'+b+'" />\n                </label><br />\n                <label>\n                    <input type="checkbox" class="randomizer-collection-only" checked="checked"/> \n                    <span class="translated" defaultText="Limit to collection"></span>\n                </label><br />\n                <label>\n                    <span class="translated" defaultText="Sets and Expansions"></span>\n                    <select class="randomizer-sources" multiple="1" data-placeholder=\''+this.uitranslation("All sets and expansions")+('\'>\n                    </select>\n                </label><br />\n                <label>\n                    <input type="checkbox" class="randomizer-fill-zero-pts" /> \n                    <span class="translated" defaultText="Always fill 0-point slots"></span>\n                </label><br />\n                <label>\n                    <span class="translated" defaultText="Maximum Seconds to Spend Randomizing"></span>\n                    <input type="number" class="randomizer-timeout" value="'+c+'" placeholder="'+c+'" />\n                </label>\n            </form>\n        </div>\n        <div class="modal-footer">\n            <button class="btn btn-primary do-randomize translated" aria-hidden="true" defaultText="Roll!"></button>\n            <button class="btn translated" data-dismiss="modal" aria-hidden="true" defaultText="Close"></button>\n        </div>\n    </div>\n</div>'))),exportObj.translateUIElements(this.randomizer_options_modal),this.randomizer_source_selector=$(this.randomizer_options_modal.find("select.randomizer-sources")),i=exportObj.expansions,g=0,h=i.length;g<h;g++)e=i[g],f=$(document.createElement("OPTION")),f.text(e),this.randomizer_source_selector.append(f);return this.randomizer_source_selector.select2({width:"100%",minimumResultsForSearch:$.isMobile()?-1:0}),this.randomizer_collection_selector=$(this.randomizer_options_modal.find(".randomizer-collection-only"))[0],this.randomizer_fill_zero_pts=$(this.randomizer_options_modal.find(".randomizer-fill-zero-pts"))[0],this.randomize_button.click(function(d){return function(e){var f,g,h;return e.preventDefault(),d.current_squad.dirty&&null!=d.backend?d.backend.warnUnsaved(d,function(){return d.randomize_button.click()}):(f=parseInt(d.desired_points_input.val()),(isNaN(f)||f<=0)&&(f=a),g=parseInt($(d.randomizer_options_modal.find(".randomizer-ship-limit")).val()),(isNaN(g)||g<0)&&(g=b),h=parseInt($(d.randomizer_options_modal.find(".randomizer-timeout")).val()),(isNaN(h)||h<=0)&&(h=c),d.randomSquad(f,d.randomizer_source_selector.val(),1e3*h,g,d.randomizer_collection_selector.checked,d.randomizer_fill_zero_pts.checked))}}(this)),this.randomizer_options_modal.find("button.do-randomize").click(function(a){return function(b){return b.preventDefault(),
a.randomizer_options_modal.modal("hide"),a.randomize_button.click()}}(this)),this.customize_randomizer.click(function(a){return function(b){return b.preventDefault(),a.randomizer_options_modal.modal()}}(this)),this.misc_settings_modal=$(document.createElement("DIV")),this.misc_settings_modal.addClass("modal fade"),this.misc_settings_modal.tabindex="-1",this.misc_settings_modal.role="dialog",$("body").append(this.misc_settings_modal),this.misc_settings_modal.append($.trim('<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="Miscellaneous Settings"></h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <label class = "toggle-initiative-prefix-names misc-settings-label">\n                <input type="checkbox" class="initiative-prefix-names-checkbox misc-settings-checkbox" /> <span class="translated" defaultText="Use INI prefix"></span> \n            </label><br />\n        </div>\n        <div class="modal-footer">\n            <span class="misc-settings-infoline"></span>\n            &nbsp;\n            <button class="btn translated" data-dismiss="modal" aria-hidden="true" defaultText="Close"></button>\n        </div>\n    </div>\n</div>')),this.misc_settings_infoline=$(this.misc_settings_modal.find(".misc-settings-infoline")),this.misc_settings_initiative_prefix=$(this.misc_settings_modal.find(".initiative-prefix-names-checkbox")),null!=this.backend?this.backend.getSettings(function(a){return function(b){if(null==exportObj.settings&&(exportObj.settings=[]),exportObj.settings.initiative_prefix=null!=b.showInitiativeInFrontOfPilotName,null!=b.showInitiativeInFrontOfPilotName)return a.misc_settings_initiative_prefix.prop("checked",!0)}}(this)):(null==this.waiting_for_backend&&(this.waiting_for_backend=[]),this.waiting_for_backend.push(function(a){return function(){return a.backend.getSettings(function(b){if(null==exportObj.settings&&(exportObj.settings=[]),exportObj.settings.initiative_prefix=null!=b.showInitiativeInFrontOfPilotName,null!=b.showInitiativeInFrontOfPilotName)return a.misc_settings_initiative_prefix.prop("checked",!0)})}}(this))),this.misc_settings_initiative_prefix.click(function(a){return function(b){if(null==exportObj.settings&&(exportObj.settings=[]),exportObj.settings.initiative_prefix=a.misc_settings_initiative_prefix.prop("checked"),null!=a.backend)return a.misc_settings_initiative_prefix.prop("checked")?a.backend.set("showInitiativeInFrontOfPilotName","1",function(b){return a.misc_settings_infoline.text(a.uitranslation("Changes Saved")),a.misc_settings_infoline.fadeIn(100,function(){return a.misc_settings_infoline.fadeOut(3e3)})}):a.backend.deleteSetting("showInitiativeInFrontOfPilotName",function(b){return a.misc_settings_infoline.text(a.uitranslation("Changes Saved")),a.misc_settings_infoline.fadeIn(100,function(){return a.misc_settings_infoline.fadeOut(3e3)})})}}(this)),this.misc_settings.click(function(a){return function(b){var c;return b.preventDefault(),a.misc_settings_modal.modal(),a.misc_settings_initiative_prefix.prop("checked",null!=(null!=(c=exportObj.settings)?c.initiative_prefix:void 0)&&exportObj.settings.initiative_prefix)}}(this)),exportObj.translateUIElements(this.misc_settings_modal),this.choose_obstacles_modal=$(document.createElement("DIV")),this.choose_obstacles_modal.addClass("modal fade choose-obstacles-modal"),this.choose_obstacles_modal.tabindex="-1",this.choose_obstacles_modal.role="dialog",this.container.append(this.choose_obstacles_modal),this.choose_obstacles_modal.append($.trim('<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <label class=\'choose-obstacles-description translated\' defaultText="Choose obstacles dialog"></label>\n        </div>\n        <div class="modal-body">\n            <div class="obstacle-select-container" style="float:left">\n                <select multiple class=\'obstacle-select\' size="18">\n                    <option class="coreasteroid0-select translated" value="coreasteroid0" defaultText="Core Asteroid 0"></option>\n                    <option class="coreasteroid1-select translated" value="coreasteroid1" defaultText="Core Asteroid 1"></option>\n                    <option class="coreasteroid2-select translated" value="coreasteroid2" defaultText="Core Asteroid 2"></option>\n                    <option class="coreasteroid3-select translated" value="coreasteroid3" defaultText="Core Asteroid 3"></option>\n                    <option class="coreasteroid4-select translated" value="coreasteroid4" defaultText="Core Asteroid 4"></option>\n                    <option class="coreasteroid5-select translated" value="coreasteroid5" defaultText="Core Asteroid 5"></option>\n                    <option class="yt2400debris0-select translated" value="yt2400debris0" defaultText="YT2400 Debris 0"></option>\n                    <option class="yt2400debris1-select translated" value="yt2400debris1" defaultText="YT2400 Debris 1"></option>\n                    <option class="yt2400debris2-select translated" value="yt2400debris2" defaultText="YT2400 Debris 2"></option>\n                    <option class="vt49decimatordebris0-select translated" value="vt49decimatordebris0" defaultText="VT49 Debris 0"></option>\n                    <option class="vt49decimatordebris1-select translated" value="vt49decimatordebris1" defaultText="VT49 Debris 1"></option>\n                    <option class="vt49decimatordebris2-select translated" value="vt49decimatordebris2" defaultText="VT49 Debris 2"></option>\n                    <option class="core2asteroid0-select translated" value="core2asteroid0" defaultText="Force Awakens Asteroid 0"></option>\n                    <option class="core2asteroid1-select translated" value="core2asteroid1" defaultText="Force Awakens Asteroid 1"></option>\n                    <option class="core2asteroid2-select translated" value="core2asteroid2" defaultText="Force Awakens Asteroid 2"></option>\n                    <option class="core2asteroid3-select translated" value="core2asteroid3" defaultText="Force Awakens Asteroid 3"></option>\n                    <option class="core2asteroid4-select translated" value="core2asteroid4" defaultText="Force Awakens Asteroid 4"></option>\n                    <option class="core2asteroid5-select translated" value="core2asteroid5" defaultText="Force Awakens Asteroid 5"></option>\n                    <option class="gascloud1-select translated" value="gascloud1" defaultText="Gas Cloud 1"></option>\n                    <option class="gascloud2-select translated" value="gascloud2" defaultText="Gas Cloud 2"></option>\n                    <option class="gascloud3-select translated" value="gascloud3" defaultText="Gas Cloud 3"></option>\n                    <option class="gascloud4-select translated" value="gascloud4" defaultText="Gas Cloud 4"></option>\n                    <option class="gascloud5-select translated" value="gascloud5" defaultText="Gas Cloud 5"></option>\n                    <option class="gascloud6-select translated" value="gascloud6" defaultText="Gas Cloud 6"></option>\n                    <option class="pomasteroid1-select translated" value="pomasteroid1" defaultText="Pride of Mandalore Rock 1"></option>\n                    <option class="pomasteroid2-select translated" value="pomasteroid2" defaultText="Pride of Mandalore Rock 2"></option>\n                    <option class="pomasteroid3-select translated" value="pomasteroid3" defaultText="Pride of Mandalore Rock 3"></option>\n                    <option class="pomdebris1-select translated" value="pomdebris1" defaultText="Pride of Mandalore Debris 1"></option>\n                    <option class="pomdebris2-select translated" value="pomdebris2" defaultText="Pride of Mandalore Debris 2"></option>\n                    <option class="pomdebris3-select translated" value="pomdebris3" defaultText="Pride of Mandalore Debris 3"></option>\n                </select>\n            </div>\n            <div>\n                <div class="obstacle-image-container" style="display:none;">\n                    <img class="obstacle-image" src="images/core2asteroid0.png" />\n                </div>\n                <div class="obstacle-sources-container">\n                    <span class="info-header obstacle-sources translated" defaultText="Sources:"></span> \n                    <span class="info-data obstacle-sources"></span>\n                </div>\n            </div>\n        </div>\n        <div class="modal-footer d-print-none">\n            <button class="btn close-print-dialog translated" data-dismiss="modal" aria-hidden="true" defaultText="Close"></button>\n        </div>\n    </div>\n</div>')),this.obstacles_select=this.choose_obstacles_modal.find(".obstacle-select"),this.obstacles_select_image=this.choose_obstacles_modal.find(".obstacle-image-container"),this.obstacles_select_sources=this.choose_obstacles_modal.find(".info-data.obstacle-sources"),this.backend_list_squads_button=$(this.container.find("button.backend-list-my-squads")),this.backend_list_squads_button.click(function(a){return function(b){if(b.preventDefault(),null!=a.backend)return a.backend.list(a)}}(this)),this.backend_save_list_button=$(this.container.find("button.save-list")),this.backend_save_list_button.click(function(a){return function(b){var c,d,e,f,g;return g=__iced_k_noop,e=iced.findDeferral(arguments),b.preventDefault(),null==a.backend||a.backend_save_list_button.hasClass("disabled")?g():(c={points:a.total_points,description:"",cards:a.listCards(),notes:a.notes.val().substr(0,1024),obstacles:a.getObstacles(),tag:a.tag.val().substr(0,1024)},a.backend_status.html($.trim('<i class="fa fa-sync fa-spin"></i>&nbsp;<span class="translated" defaultText="Saving squad..."></span>')),a.backend_status.show(),a.backend_save_list_button.addClass("disabled"),function(b){f=new iced.Deferrals(b,{parent:e}),a.backend.save(a.serialize(),a.current_squad.id,a.current_squad.name,a.faction,c,f.defer({assign_fn:function(){return function(){return d=arguments[0]}}(),lineno:3095})),f._fulfill()}(function(){return g(d.success?(a.current_squad.dirty=!1,null!=a.current_squad.id?a.backend_status.html($.trim('<i class="fa fa-check"></i>&nbsp;<span class="translated" defaultText="Squad updated successfully."></span>')):(a.backend_status.html($.trim('<i class="fa fa-check"></i>&nbsp;<span class="translated" defaultText="New squad saved successfully."></span>')),a.current_squad.id=d.id),a.container.trigger("xwing-backend:squadDirtinessChanged")):(a.backend_status.html($.trim('<i class="fa fa-exclamation-circle"></i>&nbsp;'+d.error)),a.backend_save_list_button.removeClass("disabled")))}),void 0)}}(this)),this.backend_save_list_as_button=$(this.container.find("button.save-list-as")),this.backend_save_list_as_button.addClass("disabled"),this.backend_save_list_as_button.click(function(a){return function(b){if(b.preventDefault(),null!=a.backend&&!a.backend_save_list_as_button.hasClass("disabled"))return a.backend.showSaveAsModal(a)}}(this)),this.backend_delete_list_button=$(this.container.find("button.delete-list")),this.backend_delete_list_button.click(function(a){return function(b){if(b.preventDefault(),null!=a.backend&&!a.backend_delete_list_button.hasClass("disabled"))return a.backend.showDeleteModal(a)}}(this)),d=$(document.createElement("DIV")),d.addClass("container-fluid"),this.container.append(d),d.append($.trim('<div class="row">\n    <div class="col-md-9 ship-container">\n        <label class="unsortable notes-container show-authenticated col-md-10">\n        </label>\n        <div class="unsortable obstacles-container">\n                <button class="btn btn-info choose-obstacles"><i class="fa fa-cloud"></i>&nbsp;<span class="translated" defaultText="Choose Obstacles"</span></button>\n        </div>\n    </div>\n    <div class="col-md-3 info-container" id="info-container">\n    </div>\n</div>')),this.ship_container=$(d.find("div.ship-container")),this.info_container=$(d.find("div.info-container")),this.obstacles_container=d.find(".obstacles-container"),this.notes_container=$(d.find(".notes-container")),this.notes=$(this.notes_container.find("textarea.squad-notes")),this.tag=$(this.notes_container.find("input.squad-tag")),this.ship_container.sortable({cancel:".unsortable"}),this.info_container.append($.trim(this.createInfoContainerUI())),this.info_container.find(".info-well").hide(),this.info_intro=this.info_container.find(".intro"),this.print_list_button=$(this.container.find("button.print-list")),this.container.find("[rel=tooltip]").tooltip(),this.obstacles_button=$(this.container.find("button.choose-obstacles")),this.obstacles_button.click(function(a){return function(b){return b.preventDefault(),a.showChooseObstaclesModal()}}(this)),this.condition_container=$(document.createElement("div")),this.condition_container.addClass("conditions-container d-flex flex-wrap"),this.container.append(this.condition_container),this.mobile_tooltip_modal=$(document.createElement("DIV")),this.mobile_tooltip_modal.addClass("modal fade choose-obstacles-modal d-print-none"),this.mobile_tooltip_modal.tabindex="-1",this.mobile_tooltip_modal.role="dialog",this.container.append(this.mobile_tooltip_modal),this.mobile_tooltip_modal.append($.trim('<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n        </div>\n        <div class="modal-body">'+this.createInfoContainerUI(!1)+'        </div>\n        <div class="modal-footer">\n            <button class="btn btn-danger close-print-dialog translated" data-dismiss="modal" aria-hidden="true" defaultText="Close"></button>\n        </div>\n    </div>\n</div>')),this.mobile_tooltip_modal.find("intro").hide(),exportObj.translateUIElements(this.container)},a.prototype.createInfoContainerUI=function(a){var b;return null==a&&(a=!0),b=a===!0?'<div class="card intro translated" defaultText="Intro Card YASB">\n</div>':"",""+b+'\n<div class="card info-well">\n    <div class="info-name"></div>\n    <div class="info-type"></div>\n    <span class="info-collection"></span>\n    <table class="table-sm">\n        <tbody>\n            <tr class="info-faction">\n                <td class="info-header translated" defaultText="Faction"></td>\n                <td class="info-data"></td>\n            </tr>\n            <tr class="info-ship">\n                <td class="info-header translated" defaultText="Ship"></td>\n                <td class="info-data"></td>\n            </tr>\n            <tr class="info-loadout">\n                <td class="info-header translated" defaultText="Loadout"></td>\n                <td class="info-data info-loadout"></td>\n            </tr>\n            <tr class="info-base">\n                <td class="info-header translated" defaultText="Base"></td>\n                <td class="info-data"></td> \n            </tr>\n            <tr class="info-skill">\n                <td class="info-header translated" defaultText="Initiative"></td>\n                <td class="info-data info-skill"></td>\n            </tr>\n            <tr class="info-points">\n                <td class="info-header translated" defaultText="Points"></td>\n                <td class="info-data info-points"></td>\n            </tr>\n            <tr class="info-engagement">\n                <td class="info-header translated" defaultText="Engagement"></td>\n                <td class="info-data info-engagement"></td>\n            </tr>\n            <tr class="info-attack-bullseye">\n                <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-bullseyearc"></i></td>\n                <td class="info-data info-attack"></td>\n            </tr>\n            <tr class="info-attack">\n                <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-frontarc"></i></td>\n                <td class="info-data info-attack"></td>\n            </tr>\n            <tr class="info-attack-fullfront">\n                <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-fullfrontarc"></i></td>\n                <td class="info-data info-attack"></td>\n            </tr>\n            <tr class="info-attack-left">\n                <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-leftarc"></i></td>\n                <td class="info-data info-attack"></td>\n            </tr>\n            <tr class="info-attack-right">\n                <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-rightarc"></i></td>\n                <td class="info-data info-attack"></td>\n            </tr>\n            <tr class="info-attack-back">\n                <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-reararc"></i></td>\n                <td class="info-data info-attack"></td>\n            </tr>\n            <tr class="info-attack-turret">\n                <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-singleturretarc"></i></td>\n                <td class="info-data info-attack"></td>\n            </tr>\n            <tr class="info-attack-doubleturret">\n                <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-doubleturretarc"></i></td>\n                <td class="info-data info-attack"></td>\n            </tr>\n            <tr class="info-agility">\n                <td class="info-header"><i class="xwing-miniatures-font header-agility xwing-miniatures-font-agility"></i></td>\n                <td class="info-data info-agility"></td>\n            </tr>\n            <tr class="info-hull">\n                <td class="info-header"><i class="xwing-miniatures-font header-hull xwing-miniatures-font-hull"></i></td>\n                <td class="info-data info-hull"></td>\n            </tr>\n            <tr class="info-shields">\n                <td class="info-header"><i class="xwing-miniatures-font header-shield xwing-miniatures-font-shield"></i></td>\n                <td class="info-data info-shields"></td>\n            </tr>\n            <tr class="info-force">\n                <td class="info-header"><i class="xwing-miniatures-font header-force xwing-miniatures-font-forcecharge"></i></td>\n                <td class="info-data info-force"></td>\n            </tr>\n            <tr class="info-charge">\n                <td class="info-header"><i class="xwing-miniatures-font header-charge xwing-miniatures-font-charge"></i></td>\n                <td class="info-data info-charge"></td>\n            </tr>\n            <tr class="info-energy">\n                <td class="info-header"><i class="xwing-miniatures-font header-energy xwing-miniatures-font-energy"></i></td>\n                <td class="info-data info-energy"></td>\n            </tr>\n            <tr class="info-range">\n                <td class="info-header translated" defaultText="Range"></td>\n                <td class="info-data info-range"></td><td class="info-rangebonus"><i class="xwing-miniatures-font red header-range xwing-miniatures-font-rangebonusindicator"></i></td>\n            </tr>\n            <tr class="info-actions">\n                <td class="info-header translated" defaultText="Actions"></td>\n                <td class="info-data"></td>\n            </tr>\n            <tr class="info-upgrades">\n                <td class="info-header translated" defaultText="Upgrades"></td>\n                <td class="info-data"></td>\n            </tr>\n        </tbody>\n    </table>\n    <p class="info-restrictions"></p>\n    <p class="info-text"></p>\n    <p class="info-chassis"></p>\n    <p class="info-maneuvers"></p>\n    <br />\n    <span class="info-header info-sources translated" defaultText="Sources:"></span> \n    <span class="info-data info-sources"></span>\n</div>'},a.prototype.setupEventHandlers=function(){return this.container.on("xwing:claimUnique",function(a){return function(b,c,d,e){return a.claimUnique(c,d,e)}}(this)).on("xwing:releaseUnique",function(a){return function(b,c,d,e){return a.releaseUnique(c,d,e)}}(this)).on("xwing:pointsUpdated",function(a){return function(b,c){return null==c&&(c=$.noop),a.isUpdatingPoints?c():(a.isUpdatingPoints=!0,a.onPointsUpdated(function(){return a.isUpdatingPoints=!1,c()}))}}(this)).on("xwing-backend:squadLoadRequested",function(a){return function(b,c,d){return null==d&&(d=$.noop),a.onSquadLoadRequested(c),d()}}(this)).on("xwing-backend:squadDirtinessChanged",function(a){return function(b){return a.onSquadDirtinessChanged()}}(this)).on("xwing-backend:squadNameChanged",function(a){return function(b){return a.onSquadNameChanged()}}(this)).on("xwing:beforeLanguageLoad",function(a){return function(b,c){return null==c&&(c=$.noop),a.pretranslation_serialized=a.serialize(),c()}}(this)).on("xwing:afterLanguageLoad",function(a){return function(b,c,d){var e,f,g,h,i;if(null==d&&(d=$.noop),a.language!==c){for(a.language=c,e=a.current_squad.dirty,null!=a.pretranslation_serialized.length&&a.loadFromSerialized(a.pretranslation_serialized),i=a.ships,g=0,h=i.length;g<h;g++)f=i[g],f.updateSelections();a.current_squad.dirty=e,a.pretranslation_serialized=void 0}return d()}}(this)).on("xwing:shipUpdated",function(a){return function(b,c){var d,e,f,g,h;for(null==c&&(c=$.noop),d=!0,h=a.ships,f=0,g=h.length;f<g;f++)e=h[f],e.updateSelections(),""===e.ship_selector.val()&&(d=!1);if(d&&!a.suppress_automatic_new_ship)return a.addShip()}}(this)),$(window).on("xwing-backend:authenticationChanged",function(a){return function(b){return a.resetCurrentSquad()}}(this)).on("xwing-collection:created",function(a){return function(b,c){return a.collection=c,a.checkCollection(),a.collection_button.removeClass("d-none")}}(this)).on("xwing-collection:changed",function(a){return function(b,c){return a.checkCollection()}}(this)).on("xwing-collection:destroyed",function(a){return function(b,c){return a.collection=null,a.collection_button.addClass("d-none")}}(this)).on("xwing:pingActiveBuilder",function(a){return function(b,c){if(a.container.is(":visible"))return c(a)}}(this)).on("xwing:activateBuilder",function(a){return function(b,c,d){if(c===a.faction)return a.tab.tab("show"),d(a)}}(this)),this.ship_container.on("sortstart",function(a){return function(b,c){return a.oldIndex=c.item.index()}}(this)).on("sortstop",function(a){return function(b,c){return a.updateShipOrder(a.oldIndex,c.item.index())}}(this)),this.obstacles_select.change(function(a){return function(b){var c,d,e;return a.obstacles_select.val().length>3?a.obstacles_select.val(a.current_squad.additional_data.obstacles):(e=a.current_squad.additional_data.obstacles,a.current_obstacles=function(){var a,b,c,e;for(c=this.obstacles_select.val(),e=[],a=0,b=c.length;a<b;a++)d=c[a],e.push(d);return e}.call(a),c=null!=e?a.current_obstacles.filter(function(a){return e.indexOf(a)===-1}):a.current_obstacles,c.length>0&&a.showChooseObstaclesSelectInformation(c[0]),a.current_squad.additional_data.obstacles=a.current_obstacles,a.current_squad.dirty=!0,a.container.trigger("xwing-backend:squadDirtinessChanged"),a.container.trigger("xwing:pointsUpdated"))}}(this)),this.view_list_button.click(function(a){return function(b){return b.preventDefault(),a.showTextListModal()}}(this)),this.print_list_button.click(function(a){return function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;switch(b.preventDefault(),a.printable_container.find(".printable-header").html(a.list_modal.find(".modal-header").html()),a.printable_container.find(".printable-body").text(""),a.list_display_mode){case"simple":a.printable_container.find(".printable-body").html(a.simple_container.html());break;default:for(v=a.ships,l=0,p=v.length;l<p;l++)j=v[l],null!=j.pilot&&a.printable_container.find(".printable-body").append(j.toHTML());if(a.printable_container.find(".fancy-ship").toggleClass("tall",a.list_modal.find(".toggle-vertical-space").prop("checked")),a.printable_container.find(".printable-body").toggleClass("bw",!a.list_modal.find(".toggle-color-print").prop("checked")),a.list_modal.find(".toggle-skip-text-print").prop("checked"))for(w=a.printable_container.find(".upgrade-text, .fancy-pilot-text"),m=0,q=w.length;m<q;m++)k=w[m],k.hidden=!0;for(a.list_modal.find(".toggle-maneuver-print").prop("checked")&&a.printable_container.find(".printable-body").append(a.getSquadDialsAsHTML()),d=a.list_modal.find(".toggle-expanded-shield-hull-print").prop("checked"),x=a.printable_container.find(".expanded-hull-or-shield"),n=0,r=x.length;n<r;n++)c=x[n],c.hidden=!d;for(y=a.printable_container.find(".simple-hull-or-shield"),o=0,s=y.length;o<s;o++)c=y[o],c.hidden=d;e=function(){switch(this.faction){case"Rebel Alliance":return"rebel";case"Galactic Empire":return"empire";case"Scum and Villainy":return"scum";case"Resistance":return"rebel-outline";case"First Order":return"firstorder";case"Galactic Republic":return"republic";case"Separatist Alliance":return"separatists";case"All":return"first-player-4"}}.call(a),a.printable_container.find(".squad-faction").html('<i class="xwing-miniatures-font xwing-miniatures-font-'+e+'"></i>')}if(a.isStandard&&a.printable_container.find(".squad-name").append(' <i class="xwing-miniatures-font xwing-miniatures-font-first-player-1"></i>'),a.isEpic&&a.printable_container.find(".squad-name").append(' <i class="xwing-miniatures-font xwing-miniatures-font-energy"></i>'),a.printable_container.find(".printable-body").append($.trim('<div class="version">Points Version: 06/15/2022</div>')),""!==$.trim(a.notes.val())&&(a.printable_container.find(".printable-body").append($.trim('<h5 class="print-notes translated" defaultText="Notes:"></h5>\n<pre class="print-notes"></pre>')),a.printable_container.find(".printable-body pre.print-notes").text(a.notes.val())),a.printable_container.find(".printable-body").append($.trim('<div class="print-conditions"></div>')),a.printable_container.find(".printable-body .print-conditions").html(a.condition_container.html()),a.list_modal.find(".toggle-obstacles").prop("checked")){for(h=a.getObstacles(),f="",u=0,t=h.length;u<t;u++)g=h[u],f+='<img class="obstacle-silhouettes" src="images/'+g+'.png" />';a.printable_container.find(".printable-body").append($.trim('<div class="obstacles">\n    <div>Chosen Obstacles:<br>'+f+"</div>\n</div>"))}return i=a.getPermaLinkParams(["sn","obs"]),null!=i&&a.list_modal.find(".toggle-juggler-qrcode").prop("checked")&&(a.printable_container.find(".printable-body").append($.trim('<div class="qrcode-container">\n    <div class="permalink-container">\n        <div class="qrcode"></div>\n        <div class="qrcode-text translated" defaultText="Scan QR-Code"></div>\n    </div>\n    <div class="juggler-container">\n        <div class="qrcode"></div>\n        <div class="qrcode-text translated" defaultText="List Juggler QR-Code"></div>\n    </div>\n</div>')),k="https://yasb-xws.herokuapp.com/juggler"+i,a.printable_container.find(".juggler-container .qrcode").qrcode({render:"div",ec:"M",size:k.length<144?144:160,text:k}),k="https://yasb.app/"+i,a.printable_container.find(".permalink-container .qrcode").qrcode({render:"div",ec:"M",size:k.length<144?144:160,text:k})),window.print()}}(this)),$(window).resize(function(a){return function(){var b,c,d,e,f;for($(window).width()<768&&"simple"!==a.list_display_mode&&a.select_simple_view_button.click(),e=a.ships,f=[],c=0,d=e.length;c<d;c++)b=e[c],f.push(b.checkPilotSelectorQueryModal());return f}}(this)),this.notes.change(this.onNotesUpdated),this.tag.change(this.onNotesUpdated),this.notes.on("keyup",this.onNotesUpdated),this.tag.on("keyup",this.onNotesUpdated)},a.prototype.getPermaLinkParams=function(a){var b,c,d;return null==a&&(a=[]),c={},__indexOf.call(a,"f")<0&&(c.f=encodeURI(this.faction)),__indexOf.call(a,"d")<0&&(c.d=encodeURI(this.serialize())),__indexOf.call(a,"sn")<0&&(c.sn=encodeURIComponent(this.current_squad.name)),__indexOf.call(a,"obs")<0&&(c.obs=encodeURI(this.current_squad.additional_data.obstacles||"")),"?"+function(){var a;a=[];for(b in c)d=c[b],a.push(""+b+"="+d);return a}().join("&")},a.prototype.getPermaLink=function(a){return null==a&&(a=this.getPermaLinkParams()),""+URL_BASE+a},a.prototype.updateShipOrder=function(a,b){var c;if(c=this.ships[a],this.ships.splice(a,1),this.ships.splice(b,0,c),this.updatePermaLink,a!==b)return this.current_squad.dirty=!0,this.container.trigger("xwing-backend:squadDirtinessChanged")},a.prototype.updatePermaLink=function(){var a;if(this.container.is(":visible"))return a=this.getPermaLinkParams(),window.location.search!==a?window.history.replaceState(a,"",this.getPermaLink(a)):void 0},a.prototype.onNotesUpdated=function(){if(this.total_points>0)return this.current_squad.dirty=!0,this.container.trigger("xwing-backend:squadDirtinessChanged")},a.prototype.onGameTypeChanged=function(a,b){var c,d,e,f;return null==b&&(b=$.noop),f=this.isStandard,c=this.isEpic,d=this.isQuickbuild,this.isStandard=!1,this.isEpic=!1,this.isQuickbuild=!1,this.desired_points_input.val(20),d!==this.isQuickbuild?(e=this.current_squad.id,this.newSquadFromScratch($.trim(this.current_squad.name)),this.current_squad.id=e):(e=this.current_squad.id,this.container.trigger("xwing:pointsUpdated",$.noop),this.container.trigger("xwing:shipUpdated")),b()},a.prototype.addStandardizedToList=function(a){return a.addStandardizedUpgrades()},a.prototype.onPointsUpdated=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;for(null==a&&(a=$.noop),j=0,e=0,k=!1,d=l=o=this.ships.length-1;o<=-1?l<-1:l>-1;d=o<=-1?++l:--l)h=this.ships[d],h.validate(),h&&(this.addStandardizedToList(h),j+=h.getPoints(),1===h.destroystate?e+=Math.floor(h.getPoints()/2):2===h.destroystate&&(e+=h.getPoints()),i=h.checkUnreleasedContent(),i&&(k=i));if(this.total_points=j,this.points_destroyed=e,this.total_points_span.text(this.total_points),g=parseInt(this.desired_points_input.val())-this.total_points,f=parseInt(this.total_points),this.points_remaining_span.text(g),this.points_destroyed_span.html(0!==e?'<i class="xwing-miniatures-font xwing-miniatures-font-hit"></i>'+e:""),this.points_remaining_container.toggleClass("red",g<0),this.unreleased_content_used_container.toggleClass("d-none",!k),this.fancy_total_points_container.text(this.total_points),this.updatePrintAndExportTexts(),this.checkCollection(),"undefined"!=typeof Set&&null!==Set){for(c=new Set,p=this.ships,m=0,n=p.length;m<n;m++)h=p[m],h.getConditions().forEach(function(a){return c.add(a)});b=[],c.forEach(function(a){return b.push(a)}),b.sort(function(a,b){return a.name.canonicalize()<b.name.canonicalize()?-1:b.name.canonicalize()>a.name.canonicalize()?1:0}),this.condition_container.text(""),b.forEach(function(a){return function(b){return a.condition_container.append(conditionToHTML(b))}}(this))}return a(this.total_points)},a.prototype.onSquadLoadRequested=function(a){var b,c;return this.current_squad=a,this.backend_delete_list_button.removeClass("disabled"),this.updateObstacleSelect(this.current_squad.additional_data.obstacles),null!=a.serialized.length&&this.loadFromSerialized(a.serialized),this.notes.val(null!=(b=a.additional_data.notes)?b:""),this.tag.val(null!=(c=a.additional_data.tag)?c:""),this.backend_status.fadeOut("slow"),this.current_squad.dirty=!1,this.container.trigger("xwing-backend:squadNameChanged"),this.container.trigger("xwing-backend:squadDirtinessChanged")},a.prototype.onSquadDirtinessChanged=function(){return this.backend_save_list_button.toggleClass("disabled",!(this.current_squad.dirty&&this.total_points>0)),this.backend_save_list_as_button.toggleClass("disabled",0===this.total_points),
this.backend_delete_list_button.toggleClass("disabled",null==this.current_squad.id),this.ships.length>1?$('meta[property="og:description"]').attr("content",this.uitranslation("X-Wing Squadron by YASB: ")+this.current_squad.name+": "):$('meta[property="og:description"]').attr("content",this.uitranslation("YASB advertisment"))},a.prototype.onSquadNameChanged=function(){var a;if(a=this.current_squad.name.length>SQUAD_DISPLAY_NAME_MAX_LENGTH?""+this.current_squad.name.substr(0,SQUAD_DISPLAY_NAME_MAX_LENGTH)+"&hellip;":this.current_squad.name,this.squad_name_placeholder.text(""),this.squad_name_placeholder.append(a),this.squad_name_input.val(this.current_squad.name),$.getParameterByName("f")===this.faction)return this.current_squad.name!==this.uitranslation("Unnamed Squadron")&&this.current_squad.name!==this.uitranslation("Unsaved Squadron")?document.title!=="YASB - "+this.current_squad.name&&(document.title="YASB - "+this.current_squad.name):document.title="YASB",this.updatePrintAndExportTexts()},a.prototype.updatePrintAndExportTexts=function(){var a,b,c,d,e,f,g,h,i,j,k,l;for(this.fancy_container.text(""),this.simple_container.html('<table class="simple-table"></table>'),e=[],c=[],g=[],l=this.ships,h=0,j=l.length;h<j;h++)d=l[h],null!=d.pilot&&(this.fancy_container.append(d.toHTML()),this.simple_container.find("table").append(d.toTableRow()),e.push(d.toSimpleCopy()),c.push(d.toRedditText()),g.push(d.toTTSText()));if(this.reddit_container.find("textarea").val($.trim(""+c.join("    \n")+"    \n**"+this.uitranslation("Total")+":** *"+this.total_points+"*    \n    \n["+this.uitranslation("View in YASB")+"]("+this.getPermaLink()+")")),this.simplecopy_container.find("textarea").val($.trim(""+e.join("")+"    \n"+this.uitranslation("Total")+": "+this.total_points+"    \n    \n"+this.uitranslation("View in YASB")+": "+this.getPermaLink())),b=this.getObstacles(),null!=b&&b.length>0&&g.length>0){for(g[g.length-1]=g[g.length-1].slice(0,-2),f=" |",i=0,k=b.length;i<k;i++)a=b[i],null!=a&&(f+=" "+a+" /");f=f.slice(0,-1),g.push(f)}return this.tts_textarea.val($.trim(""+g.join(""))),this.xws_textarea.val($.trim(JSON.stringify(this.toXWS()))),$("#xws-qrcode-container").text(""),$("#xws-qrcode-container").qrcode({render:"canvas",text:JSON.stringify(this.toMinimalXWS()),ec:"L",size:128})},a.prototype.removeAllShips=function(){for(;this.ships.length>0;)this.removeShip(this.ships[0]);if(this.ships.length>0)throw new Error(this.uitranslation("Ships not emptied"))},a.prototype.showTextListModal=function(){return this.list_modal.modal("show")},a.prototype.showXWSModal=function(a){return this.select_xws_view(),this.showTextListModal()},a.prototype.showChooseObstaclesModal=function(){return this.obstacles_select.val(this.current_squad.additional_data.obstacles),this.choose_obstacles_modal.modal("show")},a.prototype.showChooseObstaclesSelectInformation=function(a){return this.showChooseObstaclesSelectImage(a),this.showChooseObstaclesSelectSources(a)},a.prototype.showChooseObstaclesSelectSources=function(a){var b,c,d,e;return b=null!=(c=null!=(d=exportObj.obstacles[a])?d.sources:void 0)?c:[],this.obstacles_select_sources.text(b.length>1||(e=exportObj.translate("sources","Loose Ships"),!(__indexOf.call(b,e)>=0))?b.length>0?b.join(", "):"":this.uitranslation("Only available from 1st edition"))},a.prototype.showChooseObstaclesSelectImage=function(a){return this.image_name="images/"+a+".png",this.obstacles_select_image.find(".obstacle-image").attr("src",this.image_name),this.obstacles_select_image.show()},a.prototype.updateObstacleSelect=function(a){return this.current_obstacles=null!=a?a:[],this.obstacles_select.val(a)},a.prototype.serialize=function(){var a,b,c;return b=9,a=$.trim(this.desired_points_input.val()),"v"+b+"ZhZ"+a+"Z"+function(){var a,b,d,e;for(d=this.ships,e=[],a=0,b=d.length;a<b;a++)c=d[a],null==c.pilot||this.isQuickbuild&&!c.primary||e.push(c.toSerialized());return e}.call(this).join("Y")},a.prototype.loadFromSerialized=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;if(this.suppress_automatic_new_ship=!0,this.removeAllShips(),i=__indexOf.call(a,"Z")>=0?/^v(\d+)Z(.*)/:/^v(\d+)!(.*)/,f=i.exec(a),null!=f){if(p=parseInt(f[1]),n=p>7?"Y":";",w=p>7?(u=f[2].split("Z"),c=u[0],h=u[1],j=u[2],u,[c,parseInt(h),j]):(v=f[2].split("!"),e=v[0],j=v[1],v,h=parseInt(e.split("=")[1])?parseInt(e.split("=")[1]):20,c=e.split("=")[0],[c,h,j]),d=w[0],b=w[1],l=w[2],p<9)return this.old_version_container.toggleClass("d-none",!1),this.suppress_automatic_new_ship=!1,void this.addShip();if(null==l)return this.loading_failed_container.toggleClass("d-none",!1),this.suppress_automatic_new_ship=!1,void this.addShip();if(this.desired_points_input.val(b),this.desired_points_input.change(),o=[],null!=l.length){for(x=l.split(n),q=0,s=x.length;q<s;q++)k=x[q],""!==k&&(g=this.addShip(),g.fromSerialized(p,k)&&g.pilot||o.push([g,k]));for(r=0,t=o.length;r<t;r++)m=o[r],m[0].pilot||(m[0]=this.addShip()),m[0].fromSerialized(p,m[1])}}return this.suppress_automatic_new_ship=!1,this.addShip()},a.prototype.select_xws_view=function(){if(this.select_xws_view_button.blur(),"xws"!==this.list_display_mode)return this.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),this.select_xws_view_button.addClass("btn-inverse"),this.list_display_mode="xws",this.xws_container.show(),this.simple_container.hide(),this.simplecopy_container.hide(),this.reddit_container.hide(),this.fancy_container.hide(),this.tts_container.hide(),this.xws_textarea.select(),this.xws_textarea.focus(),this.toggle_vertical_space_container.hide(),this.toggle_color_print_container.hide(),this.toggle_color_skip_text.hide(),this.toggle_maneuver_dial_container.hide(),this.toggle_expanded_shield_hull_container.hide(),this.toggle_qrcode_container.hide(),this.toggle_obstacle_container.hide(),this.btn_print_list.disabled=!0},a.prototype.uniqueIndex=function(a,b){if(!(b in this.uniques_in_use))throw new Error("Invalid unique type '"+b+"'");return this.uniques_in_use[b].indexOf(a)},a.prototype.claimUnique=function(a,b,c){var d,e,f,g,h,i,j;if(!(this.uniqueIndex(a,b)<0))throw new Error("Unique "+b+" '"+a.name+"' already claimed");for(i=exportObj.pilotsByUniqueName[a.canonical_name.getXWSBaseName()]||[],e=0,g=i.length;e<g;e++)if(d=i[e],a!==d){if(!(this.uniqueIndex(d,"Pilot")<0))throw new Error("Unique "+b+" '"+a.name+"' already claimed as pilot");this.uniques_in_use.Pilot.push(d)}for(j=exportObj.upgradesByUniqueName[a.canonical_name.getXWSBaseName()]||[],f=0,h=j.length;f<h;f++){if(d=j[f],!(this.uniqueIndex(d,"Upgrade")<0))throw new Error("Unique "+b+" '"+d.name+"' already claimed as pilot");this.uniques_in_use.Upgrade.push(d)}return null!=a.solitary&&this.uniques_in_use.Slot.push(a.slot),this.uniques_in_use[b].push(a),c()},a.prototype.releaseUnique=function(a,b,c){var d,e,f,g,h,i,j,k;if(d=this.uniqueIndex(a,b),!(d>=0))throw new Error("Unique "+b+" '"+a.name+"' not in use");k=this.uniques_in_use;for(b in k)if(f=k[b],"Slot"===b){if(null!=a.solitary)for(this.uniques_in_use[b]=[],g=0,i=f.length;g<i;g++)e=f[g],e!==a.slot&&this.uniques_in_use[b].push(e.slot)}else for(this.uniques_in_use[b]=[],h=0,j=f.length;h<j;h++)e=f[h],e.canonical_name.getXWSBaseName()!==a.canonical_name.getXWSBaseName()&&this.uniques_in_use[b].push(e);return c()},a.prototype.addShip=function(){var a;return a=new Ship({builder:this,container:this.ship_container}),this.ships.push(a),this.ship_number_invalid_container.toggleClass("d-none",this.ships.length<10&&this.ships.length>3),this.multi_faction_warning_container.toggleClass("d-none","All"!==this.faction),a},a.prototype.removeShip=function(a,b){var c,d,e;e=__iced_k_noop,c=iced.findDeferral(arguments),null==b&&(b=$.noop),function(b){return function(e){return null==(null!=a?a.destroy:void 0)?e():void!function(b){d=new iced.Deferrals(b,{parent:c,funcname:"SquadBuilder.removeShip"}),a.destroy(d.defer({lineno:3936})),d._fulfill()}(function(){!function(a){d=new iced.Deferrals(a,{parent:c,funcname:"SquadBuilder.removeShip"}),b.container.trigger("xwing:pointsUpdated",d.defer({lineno:3937})),d._fulfill()}(function(){return b.current_squad.dirty=!0,b.container.trigger("xwing-backend:squadDirtinessChanged"),b.ship_number_invalid_container.toggleClass("d-none",b.ships.length<10&&b.ships.length>3),e(b.multi_faction_warning_container.toggleClass("d-none","All"!==b.faction))})})}}(this)(function(a){return function(){return b()}}(this))},a.prototype.matcher=function(a,b){return a.toUpperCase().indexOf(b.toUpperCase())>=0},a.prototype.isOurFaction=function(a,b){var c,d,e,f;if(null==b&&(b=""),c=this.faction,"All"===this.faction){if(""===b)return!0;c=b}if(a instanceof Array){for(e=0,f=a.length;e<f;e++)if(d=a[e],getPrimaryFaction(d)===c)return!0;return!1}return getPrimaryFaction(a)===c},a.prototype.isItemAvailable=function(a,b){return null==b&&(b=!1),!!this.isQuickbuild||(this.isStandard?exportObj.standardCheck(a,this.faction,b):!!this.isEpic||exportObj.epicExclusions(a))},a.prototype.getAvailableShipsMatching=function(a,b,c){var d,e,f,g;null==a&&(a=""),null==b&&(b=!0),null==c&&(c=!1),f=[],g=exportObj.ships;for(e in g)d=g[e],this.isOurFaction(d.factions)&&(this.matcher(d.name,a)||d.display_name&&this.matcher(d.display_name,a))&&this.isItemAvailable(d,!0)&&(!c||null!=this.collection&&"true"===this.collection.checks.collectioncheck&&this.collection.checkShelf("ship",d.name))&&f.push({id:d.name,text:d.display_name?d.display_name:d.name,chassis:d.chassis,name:d.name,display_name:d.display_name,canonical_name:d.canonical_name,xws:d.xws,icon:d.icon?d.icon:d.xws});return b&&f.sort(exportObj.sortHelper),f},a.prototype.getAvailableShipsMatchingAndCheapEnough=function(a,b,c,d){var e,f,g,h,i,j;for(null==b&&(b=""),null==c&&(c=!1),null==d&&(d=!1),g=this.getAvailableShipsMatching(b,c,d),e=[],i=0,j=g.length;i<j;i++)h=g[i],f=this.getAvailablePilotsForShipIncluding(h.name,null,"",!0),f.length&&f[0].points<=a&&e.push(h);return e},a.prototype.getAvailablePilotsForShipIncluding=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;if(null==c&&(c=""),null==d&&(d=!0),null==e&&(e=null),s=[],this.isQuickbuild){if(r=function(){var b,d;b=exportObj.quickbuildsById,d=[];for(i in b)q=b[i],(null==a||q.ship===a)&&this.isOurFaction(q.faction)&&(this.matcher(q.pilot,c)||null!=exportObj.pilots[q.pilot].display_name&&this.matcher(exportObj.pilots[q.pilot].display_name,c))&&d.push(q);return d}.call(this),t=[],null!=b&&b!==-1){if(k=exportObj.quickbuildsById[b],j=exportObj.pilots[k.pilot],null!=j.unique)for(t.push(j),C=exportObj.pilotsByUniqueName[j.canonical_name.getXWSBaseName()]||[],w=0,z=C.length;w<z;w++)n=C[w],null!=n&&t.push(n);for(E=null!=(D=k.upgrades)?D:[],x=0,A=E.length;x<A;x++){if(m=E[x],l=exportObj.upgrades[m],null!=l.unique)for(t.push(n),F=exportObj.pilotsByUniqueName[l.canonical_name.getXWSBaseName()]||[],y=0,B=F.length;y<B;y++)n=F[y],null!=n&&t.push(n);null!=l.solitary&&t.push(l.slot)}}f=[],{loop:function(){var a,b,c,d,g,h;h=[];for(i in r)q=r[i],!(null!=(null!=(a=exportObj.pilots[q.pilot])?a.unique:void 0)&&(b=exportObj.pilots[q.pilot],__indexOf.call(this.uniques_in_use.Pilot,b)>=0)&&(c=exportObj.pilots[q.pilot],!(__indexOf.call(t,c)>=0))||null!=(null!=(d=exportObj.pilots[q.pilot])?d.max_per_squad:void 0)&&this.countPilots(exportObj.pilots[q.pilot].canonical_name)>=exportObj.pilots[q.pilot].max_per_squad&&(g=exportObj.pilots[q.pilot],!(__indexOf.call(t,g)>=0)))?null!=q.upgrades?h.push(function(){var a,b,c,d,g,h,i,j;for(i=q.upgrades,j=[],a=0,b=i.length;a<b;a++)if(u=i[a],v=exportObj.upgrades[u],null!=v){if(null!=v.unique&&__indexOf.call(this.uniques_in_use.Upgrade,v)>=0&&!(__indexOf.call(t,v)>=0)&&(null===e||!(__indexOf.call(exportObj.quickbuildsById[e.quickbuildId].upgrades,u)>=0||e.linkedShip&&__indexOf.call(null!=(c=exportObj.quickbuildsById[null!=(d=e.linkedShip)?d.quickbuildId:void 0].upgrades)?c:[],u)>=0))){f.push(q.id);break}if(null!=v.solitary&&(g=v.slot,__indexOf.call(this.uniques_in_use.Slot,g)>=0)&&(h=v.slot,!(__indexOf.call(t,h)>=0))){f.push(q.id);break}j.push(void 0)}else console.log("There was an Issue including the upgrade "+u+" in some quickbuild. Please report that Issue!");return j}.call(this)):h.push(void 0):f.push(q.id);return h}.call(this)},s=function(){var a,b,c,d,e;for(e=[],a=0,b=r.length;a<b;a++)q=r[a],e.push({id:q.id,text:""+(null!=(null!=(c=exportObj.settings)?c.initiative_prefix:void 0)&&exportObj.settings.initiative_prefix?exportObj.pilots[q.pilot].skill+" - ":"")+(exportObj.pilots[q.pilot].display_name?exportObj.pilots[q.pilot].display_name:q.pilot)+q.suffix+" ("+q.threat+")",points:q.threat,ship:q.ship,disabled:(d=q.id,__indexOf.call(f,d)>=0)});return e}()}else g=function(){var b,d;b=exportObj.pilots,d=[];for(p in b)o=b[p],(null==a||o.ship===a)&&this.isOurFaction(o.faction)&&(this.matcher(p,c)||o.display_name&&this.matcher(o.display_name,c))&&this.isItemAvailable(o,!0)&&d.push(o);return d}.call(this),h=function(){var a;a=[];for(p in g)o=g[p],(null==o.unique||__indexOf.call(this.uniques_in_use.Pilot,o)<0||o.canonical_name.getXWSBaseName()===(null!=b?b.canonical_name.getXWSBaseName():void 0))&&(null==o.max_per_squad||this.countPilots(o.canonical_name)<o.max_per_squad||o.canonical_name.getXWSBaseName()===(null!=b?b.canonical_name.getXWSBaseName():void 0))&&(null==o.restriction_func||o.restriction_func({builder:this},o))&&a.push(o);return a}.call(this),null!=b&&null!=b.unique&&(this.matcher(b.name,c)||b.display_name&&this.matcher(b.display_name,c))&&h.push(b),s=function(){var a,b,c,d;for(d=[],a=0,b=g.length;a<b;a++)o=g[a],d.push({id:o.id,text:""+(null!=(null!=(c=exportObj.settings)?c.initiative_prefix:void 0)&&exportObj.settings.initiative_prefix?o.skill+" - ":"")+(o.display_name?o.display_name:o.name)+" ("+o.points+(null!=o.loadout?"/"+o.loadout:"")+")",points:o.points,ship:o.ship,name:o.name,display_name:o.display_name,disabled:__indexOf.call(h,o)<0});return d}();return d&&(s=s.sort(exportObj.sortHelper)),s},b=function(){return!0},a.prototype.countUpgrades=function(a){var b,c,d,e,f,g,h,i,j,k;for(b=0,i=this.ships,e=0,g=i.length;e<g;e++)for(c=i[e],j=c.upgrades,f=0,h=j.length;f<h;f++)d=j[f],(null!=d&&null!=(k=d.data)?k.canonical_name:void 0)===a&&b++;return b},a.prototype.countPilots=function(a){var b,c,d,e,f,g;for(b=0,f=this.ships,d=0,e=f.length;d<e;d++)c=f[d],(null!=c&&null!=(g=c.pilot)?g.canonical_name.getXWSBaseName():void 0)===a.getXWSBaseName()&&b++;return b},a.prototype.isShip=function(a,b){var c,d,e;if(a instanceof Array){for(d=0,e=a.length;d<e;d++)if(c=a[d],c===b)return!0;return!1}return a===b},a.prototype.getAvailableUpgradesIncluding=function(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u;for(null==e&&(e=""),null==f&&(f=this.dfl_filter_func),null==g&&(g=!0),o=function(){var a,b,d,e;for(d=c.upgrades,e=[],a=0,b=d.length;a<b;a++)m=d[a],e.push(m.data);return e}(),h=function(){var b,d;b=exportObj.upgrades,d=[];for(n in b)m=b[n],exportObj.slotsMatching(m.slot,a)&&(this.matcher(n,e)||m.display_name&&this.matcher(m.display_name,e))&&(null==m.ship||this.isShip(m.ship,c.data.name))&&(null==m.faction||this.isOurFaction(m.faction,c.pilot.faction))&&this.isItemAvailable(m)&&null==m.standard&&d.push(m);return d}.call(this),f!==this.dfl_filter_func&&(h=function(){var a,b,c;for(c=[],a=0,b=h.length;a<b;a++)m=h[a],f(m)&&c.push(m);return c}()),k=c.upgrade_points_total-d.getPoints(b),i=function(){var a,e;e=[];for(n in h)m=h[n],(null==m.unique||__indexOf.call(this.uniques_in_use.Upgrade,m)<0)&&c.restriction_check(m.restrictions?m.restrictions:void 0,d,d.getPoints(m),k)&&__indexOf.call(o,m)<0&&(null==m.max_per_squad||c.builder.countUpgrades(m.canonical_name)<m.max_per_squad)&&(null==m.solitary||(a=m.slot,__indexOf.call(this.uniques_in_use.Slot,a)<0||null!=(null!=b?b.solitary:void 0)))&&e.push(m);return e}.call(this),t=function(){var a,b,d,e;for(d=c.upgrades,e=[],a=0,b=d.length;a<b;a++)m=d[a],null!=(null!=m?m.data:void 0)&&e.push(m.data);return e}(),p=0,r=t.length;p<r;p++)j=t[p],i.removeItem(j);if(null!=b&&(this.matcher(b.name,e)||b.display_name&&this.matcher(b.display_name,e))&&i.push(b),l=function(){var a,b,c;for(c=[],a=0,b=h.length;a<b;a++)m=h[a],c.push({id:m.id,text:""+(m.display_name?m.display_name:m.name)+" ("+d.getPoints(m)+(m.variablepoints?"*":"")+")",points:d.getPoints(m),name:m.name,display_name:m.display_name,disabled:__indexOf.call(i,m)<0});return c}(),g&&(l=l.sort(exportObj.sortHelper)),"function"==typeof d?d("undefined"!=typeof adjustment_func&&null!==adjustment_func):void 0){for(u=[],q=0,s=l.length;q<s;q++)m=l[q],u.push(d.adjustment_func(m));return u}return l},a.prototype.getSquadDialsAsHTML=function(){var a,b,c,d,e,f,g,h,i,j;for(b="",a={},h=this.ships,f=0,g=h.length;f<g;f++)e=h[f],null!=e.pilot&&(d=e.data.maneuvers,c=e.effectiveStats().maneuvers,null!=a[e.data.name]&&(i=c.toString(),__indexOf.call(a[e.data.name],i)>=0)||(a[e.data.name]=(null!=(j=a[e.data.name])?j:[]).concat([c.toString()]),b+='<div class="fancy-dial"><h4 class="ship-name-dial">'+(null!=e.data.display_name?e.data.display_name:e.data.name)+(""+(c.toString()!==d.toString()?" ("+this.uitranslation("modified")+")":"")+"</h4>")+this.getManeuverTableHTML(c,d)+"</div>"));return'<div class="print-dials-container">\n    '+b+"\n</div>"},a.prototype.getManeuverTableHTML=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;if(null==a||0===a.length)return this.uitranslation("Missing maneuver info.");for(e=function(){F=[];for(var b=0,c=a[0].length;0<=c?b<c:b>c;0<=c?b++:b--)F.push(b);return F}.apply(this),u=0,x=a.length;u<x;u++)for(d=a[u],c=v=0,y=d.length;v<y;c=++v)h=d[c],h>0&&e.removeItem(c);for(n="<table><tbody>",p=w=C=a.length-1;C<=0?w<=0:w>=0;p=C<=0?++w:--w){for(i=!1,D=a[p],A=0,z=D.length;A<z;A++)if(t=D[A],t>0){i=!0;break}if(i){for(n+="<tr><td>"+p+"</td>",s=B=0,E=a[p].length;0<=E?B<E:B>E;s=0<=E?++B:--B)if(!(__indexOf.call(e,s)>=0)){if(n+="<td>",a[p][s]>0){if(g=function(){switch(a[p][s]){case 1:return"dodgerblue";case 2:return"white";case 3:return"red";case 4:return"purple"}}(),l=function(){switch(a[p][s]){case 1:return"svg-blue-maneuver";case 2:return"svg-white-maneuver";case 3:return"svg-red-maneuver";case 4:return"svg-purple-maneuver"}}(),n+='<svg xmlns="http://www.w3.org/2000/svg" width="30px" height="30px" viewBox="0 0 200 200">',o="black",m="svg-base-maneuver",a[p][s]!==b[p][s]&&(o="DarkSlateGrey",m="svg-modified-maneuver"),0===p&&2===s)n+='<rect class="svg-maneuver-stop '+l+" "+m+'" x="50" y="50" width="100" height="100" style="fill:'+g+"; stroke-width:5; stroke:"+o+'" />';else{switch(q="",f="",s){case 0:k="M160,180 L160,70 80,70",j="M160,175 L160,70 70,70",r="M80,100 V40 L30,70 Z";break;case 1:k="M150,180 S150,120 80,60",j="M150,175 S150,120 80,60",r="M80,100 V40 L30,70 Z",q="transform='translate(-5 -15) rotate(45 70 90)' ";break;case 2:k="M100,180 L100,100 100,80",j="M100,175 L100,120 100,70",r="M70,80 H130 L100,30 Z";break;case 3:k="M50,180 S50,120 120,60",j="M50,175 S50,120 120,60",r="M120,100 V40 L170,70 Z",q="transform='translate(5 -15) rotate(-45 130 90)' ";break;case 4:k="M40,180 L40,70 120,70",j="M40,175 L40,70 130,70",r="M120,100 V40 L170,70 Z";break;case 5:k="M50,180 L50,100 C50,10 140,10 140,100 L140,120",j="M50,175 L50,100 C50,10 140,10 140,100 L140,130",r="M170,120 H110 L140,180 Z";break;case 6:k="M150,180 S150,120 80,60",j="M150,175 S150,120 85,65",r="M80,100 V40 L30,70 Z",q="transform='translate(0 50)'";break;case 7:k="M50,180 S50,120 120,60",j="M50,175 S50,120 115,65",r="M120,100 V40 L170,70 Z",q="transform='translate(0 50)'";break;case 8:k="M160,180 L160,70 80,70",j="M160,175 L160,70 85,70",r="M60,100 H100 L80,140 Z";break;case 9:k="M40,180 L40,70 120,70",j="M40,175 L40,70 115,70",r="M100,100 H140 L120,140 Z";break;case 10:k="M50,180 S50,120 120,60",j="M50,175 S50,120 120,60",r="M120,100 V40 L170,70 Z",q="transform='translate(5 -15) rotate(-45 130 90)' ",f="backwards";break;case 11:k="M100,180 L100,100 100,80",j="M100,175 L100,100 100,70",r="M70,80 H130 L100,30 Z",f="backwards";break;case 12:k="M150,180 S150,120 80,60",j="M150,175 S150,120 80,60",r="M80,100 V40 L30,70 Z",q="transform='translate(-5 -15) rotate(45 70 90)' ",f="backwards"}n+=$.trim('<g class="maneuver '+f+"\">\n  <path class = 'svg-maneuver-outer "+l+" "+m+"' stroke-width='25' fill='none' stroke='"+o+"' d='"+k+"' />\n  <path class = 'svg-maneuver-triangle "+l+" "+m+"' d='"+r+"' fill='"+g+"' stroke-width='5' stroke='"+o+"' "+q+"/>\n  <path class = 'svg-maneuver-inner "+l+" "+m+"' stroke-width='15' fill='none' stroke='"+g+"' d='"+j+"' />\n</g>")}n+="</svg>"}n+="</td>"}n+="</tr>"}}return n+="</tbody></table>"},a.prototype.formatActions=function(a,b,c){var d,e,f,g,h,i,j;for(null==c&&(c=[]),e=[],i=0,j=a.length;i<j;i++)d=a[i],g="",h=b,__indexOf.call(c,"Droid")>=0&&(d=d.replace("Focus","Calculate")),d.search("> ")!==-1&&(d=d.replace(/> /gi,""),h=' <i class="xwing-miniatures-font xwing-miniatures-font-linked"></i> '),d.search("F-")!==-1&&(g="force ",d=d.replace(/F-/gi,"")),d.search("W-")!==-1?(h="White ",d=d.replace(/W-/gi,"")):d.search("R-")!==-1&&(g="red ",d=d.replace(/R-/gi,"")),d=d.toLowerCase().replace(/[^0-9a-z]/gi,""),e.push(""+h+'<i class="xwing-miniatures-font '+g+"xwing-miniatures-font-"+d+'"></i>');return f=e.join(""),f.replace(b,"")},a.prototype.showTooltip=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia,Ja,Ka,La,Ma,Na,Oa,Pa,Qa,Ra,Sa,Ta,Ua,Va,Wa,Xa,Ya,Za,$a,_a,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb;if(null==d&&(d=this.info_container),null==e&&(e=!1),b!==this.tooltip_currently_displaying||e){switch(a){case"Ship":z=[],y=[],A=[],G={};for(F in exportObj.upgradesBySlotCanonicalName)G[F]=-1;V=exportObj.pilots;for(t in V)if(u=V[t],u.ship===b.name&&this.isOurFaction(u.faction)&&(W=u.skill,__indexOf.call(z,W)>=0||z.push(u.skill),y.push(u.points),null!=u.loadout&&A.push(u.loadout),null!=u.slots))for(F in G)switch(J=G[F],u.slots.filter(function(a){return function(a){return a===F}}(this)).length){case 1:switch(J){case-1:G[F]=1;break;case 0:G[F]=2;break;case 3:G[F]=4}break;case 0:switch(J){case-1:G[F]=0;break;case 1:G[F]=2;break;case 3:case 4:G[F]=5}break;case 2:switch(J){case-1:G[F]=3;break;case 0:case 2:G[F]=5;break;case 1:G[F]=4}break;case 3:G[F]=6}for(z.sort(),d.find(".info-type").text(a),d.find(".info-name").html(""+(b.display_name?b.display_name:b.name)),null!=(null!=(ga=this.collection)?ga.counts:void 0)?(E=null!=(ra=null!=(Ca=this.collection.counts)&&null!=(Na=Ca.ship)?Na[b.name]:void 0)?ra:0,d.find(".info-collection").text(this.uitranslation("collectionContentShips",E)),d.find(".info-collection").show()):d.find(".info-collection").hide(),m=!0,p=String(z[0]),N=0,P=z.length;N<P;N++)o=z[N],m||(p+=", "+o),m=!1;for(d.find("tr.info-skill td.info-data").text(p),d.find("tr.info-skill").show(),x=""+Math.min.apply(Math,y)+" - "+Math.max.apply(Math,y),d.find("tr.info-points td.info-data").text(x),r=""+Math.min.apply(Math,A)+" - "+Math.max.apply(Math,A),d.find("tr.info-loadout td.info-data").text(r),this.isQuickbuild?(d.find("tr.info-points").hide(),d.find("tr.info-loadout").hide()):(d.find("tr.info-points").show(),d.find("tr.info-loadout").show()),d.find("tr.info-engagement").hide(),d.find("tr.info-attack td.info-data").text(b.attack),d.find("tr.info-attack-bullseye td.info-data").text(b.attackbull),d.find("tr.info-attack-fullfront td.info-data").text(b.attackf),d.find("tr.info-attack-left td.info-data").text(b.attackl),d.find("tr.info-attack-right td.info-data").text(b.attackr),d.find("tr.info-attack-back td.info-data").text(b.attackb),d.find("tr.info-attack-turret td.info-data").text(b.attackt),d.find("tr.info-attack-doubleturret td.info-data").text(b.attackdt),d.find("tr.info-attack").toggle(null!=b.attack),d.find("tr.info-attack-bullseye").toggle(null!=b.attackbull),d.find("tr.info-attack-fullfront").toggle(null!=b.attackf),d.find("tr.info-attack-left").toggle(null!=b.attackl),d.find("tr.info-attack-right").toggle(null!=b.attackr),d.find("tr.info-attack-back").toggle(null!=b.attackb),d.find("tr.info-attack-turret").toggle(null!=b.attackt),d.find("tr.info-attack-doubleturret").toggle(null!=b.attackdt),d.find("tr.info-ship").hide(),null!=b.base?d.find("tr.info-base td.info-data").text(exportObj.translate("gameterms",b.base)):d.find("tr.info-base td.info-data").text(exportObj.translate("gameterms","Small")),d.find("tr.info-base").show(),d.find("tr.info-faction td.info-data").text([function(){var a,c,d,e;for(d=b.factions,e=[],a=0,c=d.length;a<c;a++)l=d[a],e.push(exportObj.translate("faction",l));return e}()]),d.find("tr.info-faction").hide(),d.find("p.info-restrictions").hide(),Ya=d.find("tr.info-attack td.info-header i.xwing-miniatures-font")[0].classList,O=0,Q=Ya.length;O<Q;O++)i=Ya[O],i.startsWith("xwing-miniatures-font-attack")&&d.find("tr.info-attack td.info-header i.xwing-miniatures-font").removeClass(i);if(d.find("tr.info-attack td.info-header i.xwing-miniatures-font").addClass(null!=(hb=b.attack_icon)?hb:"xwing-miniatures-font-attack"),d.find("tr.info-range").hide(),d.find("tr.info-agility td.info-data").text(b.agility),d.find("tr.info-agility").show(),d.find("tr.info-hull td.info-data").text(b.hull),d.find("tr.info-hull").show(),B="",null!=b.shieldrecurr)for(j=0;j<b.shieldrecurr;)B+='<sup><i class="fas fa-caret-up"></i></sup>',++j;if(d.find("tr.info-shields td.info-data").html(b.shields+B),d.find("tr.info-shields").show(),B="",null!=b.energyrecurr)for(j=0;j<b.energyrecurr;)B+='<sup><i class="fas fa-caret-up"></i></sup>',++j;d.find("tr.info-energy td.info-data").html(b.energy+B),d.find("tr.info-energy").toggle(null!=b.energy),d.find("tr.info-force").hide(),d.find("tr.info-charge").hide(),d.find("tr.info-actions td.info-data").html(this.formatActions(b.actions,", ",null!=(sb=b.keyword)?sb:[])),d.find("tr.info-actions").show(),d.find("tr.info-upgrades").show(),d.find("tr.info-upgrades td.info-data").html(function(){var a;a=[];for(F in G)J=G[F],a.push(1===J?exportObj.translate("sloticon",F):2===J?"("+exportObj.translate("sloticon",F)+")":3===J?exportObj.translate("sloticon",F)+exportObj.translate("sloticon",F):4===J?exportObj.translate("sloticon",F)+"("+exportObj.translate("sloticon",F)+")":5===J?"("+exportObj.translate("sloticon",F)+exportObj.translate("sloticon",F)+")":6===J?exportObj.translate("sloticon",F)+exportObj.translate("sloticon",F)+exportObj.translate("sloticon",F):void 0);return a}().join(" ")||"None"),d.find("p.info-text").hide(),d.find("p.info-chassis").show(),d.find("p.info-chassis").html(null!=b.chassis?"<strong>"+(null!=(vb=null!=(X=exportObj.chassis[b.chassis])?X.display_name:void 0)?vb:b.chassis)+":</strong> "+exportObj.chassis[b.chassis].text:""),d.find("p.info-maneuvers").show(),d.find("p.info-maneuvers").html(this.getManeuverTableHTML(b.maneuvers,b.maneuvers)),I=function(){var a,c,d,e;for(d=b.sources,e=[],a=0,c=d.length;a<c;a++)H=d[a],e.push(exportObj.translate("sources",H));return e}().sort(),d.find(".info-sources.info-data").text(I.length>1||(Y=exportObj.translate("sources","Loose Ships"),!(__indexOf.call(I,Y)>=0))?I.length>0?I.join(", "):"":this.uitranslation("Only available from 1st edition")),d.find(".info-sources").show();break;case"Pilot":if(d.find(".info-type").text(a),d.find(".info-sources.info-data").text(function(){var a,c,d,e;for(d=b.sources,e=[],a=0,c=d.length;a<c;a++)H=d[a],e.push(exportObj.translate("sources",H));return e}().sort().join(", ")),d.find(".info-sources").show(),null!=(null!=(Z=this.collection)?Z.counts:void 0)?(v=null!=(_=null!=(aa=this.collection.counts)&&null!=(ba=aa.pilot)?ba[b.name]:void 0)?_:0,E=null!=(ca=null!=(da=this.collection.counts.ship)?da[b.ship]:void 0)?ca:0,d.find(".info-collection").text(this.uitranslation("collectionContentShipsAndPilots",E,v)),d.find(".info-collection").show()):d.find(".info-collection").hide(),null!=(null!=c?c.effectiveStats:void 0)&&(k=c.effectiveStats()),null!=b.unique)K="&middot;&nbsp;";else if(null!=b.max_per_squad){for(j=0,K="";j<b.max_per_squad;)K=K.concat("&middot;"),++j;K=K.concat("&nbsp;")}else K="";if(d.find(".info-name").html(""+K+(b.display_name?b.display_name:b.name)+(exportObj.isReleased(b),"")),C=this.restriction_text(b)+this.upgrade_effect(b),""!==C?(d.find("p.info-restrictions").html(null!=C?C:""),d.find("p.info-restrictions").show()):d.find("p.info-restrictions").hide(),d.find("p.info-text").html(null!=(ea=b.text)?ea:""),d.find("p.info-text").show(),D=exportObj.ships[b.ship],h=null!=(null!=k?k.chassis:void 0)&&""!==k.chassis?k.chassis:null!=b.chassis?b.chassis:null!=D.chassis?D.chassis:"",""!==h?(d.find("p.info-chassis").html("<strong>"+(null!=(fa=null!=(ha=exportObj.chassis[h])?ha.display_name:void 0)?fa:h)+":</strong> "+exportObj.chassis[h].text),d.find("p.info-chassis").show()):d.find("p.info-chassis").hide(),d.find("tr.info-ship td.info-data").text(b.ship),d.find("tr.info-ship").show(),d.find("tr.info-faction td.info-data").text(exportObj.translate("faction",b.faction)),d.find("tr.info-faction").hide(),null!=D.base?d.find("tr.info-base td.info-data").text(exportObj.translate("gameterms",D.base)):d.find("tr.info-base td.info-data").text(exportObj.translate("gameterms","Small")),d.find("tr.info-base").show(),d.find("tr.info-skill td.info-data").text(b.skill),d.find("tr.info-skill").show(),d.find("tr.info-loadout td.info-data").text(b.loadout),d.find("tr.info-loadout").show(),null!=b.engagement?(d.find("tr.info-engagement td.info-data").text(b.engagement),d.find("tr.info-engagement").show()):d.find("tr.info-engagement").hide(),d.find("tr.info-points").hide(),d.find("tr.info-attack td.info-header i.xwing-miniatures-font").addClass(null!=(ia=D.attack_icon)?ia:"xwing-miniatures-font-attack"),d.find("tr.info-attack td.info-data").text(statAndEffectiveStat(null!=(ja=null!=(ka=b.ship_override)?ka.attack:void 0)?ja:D.attack,k,"attack")),d.find("tr.info-attack").toggle(null!=D.attack||null!=(null!=k?k.attack:void 0)),d.find("tr.info-attack-fullfront td.info-data").text(statAndEffectiveStat(null!=(la=null!=(ma=b.ship_override)?ma.attackf:void 0)?la:D.attackf,k,"attackf")),d.find("tr.info-attack-fullfront").toggle(null!=D.attackf||null!=(null!=k?k.attackf:void 0)),d.find("tr.info-attack-bullseye td.info-data").text(statAndEffectiveStat(null!=(na=null!=(oa=b.ship_override)?oa.attackbull:void 0)?na:D.attackbull,k,"attackbull")),d.find("tr.info-attack-bullseye").toggle(null!=D.attackbull||null!=(null!=k?k.attackbull:void 0)),d.find("tr.info-attack-left td.info-data").text(statAndEffectiveStat(null!=(pa=null!=(qa=b.ship_override)?qa.attackl:void 0)?pa:D.attackl,k,"attackl")),d.find("tr.info-attack-left").toggle(null!=D.attackl||null!=(null!=k?k.attackl:void 0)),d.find("tr.info-attack-right td.info-data").text(statAndEffectiveStat(null!=(sa=null!=(ta=b.ship_override)?ta.attackr:void 0)?sa:D.attackr,k,"attackr")),d.find("tr.info-attack-right").toggle(null!=D.attackr||null!=(null!=k?k.attackr:void 0)),d.find("tr.info-attack-back td.info-data").text(statAndEffectiveStat(null!=(ua=null!=(va=b.ship_override)?va.attackb:void 0)?ua:D.attackb,k,"attackb")),d.find("tr.info-attack-back").toggle(null!=D.attackb||null!=(null!=k?k.attackb:void 0)),d.find("tr.info-attack-turret td.info-data").text(statAndEffectiveStat(null!=(wa=null!=(xa=b.ship_override)?xa.attackt:void 0)?wa:D.attackt,k,"attackt")),d.find("tr.info-attack-turret").toggle(null!=D.attackt||null!=(null!=k?k.attackt:void 0)),d.find("tr.info-attack-doubleturret td.info-data").text(statAndEffectiveStat(null!=(ya=null!=(za=b.ship_override)?za.attackdt:void 0)?ya:D.attackdt,k,"attackdt")),d.find("tr.info-attack-doubleturret").toggle(null!=D.attackdt||null!=(null!=k?k.attackdt:void 0)),d.find("tr.info-range").hide(),d.find("td.info-rangebonus").hide(),d.find("tr.info-agility td.info-data").text(statAndEffectiveStat(null!=(Aa=null!=(Ba=b.ship_override)?Ba.agility:void 0)?Aa:D.agility,k,"agility")),d.find("tr.info-agility").show(),d.find("tr.info-hull td.info-data").text(statAndEffectiveStat(null!=(Da=null!=(Ea=b.ship_override)?Ea.hull:void 0)?Da:D.hull,k,"hull")),
d.find("tr.info-hull").show(),B="",null!=D.shieldrecurr)for(j=0;j<D.shieldrecurr;)B+='<sup><i class="fas fa-caret-up"></i></sup>',++j;if(d.find("tr.info-shields td.info-data").html(statAndEffectiveStat(null!=(Fa=null!=(Ga=b.ship_override)?Ga.shields:void 0)?Fa:D.shields,k,"shields")+B),d.find("tr.info-shields").show(),B="",null!=D.energyrecurr)for(j=0;j<D.energyrecurr;)B+='<sup><i class="fas fa-caret-up"></i></sup>',++j;if(d.find("tr.info-energy td.info-data").html(statAndEffectiveStat(null!=(Ha=null!=(Ia=b.ship_override)?Ia.energy:void 0)?Ha:D.energy,k,"energy")+B),d.find("tr.info-energy").toggle(null!=(null!=(Ja=b.ship_override)?Ja.energy:void 0)||null!=D.energy),null!=(null!=k?k.force:void 0)&&k.force>0||null!=b.force){if(B="",null!=(null!=k?k.forcerecurring:void 0))for(j=0;j<k.forcerecurring;)B+='<sup><i class="fas fa-caret-up"></i></sup>',++j;else B+='<sup><i class="fas fa-caret-up"></i></sup>';d.find("tr.info-force td.info-data").html(statAndEffectiveStat(null!=(Ka=null!=(La=b.ship_override)?La.force:void 0)?Ka:b.force,k,"force")+B),d.find("tr.info-force").show()}else d.find("tr.info-force").hide();if(null!=b.charge){if(B="",null!=b.recurring)if(b.recurring>0)for(j=0;j<b.recurring;)B+='<sup><i class="fas fa-caret-up"></i></sup>',++j;else for(j=b.recurring;j<0;)B+='<sub><i class="fas fa-caret-down"></i></sub>',++j;g=$.trim(""+b.charge+B),d.find("tr.info-charge td.info-data").html(g),d.find("tr.info-charge").show()}else d.find("tr.info-charge").hide();null!=(null!=k?k.actions:void 0)?d.find("tr.info-actions td.info-data").html(this.formatActions(null!=(Ma=null!=(Oa=b.ship_override)?Oa.actions:void 0)?Ma:k.actions,", ")):d.find("tr.info-actions td.info-data").html(this.formatActions(null!=(Pa=null!=(Qa=b.ship_override)?Qa.actions:void 0)?Pa:D.actions,", ",null!=(Ra=b.keyword)?Ra:[])),d.find("tr.info-actions").show(),this.isQuickbuild?d.find("tr.info-upgrades").hide():(d.find("tr.info-upgrades").show(),d.find("tr.info-upgrades td.info-data").html(null!=b.slots?function(){var a,c,d,e;for(d=b.slots,e=[],a=0,c=d.length;a<c;a++)F=d[a],e.push(exportObj.translate("sloticon",F));return e}().join(" ")||"None":"Standardized")),d.find("p.info-maneuvers").show(),d.find("p.info-maneuvers").html(this.getManeuverTableHTML(null!=(Sa=null!=k?k.maneuvers:void 0)?Sa:D.maneuvers,D.maneuvers));break;case"Quickbuild":if(d.find(".info-type").text(this.uitranslation("Quickbuild")),d.find(".info-sources").hide(),d.find(".info-collection").hide(),u=exportObj.pilots[b.pilot],D=exportObj.ships[b.ship],null!=u.unique)K="&middot;&nbsp;";else if(null!=u.max_per_squad){for(j=0,K="";j<b.max_per_squad;)K=K.concat("&middot;"),++j;K=K.concat("&nbsp;")}else K="";if(d.find(".info-name").html(""+K+(u.display_name?u.display_name:u.name)+(null!=b.suffix?b.suffix:"")),C=this.restriction_text(b)+this.upgrade_effect(b),""!==C?(d.find("p.info-restrictions").html(null!=C?C:""),d.find("p.info-restrictions").show()):d.find("p.info-restrictions").hide(),d.find("p.info-text").html(null!=(Ta=u.text)?Ta:""),d.find("p.info-text").show(),d.find("p.info-chassis").html(null!=u.chassis?"<strong>"+(null!=(Ua=null!=(Va=exportObj.chassis[u.chassis])?Va.display_name:void 0)?Ua:u.chassis)+":</strong> "+exportObj.chassis[u.chassis].text:null!=D.chassis?"<strong>"+D.chassis+":</strong> "+exportObj.chassis[D.chassis].text:""),d.find("p.info-chassis").show(),d.find("tr.info-ship td.info-data").text(b.ship),d.find("tr.info-ship").show(),d.find("tr.info-faction td.info-data").text(exportObj.translate("faction",b.faction)),d.find("tr.info-faction").hide(),null!=D.base?d.find("tr.info-base td.info-data").text(exportObj.translate("gameterms",D.base)):d.find("tr.info-base td.info-data").text(exportObj.translate("gameterms","Small")),d.find("tr.info-base").show(),d.find("tr.info-skill td.info-data").text(u.skill),d.find("tr.info-skill").show(),d.find("tr.info-points").hide(),d.find("tr.info-loadout").hide(),d.find("tr.info-engagement td.info-data").text(u.skill),d.find("tr.info-engagement").show(),d.find("tr.info-attack td.info-data").text(null!=(Wa=null!=(Xa=u.ship_override)?Xa.attack:void 0)?Wa:D.attack),d.find("tr.info-attack").toggle(null!=(null!=(Za=u.ship_override)?Za.attack:void 0)||null!=D.attack),d.find("tr.info-attack-fullfront td.info-data").text(D.attackf),d.find("tr.info-attack-fullfront").toggle(null!=D.attackf),d.find("tr.info-attack-bullseye td.info-data").text(D.attackbull),d.find("tr.info-attack-bullseye").toggle(null!=D.attackbull),d.find("tr.info-attack-left td.info-data").text(D.attackl),d.find("tr.info-attack-left").toggle(null!=D.attackl),d.find("tr.info-attack-right td.info-data").text(D.attackr),d.find("tr.info-attack-right").toggle(null!=D.attackr),d.find("tr.info-attack-back td.info-data").text(null!=D.attackb),d.find("tr.info-attack-back").toggle(null!=D.attackb),d.find("tr.info-attack-turret td.info-data").text(null!=D.attackt),d.find("tr.info-attack-turret").toggle(null!=D.attackt),d.find("tr.info-attack-doubleturret td.info-data").text(D.attackdt),d.find("tr.info-attack-doubleturret").toggle(null!=D.attackdt),d.find("tr.info-attack td.info-header i.xwing-miniatures-font").addClass(null!=($a=D.attack_icon)?$a:"xwing-miniatures-font-frontarc"),d.find("tr.info-energy td.info-data").text(null!=(_a=null!=(ab=u.ship_override)?ab.energy:void 0)?_a:D.energy),d.find("tr.info-energy").toggle(null!=(null!=(bb=u.ship_override)?bb.energy:void 0)||null!=D.energy),d.find("tr.info-range").hide(),d.find("td.info-rangebonus").hide(),d.find("tr.info-agility td.info-data").text(null!=(cb=null!=(db=u.ship_override)?db.agility:void 0)?cb:D.agility),d.find("tr.info-agility").show(),d.find("tr.info-hull td.info-data").text(null!=(eb=null!=(fb=u.ship_override)?fb.hull:void 0)?eb:D.hull),d.find("tr.info-hull").show(),d.find("tr.info-shields td.info-data").text(null!=(gb=null!=(ib=u.ship_override)?ib.shields:void 0)?gb:D.shields),d.find("tr.info-shields").show(),null!=(null!=k?k.force:void 0)||null!=b.force){for(B="",n=1,null!=(null!=k?k.forcerecurring:void 0)&&(n=k.forcerecurring),j=0;j<n;)B+='<sup><i class="fas fa-caret-up"></i></sup>',++j;d.find("tr.info-force td.info-data").html((null!=(jb=null!=(kb=u.ship_override)?kb.force:void 0)?jb:u.force)+B),d.find("tr.info-force").show()}else d.find("tr.info-force").hide();if(null!=b.charge){if(B="",null!=b.recurring)if(b.recurring>0)for(j=0;j<b.recurring;)B+='<sup><i class="fas fa-caret-up"></i></sup>',++j;else for(j=b.recurring;j<0;)B+='<sub><i class="fas fa-caret-down"></i></sub>',++j;g=$.trim(""+b.charge+B),d.find("tr.info-charge td.info-data").html(g),d.find("tr.info-charge").show()}else d.find("tr.info-charge").hide();d.find("tr.info-actions td.info-data").html(this.formatActions(null!=(lb=null!=(mb=u.ship_override)?mb.actions:void 0)?lb:exportObj.ships[b.ship].actions,", ",null!=(nb=u.keyword)?nb:[])),d.find("tr.info-actions").show(),d.find("tr.info-upgrades").show(),d.find("tr.info-upgrades td.info-data").html(function(){var a,c,d,e,f;for(e=null!=(d=b.upgrades)?d:[],f=[],a=0,c=e.length;a<c;a++)L=e[a],f.push(null!=exportObj.upgrades[L].display_name?exportObj.upgrades[L].display_name:L);return f}().join(", ")||"None"),d.find("p.info-maneuvers").show(),d.find("p.info-maneuvers").html(this.getManeuverTableHTML(D.maneuvers,D.maneuvers));break;case"Addon":if(d.find(".info-type").text(c.addon_type),d.find(".info-sources.info-data").text(function(){var a,c,d,e;for(d=b.sources,e=[],a=0,c=d.length;a<c;a++)H=d[a],e.push(exportObj.translate("sources",H));return e}().sort().join(", ")),d.find(".info-sources").show(),null!=b.unique)K="&middot;&nbsp;";else if(null!=b.max_per_squad){for(j=0,K="";j<b.max_per_squad;)K=K.concat("&middot;"),++j;K=K.concat("&nbsp;")}else K="";if(null!=(null!=(ob=this.collection)?ob.counts:void 0)?(f=null!=(pb=null!=(qb=this.collection.counts)&&null!=(rb=qb.upgrade)?rb[b.name]:void 0)?pb:0,d.find(".info-collection").text(this.uitranslation("collectionContentUpgrades",f)),d.find(".info-collection").show()):d.find(".info-collection").hide(),d.find(".info-name").html(""+K+(b.display_name?b.display_name:b.name)),null!=b.variablepoints){switch(w="<i>"+this.uitranslation("varPointCostsPoints",b.points),b.variablepoints){case"Agility":w+=this.uitranslation("varPointCostsConditionAgility",function(){wb=[];for(var a=0,c=b.points.length-1;0<=c?a<=c:a>=c;0<=c?a++:a--)wb.push(a);return wb}.apply(this));break;case"Initiative":w+=this.uitranslation("varPointCostsConditionIni",function(){xb=[];for(var a=0,c=b.points.length-1;0<=c?a<=c:a>=c;0<=c?a++:a--)xb.push(a);return xb}.apply(this));break;case"Base":w+=this.uitranslation("varPointCostsConditionBase")}w+="</i>"}if(C=this.restriction_text(b)+this.upgrade_effect(b),null!=w||""!==C?(null!=w&&""!==C&&(w+="<br/>"),d.find("p.info-restrictions").html((null!=w?w:"")+C),d.find("p.info-restrictions").show()):d.find("p.info-restrictions").hide(),d.find("p.info-text").html(null!=(tb=b.text)?tb:""),d.find("p.info-text").show(),d.find("p.info-chassis").hide(),d.find("tr.info-ship").hide(),d.find("tr.info-faction").hide(),d.find("tr.info-base").hide(),d.find("tr.info-skill").hide(),d.find("tr.info-points").hide(),d.find("tr.info-loadout").hide(),d.find("tr.info-engagement").hide(),null!=b.energy?(d.find("tr.info-energy td.info-data").text(b.energy),d.find("tr.info-energy").show()):d.find("tr.info-energy").hide(),null!=b.attack?(d.find("tr.info-attack td.info-data").text(b.attack),d.find("tr.info-attack").show()):d.find("tr.info-attack").hide(),null!=b.attackb?(d.find("tr.info-attack-back td.info-data").text(b.attackb),d.find("tr.info-attack-back").show()):d.find("tr.info-attack-back").hide(),null!=b.attackt?(d.find("tr.info-attack-turret td.info-data").text(b.attackt),d.find("tr.info-attack-turret").show()):d.find("tr.info-attack-turret").hide(),null!=b.attackr?(d.find("tr.info-attack-right td.info-data").text(b.attackr),d.find("tr.info-attack-right").show()):d.find("tr.info-attack-right").hide(),null!=b.attackl?(d.find("tr.info-attack-left td.info-data").text(b.attackl),d.find("tr.info-attack-left").show()):d.find("tr.info-attack-left").hide(),null!=b.attackdt?(d.find("tr.info-attack-doubleturret td.info-data").text(b.attackdt),d.find("tr.info-attack-doubleturret").show()):d.find("tr.info-attack-doubleturret").hide(),null!=b.attackbull?(d.find("tr.info-attack-bullseye td.info-data").text(b.attackbull),d.find("tr.info-attack-bullseye").show()):d.find("tr.info-attack-bullseye").hide(),null!=b.attackf?(d.find("tr.info-attack-fullfront td.info-data").text(b.attackf),d.find("tr.info-attack-fullfront").show()):d.find("tr.info-attack-fullfront").hide(),null!=b.charge){if(B="",null!=b.recurring)if(b.recurring>0)for(j=0;j<b.recurring;)B+='<sup><i class="fas fa-caret-up"></i></sup>',++j;else for(j=b.recurring;j<0;)B+='<sub><i class="fas fa-caret-down"></i></sub>',++j;g=$.trim(""+b.charge+B),d.find("tr.info-charge td.info-data").html(g)}if(d.find("tr.info-charge").toggle(null!=b.charge),null!=b.range?(d.find("tr.info-range td.info-data").text(b.range),d.find("tr.info-range").show()):d.find("tr.info-range").hide(),null!=b.rangebonus?d.find("td.info-rangebonus").show():d.find("td.info-rangebonus").hide(),null!=b.force){for(B="",n=1,null!=b.forcerecurring&&(n=b.forcerecurring),j=0;j<n;)B+='<sup><i class="fas fa-caret-up"></i></sup>',++j;d.find("tr.info-force td.info-data").html(b.force+B)}d.find("tr.info-force").toggle(null!=b.force),d.find("tr.info-agility").hide(),d.find("tr.info-hull").hide(),d.find("tr.info-shields").hide(),d.find("tr.info-actions").hide(),d.find("tr.info-upgrades").hide(),d.find("p.info-maneuvers").hide();break;case"Rules":d.find(".info-type").hide(),d.find(".info-sources").hide(),d.find(".info-collection").hide(),d.find(".info-name").html(b.name),d.find(".info-name").show(),d.find("p.info-restrictions").hide(),d.find("p.info-text").html(b.text),d.find("p.info-text").show(),d.find("tr.info-ship").hide(),d.find("tr.info-faction").hide(),d.find("tr.info-base").hide(),d.find("tr.info-skill").hide(),d.find("tr.info-points").hide(),d.find("tr.info-loadout").hide(),d.find("tr.info-agility").hide(),d.find("tr.info-hull").hide(),d.find("tr.info-shields").hide(),d.find("tr.info-actions").hide(),d.find("tr.info-upgrades").hide(),d.find("p.info-maneuvers").hide(),d.find("tr.info-energy").hide(),d.find("tr.info-attack").hide(),d.find("tr.info-attack-turret").hide(),d.find("tr.info-attack-bullseye").hide(),d.find("tr.info-attack-fullfront").hide(),d.find("tr.info-attack-back").hide(),d.find("tr.info-attack-doubleturret").hide(),d.find("tr.info-charge").hide(),d.find("td.info-rangebonus").hide(),d.find("tr.info-range").hide(),d.find("tr.info-force").hide();break;case"MissingStuff":for(d.find(".info-type").text(this.uitranslation("List of Missing items")),d.find(".info-sources").hide(),d.find(".info-collection").hide(),d.find(".info-name").html(this.uitranslation("Missing items")),d.find(".info-name").show(),s=this.uitranslation("Missing Item List:")+"<ul>",T=0,R=b.length;T<R;T++){for(q=b[T],s+="<li><strong>"+(null!=q.display_name?q.display_name:q.name)+"</strong> (",m=!0,ub=q.sources,U=0,S=ub.length;U<S;U++)H=ub[U],m||(s+=", "),s+=H,m=!1;s+=")</li>"}s+="</ul>",d.find("p.info-restrictions").hide(),d.find("p.info-text").html(s),d.find("p.info-text").show(),d.find("tr.info-ship").hide(),d.find("tr.info-faction").hide(),d.find("tr.info-base").hide(),d.find("tr.info-skill").hide(),d.find("tr.info-points").hide(),d.find("tr.info-loadout").hide(),d.find("tr.info-agility").hide(),d.find("tr.info-hull").hide(),d.find("tr.info-shields").hide(),d.find("tr.info-actions").hide(),d.find("tr.info-upgrades").hide(),d.find("p.info-maneuvers").hide(),d.find("tr.info-energy").hide(),d.find("tr.info-attack").hide(),d.find("tr.info-attack-turret").hide(),d.find("tr.info-attack-bullseye").hide(),d.find("tr.info-attack-fullfront").hide(),d.find("tr.info-attack-back").hide(),d.find("tr.info-attack-doubleturret").hide(),d.find("tr.info-charge").hide(),d.find("td.info-rangebonus").hide(),d.find("tr.info-range").hide(),d.find("tr.info-force").hide()}if(d!==this.mobile_tooltip_modal&&(d.find(".info-well").show(),d.find(".intro").hide()),this.tooltip_currently_displaying=b,$(window).width()>=768)return M=d.find(".info-well"),$.isElementInView(M,!0)?M.css("position","fixed"):M.css("position","static")}},a.prototype._randomizerLoopBody=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;if(a.keep_running){if(this.total_points===a.max_points){if(a.keep_running=!1,this.isQuickbuild)return void(a.keep_running=!1);for(x=this.ships,n=0,r=x.length;n<r;n++)if(i=x[n],f=[],null!=i.pilot.loadout)for(;i.upgrade_points_total<i.pilot.loadout;){for(l=[],y=i.upgrades,o=0,s=y.length;o<s;o++)m=y[o],null!=m.data||null!=m.occupied_by&&null!==m.occupied_by||__indexOf.call(f,m)>=0||l.push(m);if(0===l.length)break;b=l[$.randomInt(l.length)],e=function(){var c,d,e,f;for(e=this.getAvailableUpgradesIncluding(b.slot,null,i,b,"",this.dfl_filter_func,k=!1),f=[],c=0,d=e.length;c<d;c++)m=e[c],!exportObj.upgradesById[m.id].sources.intersects(a.allowed_sources)||a.collection_only&&!this.collection.checkShelf("upgrade",m.name)||m.disabled||f.push(m);return f}.call(this),e.length>0?(m=e[$.randomInt(e.length)],b.setById(m.id)):f.push(b)}}else if(this.total_points<a.max_points){if(d=this.getAvailableShipsMatchingAndCheapEnough(a.max_points-this.total_points,"",!1,a.collection_only),0===d.length&&(d=this.getAvailableShipsMatching("",!1,a.collection_only)),d.length>0&&(this.ships.length<a.ship_limit||0===a.ship_limit)){if(j=d[$.randomInt(d.length)].name,c=this.getAvailablePilotsForShipIncluding(j),0===c.length)return;h=c[$.randomInt(c.length)],h.disabled||!(this.isQuickbuild?exportObj.pilots[exportObj.quickbuildsById[h.id].pilot]:exportObj.pilotsById[h.id]).sources.intersects(a.allowed_sources)||a.collection_only&&!this.collection.checkShelf("pilot",this.isQuickbuild?exportObj.quickbuildsById[h.id]:h.name)||(g=this.addShip(),g.setPilotById(h.id))}}else this.removeShip(this.ships[$.randomInt(this.ships.length)]);return window.setTimeout(this._makeRandomizerLoopFunc(a),0)}for(;this.total_points>a.max_points;)this.removeShip(this.ships[$.randomInt(this.ships.length)]);if(a.fill_zero_pts)for(z=this.ships,p=0,t=z.length;p<t;p++)for(i=z[p],A=i.upgrades,q=0,u=A.length;q<u;q++)b=A[q],null!=b.data||null!=b.occupied_by&&null!==b.occupied_by||(e=function(){var c,d,e,f;for(e=this.getAvailableUpgradesIncluding(b.slot,null,b.ship,b,"",this.dfl_filter_func,k=!1),f=[],d=0,c=e.length;d<c;d++)m=e[d],exportObj.upgradesById[m.id].sources.intersects(a.allowed_sources)&&m.points<1&&(!a.collection_only||this.collection.checkShelf("upgrade",m.name))&&f.push(m);return f}.call(this),m=e.length>0?e[$.randomInt(e.length)]:void 0,m&&!m.disabled&&b.setById(m.id));for(window.clearTimeout(a.timer),B=this.ships,w=0,v=B.length;w<v;w++)i=B[w],i.updateSelections();return this.suppress_automatic_new_ship=!1,this.addShip()},a.prototype._makeRandomizerLoopFunc=function(a){return function(b){return function(){return b._randomizerLoopBody(a)}}(this)},a.prototype.randomSquad=function(a,b,c,d,e,f){var g,h;for(null==a&&(a=200),null==b&&(b=null),null==c&&(c=1e3),null==d&&(d=0),null==e&&(e=!0),null==f&&(f=!1),this.backend_status.fadeOut("slow"),this.suppress_automatic_new_ship=!0,b.length<1&&(b=null);this.ships.length>0;)this.removeShip(this.ships[0]);if(this.ships.length>0)throw new Error("Ships not emptied");return g={max_points:a,ship_limit:d,keep_running:!0,allowed_sources:null!=b?b:exportObj.expansions,collection_only:null!=this.collection&&"true"===this.collection.checks.collectioncheck&&e,fill_zero_pts:f},h=function(a){return function(){return g.keep_running=!1}}(this),g.timer=window.setTimeout(h,c),window.setTimeout(this._makeRandomizerLoopFunc(g),0),this.resetCurrentSquad(),this.current_squad.name=this.uitranslation("Random Squad"),this.container.trigger("xwing-backend:squadNameChanged")},a.prototype.setBackend=function(a){var b,c,d,e,f;if(this.backend=a,null!=this.waiting_for_backend){for(e=this.waiting_for_backend,f=[],c=0,d=e.length;c<d;c++)b=e[c],f.push(b());return f}},a.prototype.upgrade_effect=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(e=h=c="",a.modifier_func&&(g={attack:0,attackf:0,attackbull:0,attackb:0,attackt:0,attackl:0,attackr:0,attackdt:0,energy:0,agility:0,hull:0,shields:0,force:0,actions:[],maneuvers:[0,0]},a.modifier_func(g),0!==g.attack&&(h+=c+("%FRONTARC% ("+g.attack+")"),c=", "),0!==g.attackf&&(h+=c+("%FULLFRONTARC% ("+g.attackf+")"),c=", "),0!==g.attackbull&&(h+=c+("%BULLSEYEARC% ("+g.attackbull+")"),c=", "),0!==g.attackb&&(h+=c+("%REARARC% ("+g.attackb+")"),c=", "),0!==g.attackt&&(h+=c+("%SINGLETURRETARC% ("+g.attackt+")"),c=", "),0!==g.attackl&&(h+=c+("%LEFTARC% ("+g.attackl+")"),c=", "),0!==g.attackr&&(h+=c+("%RIGHTARC% ("+g.attackr+")"),c=", "),0!==g.attackdt&&(h+=c+("%DOUBLETURRETARC% ("+g.attackdt+")"),c=", "),0!==g.energy&&(h+=c+("%ENERGY% ("+g.energy+")"),c=", "),0!==g.agility&&(h+=c+("%AGILITY% ("+g.agility+")"),c=", "),0!==g.hull&&(h+=c+("%HULL% ("+g.hull+")"),c=", "),0!==g.shields&&(h+=c+("%SHIELD% ("+g.shields+")"),c=", "),g.actions.length>0&&(h+=c+this.formatActions(g.actions,", "),c=", ")),a.confersAddons)for(m=a.confersAddons,i=0,k=m.length;i<k;i++)b=m[i],h+=c+("%"+b.slot.toUpperCase().replace(/[^a-z0-9]/gi,"")+"%"),c=", ";if(a.unequips_upgrades)for(c="",n=a.unequips_upgrades,j=0,l=n.length;j<l;j++)f=n[j],e+=c+("%"+f.toUpperCase().replace(/[^a-z0-9]/gi,"")+"%"),c=", ";return""!==h?(d={text:"</br><b>"+this.uitranslation("adds",h)+"</b>"},""!==e&&(d.text+="</br><b>"+this.uitranslation("removes",e)+"</b>"),exportObj.fixIcons(d)):""},a.prototype.restriction_text=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(l=d=h=k="",a.restrictions)for(u=a.restrictions,m=0,q=u.length;m<q;m++){switch(i=u[m],i[0]){case"FactionOrUnique":h+=d+exportObj.translate("faction",""+i[2]),l=exportObj.translate("restrictions"," or Squad Including")+(" "+i[1]);break;case"Base":for(g=n=0,r=i.length;n<r;g=++n)c=i[g],"Base"!==c?(k+=""+c+" ",k+=g<i.length-1?"or ":exportObj.translate("restrictions","Ship")):k+=d;break;case"Action":b=[i[1]],k+=d+this.formatActions(b,"",[]);break;case"Equipped":k+=d+("%"+i[1].toUpperCase().replace(/[^a-z0-9]/gi,"")+"% Equipped");break;case"Slot":k+=d+exportObj.translate("restrictions","Extra")+(" %"+i[1].toUpperCase().replace(/[^a-z0-9]/gi,"")+"%");break;case"Keyword":k+=d+exportObj.translate("restrictions",""+i[1]);break;case"AttackArc":k+=d+"%REARARC%";break;case"ShieldsGreaterThan":k+=d+("%SHIELD% > "+i[1]);break;case"EnergyGreatterThan":k+=d+("%ENERGY% > "+i[1]);break;case"InitiativeGreaterThan":k+=d+exportObj.translate("restrictions","Initiative")+(" > "+i[1]);break;case"InitiativeLessThan":k+=d+exportObj.translate("restrictions","Initiative")+(" < "+i[1]);break;case"AgilityEquals":k+=d+exportObj.translate("restrictions","Agility")+(" = "+i[1]);break;case"isUnique":k+=i[1]===!0?d+exportObj.translate("restrictions","Limited"):d+exportObj.translate("restrictions","Non-Limited");break;case"Format":k+=d+exportObj.translate("restrictions",""+i[1]+" Ship");break;case"Faction":h+=d+exportObj.translate("faction",""+i[1])}d=", "}if(!a.skill){if(""===h&&a.faction){if(a.faction instanceof Array)for(v=a.faction,o=0,s=v.length;o<s;o++)f=v[o],h+=d+exportObj.translate("faction",""+f),d=" or ";else h+=d+exportObj.translate("faction",""+a.faction);d=", "}if(a.ship){if(a.ship instanceof Array)for(w=a.ship,p=0,t=w.length;p<t;p++)j=w[p],h+=d+j,d=" or ";else h+=d+a.ship;d=", "}a.solitary&&(h+=d+exportObj.translate("faction","Solitary"),d=", "),a.standardized&&(h+=d+exportObj.translate("faction","Standardized"),d=", ")}return k+=h+l,""!==k?(e={text:"<i><b>"+exportObj.translate("restrictions","Restrictions")+":</b> "+k+"</i>"},exportObj.fixIcons(e)):""},a.prototype.listCards=function(){var a,b,c,d,e,f,g,h,i;for(a={},h=this.ships,d=0,f=h.length;d<f;d++)if(b=h[d],null!=b.pilot)for(a[b.pilot.name]=null,i=b.upgrades,e=0,g=i.length;e<g;e++)c=i[e],null!=c.data&&(a[c.data.name]=null);return Object.keys(a).sort()},a.prototype.getNotes=function(){return this.notes.val()},a.prototype.getTag=function(){return this.tag.val()},a.prototype.getObstacles=function(){return this.current_obstacles},a.prototype.isSquadPossibleWithCollection=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(0===Object.keys(null!=(l=null!=(m=this.collection)?m.expansions:void 0)?l:{}).length)return[!0,[]];if("true"!==(null!=(n=this.collection)?n.checks.collectioncheck:void 0))return[!0,[]];for(this.collection.reset(),g=!0,a=[],o=this.ships,h=0,j=o.length;h<j;h++)if(c=o[h],null!=c.pilot)for(d=this.collection.use("ship",c.pilot.ship),b=this.collection.use("pilot",c.pilot.name),d&&b||(g=!1),d||a.push(c.data),b||a.push(c.pilot),p=c.upgrades,i=0,k=p.length;i<k;i++)e=p[i],null!=e.data&&(f=this.collection.use("upgrade",e.data.name),f||(g=!1),f||a.push(e.data));return[g,a]},a.prototype.checkCollection=function(){var a,b,c;if(null!=this.collection)return c=this.isSquadPossibleWithCollection(),b=c[0],a=c[1],this.collection_invalid_container.toggleClass("d-none",b),this.collection_invalid_container.on("mouseover",function(b){return function(c){return b.showTooltip("MissingStuff",a)}}(this))},a.prototype.toXWS=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;for(k={description:this.getNotes(),faction:exportObj.toXWSFaction[this.faction],name:this.current_squad.name,pilots:[],points:this.total_points,vendor:{yasb:{builder:"YASB - X-Wing 2.5",builder_url:window.location.href.split("?")[0],link:this.getPermaLink()}},version:"06/15/2022"},w=this.ships,m=0,q=w.length;m<q;m++)h=w[m],null!=h.pilot&&k.pilots.push(h.toXWS());for(e={},b=0,i=function(){var a,b,c,d;for(c=k.pilots,d=[],a=0,b=c.length;a<b;a++)g=c[a],null!=g.multisection&&d.push(g);return d}(),l=n=0,x=Math.pow(i.length,2);(0<=x?n<x:n>x)&&0!==i.length&&(j=i.shift(),null==j.multisection_id&&(j.multisection_id=b++),null==e[v=j.multisection_id]&&(e[v]=[j]),0!==i.length);l=0<=x?++n:--n){for(d=[],o=0,r=i.length;o<r&&(a=i[o],y=j.name,!(__indexOf.call(a.multisection,y)>=0&&(d.push(a),j.multisection.removeItem(a.name),a.multisection.removeItem(j.name),a.multisection_id=j.multisection_id,e[a.multisection_id].push(a),0===j.multisection.length)));o++);for(p=0,s=d.length;p<s;p++)c=d[p],0===c.multisection.length&&i.removeItem(c)}for(z=k.pilots,u=0,t=z.length;u<t;u++)g=z[u],null!=g.multisection&&delete g.multisection;return f=this.getObstacles(),null!=f&&f.length>0&&(k.obstacles=f),k},a.prototype.toMinimalXWS=function(){var a,b,c,d;c=this.toXWS();for(a in c)__hasProp.call(c,a)&&(b=c[a],"faction"!==a&&"pilots"!==a&&"version"!==a&&delete c[a]);d=c.pilots;for(a in d)__hasProp.call(d,a)&&(b=d[a],"id"!==a&&"upgrades"!==a&&"multisection_id"!==a&&delete c[a]);return c},a.prototype.loadFromXWS=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H;switch(o=null,d=null,t=null!=a.version?function(){var b,c,d,e;for(d=a.version.split("."),e=[],b=0,c=d.length;b<c;b++)u=d[b],e.push(parseInt(u));return e}():[0,2],!1){case!(t>[0,1]):if(v=exportObj.fromXWSFaction[a.faction],this.faction!==v)throw new Error("Attempted to load XWS for "+a.faction+" but builder is "+this.faction);for(null!=a.name&&(this.current_squad.name=a.name),null!=a.description&&this.notes.val(a.description),null!=a.obstacles&&(this.current_squad.additional_data.obstacles=a.obstacles),this.suppress_automatic_new_ship=!0,this.removeAllShips(),o=!0,d="",e=this.isStandard?"h":"s",l="",D=a.pilots,x=0,A=D.length;x<A;x++){if(h=D[x],g=this.addShip(),h.id)i=h.id;else{if(!h.name){o=!1,d="Pilot without identifier";break}i=h.name}if(null!=exportObj.pilotsByFactionXWS[v][i])l+=exportObj.pilotsByFactionXWS[v][i][0].id;else if(exportObj.pilotsByUniqueName[i]&&1===exportObj.pilotsByUniqueName[i].length)l+=exportObj.pilotsByUniqueName[i][0].id;else{E=exportObj.pilotsByUniqueName;for(f in E)for(k=E[f],y=0,B=k.length;y<B;y++)if(j=k[y],j.xws&&j.xws===i||!j.xws&&f===i){l+=j.id;break}}exportObj.standardCheck(h,!0)||"h"!==e||(e="s"),l+="X",c=[],G=null!=(F=h.upgrades)?F:{};for(s in G)for(r=G[s],z=0,C=r.length;z<C;z++)if(q=r[z],n=null,n=null!=(H=exportObj.fromXWSUpgrade[s])?H:s.capitalize(),null!=q){if(p=null!=(w=exportObj.upgradesBySlotXWSName[n])[q]?w[q]:w[q]=exportObj.upgradesBySlotCanonicalName[n][q],null==p){console.log("Failed to load xws upgrade: "+q),d+="Skipped upgrade "+q,o=!1;continue}l+=p.id,l+="W",exportObj.standardCheck(p,!0)||"h"!==e||(e="s")}l+="XY"}m="v9Z"+e+"Z20Z",l=m+l,this.loadFromSerialized(l),this.current_squad.dirty=!0,this.container.trigger("xwing-backend:squadNameChanged"),this.container.trigger("xwing-backend:squadDirtinessChanged")}return b({success:o,error:d})},a}(),Ship=function(){function a(a){this.builder=a.builder,this.container=a.container,this.pilot=null,this.data=null,this.quickbuildId=-1,this.linkedShip=null,this.primary=!0,this.upgrades=[],this.upgrade_points_total=0,this.wingmates=[],this.destroystate=0,this.uitranslation=this.builder.uitranslation,this.setupUI()}return a.prototype.destroy=function(a){var b,c,d,e;if(e=__iced_k_noop,c=iced.findDeferral(arguments),this.resetPilot(),this.resetAddons(),this.teardownUI(),b=this.builder.ships.indexOf(this),b<0)throw new Error("Ship not registered with builder");this.builder.ships.splice(b,1),this.wingmates.length>0&&this.setWingmates(0),function(a){return function(b){return null===a.linkedShip?b():void!function(b){var e;return(null!=(e=a.linkedShip.wingmates)?e.length:void 0)>0&&__indexOf.call(a.linkedShip.wingmates,a)>=0?b(a.linkedShip.removeFromWing(a)):(a.linkedShip.linkedShip=null,void function(b){d=new iced.Deferrals(b,{parent:c,funcname:"Ship.destroy"}),a.builder.removeShip(a.linkedShip,d.defer({lineno:5597})),d._fulfill()}(b))}(b)}}(this)(function(b){return function(){return a()}}(this))},a.prototype.copyFrom=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;if(a===this)throw new Error("Cannot copy from self");if(null!=a.pilot&&null!=a.data){if(this.builder.isQuickbuild){if(e=!(a.pilot.unique||null!=a.pilot.max_per_squad&&this.builder.countPilots(a.pilot.canonical_name)>=a.pilot.max_per_squad))for(s=a.upgrades,j=0,n=s.length;j<n;j++)i=s[j],(null!=(null!=(t=i.data)?t.unique:void 0)&&i.data.unique||null!=(null!=(u=i.data)?u.max_per_squad:void 0)&&this.builder.countUpgrades(i.data.canonical_name)>=i.data.max_per_squad||null!=(null!=(v=i.data)?v.solitary:void 0))&&(e=!1);if(e)this.setPilotById(a.quickbuildId);else{if(b=function(){var b,c,d,e;for(d=this.builder.getAvailablePilotsForShipIncluding(a.data.name),e=[],b=0,c=d.length;b<c;b++)h=d[b],h.disabled||e.push(h);return e}.call(this),!(b.length>0))return;this.setPilotById(b[0].id,!0)}}else{if(a.pilot.unique||null!=a.pilot.max_per_squad&&this.builder.countPilots(a.pilot.canonical_name)>=a.pilot.max_per_squad){if(b=function(){var b,c,d,e;for(d=this.builder.getAvailablePilotsForShipIncluding(a.data.name),e=[],b=0,c=d.length;b<c;b++)h=d[b],h.disabled||e.push(h);return e}.call(this),!(b.length>0))return;this.setPilotById(b[0].id,!0)}else this.setPilotById(a.pilot.id,!0);for(g={},w=a.upgrades,k=0,o=w.length;k<o;k++)i=w[k],null!=(null!=i?i.data:void 0)&&!i.data.unique&&(null==i.data.max_per_squad||this.builder.countUpgrades(i.data.canonical_name)<i.data.max_per_squad)&&(null==g[r=i.slot]&&(g[r]=[]),g[i.slot].push(i));for(c={},x=this.upgrades,l=0,p=x.length;l<p;l++)i=x[l],i.isOccupied()||(f=(null!=(y=g[i.slot])?y:[]).shift(),null!=f&&(i.setById(f.data.id),i.lastSetValid||(c[f.data.id]=i)));for(d in c)i=c[d],i.setById(d);for(z=this.upgrades,m=0,q=z.length;m<q;m++)i=z[m],i.isOccupied()||(f=(null!=(A=g[i.slot])?A:[]).shift(),null!=f&&i.setById(f.data.id));this.addStandardizedUpgrades()}return this.updateSelections(),this.builder.container.trigger("xwing:pointsUpdated"),this.builder.current_squad.dirty=!0,this.builder.container.trigger("xwing-backend:squadDirtinessChanged")}},a.prototype.setShipType=function(a){var b,c,d,e,f,g,h,i;for(this.pilot_selector.data("select2").container.show(),a!==(null!=(h=this.pilot)?h.ship:void 0)&&(this.builder.isQuickbuild?(d=function(){var b,c,d,f;for(d=this.builder.getAvailablePilotsForShipIncluding(a),f=[],b=0,c=d.length;b<c;b++)e=d[b],e.disabled||f.push(e.id);return f}.call(this)[0],this.setPilotById(d)):(c=function(){var b,c,d,f;for(d=this.builder.getAvailablePilotsForShipIncluding(a),f=[],b=0,c=d.length;b<c;b++)e=d[b],exportObj.pilotsById[e.id].unique||f.push(exportObj.pilotsById[e.id]);return f}.call(this)[0],c?this.setPilot(c):this.setPilot(function(){var b,c,d,f,g;for(d=this.builder.getAvailablePilotsForShipIncluding(a),g=[],b=0,c=d.length;b<c;b++)e=d[b],null!=exportObj.pilotsById[e.id].restriction_func&&!exportObj.pilotsById[e.id].restriction_func(this)||(f=exportObj.pilotsById[e.id],__indexOf.call(this.builder.uniques_in_use.Pilot,f)>=0)||g.push(exportObj.pilotsById[e.id]);return g}.call(this)[0]))),this.checkPilotSelectorQueryModal(),i=this.row.attr("class").split(/\s+/),f=0,g=i.length;f<g;f++)b=i[f],0===b.indexOf("ship-")&&this.row.removeClass(b);return this.remove_button.fadeIn("fast"),this.copy_button.fadeIn("fast"),this.builder.show_points_destroyed===!0&&this.points_destroyed_button.fadeIn("fast"),this.row.addClass("ship-"+a.toLowerCase().replace(/[^a-z0-9]/gi,"")),this.builder.container.trigger("xwing:shipUpdated")},a.prototype.setPilotById=function(a,b){var c,d,e,f,g,h;return h=__iced_k_noop,f=iced.findDeferral(arguments),null==b&&(b=!1),this.builder.isQuickbuild?void!function(b){return function(h){return a===b.quickbuildId?h():(b.wingmate_selector.parent().hide(),null!=b.wingmates&&b.wingmates.length>0&&(b.setWingmates(0),b.linkedShip=null),b.quickbuildId=a,b.builder.current_squad.dirty=!0,b.resetPilot(),b.resetAddons(),function(h){return null!=a&&a>-1?(d=exportObj.quickbuildsById[parseInt(a)],c=exportObj.pilots[d.pilot],b.data=exportObj.ships[d.ship],b.builder.isUpdatingPoints=!0,function(a){return null==(null!=c?c.unique:void 0)?a():void!function(a){g=new iced.Deferrals(a,{parent:f,funcname:"Ship.setPilotById"}),b.builder.container.trigger("xwing:claimUnique",[c,"Pilot",g.defer({
lineno:5719})]),g._fulfill()}(a)}(function(){var a,i,j;if(b.pilot=c,null!=b.pilot&&b.setupAddons(),b.copy_button.show(),b.setShipType(b.pilot.ship),null!=d.wingmate&&null==b.linkedShip)for(j=b.builder.ships,a=0,i=j.length;a<i;a++)if(e=j[a],e.quickbuildId===d.linkedId)return e.joinWing(b),b.linkedShip=e,b.primary=!1,b.builder.isUpdatingPoints=!1,b.builder.container.trigger("xwing:pointsUpdated"),void b.builder.container.trigger("xwing-backend:squadDirtinessChanged");!function(a){return b.linkedShip?void!function(a){return null!=d.linkedId?(b.linkedShip.setPilotById(d.linkedId),a(null==d.wingmate?b.linkedShip.primary=!1:void 0)):void!function(a){var c;return(null!=(c=b.linkedShip.wingmates)?c.length:void 0)>0?a(b.linkedShip.removeFromWing(b)):(b.linkedShip.linkedShip=null,void function(a){g=new iced.Deferrals(a,{parent:f,funcname:"Ship.setPilotById"}),b.builder.removeShip(b.linkedShip,g.defer({lineno:5752})),g._fulfill()}(a))}(function(){return a(b.linkedShip=null)})}(a):a(null!=d.linkedId?(b.linkedShip=b.builder.ships.slice(-1)[0],null!==b.linkedShip.data?b.linkedShip=b.builder.addShip():b.builder.addShip(),b.linkedShip.linkedShip=b,b.linkedShip.setPilotById(d.linkedId),null==d.wingmate?b.linkedShip.primary=!1:void 0):void 0)}(function(){return b.primary=null==d.wingmate,null!=(null!=d?d.wingleader:void 0)&&(b.wingmate_selector.parent().show(),b.wingmate_selector.val(d.wingmates[0]),b.wingmate_selector.attr("min",d.wingmates[0]),b.wingmate_selector.attr("max",d.wingmates[d.wingmates.length-1]),b.setWingmates(d.wingmates[0])),b.builder.isUpdatingPoints=!1,h(b.builder.container.trigger("xwing:pointsUpdated"))})}),void 0):h(b.copy_button.hide())}(function(){return b.row.removeClass("unsortable"),b.builder.container.trigger("xwing:pointsUpdated"),h(b.builder.container.trigger("xwing-backend:squadDirtinessChanged"))}),void 0)}}(this)(h):h(this.setPilot(exportObj.pilotsById[parseInt(a)],b))},a.prototype.addStandardizedUpgrades=function(){var a,b,c,d,e,f,g,h,i,j;if(b=this.builder.standard_list.Ship.indexOf(null!=(h=this.data)?h.name:void 0),b>-1){for(e=this.builder.standard_list.Upgrade[b],i=this.upgrades,j=[],f=0,g=i.length;f<g;f++)if(d=i[f],exportObj.slotsMatching(d.slot,this.builder.standard_list.Upgrade[b].slot)){if(c=e.restrictions?e.restrictions:void 0,a=this.restriction_check(c,d,0,0)){d.setData(e);break}j.push(void 0)}else j.push(void 0);return j}},a.prototype.setPilot=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(o=__iced_k_noop,m=iced.findDeferral(arguments),null==b&&(b=!1),a===this.pilot)return o();if(this.builder.current_squad.dirty=!0,i=null!=this.pilot&&(null!=a?a.ship:void 0)===this.pilot.ship,h={},i)for(s=this.upgrades,p=0,q=s.length;p<q;p++)j=s[p],null!=(null!=j?j.data:void 0)&&(null==h[r=j.slot]&&(h[r]=[]),h[j.slot].push(j.data.id));this.resetPilot(),this.resetAddons(),function(o){return function(p){return null==a?p(o.copy_button.hide()):(o.data=exportObj.ships[null!=a?a.ship:void 0],void function(b){return null==(null!=a?a.unique:void 0)?b():void!function(b){n=new iced.Deferrals(b,{parent:m,funcname:"Ship.setPilot"}),o.builder.container.trigger("xwing:claimUnique",[a,"Pilot",n.defer({lineno:5817})]),n._fulfill()}(b)}(function(){var m,n,q,r,s,t,u,v,w,x,y,z;if(o.pilot=a,null!=o.pilot&&o.setupAddons(),o.copy_button.show(),o.setShipType(o.pilot.ship),o.addStandardizedUpgrades(),(null!=o.pilot.autoequip||null!=exportObj.ships[o.pilot.ship].autoequip&&!i)&&!b)for(d=(null!=(w=o.pilot.autoequip)?w:[]).concat(null!=(v=exportObj.ships[o.pilot.ship].autoequip)?v:[]),m=0,r=d.length;m<r;m++)for(k=d[m],c=exportObj.upgrades[k],x=o.upgrades,n=0,s=x.length;n<s;n++)j=x[n],exportObj.slotsMatching(j.slot,c.slot)&&j.setData(c);if(i)for(l=q=1;q<=2;l=++q){for(e={},y=o.upgrades,u=0,t=y.length;u<t;u++)j=y[u],g=(null!=(z=h[j.slot])?z:[]).shift(),null!=g&&(j.setById(g),j.lastSetValid||(e[g]=j));for(f in e)j=e[f],j.setById(f)}return p()}))}}(this)(function(a){return function(){return a.row.removeClass("unsortable"),a.builder.container.trigger("xwing:pointsUpdated"),o(a.builder.container.trigger("xwing-backend:squadDirtinessChanged"))}}(this))},a.prototype.resetPilot=function(){var a,b,c;c=__iced_k_noop,a=iced.findDeferral(arguments),function(c){return function(d){var e;return null==(null!=(e=c.pilot)?e.unique:void 0)?d():void!function(d){b=new iced.Deferrals(d,{parent:a,funcname:"Ship.resetPilot"}),c.builder.container.trigger("xwing:releaseUnique",[c.pilot,"Pilot",b.defer({lineno:5853})]),b._fulfill()}(d)}}(this)(function(a){return function(){return a.pilot=null}}(this))},a.prototype.setupAddons=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(this.builder.isQuickbuild){for(p=null!=(o=exportObj.quickbuildsById[this.quickbuildId].upgrades)?o:[],s=[],g=0,j=p.length;g<j;g++)d=p[g],c=exportObj.upgrades[d],null!=c?(b=new exportObj.QuickbuildUpgrade({ship:this,container:this.addon_container,slot:c.slot,upgrade:c}),b.setData(c),s.push(this.upgrades.push(b))):console.log("Unknown Upgrade: "+d);return s}if(null!=this.pilot.upgrades){for(l=null!=(k=this.pilot.upgrades)?k:[],q=[],e=0,h=l.length;e<h;e++)d=l[e],c=exportObj.upgrades[d],null!=c?(b=new exportObj.QuickbuildUpgrade({ship:this,container:this.addon_container,slot:c.slot,upgrade:c}),b.setData(c),q.push(this.upgrades.push(b))):console.log("Unknown Upgrade: "+d);return q}for(n=null!=(m=this.pilot.slots)?m:[],r=[],f=0,i=n.length;f<i;f++)a=n[f],r.push(this.upgrades.push(new exportObj.Upgrade({ship:this,container:this.addon_container,slot:a})));return r},a.prototype.resetAddons=function(){var a,b,c,d;d=__iced_k_noop,b=iced.findDeferral(arguments),function(d){return function(e){var f,g,h;for(c=new iced.Deferrals(e,{parent:b,funcname:"Ship.resetAddons"}),h=d.upgrades,f=0,g=h.length;f<g;f++)a=h[f],null!=a&&a.destroy(c.defer({lineno:5895}));c._fulfill()}}(this)(function(a){return function(){return a.upgrades=[]}}(this))},a.prototype.getPoints=function(){var a,b,c,d,e,f,g;return this.builder.isQuickbuild?(b=exportObj.quickbuildsById[this.quickbuildId],c=this.primary&&null!=(g=null!=b?b.threat:void 0)?g:0,null!=(null!=b?b.wingleader:void 0)&&(c=b.threat[b.wingmates.indexOf(this.wingmates.length)]),this.points_container.find("span").text(c),c>0?this.points_container.fadeTo("fast",1):this.points_container.fadeTo(0,0),c):(a=null!=(d=null!=(e=this.pilot)?e.points:void 0)?d:0,this.points_container.find("div").text(""+a),this.points_container.find(".upgrade-points").text(null!=(null!=(f=this.pilot)?f.loadout:void 0)?"("+this.upgrade_points_total+"/"+this.pilot.loadout+")":""),a>0?this.points_container.fadeTo("fast",1):this.points_container.fadeTo(0,0),a)},a.prototype.setWingmates=function(a){var b,c,d,e,f,g,h;if(g=__iced_k_noop,e=iced.findDeferral(arguments),(null!=(h=this.wingmates)?h.length:void 0)!==a){for(null!=this.wingmates&&0!==this.wingmates.length||(this.wingmates=[]),d=exportObj.quickbuildsById[this.quickbuildId];this.wingmates.length<a;)c=this.builder.ships.slice(-1)[0],null!==c.data?c=this.builder.addShip():this.builder.addShip(),c.linkedShip=this,this.wingmates.push(c),c.setPilotById(d.wingmateId),c.primary=!1,this.primary=!0;!function(c){return function(d){var g;(g=function(d){var h,i,j;return h=d,i=function(){return iced.trampoline(function(){return g(d)})},j=i,c.wingmates.length>a?(b=c.wingmates.pop(),b.linkedShip=null,function(a){f=new iced.Deferrals(a,{parent:e,funcname:"Ship.setWingmates"}),c.builder.removeShip(b,f.defer({lineno:5950})),f._fulfill()}(j),void 0):h()})(d)}}(this)(function(b){return function(){return b.wingmate_selector.val(a)}}(this))}},a.prototype.removeFromWing=function(a){var b,c;return this.wingmates.removeItem(a),b=exportObj.quickbuildsById[this.quickbuildId],c=this.wingmates.length,__indexOf.call(b.wingmates,c)>=0||this.destroy($.noop),this.wingmate_selector.val(this.wingmates.length)},a.prototype.joinWing=function(a){var b,c;return this.wingmates.push(a),b=exportObj.quickbuildsById[this.quickbuildId],c=this.wingmates.length,__indexOf.call(b.wingmates,c)>=0||(a.destroy($.noop),this.removeFromWing(a)),this.wingmate_selector.val(this.wingmates.length)},a.prototype.updateSelections=function(){var a,b,c,d,e,f,g;if(null!=this.pilot){for(this.ship_selector.select2("data",{id:this.pilot.ship,text:exportObj.ships[this.pilot.ship].display_name?exportObj.ships[this.pilot.ship].display_name:this.pilot.ship,chassis:exportObj.ships[this.pilot.ship].chassis?exportObj.ships[this.pilot.ship].chassis:"",xws:exportObj.ships[this.pilot.ship].xws,icon:exportObj.ships[this.pilot.ship].icon?exportObj.ships[this.pilot.ship].icon:exportObj.ships[this.pilot.ship].xws}),this.pilot_selector.select2("data",{id:this.pilot.id,text:""+(null!=(null!=(e=exportObj.settings)?e.initiative_prefix:void 0)&&exportObj.settings.initiative_prefix?this.pilot.skill+" - ":"")+(this.pilot.display_name?this.pilot.display_name:this.pilot.name)+(this.quickbuildId!==-1?exportObj.quickbuildsById[this.quickbuildId].suffix:"")+" ("+(this.quickbuildId!==-1?this.primary?exportObj.quickbuildsById[this.quickbuildId].threat:0:this.pilot.points)+(this.quickbuildId!==-1||null==this.pilot.loadout?"":"/"+this.pilot.loadout)+")",chassis:null!=this.pilot.chassis?this.pilot.chassis:""}),this.pilot_selector.data("select2").container.show(),f=this.upgrades,g=[],c=0,d=f.length;c<d;c++)b=f[c],a=b.getPoints(),g.push(b.updateSelection(a));return g}return this.pilot_selector.select2("data",null)},a.prototype.checkPilotSelectorQueryModal=function(){return $(window).width()>=768?this.pilot_query_modal.hide():this.pilot?this.pilot_query_modal.show():void 0},a.prototype.setupUI=function(){var a,b;return this.row=$(document.createElement("DIV")),this.row.addClass("row ship mb-5 mb-sm-0 unsortable"),this.row.insertBefore(this.builder.notes_container),this.row.append($.trim('<div class="col-md-3">\n    <div class="form-group d-flex">\n        <input class="ship-selector-container" type="hidden"></input>\n        <div class="d-block d-md-none input-group-append">\n            <button class="btn btn-secondary ship-query-modal"><i class="fas fa-question"></i></button>\n        </div>\n    <br />\n    </div>\n    <div class="form-group d-flex">\n        <input type="hidden" class="pilot-selector-container"></input>\n        <div class="d-block d-md-none input-group-append">\n            <button class="btn btn-secondary pilot-query-modal"><i class="fas fa-question"></i></button>\n        <br />\n        </div>\n    </div>\n    <label class="wingmate-label">\n    '+this.uitranslation("Wingmates")+': \n        <input type="number" class="wingmate-selector"></input>\n    </label>\n</div>\n<div class="col-md-1 points-display-container">\n     <div></div>\n     <div class="upgrade-points"></div>\n</div>\n<div class="col-md-6 addon-container">  </div>\n<div class="col-md-2 button-container">\n    <button class="btn btn-danger remove-pilot side-button"><span class="d-none d-sm-block" data-toggle="tooltip" title="'+this.uitranslation("Remove Pilot")+'"><i class="fa fa-times"></i></span><span class="d-block d-sm-none"> '+this.uitranslation("Remove Pilot")+'</span></button>\n    <button class="btn btn-light copy-pilot side-button"><span class="d-none d-sm-block" data-toggle="tooltip" title="'+this.uitranslation("Clone Pilot")+'"><i class="far fa-copy"></i></span><span class="d-block d-sm-none"> '+this.uitranslation("Clone Pilot")+'</span></button>\n    <button class="btn btn-light points-destroyed side-button" points-state"><span class="d-none d-sm-block destroyed-type" data-toggle="tooltip" title="'+this.uitranslation("Points Destroyed")+'"><i class="fas fa-circle"></i></i></span><span class="d-block d-sm-none destroyed-type-mobile"> '+this.uitranslation("Undamaged")+"</span></button>\n</div>")),this.row.find(".button-container span").tooltip(),this.ship_selector=$(this.row.find("input.ship-selector-container")),this.pilot_selector=$(this.row.find("input.pilot-selector-container")),this.wingmate_selector=$(this.row.find("input.wingmate-selector")),this.ship_query_modal=$(this.row.find("button.ship-query-modal")),this.pilot_query_modal=$(this.row.find("button.pilot-query-modal")),this.ship_query_modal.click(function(a){return function(b){if(a.pilot)return a.builder.showTooltip("Ship",exportObj.ships[a.pilot.ship],null,a.builder.mobile_tooltip_modal,!0),a.builder.mobile_tooltip_modal.modal("show")}}(this)),this.pilot_query_modal.click(function(a){return function(b){if(a.pilot)return a.builder.showTooltip("Pilot",a.pilot,a.pilot?a:void 0,a.builder.mobile_tooltip_modal,!0),a.builder.mobile_tooltip_modal.modal("show")}}(this)),a=function(a,b,c){return'<i class="xwing-miniatures-ship xwing-miniatures-ship-'+a.icon+'"></i> '+a.text},b=function(a,b){return'<i class="xwing-miniatures-ship xwing-miniatures-ship-'+a.icon+'"></i> '+a.text},this.ship_selector.select2({width:"100%",placeholder:exportObj.translate("ui","shipSelectorPlaceholder"),query:function(a){return function(b){var c;return c={results:[]},c.results=a.builder.getAvailableShipsMatching(b.term),b.callback(c)}}(this),minimumResultsForSearch:$.isMobile()?-1:0,formatResultCssClass:function(a){return function(b){var c;return null!=a.builder.collection&&"true"===a.builder.collection.checks.collectioncheck?(c=!1,null!=a.pilot&&b.id===exportObj.ships[a.pilot.ship].id?a.builder.collection.checkShelf("ship",b.name)||a.builder.collection.checkTable("pilot",b.name)||(c=!0):c=!a.builder.collection.checkShelf("ship",b.name),c?"select2-result-not-in-collection":""):""}}(this),formatResult:a,formatSelection:a}),this.ship_selector.on("select2-focus",function(a){return function(a){if($.isMobile())return $(".select2-container .select2-focusser").remove(),$(".select2-search input").prop("focus",!1).removeClass("select2-focused")}}(this)),this.ship_selector.on("change",function(a){return function(b){return a.setShipType(a.ship_selector.val())}}(this)),this.ship_selector.data("select2").results.on("mousemove-filtered",function(a){return function(b){var c;if(c=$(b.target).closest(".select2-result").data("select2-data"),null!=(null!=c?c.id:void 0))return a.builder.showTooltip("Ship",exportObj.ships[c.id])}}(this)),this.ship_selector.data("select2").container.on("mouseover",function(a){return function(b){if(a.pilot)return a.builder.showTooltip("Ship",exportObj.ships[a.pilot.ship])}}(this)),this.pilot_selector.select2({width:"100%",placeholder:exportObj.translate("ui","pilotSelectorPlaceholder"),query:function(a){return function(b){var c;return c={results:[]},c.results=a.builder.getAvailablePilotsForShipIncluding(a.ship_selector.val(),a.builder.isQuickbuild?a.quickbuildId:a.pilot,b.term,!0,a),b.callback(c)}}(this),minimumResultsForSearch:$.isMobile()?-1:0,formatResultCssClass:function(a){return function(b){var c,d,e,f,g;return null!=a.builder.collection&&"true"===a.builder.collection.checks.collectioncheck?(d=!1,c="",c=a.builder.isQuickbuild?null!=(e=null!=(f=exportObj.quickbuildsById[b.id])?f.pilot:void 0)?e:"unknown pilot":b.name,b.id===(null!=(g=a.pilot)?g.id:void 0)?a.builder.collection.checkShelf("pilot",c)||a.builder.collection.checkTable("pilot",c)||(d=!0):d=!a.builder.collection.checkShelf("pilot",c),d?"select2-result-not-in-collection":""):""}}(this)}),this.pilot_selector.on("select2-focus",function(a){return function(a){if($.isMobile())return $(".select2-container .select2-focusser").remove(),$(".select2-search input").prop("focus",!1).removeClass("select2-focused")}}(this)),this.pilot_selector.on("change",function(a){return function(b){return a.setPilotById(a.pilot_selector.select2("val")),a.builder.current_squad.dirty=!0,a.builder.container.trigger("xwing-backend:squadDirtinessChanged"),a.builder.backend_status.fadeOut("slow")}}(this)),this.pilot_selector.data("select2").results.on("mousemove-filtered",function(a){return function(b){var c,d;if(c=$(b.target).closest(".select2-result").data("select2-data"),a.builder.isQuickbuild){if(null!=(null!=c?c.id:void 0))return a.builder.showTooltip("Quickbuild",exportObj.quickbuildsById[c.id],{ship:null!=(d=a.data)?d.name:void 0})}else if(null!=(null!=c?c.id:void 0))return a.builder.showTooltip("Pilot",exportObj.pilotsById[c.id])}}(this)),this.pilot_selector.data("select2").container.on("mouseover",function(a){return function(b){if(a.pilot)return a.builder.showTooltip("Pilot",a.pilot,a)}}(this)),this.pilot_selector.data("select2").container.hide(),this.builder.isQuickbuild&&(this.wingmate_selector.on("change",function(a){return function(b){return a.setWingmates(parseInt(a.wingmate_selector.val())),a.builder.current_squad.dirty=!0,a.builder.container.trigger("xwing-backend:squadDirtinessChanged"),a.builder.backend_status.fadeOut("slow")}}(this)),this.wingmate_selector.on("mousemove-filtered",function(a){return function(a){}}(this))),this.wingmate_selector.parent().hide(),this.points_container=$(this.row.find(".points-display-container")),this.points_container.fadeTo(0,0),this.addon_container=$(this.row.find("div.addon-container")),this.remove_button=$(this.row.find("button.remove-pilot")),this.remove_button.click(function(a){return function(b){return b.preventDefault(),a.row.slideUp("fast",function(){var b;return a.builder.removeShip(a),null!=(b=a.backend_status)?b.fadeOut("slow"):void 0})}}(this)),this.remove_button.hide(),this.copy_button=$(this.row.find("button.copy-pilot")),this.copy_button.click(function(a){return function(b){var c,d,e,f,g;for(f=a.builder.ships,g=[],d=0,e=f.length;d<e;d++){if(c=f[d],c.row.hasClass("unsortable")){c.copyFrom(a);break}g.push(void 0)}return g}}(this)),this.copy_button.hide(),this.checkPilotSelectorQueryModal(),this.points_destroyed_button_span=$(this.row.find(".destroyed-type")),this.points_destroyed_button_span_mobile=$(this.row.find(".destroyed-type-mobile")),this.points_destroyed_button=$(this.row.find("button.points-destroyed")),this.points_destroyed_button.click(function(a){return function(b){switch(a.destroystate){case 0:a.destroystate++,a.points_destroyed_button.addClass("btn-warning"),a.points_destroyed_button.removeClass("btn-light"),a.points_destroyed_button_span_mobile.text(a.uitranslation("Half Damaged")),a.points_destroyed_button_span.html('<i class="fas fa-adjust"></i>');break;case 1:a.destroystate++,a.points_destroyed_button.addClass("btn-danger"),a.points_destroyed_button.removeClass("btn-warning"),a.points_destroyed_button_span_mobile.text(a.uitranslation("Fully Destroyed")),a.points_destroyed_button_span.html('<i class="far fa-circle"></i>');break;case 2:a.destroystate=0,a.points_destroyed_button.addClass("btn-light"),a.points_destroyed_button.removeClass("btn-danger"),a.points_destroyed_button_span_mobile.text(a.uitranslation("Undamaged")),a.points_destroyed_button_span.html('<i class="fas fa-circle"></i>')}return a.builder.onPointsUpdated()}}(this)),this.points_destroyed_button.hide()},a.prototype.teardownUI=function(){return this.row.text(""),this.row.remove()},a.prototype.toString=function(){return null!=this.pilot?this.uitranslation("PilotFlyingShip",this.pilot.display_name?this.pilot.display_name:this.pilot.name,this.data.display_name?this.data.display_name:this.data.name):this.data.display_name?this.data.display_name:this.data.name},a.prototype.toHTML=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa;if(p=this.effectiveStats(),c=this.builder.formatActions(p.actions,"&nbsp;&nbsp;",null!=(G=this.pilot.keyword)?G:[]),e=null!=(H=this.data.attack_icon)?H:"xwing-miniatures-font-frontarc",r=null!=this.pilot.engagement?$.trim('<span class="info-data info-skill">ENG '+this.pilot.engagement+"</span>"):"",d=null!=p.attack?$.trim('<i class="xwing-miniatures-font header-attack '+e+'"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(S=null!=(ca=this.pilot.ship_override)?ca.attack:void 0)?S:this.data.attack,p,"attack")+"</span>"):"",g=null!=p.attackbull?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-bullseyearc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(ja=null!=(ka=this.pilot.ship_override)?ka.attackbull:void 0)?ja:this.data.attackbull,p,"attackbull")+"</span>"):"",f=null!=p.attackb?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-reararc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(la=null!=(ma=this.pilot.ship_override)?ma.attackb:void 0)?la:this.data.attackb,p,"attackb")+"</span>"):"",i=null!=p.attackf?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-fullfrontarc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(na=null!=(oa=this.pilot.ship_override)?oa.attackf:void 0)?na:this.data.attackf,p,"attackf")+"</span>"):"",l=null!=p.attackt?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-singleturretarc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(I=null!=(J=this.pilot.ship_override)?J.attackt:void 0)?I:this.data.attackt,p,"attackt")+"</span>"):"",j=null!=p.attackl?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-leftarc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(K=null!=(L=this.pilot.ship_override)?L.attackl:void 0)?K:this.data.attackl,p,"attackl")+"</span>"):"",k=null!=p.attackr?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-rightarc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(M=null!=(N=this.pilot.ship_override)?N.attackr:void 0)?M:this.data.attackr,p,"attackr")+"</span>"):"",h=null!=p.attackdt?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-doubleturretarc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(O=null!=(P=this.pilot.ship_override)?P.attackdt:void 0)?O:this.data.attackdt,p,"attackdt")+"</span>"):"",w="",null!=this.data.energyrecurr)for(o=0;o<this.data.energyrecurr;)w+='<sup><i class="fas fa-caret-up"></i></sup>',++o;if(q=null!=(null!=(Q=this.pilot.ship_override)?Q.energy:void 0)||null!=this.data.energy?$.trim('<i class="xwing-miniatures-font header-energy xwing-miniatures-font-energy"></i>\n<span class="info-data info-energy">'+statAndEffectiveStat(null!=(R=null!=(T=this.pilot.ship_override)?T.energy:void 0)?R:this.data.energy,p,"energy")+w+"</span>"):"",null!=p.force)if(w="",null!=p.forcerecurring)for(o=0;o<p.forcerecurring;)w+='<sup><i class="fas fa-caret-up"></i></sup>',++o;else w+='<sup><i class="fas fa-caret-up"></i></sup>';if(s=null!=p.force&&p.force>0?$.trim('<i class="xwing-miniatures-font header-force xwing-miniatures-font-forcecharge"></i>\n<span class="info-data info-force">'+statAndEffectiveStat(null!=(U=null!=(V=null!=(W=this.pilot.ship_override)?W.force:void 0)?V:this.pilot.force)?U:0,p,"force")+w+"</span>"):"",null!=this.pilot.charge){if(w="",null!=this.pilot.recurring)if(this.pilot.recurring>0)for(o=0;o<this.pilot.recurring;)w+='<sup><i class="fas fa-caret-up"></i></sup>',++o;else for(o=this.pilot.recurring;o<0;)w+='<sub><i class="fas fa-caret-down"></i></sub>',++o;m=$.trim('<i class="xwing-miniatures-font header-charge xwing-miniatures-font-charge"></i><span class="info-data info-charge">'+statAndEffectiveStat(null!=(X=null!=(Y=this.pilot.ship_override)?Y.charge:void 0)?X:this.pilot.charge,p,"charge")+w+"</span>")}else m="";if(y="",null!=this.data.shieldrecurr)for(o=0;o<this.data.shieldrecurr;)y+='<sup><i class="fas fa-caret-up"></i></sup>',++o;if(x="",p.shields){for(B=C=Z=p.shields;C>=2;B=C+=-1)x+='<i class="xwing-miniatures-font header-shield xwing-miniatures-font-shield expanded-hull-or-shield"></i>';x+='<i class="xwing-miniatures-font header-shield xwing-miniatures-font-shield"></i>'}if(u="",p.hull){for(B=D=_=p.hull;D>=2;B=D+=-1)u+='<i class="xwing-miniatures-font header-hull xwing-miniatures-font-hull expanded-hull-or-shield"></i>';u+='<i class="xwing-miniatures-font header-hull xwing-miniatures-font-hull"></i>'}if(t=$.trim('<div class="fancy-pilot-header">\n    <div class="pilot-header-text">'+(this.pilot.display_name?this.pilot.display_name:this.pilot.name)+' <i class="xwing-miniatures-ship xwing-miniatures-ship-'+this.data.xws+'"></i><span class="fancy-ship-type"> '+(this.data.display_name?this.data.display_name:this.data.name)+'</span></div>\n    <div class="mask">\n        <div class="outer-circle">\n            <div class="inner-circle pilot-points">'+(this.quickbuildId!==-1?this.primary?this.getPoints():"*":this.pilot.points)+'</div>\n        </div>\n    </div>\n</div>\n<div class="fancy-pilot-stats">\n    <div class="pilot-stats-content">\n        <span class="info-data info-skill">INI '+statAndEffectiveStat(this.pilot.skill,p,"skill")+"</span>\n        "+r+"\n        "+g+"\n        "+d+"\n        "+f+"\n        "+i+"\n        "+l+"\n        "+j+"\n        "+k+"\n        "+h+'\n        <i class="xwing-miniatures-font header-agility xwing-miniatures-font-agility"></i>\n        <span class="info-data info-agility">'+statAndEffectiveStat(null!=(aa=null!=(ba=this.pilot.ship_override)?ba.agility:void 0)?aa:this.data.agility,p,"agility")+"</span>                    \n        "+u+'\n        <span class="info-data info-hull">'+statAndEffectiveStat(null!=(da=null!=(ea=this.pilot.ship_override)?ea.hull:void 0)?da:this.data.hull,p,"hull")+"</span>\n        "+x+'\n        <span class="info-data info-shields">'+statAndEffectiveStat(null!=(fa=null!=(ga=this.pilot.ship_override)?ga.shields:void 0)?fa:this.data.shields,p,"shields")+y+"</span>\n        "+q+"\n        "+s+"\n        "+m+"\n        <br />\n        "+c+"\n    </div>\n</div>"),this.pilot.text&&(t+=$.trim('<div class="fancy-pilot-text">'+this.pilot.text+"</div>")),n=null!=(null!=p?p.chassis:void 0)&&""!==p.chassis?p.chassis:null!=this.data.chassis?this.data.chassis:"",""!==n&&(t+=$.trim('<div class="fancy-pilot-chassis"><strong>'+(null!=(ha=null!=(ia=exportObj.chassis[n])?ia.display_name:void 0)?ha:n)+":</strong> "+exportObj.chassis[n].text+"</div>")),z=function(){var a,b,c,d;for(c=this.upgrades,d=[],a=0,b=c.length;a<b;a++)A=c[a],null!=A.data&&d.push(A);return d}.call(this),z.length>0){for(t+=$.trim('<div class="fancy-upgrade-container">'),E=0,F=z.length;E<F;E++)A=z[E],v=A.getPoints(),t+=A.toHTML(v);t+=$.trim("</div>")}return a=Math.floor(this.getPoints()/2),b=Math.floor((p.hull+p.shields)/2),t+=$.trim('<div class="ship-points-total">\n    <strong>'+this.uitranslation("Ship Cost")+": "+this.getPoints()+", "+this.uitranslation("Loadout")+": ("+this.upgrade_points_total+(null!=this.pilot.loadout?"/"+this.pilot.loadout:"")+"), "+this.uitranslation("Half Points")+": "+a+", "+this.uitranslation("Damage Threshold")+": "+b+"</strong> \n</div>"),'<div class="fancy-ship">'+t+"</div>"},a.prototype.toTableRow=function(){var a,b,c,d,e,f,g,h;if(d=$.trim('<tr class="simple-pilot">\n    <td class="name">'+(this.pilot.display_name?this.pilot.display_name:this.pilot.name)+" &mdash; "+(this.data.display_name?this.data.display_name:this.data.name)+'</td>\n    <td class="points">'+(this.quickbuildId!==-1?this.primary?exportObj.quickbuildsById[this.quickbuildId].threat:0:this.pilot.points)+"</td>\n</tr>"),c=function(){var a,b,c,d;for(c=this.upgrades,d=[],a=0,b=c.length;a<b;a++)f=c[a],null!=f.data&&d.push(f);return d}.call(this),c.length>0)for(g=0,h=c.length;g<h;g++)f=c[g],b=f.getPoints(),d+=f.toTableRow(b);return d+='<tr class="simple-ship-total"><td colspan="2">'+this.uitranslation("Ship Cost")+": "+this.getPoints()+"</td></tr>",a=Math.floor(this.getPoints()/2),e=Math.floor((this.effectiveStats().hull+this.effectiveStats().shields)/2),d+='<tr class="simple-ship-half-points"><td colspan="2">'+this.uitranslation("Loadout")+": ("+this.upgrade_points_total+(null!=this.pilot.loadout?"/"+this.pilot.loadout:"")+") "+this.uitranslation("Half Points")+": "+a+" "+this.uitranslation("Damage Threshold")+": "+e+"</td></tr>",d+="<tr><td>&nbsp;</td><td></td></tr>"},a.prototype.toSimpleCopy=function(){var a,b,c,d,e,f,g,h,i,j;if(c=""+this.pilot.name+" ("+(this.quickbuildId!==-1?this.primary?exportObj.quickbuildsById[this.quickbuildId].threat:0:this.pilot.points)+")    \n",e=function(){var a,b,c,d;for(c=this.upgrades,d=[],a=0,b=c.length;a<b;a++)g=c[a],null!=g.data&&d.push(g);return d}.call(this),e.length>0){for(c+="    ",d=[],i=0,j=e.length;i<j;i++)g=e[i],b=g.getPoints(),h=g.toSimpleCopy(b),null!=h&&d.push(h);c+=d.join("    "),c+="    \n"}return a=Math.floor(this.getPoints()/2),f=Math.floor((this.effectiveStats().hull+this.effectiveStats().shields)/2),c+=""+this.uitranslation("Ship Cost")+": "+this.getPoints()+"  "+this.uitranslation("Loadout")+": ("+this.upgrade_points_total+(null!=this.pilot.loadout?"/"+this.pilot.loadout:"")+")  "+this.uitranslation("Half Points")+": "+a+"  "+this.uitranslation("Damage Threshold")+": "+f+"    \n    \n"},a.prototype.toRedditText=function(){var a,b,c,d,e,f,g,h,i,j;if(c="**"+this.pilot.name+" ("+(this.quickbuildId!==-1?this.primary?exportObj.quickbuildsById[this.quickbuildId].threat:0:this.pilot.points)+")**    \n",e=function(){var a,b,c,d;for(c=this.upgrades,d=[],a=0,b=c.length;a<b;a++)g=c[a],null!=g.data&&d.push(g);return d}.call(this),e.length>0){for(a=Math.floor(this.getPoints()/2),f=Math.floor((this.effectiveStats().hull+this.effectiveStats().shields)/2),c+="    ",d=[],i=0,j=e.length;i<j;i++)g=e[i],b=g.getPoints(),h=g.toRedditText(b),null!=h&&d.push(h);c+=d.join("    "),c+="&nbsp;*"+this.uitranslation("Ship Cost")+": "+this.getPoints()+"  "+this.uitranslation("Loadout")+": ("+this.upgrade_points_total+(null!=this.pilot.loadout?"/"+this.pilot.loadout:"")+")  "+this.uitranslation("Half Points")+": "+a+"  "+this.uitranslation("Damage Threshold")+": "+f+"*    \n"}return c},a.prototype.toTTSText=function(){var a,b,c,d,e,f;if(b=""+exportObj.toTTS(this.pilot.name),a=function(){var a,b,d,e;for(d=this.upgrades,e=[],a=0,b=d.length;a<b;a++)c=d[a],null!=c.data&&e.push(c);return e}.call(this),a.length>0)for(e=0,f=a.length;e<f;e++)c=a[e],d=c.toTTSText(),null!=d&&(b+=" + "+d);return b+=" / "},a.prototype.toSerialized=function(){var a,b,c;return this.builder.isQuickbuild?null==this.wingmates||0===this.wingmates.length?""+this.quickbuildId+"X":""+this.quickbuildId+"X"+this.wingmates.length:(c=(""+function(){var c,d,e,f,g,h;for(e=this.upgrades,h=[],a=c=0,d=e.length;c<d;a=++c)b=e[a],h.push(null!=(f=null!=b&&null!=(g=b.data)?g.id:void 0)?f:"");return h}.call(this)).replace(/,/g,"W"),[this.pilot.id,c].join("X"))},a.prototype.fromSerialized=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;switch(d=!0,a){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:console.log("Incorrect Version!"),this.old_version_container.toggleClass("d-none",!1);break;case 9:if(g="X",l="W",r=b.split(g),f=r[0],j=r[1],c=r[2],j=j.split(l),this.setPilotById(parseInt(f),!0),!this.validate)return!1;if(this.builder.isQuickbuild)j.length>0&&this.wingmates.length>0&&this.setWingmates(j[0]);else for(m=n=1;n<3;m=++n)for(e=o=s=j.length-1;s<=-1?o<-1:o>-1;e=s<=-1?++o:--o)if(i=j[e],h=exportObj.upgradesById[i],null!=h){for(t=this.upgrades,p=0,q=t.length;p<q;p++)if(k=t[p],exportObj.slotsMatching(h.slot,k.slot)&&!k.isOccupied()){k.setById(i),k.lastSetValid&&j.splice(e,1);break}}else j.splice(e,1),""!==i&&(console.log("Unknown upgrade id "+i+" could not be added. Please report that error"),d=!1);d&=0===j.length}return this.updateSelections(),d},a.prototype.effectiveStats=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X;for(d={attack:null!=(k=null!=(l=this.pilot.ship_override)?l.attack:void 0)?k:this.data.attack,attackf:null!=(w=null!=(H=this.pilot.ship_override)?H.attackf:void 0)?w:this.data.attackf,attackbull:null!=(S=null!=(T=this.pilot.ship_override)?T.attackbull:void 0)?S:this.data.attackbull,attackb:null!=(U=null!=(V=this.pilot.ship_override)?V.attackb:void 0)?U:this.data.attackb,attackt:null!=(W=null!=(X=this.pilot.ship_override)?X.attackt:void 0)?W:this.data.attackt,attackl:null!=(m=null!=(n=this.pilot.ship_override)?n.attackl:void 0)?m:this.data.attackl,attackr:null!=(o=null!=(p=this.pilot.ship_override)?p.attackr:void 0)?o:this.data.attackr,
attackdt:null!=(q=null!=(r=this.pilot.ship_override)?r.attackdt:void 0)?q:this.data.attackdt,energy:null!=(s=null!=(t=this.pilot.ship_override)?t.energy:void 0)?s:this.data.energy,agility:null!=(u=null!=(v=this.pilot.ship_override)?v.agility:void 0)?u:this.data.agility,hull:null!=(x=null!=(y=this.pilot.ship_override)?y.hull:void 0)?x:this.data.hull,shields:null!=(z=null!=(A=this.pilot.ship_override)?A.shields:void 0)?z:this.data.shields,force:null!=(B=null!=(C=null!=(D=this.pilot.ship_override)?D.force:void 0)?C:this.pilot.force)?B:0,forcerecurring:1,charge:null!=(E=null!=(F=this.pilot.ship_override)?F.charge:void 0)?E:this.pilot.charge,actions:(null!=(G=null!=(I=this.pilot.ship_override)?I.actions:void 0)?G:this.data.actions).slice(0),chassis:null!=(J=null!=(K=null!=(L=this.pilot.ship_override)?L.chassis:void 0)?K:this.pilot.chassis)?J:""},d.maneuvers=[],b=f=0,M=(null!=(N=this.data.maneuvers)?N:[]).length;0<=M?f<M:f>M;b=0<=M?++f:--f)d.maneuvers[b]=this.data.maneuvers[b].slice(0);if(null!=this.pilot.keyword&&__indexOf.call(this.pilot.keyword,"Droid")>=0&&null!=d.actions){for(a=[],O=d.actions,g=0,i=O.length;g<i;g++)c=O[g],a.push(c.replace("Focus","Calculate"));d.actions=a}for(P=this.upgrades,h=0,j=P.length;h<j;h++)e=P[h],null!=(null!=e&&null!=(Q=e.data)?Q.modifier_func:void 0)&&e.data.modifier_func(d);return null!=(null!=(R=this.pilot)?R.modifier_func:void 0)&&this.pilot.modifier_func(d),d},a.prototype.validate=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;if(null==this.pilot)return!0;if(i=!0,e=32,this.builder.isEpic){if(!(__indexOf.call(this.pilot.slots,"Command")>=0)){for(a=!0,r=this.upgrades,l=0,p=r.length;l<p;l++)j=r[l],"Command"===j.slot&&this===j.ship&&(a=!1);a===!0&&this.upgrades.push(new exportObj.Upgrade({ship:this,container:this.addon_container,slot:"Command"}))}}else if(!this.builder.isQuickbuild)for(d=m=s=this.upgrades.length-1;s<=-1?m<-1:m>-1;d=s<=-1?++m:--m)j=this.upgrades[d],"Command"===j.slot&&(j.destroy($.noop),this.upgrades.splice(d,1));for(d=n=0;0<=e?n<e:n>e;d=0<=e?++n:--n){if(k=!0,g=null!=(w=null!=(x=null!=(y=this.pilot)?y.validation_func:void 0)?x:null!=(z=this.pilot)?z.restriction_func:void 0)?w:void 0,null!=g&&!g(this,this.pilot)||!this.builder.isItemAvailable(this.pilot,!0))return this.builder.removeShip(this),!1;for(b=[],this.upgrade_points_total=0,A=this.upgrades,o=0,q=A.length;o<q;o++){if(j=A[o],f=!0,c=null!=(B=null!=j&&null!=(C=j.data)?C.validation_func:void 0)?B:void 0,null!=c&&(f=f&&(null!=j&&null!=(D=j.data)?D.validation_func(this,j):void 0)),h=null!=(t=null!=j&&null!=(u=j.data)?u.restrictions:void 0)?t:void 0,f=f&&this.restriction_check(h,j,j.getPoints(),this.upgrade_points_total),(!f||null!=(null!=j?j.data:void 0)&&(v=j.data,__indexOf.call(b,v)>=0||null!=j.data.faction&&!this.builder.isOurFaction(j.data.faction,this.pilot.faction)||!this.builder.isItemAvailable(j.data)))&&!this.builder.isQuickbuild){j.setById(null),k=!1,i=!1;break}null!=(null!=j?j.data:void 0)&&j.data&&b.push(null!=j?j.data:void 0),this.upgrade_points_total+=j.getPoints()}if(k)break}return this.updateSelections(),i},a.prototype.checkUnreleasedContent=function(){var a,b,c,d;if(null!=this.pilot&&!exportObj.isReleased(this.pilot))return!0;for(d=this.upgrades,b=0,c=d.length;b<c;b++)if(a=d[b],null!=(null!=a?a.data:void 0)&&!exportObj.isReleased(a.data))return!0;return!1},a.prototype.hasAnotherUnoccupiedSlotLike=function(a,b){var c,d,e,f;for(f=this.upgrades,d=0,e=f.length;d<e;d++)if(c=f[d],c!==a&&exportObj.slotsMatching(c.slot,b)&&!c.isOccupied())return!0;return!1},a.prototype.hasFilledSlotLike=function(a,b){var c,d,e,f;for(f=this.upgrades,d=0,e=f.length;d<e;d++)if(c=f[d],c!==a&&exportObj.slotsMatching(c.slot,b)&&c.isOccupied())return!0;return!1},a.prototype.restriction_check=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;if(i=this.effectiveStats(),null!=this.pilot.loadout&&c+d>this.pilot.loadout)return!1;if(null!=a)for(l=0,o=a.length;l<o;l++)switch(j=a[l],j[0]){case"FactionOrUnique":if(this.pilot.faction!==j[2]&&!this.checkListForUnique(j[1].toLowerCase().replace(/[^0-9a-z]/gi,"").replace(/\s+/g,"-")))return!1;break;case"Base":for(h=!1,m=0,p=j.length;m<p;m++)if(f=j[m],"Base"!==f){switch(g=f.startsWith("Non-")?f.substring(4):f){case"Small":null==this.data.base&&(h=!0);break;case"Standard":null!=this.data.base&&"Huge"===this.data.base||(h=!0);break;default:null!=this.data.base&&this.data.base===g&&(h=!0)}if(f!==g&&(h=!h),h===!0)break}return h;case"Action":if(j[1].startsWith("W-")){if(k=j[1].substring(2),__indexOf.call(i.actions,k)<0)return!1}else{for(h=!1,r=i.actions,n=0,q=r.length;n<q;n++)e=r[n],e.includes(j[1])&&!e.includes(">")&&(h=!0);if(h===!1)return!1}break;case"Keyword":if(!this.checkKeyword(j[1]))return!1;break;case"Equipped":if(!this.doesSlotExist(j[1])||!this.hasFilledSlotLike(b,j[1]))return!1;break;case"Slot":if(!this.hasAnotherUnoccupiedSlotLike(b,j[1])&&!b.occupiesAnUpgradeSlot(j[1]))return!1;break;case"AttackArc":if(null==this.data.attackb)return!1;break;case"ShieldsGreaterThan":if(!(this.data.shields>j[1]))return!1;break;case"EnergyGreatterThan":if(!(i.energy>j[1]))return!1;break;case"InitiativeGreaterThan":if(!(this.pilot.skill>j[1]))return!1;break;case"InitiativeLessThan":if(!(this.pilot.skill<j[1]))return!1;break;case"AgilityEquals":if(i.agility!==j[1])return!1;break;case"isUnique":if(j[1]!==(null!=this.pilot.unique))return!1;break;case"Format":switch(j[1]){case"Epic":if(s=this.data.name,!(__indexOf.call(exportObj.epicExclusionsList,s)>=0))return!1;break;case"Standard":if(t=this.data.name,__indexOf.call(exportObj.epicExclusionsList,t)>=0)return!1}}return!0},a.prototype.doesSlotExist=function(a){var b,c,d,e;for(e=this.upgrades,c=0,d=e.length;c<d;c++)if(b=e[c],exportObj.slotsMatching(b.slot,a))return!0;return!1},a.prototype.isSlotOccupied=function(a){var b,c,d,e;for(e=this.upgrades,c=0,d=e.length;c<d;c++)if(b=e[c],exportObj.slotsMatching(b.slot,a)&&!b.isOccupied())return!0;return!1},a.prototype.checkKeyword=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(null!=(m=this.data.name)?m.includes(a):void 0)return!0;if(null!=this.data.chassis&&this.data.chassis===a||null!=this.pilot.chassis&&this.pilot.chassis===a)return!0;for(o=null!=(n=this.data.keyword)?n:[],e=0,i=o.length;e<i;e++)if(d=o[e],d===a)return!0;for(q=null!=(p=this.pilot.keyword)?p:[],f=0,j=q.length;f<j;f++)if(d=q[f],d===a)return!0;for(r=this.upgrades,g=0,k=r.length;g<k;g++){if(b=r[g],null!=b.chassis&&b.chassis===a)return!0;for(u=null!=(s=null!=b&&null!=(t=b.data)?t.keyword:void 0)?s:[],h=0,l=u.length;h<l;h++)if(c=u[h],c===a)return!0}return!1},a.prototype.checkListForUnique=function(a){var b,c,d,e;e=this.builder.uniques_in_use;for(b in e)if(d=e[b],"Slot"!==b&&__indexOf.call(function(){var a,b,e;for(e=[],a=0,b=d.length;a<b;a++)c=d[a],e.push(c.canonical_name.getXWSBaseName());return e}(),a)>=0)return!0;return!1},a.prototype.toXWS=function(){var a,b,c,d,e,f,g,h;for(c={id:null!=(f=this.pilot.xws)?f:this.pilot.canonical_name,name:null!=(g=this.pilot.xws)?g:this.pilot.canonical_name,points:this.getPoints(),ship:this.data.xws.canonicalize()},this.data.multisection&&(c.multisection=this.data.multisection.slice(0)),b={},h=this.upgrades,d=0,e=h.length;d<e;d++)a=h[d],null!=(null!=a?a.data:void 0)&&a.toXWS(b);return Object.keys(b).length>0&&(c.upgrades=b),c},a.prototype.getConditions=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;if("undefined"!=typeof Set&&null!==Set){if(b=new Set,null!=(null!=(j=this.pilot)?j.applies_condition:void 0))if(this.pilot.applies_condition instanceof Array)for(k=this.pilot.applies_condition,d=0,g=k.length;d<g;d++)a=k[d],b.add(exportObj.conditionsByCanonicalName[a]);else b.add(exportObj.conditionsByCanonicalName[this.pilot.applies_condition]);for(l=this.upgrades,e=0,h=l.length;e<h;e++)if(c=l[e],null!=(null!=c&&null!=(m=c.data)?m.applies_condition:void 0))if(c.data.applies_condition instanceof Array)for(n=c.data.applies_condition,f=0,i=n.length;f<i;f++)a=n[f],b.add(exportObj.conditionsByCanonicalName[a]);else b.add(exportObj.conditionsByCanonicalName[c.data.applies_condition]);return b}return console.warn("Set not supported in this JS implementation, not implementing conditions"),[]},a}(),GenericAddon=function(){function a(a){this.ship=a.ship,this.container=$(a.container),this.data=null,this.unadjusted_data=null,this.conferredAddons=[],this.serialization_code="X",this.occupied_by=null,this.occupying=[],this.destroyed=!1,this.type=null,this.dataByName=null,this.dataById=null,null!=a.adjustment_func&&(this.adjustment_func=a.adjustment_func),null!=a.filter_func&&(this.filter_func=a.filter_func),this.placeholderMod_func=null!=a.placeholderMod_func?a.placeholderMod_func:function(a){return function(a){return a}}(this)}return a.prototype.destroy=function(){var a,b,c,d,e,f,g;return g=__iced_k_noop,e=iced.findDeferral(arguments),b=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],this.destroyed?b(a):void function(a){return function(b){var c;return null==(null!=(c=a.data)?c.unique:void 0)?b():void!function(b){f=new iced.Deferrals(b,{parent:e,funcname:"GenericAddon.destroy"}),a.ship.builder.container.trigger("xwing:releaseUnique",[a.data,a.type,f.defer({lineno:6860})]),f._fulfill()}(b)}}(this)(function(e){return function(){var f,g,h,i;if(null!=(null!=(h=e.data)?h.standardized:void 0)){for(c=!0,i=e.ship.builder.ships,f=0,g=i.length;f<g;f++)d=i[f],null!=d.data&&e.ship.data.name===d.data.name&&e.ship!==d&&(c=!1);c===!0&&e.removeStandardized()}return e.destroyed=!0,e.rescindAddons(),e.deoccupyOtherUpgrades(),e.selector.select2("destroy"),e.selectorwrap.remove(),b(a)}}(this))},a.prototype.setupSelector=function(a){return this.selectorwrap=$(document.createElement("div")),this.selectorwrap.addClass("form-group d-flex upgrade-box"),this.selector=$(document.createElement("INPUT")),this.selector.attr("type","hidden"),this.selectorwrap.append(this.selector),this.selectorwrap.append($.trim('<div class="input-group-addon">\n    <button class="btn btn-secondary d-block d-md-none upgrade-query-modal"><i class="fas fa-question"></i></button>\n</div>')),this.upgrade_query_modal=$(this.selectorwrap.find("button.upgrade-query-modal")),this.container.append(this.selectorwrap),$.isMobile()&&(a.minimumResultsForSearch=-1),a.formatResultCssClass=function(a){return function(b){var c,d;return null!=a.ship.builder.collection?(c=!1,b.id===(null!=(d=a.data)?d.id:void 0)?a.ship.builder.collection.checkShelf(a.type.toLowerCase(),b.name)||a.ship.builder.collection.checkTable(a.type.toLowerCase(),b.name)||(c=!0):c=!a.ship.builder.collection.checkShelf(a.type.toLowerCase(),b.name),c?"select2-result-not-in-collection":""):""}}(this),a.formatSelection=function(a){return function(b,c){var d;d=function(){switch(this.type){case"Upgrade":return this.slot.toLowerCase().replace(/[^0-9a-z]/gi,"");default:return this.type.toLowerCase().replace(/[^0-9a-z]/gi,"")}}.call(a),d=d.replace("configuration","config").replace("force","forcepower"),$(c).append('<i class="xwing-miniatures-font xwing-miniatures-font-'+d+'"></i> '+b.text)}}(this),this.selector.select2(a),this.upgrade_query_modal.click(function(a){return function(b){if(a.data)return console.log(""+a.data.name),a.ship.builder.showTooltip("Addon",a.data,null!=a.data?{addon_type:a.type}:void 0,a.ship.builder.mobile_tooltip_modal,!0),a.ship.builder.mobile_tooltip_modal.modal("show")}}(this)),this.selector.on("select2-focus",function(a){return function(a){if($.isMobile())return $(".select2-container .select2-focusser").remove(),$(".select2-search input").prop("focus",!1).removeClass("select2-focused")}}(this)),this.selector.on("change",function(a){return function(b){return a.setById(a.selector.select2("val")),a.ship.builder.current_squad.dirty=!0,a.ship.builder.container.trigger("xwing-backend:squadDirtinessChanged"),a.ship.builder.backend_status.fadeOut("slow")}}(this)),this.selector.data("select2").results.on("mousemove-filtered",function(a){return function(b){var c;if(c=$(b.target).closest(".select2-result").data("select2-data"),null!=(null!=c?c.id:void 0))return a.ship.builder.showTooltip("Addon",a.dataById[c.id],{addon_type:a.type})}}(this)),this.selector.data("select2").container.on("mouseover",function(a){return function(b){if(null!=a.data)return a.ship.builder.showTooltip("Addon",a.data,{addon_type:a.type})}}(this))},a.prototype.setById=function(a){return this.setData(this.dataById[parseInt(a)])},a.prototype.setByName=function(a){return this.setData(this.dataByName[$.trim(a)])},a.prototype.setData=function(a){var b,c,d,e,f;return e=__iced_k_noop,c=iced.findDeferral(arguments),(null!=a?a.id:void 0)===(null!=(f=this.data)?f.id:void 0)?e():void!function(a){return function(b){var e,f;return null==(null!=(e=a.data)?e.unique:void 0)&&null==(null!=(f=a.data)?f.solitary:void 0)?b():void!function(b){d=new iced.Deferrals(b,{parent:c,funcname:"GenericAddon.setData"}),a.ship.builder.container.trigger("xwing:releaseUnique",[a.unadjusted_data,a.type,d.defer({lineno:6954})]),d._fulfill()}(b)}}(this)(function(f){return function(){var g;null!=(null!=(g=f.data)?g.standardized:void 0)&&f.removeStandardized(),f.rescindAddons(),f.deoccupyOtherUpgrades(),function(e){return null==(null!=a?a.unique:void 0)&&null==(null!=a?a.solitary:void 0)?e():void!function(e){try{d=new iced.Deferrals(e,{parent:c,funcname:"GenericAddon.setData"}),f.ship.builder.container.trigger("xwing:claimUnique",[a,f.type,d.defer({lineno:6961})]),d._fulfill()}catch(g){return b=g,f.ship.builder.container.trigger("xwing:pointsUpdated"),f.lastSetValid=!1}}(e)}(function(){if(f.data=f.unadjusted_data=a,null!=f.data){if(f.data.superseded_by_id)return f.setById(f.data.superseded_by_id);null!=f.adjustment_func&&(f.data=f.adjustment_func(f.data)),f.unequipOtherUpgrades(),f.occupyOtherUpgrades(),f.conferAddons(),null!=f.data.standardized&&f.addToStandardizedList()}else f.deoccupyOtherUpgrades();return f.lastSetValid=f.ship.validate(),e(f.ship.builder.container.trigger("xwing:pointsUpdated"))})}}(this))},a.prototype.addToStandardizedList=function(){var a,b;if(a=this.ship.builder.standard_list.Ship.indexOf(this.ship.data.name),!(a>-1&&(null!=(b=this.ship.builder.standard_list.Upgrade[a])?b.name:void 0)===this.data.name))return this.ship.builder.standard_list.Upgrade.push(this.data),this.ship.builder.standard_list.Ship.push(this.ship.data.name)},a.prototype.removeStandardized=function(){var a,b,c,d,e,f,g,h,i,j;if(a=this.ship.builder.standard_list.Ship.indexOf(this.ship.data.name),a>-1&&(null!=(g=this.ship.builder.standard_list.Upgrade[a])?g.name:void 0)===this.data.name){for(this.ship.builder.standard_list.Upgrade.splice(a,1),this.ship.builder.standard_list.Ship.splice(a,1),b=this.data.name,h=this.ship.builder.ships,j=[],e=0,f=h.length;e<f;e++)c=h[e],(null!=(i=c.data)?i.name:void 0)===this.ship.data.name?j.push(function(){var a,e,f,g,h;for(f=c.upgrades,h=[],a=0,e=f.length;a<e;a++){if(d=f[a],(null!=(g=d.data)?g.name:void 0)===b){d.setData(null);break}h.push(void 0)}return h}()):j.push(void 0);return j}},a.prototype.conferAddons=function(){var a,b,c,d,e,f,g;if(null!=this.data.confersAddons&&!this.ship.builder.isQuickbuild&&this.data.confersAddons.length>0){for(f=this.data.confersAddons,g=[],d=0,e=f.length;d<e;d++){if(a=f[d],c=a.type,b={ship:this.ship,container:this.container},null!=a.slot&&(b.slot=a.slot),null!=a.adjustment_func&&(b.adjustment_func=a.adjustment_func),null!=a.filter_func&&(b.filter_func=a.filter_func),null!=a.auto_equip&&(b.auto_equip=a.auto_equip),null!=a.placeholderMod_func&&(b.placeholderMod_func=a.placeholderMod_func),a=new c(b),!(a instanceof exportObj.Upgrade))throw new Error("Unexpected addon type for addon "+a);this.ship.upgrades.push(a),g.push(this.conferredAddons.push(a))}return g}},a.prototype.rescindAddons=function(){var a,b,c,d;d=__iced_k_noop,b=iced.findDeferral(arguments),function(d){return function(e){var f,g,h;for(c=new iced.Deferrals(e,{parent:b,funcname:"GenericAddon.rescindAddons"}),h=d.conferredAddons,f=0,g=h.length;f<g;f++)a=h[f],a.destroy(c.defer({lineno:7036}));c._fulfill()}}(this)(function(b){return function(){var c,d,e;for(e=b.conferredAddons,c=0,d=e.length;c<d;c++){if(a=e[c],!(a instanceof exportObj.Upgrade))throw new Error("Unexpected addon type for addon "+a);b.ship.upgrades.removeItem(a)}return b.conferredAddons=[]}}(this))},a.prototype.getPoints=function(a,b){var c;if(null==a&&(a=this.data),null==b&&(b=this.ship),null==(null!=a?a.variablepoints:void 0))return null!=(c=null!=a?a.points:void 0)?c:0;switch(a.variablepoints){case"Agility":return null!=a?a.points[b.data.agility]:void 0;case"Base":if(null==(null!=b?b.data.base:void 0))return null!=a?a.points[0]:void 0;switch(b.data.base){case"Medium":return null!=a?a.points[1]:void 0;case"Large":return null!=a?a.points[2]:void 0;case"Huge":return null!=a?a.points[3]:void 0}break;case"Initiative":return null!=a?a.points[b.pilot.skill]:void 0}},a.prototype.updateSelection=function(a){return null!=this.data?this.selector.select2("data",{id:this.data.id,text:""+(this.data.display_name?this.data.display_name:this.data.name)+" ("+a+(this.data.variablepoints?"*":"")+")"}):this.selector.select2("data",null)},a.prototype.toString=function(){return null!=this.data?""+(this.data.display_name?this.data.display_name:this.data.name)+" ("+this.getPoints()+")":"No "+this.type},a.prototype.toHTML=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(null!=this.data){if(n=null!=this.data.slot&&"HardpointShip"===this.data.slot?"hardpoint":(null!=(p=this.data.slot)?p:this.type).toLowerCase().replace(/[^0-9a-z]/gi,""),j="function"==typeof(o=this.data).text?o.text(match(/(<span.*<\/span>)<br \/><br \/>(.*)/)):void 0,j?(l='<div class="card-restriction-container">'+j[1]+"</div>",m=j[2]):(l="",m=this.data.text),b="",null!=this.data.range&&(e=null!=this.data.rangebonus?'<span class="upgrade-attack-rangebonus"><i class="xwing-miniatures-font xwing-miniatures-font-rangebonusindicator"></i></span>':"",d=$.trim('<span class="upgrade-attack-range">'+this.data.range+"</span>\n"+e),c=null!=this.data.attack?$.trim('<span class="info-data info-attack">'+this.data.attack+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-frontarc"></i>'):null!=this.data.attackf?$.trim('<span class="info-data info-attack">'+this.data.attackf+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-fullfrontarc"></i>'):null!=this.data.attackb?$.trim('<span class="info-data info-attack">'+this.data.attackb+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-backarc"></i>'):null!=this.data.attackt?$.trim('<span class="info-data info-attack">'+this.data.attackt+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-singleturretarc"></i>'):null!=this.data.attackdt?$.trim('<span class="info-data info-attack">'+this.data.attackdt+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-doubleturretarc"></i>'):null!=this.data.attackl?$.trim('<span class="info-data info-attack">'+this.data.attackl+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-leftarc"></i>'):null!=this.data.attackr?$.trim('<span class="info-data info-attack">'+this.data.attackr+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-rightarc"></i>'):null!=this.data.attackbull?$.trim('<span class="info-data info-attack">'+this.data.attackbull+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-bullseyearc"></i>'):"",b=$.trim('<div class="upgrade-attack">\n    '+d+"\n    "+c+"\n</div>")),null!=this.data.charge){if(k="",null!=this.data.recurring)if(this.data.recurring>0)for(g=0;g<this.data.recurring;)k+='<sup><i class="fas fa-caret-up"></i></sup>',++g;else for(g=this.data.recurring;g<0;)k+='<sub><i class="fas fa-caret-down"></i></sub>',++g;f=$.trim('<div class="upgrade-charge">\n    <span class="info-data info-charge">'+this.data.charge+'</span>\n    <i class="xwing-miniatures-font xwing-miniatures-font-charge"></i>'+k+"\n</div>")}else f=$.trim("");if(null!=this.data.force){for(i=1,null!=this.data.forcerecurring&&(i=this.data.forcerecurring),g=0,k="";g<i;)k+='<sup><i class="fas fa-caret-up"></i></sup>',++g;h=$.trim('<div class="upgrade-force">\n    <span class="info-data info-force">'+this.data.force+'</span>\n    <i class="xwing-miniatures-font xwing-miniatures-font-forcecharge"></i>'+k+"\n</div>")}else h=$.trim("");return $.trim('<div class="upgrade-container">\n    <div class="upgrade-stats">\n        <div class="upgrade-name"><i class="xwing-miniatures-font xwing-miniatures-font-'+n+'"></i>'+(this.data.display_name?this.data.display_name:this.data.name)+'</div>\n        <div class="mask">\n            <div class="outer-circle">\n                <div class="inner-circle upgrade-points">'+a+"</div>\n            </div>\n        </div>\n        "+l+"\n    </div>\n    "+b+"\n    "+f+"\n    "+h+'\n    <div class="upgrade-text">'+m+'</div>\n    <div style="clear: both;"></div>\n</div>')}return""},a.prototype.toTableRow=function(a){return null!=this.data?$.trim('<tr class="simple-addon">\n    <td class="name">'+(this.data.display_name?this.data.display_name:this.data.name)+'</td>\n    <td class="points">'+a+"</td>\n</tr>"):""},a.prototype.toSimpleCopy=function(a){return null!=this.data?""+this.data.name+" ("+a+")    \n":null},a.prototype.toRedditText=function(a){return null!=this.data?"*&nbsp;"+this.data.name+" ("+a+")*    \n":null},a.prototype.toTTSText=function(){return null!=this.data?""+exportObj.toTTS(this.data.name):null},a.prototype.toSerialized=function(){var a,b;return""+this.serialization_code+"."+(null!=(a=null!=(b=this.data)?b.id:void 0)?a:-1)},a.prototype.unequipOtherUpgrades=function(){var a,b,c,d,e,f,g,h;for(g=null!=(e=null!=(f=this.data)?f.unequips_upgrades:void 0)?e:[],h=[],c=0,d=g.length;c<d;c++)a=g[c],h.push(function(){var c,d,e,f;for(e=this.ship.upgrades,f=[],c=0,d=e.length;c<d;c++)if(b=e[c],exportObj.slotsMatching(b.slot,a)&&b!==this&&b.isOccupied()){b.setData(null);break}return f}.call(this));return h},a.prototype.isOccupied=function(){return null!=this.data||null!=this.occupied_by},a.prototype.occupyOtherUpgrades=function(){var a,b,c,d,e,f,g,h;for(g=null!=(e=null!=(f=this.data)?f.also_occupies_upgrades:void 0)?e:[],h=[],c=0,d=g.length;c<d;c++)a=g[c],h.push(function(){var c,d,e,f;for(e=this.ship.upgrades,f=[],c=0,d=e.length;c<d;c++)if(b=e[c],exportObj.slotsMatching(b.slot,a)&&b!==this&&!b.isOccupied()){this.occupy(b);break}return f}.call(this));return h},a.prototype.deoccupyOtherUpgrades=function(){var a,b,c,d,e;for(d=this.occupying,e=[],b=0,c=d.length;b<c;b++)a=d[b],e.push(this.deoccupy(a));return e},a.prototype.occupy=function(a){return a.occupied_by=this,a.selector.select2("enable",!1),this.occupying.push(a)},a.prototype.deoccupy=function(a){return a.occupied_by=null,a.selector.select2("enable",!0)},a.prototype.occupiesAnUpgradeSlot=function(a){var b,c,d,e;for(e=this.ship.upgrades,c=0,d=e.length;c<d;c++)if(b=e[c],exportObj.slotsMatching(b.slot,a)&&b!==this&&null==b.data&&null!=b.occupied_by&&b.occupied_by===this)return!0;return!1},a.prototype.toXWS=function(a){var b,c,d;return(null!=a[b=null!=(d=exportObj.toXWSUpgrade[this.data.slot])?d:this.data.slot.canonicalize()]?a[b]:a[b]=[]).push(null!=(c=this.data.xws)?c:this.data.canonical_name)},a}(),exportObj.Upgrade=function(a){function b(a){b.__super__.constructor.call(this,a),this.slot=a.slot,this.type="Upgrade",this.dataById=exportObj.upgradesById,this.dataByName=exportObj.upgrades,this.serialization_code="U",this.setupSelector()}return __extends(b,a),b.prototype.setupSelector=function(){return b.__super__.setupSelector.call(this,{width:"100%",placeholder:this.placeholderMod_func(exportObj.translate("ui","upgradePlaceholder",this.slot)),allowClear:!0,query:function(a){return function(b){var c;return c={results:[]},c.results=a.ship.builder.getAvailableUpgradesIncluding(a.slot,a.data,a.ship,a,b.term,a.filter_func),b.callback(c)}}(this)})},b}(GenericAddon),exportObj.RestrictedUpgrade=function(a){function b(a){this.filter_func=a.filter_func,b.__super__.constructor.call(this,a),this.serialization_code="u",null!=a.auto_equip&&this.setById(a.auto_equip)}return __extends(b,a),b}(exportObj.Upgrade),exportObj.QuickbuildUpgrade=function(a){function b(a){b.__super__.constructor.call(this,a),this.slot=a.slot,this.type="Upgrade",this.dataById=exportObj.upgradesById,this.dataByName=exportObj.upgrades,this.serialization_code="U",this.upgrade=a.upgrade,this.setupSelector()}return __extends(b,a),b.prototype.setupSelector=function(){return b.__super__.setupSelector.call(this,{width:"100%",allowClear:!1,query:function(a){return function(b){var c;return c={results:[{id:a.upgrade.id,text:a.upgrade.display_name?a.upgrade.display_name:a.upgrade.name,points:0,name:a.upgrade.name,display_name:a.upgrade.display_name}]},b.callback(c)}}(this)})},b.prototype.getPoints=function(a){return 0},b.prototype.updateSelection=function(a){return null!=this.data?this.selector.select2("data",{id:this.data.id,text:""+(this.data.display_name?this.data.display_name:this.data.name)}):this.selector.select2("data",null)},b}(GenericAddon),SERIALIZATION_CODE_TO_CLASS={U:exportObj.Upgrade,u:exportObj.RestrictedUpgrade},exportObj="undefined"!=typeof exports&&null!==exports?exports:this,exportObj.fromXWSFaction={rebelalliance:"Rebel Alliance",rebels:"Rebel Alliance",rebel:"Rebel Alliance",galacticempire:"Galactic Empire",imperial:"Galactic Empire",scumandvillainy:"Scum and Villainy",firstorder:"First Order",resistance:"Resistance",galacticrepublic:"Galactic Republic",separatistalliance:"Separatist Alliance"},exportObj.toXWSFaction={"Rebel Alliance":"rebelalliance","Galactic Empire":"galacticempire","Scum and Villainy":"scumandvillainy","First Order":"firstorder",Resistance:"resistance","Galactic Republic":"galacticrepublic","Separatist Alliance":"separatistalliance"},exportObj.toXWSUpgrade={Modification:"modification",Force:"force-power","Tactical Relay":"tactical-relay"},exportObj.fromXWSUpgrade={amd:"Astromech",astromechdroid:"Astromech",ept:"Talent",elitepilottalent:"Talent",system:"Sensor",mod:"Modification","force-power":"Force","tactical-relay":"Tactical Relay"},SPEC_URL="https://github.com/elistevens/xws-spec",SQUAD_TO_XWS_URL="https://squad2xws.herokuapp.com/translate/",exportObj.loadXWSButton=function(a){var b;return b=$(a.find(".xws-import-status")),b.text(exportObj.translate("ui","Loading...")),function(b){return function(b){var c,d,e,f,g,h;f=function(c){return $(window).trigger("xwing:activateBuilder",[exportObj.fromXWSFaction[c.faction],function(d){return d.current_squad.dirty&&null!=d.backend?(a.modal("hide"),d.backend.warnUnsaved(d,function(){return d.loadFromXWS(c,function(c){if(!c.success)return a.modal("show"),b.text(c.error)})})):d.loadFromXWS(c,function(c){return c.success?a.modal("hide"):b.text(c.error)})}])},d=a.find(".xws-content").val();try{return h=JSON.parse(d),f(h)}catch(i){return c=i,g=d.split("/").pop(),e=SQUAD_TO_XWS_URL+g,$.getJSON(e,f)["catch"](function(a){return b.text("Invalid Input")})}}}(this)(b)};
//# sourceMappingURL=xwing.min.js.map