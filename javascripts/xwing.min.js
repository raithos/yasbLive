var DFL_LANGUAGE,GenericAddon,SERIALIZATION_CODE_TO_CLASS,SHOW_DEBUG_OUT_MISSING_TRANSLATIONS,SPEC_URL,SQUAD_DISPLAY_NAME_MAX_LENGTH,SQUAD_TO_XWS_URL,Ship,TYPES,URL_BASE,all,builders,byName,byPoints,conditionToHTML,exportObj,getPrimaryFaction,statAndEffectiveStat,__slice=[].slice,__bind=function(t,e){return function(){return t.apply(e,arguments)}},__indexOf=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1},__hasProp={}.hasOwnProperty,__extends=function(t,e){for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};window.iced={Deferrals:(()=>{function t(t){this.continuation=t,this.count=1,this.ret=null}return t.prototype._fulfill=function(){if(!--this.count)return this.continuation(this.ret)},t.prototype.defer=function(i){return++this.count,n=this,function(){var t,e=1<=arguments.length?__slice.call(arguments,0):[];return null!=i&&null!=(t=i.assign_fn)&&t.apply(null,e),n._fulfill()};var n},t})(),findDeferral:function(){return null},trampoline:function(t){return t()}},window.__iced_k=window.__iced_k_noop=function(){},(exportObj="undefined"!=typeof exports&&null!==exports?exports:this).SquadBuilderBackend=(()=>{function t(t){var e,i,n,a;for(this.getCollectionCheck=__bind(this.getCollectionCheck,this),this.getLanguagePreference=__bind(this.getLanguagePreference,this),this.nameCheck=__bind(this.nameCheck,this),this.maybeAuthenticationChanged=__bind(this.maybeAuthenticationChanged,this),$.ajaxSetup({dataType:"json",xhrFields:{withCredentials:!0}}),this.server=t.server,this.builders=t.builders,this.login_logout_button=$(t.login_logout_button),this.auth_status=$(t.auth_status),this.authenticated=!1,this.ui_ready=!1,this.oauth_window=null,this.method_metadata={google_oauth2:{icon:"fab fa-google",text:"Google"},twitter:{icon:"fab fa-twitter",text:"Twitter"},discord:{icon:"fab fa-discord",text:"Discord"}},this.squad_display_mode="all",this.show_archived=!1,this.collection_save_timer=null,this.collection_reset_timer=null,this.setupHandlers(),this.setupUI(),this.authenticate((a=this,function(){return a.auth_status.hide(),a.login_logout_button.removeClass("d-none")})),e=0,i=(n=this.builders).length;e<i;e++)n[e].setBackend(this);this.updateAuthenticationVisibility()}return t.prototype.updateAuthenticationVisibility=function(){return this.authenticated?($(".show-authenticated").show(),$(".hide-authenticated").hide()):($(".show-authenticated").hide(),$(".hide-authenticated").show())},t.prototype.save=function(t,e,i,n,a,s){var l;if(null==e&&(e=null),null==a&&(a={}),""===t)return s({id:null,success:!1,error:"You cannot save an empty squad"});if(""===$.trim(i))return s({id:null,success:!1,error:"Squad name cannot be empty"});if(null==n||""===n)throw"Faction unspecified to save()";return i={name:$.trim(i),faction:$.trim(n),serialized:t,additional_data:a},null!=e?l=this.server+"/squads/"+e:(l=this.server+"/squads/new",i._method="put"),$.post(l,i,function(t,e,i){return s({id:t.id,success:t.success,error:t.error})})},t.prototype.delete=function(t,n){return $.post(this.server+"/squads/"+t,{_method:"delete"},function(t,e,i){return n({success:t.success,error:t.error})})},t.prototype.archive=function(t,e,i){return t.additional_data.archived=!0,this.save(t.serialized,t.id,t.name,e,t.additional_data,i)},t.prototype.list=function(g){var v,x,k,t,y;return this.squad_list_modal.find(".modal-header .squad-list-header-placeholder").text(exportObj.translate("ui","yourXYsquads",g.faction)),(v=$(this.squad_list_modal.find("ul.squad-list"))).text(""),v.hide(),(x=$(this.squad_list_modal.find("p.squad-list-loading"))).show(),this.show_all_squads_button.click(),this.squad_list_modal.modal("show"),this.number_of_selected_squads_to_be_deleted=0,k=[],t=this.server+"/squads/list",$.get(t,(y=this,function(t,e,i){for(var n,a,l,o,s,r,d,c,u,h,p,f=!1,m=t[g.faction],_=0,b=m.length;_<b;_++){if(a=m[_],(n=$(document.createElement("LI"))).addClass("squad-summary"),n.data("squad",a),n.data("builder",g),n.data("selectedForDeletion",!1),v.append(n),null!=(null!=(p=a.additional_data)?p.tag:void 0)&&""!==(null!=(p=a.additional_data)?p.tag:void 0)&&-1===k.indexOf(a.additional_data.tag))for(d=0,u=(o=null!=(p=a.additional_data)?p.tag.split(","):void 0).length;d<u;d++)s=o[d],k.push(s);null!=(null!=(p=a.additional_data)?p.archived:void 0)?n.hide():f=!0,p=-1!==a.serialized.search(/v\d+Zb/)?' <i class="xwing-miniatures-font xwing-miniatures-font-point"></i>':"",n.append($.trim('<div class="row">\n    <div class="col-md-9">\n        <h4>'+a.name+p+'</h4>\n    </div>\n    <div class="col-md-3">\n        <h5>'+(null!=(p=a.additional_data)?p.points:void 0)+" "+exportObj.translate("ui","Points")+'</h5>\n    </div>\n</div>\n<div class="row squad-description">\n    <div class="col-md-9">\n        '+(null!=(p=a.additional_data)?p.description:void 0)+'\n    </div>\n    <div class="squad-buttons col-md-3">\n        <button class="btn btn-modal convert-squad"><i class="xwing-miniatures-font xwing-miniatures-font-first-player-1"></i></button>\n        &nbsp;\n        <button class="btn btn-modal load-squad"><i class="fa fa-download"></i></button>\n        &nbsp;\n        <button class="btn btn-danger delete-squad"><i class="fa fa-times"></i></button>\n    </div>\n</div>\n<div class="row squad-convert-confirm">\n    <div class="col-md-9 translated" defaultText="Convert to Extended?">\n    </div>\n    <div class="squad-buttons col-md-3">\n        <button class="btn btn-danger confirm-convert-squad translated" defaultText="Convert"></button>\n        &nbsp;\n        <button class="btn btn-modal cancel-convert-squad translated" defaultText="Cancel"></button>\n    </div>\n</div>\n<div class="row squad-delete-confirm">\n    <div class="col-md-6">\n        '+exportObj.translate("ui","reallyDeleteSquadXY","<em>"+a.name+"</em>")+'\n    </div>\n    <div class="col-md-6 btn-group">\n        <button class="btn btn-danger confirm-delete-squad translated" defaultText="Delete"></button>\n        <button class="btn confirm-archive-squad translated" defaultText="Archive"></button>\n        <button class="btn btn-modal cancel-delete-squad translated" defaultText="Unselect"></button>\n    </div>\n</div>')),n.find(".squad-convert-confirm").hide(),n.find(".squad-delete-confirm").hide(),-1===a.serialized.search(/v\d+Zh/)&&n.find("button.convert-squad").hide(),n.find("button.convert-squad").click(function(t){var e;return t.preventDefault(),t=$(t.target),n=t.closest("li"),g=n.data("builder"),n.data("selectedToConvert",!0),(e=n).find(".squad-description").fadeOut("fast",function(){return e.find(".squad-convert-confirm").fadeIn("fast")})}),n.find("button.cancel-convert-squad").click(function(t){var e;return t.preventDefault(),t=$(t.target),n=t.closest("li"),g=n.data("builder"),n.data("selectedToConvert",!1),(e=n).find(".squad-convert-confirm").fadeOut("fast",function(){return e.find(".squad-description").fadeIn("fast")})}),n.find("button.confirm-convert-squad").click(function(t){var e;return t.preventDefault(),t=$(t.target),n=t.closest("li"),g=n.data("builder"),n.find(".cancel-convert-squad").fadeOut("fast"),n.find(".confirm-convert-squad").addClass("disabled"),n.find(".confirm-convert-squad").text("Converting..."),e=n.data("squad").serialized.replace("Zh","Zs"),y.save(e,n.data("squad").id,n.data("squad").name,n.data("builder").faction,n.data("squad").additional_data,function(t){return t.success?(n.data("squad").serialized=e,n.find(".squad-convert-confirm").fadeOut("fast",function(){return n.find(".squad-description").fadeIn("fast"),n.find("button.convert-squad").fadeOut("fast")})):n.html($.trim("Error converting "+n.data("squad").name+": <em>"+t.error+"</em>"))})}),n.find("button.load-squad").click(function(t){return t.preventDefault(),t=$(t.target),n=t.closest("li"),g=n.data("builder"),y.squad_list_modal.modal("hide"),g.current_squad.dirty?y.warnUnsaved(g,function(){return g.container.trigger("xwing-backend:squadLoadRequested",n.data("squad"))}):g.container.trigger("xwing-backend:squadLoadRequested",n.data("squad"))}),n.find("button.delete-squad").click(function(t){var e;return t.preventDefault(),t=$(t.target),n=t.closest("li"),g=n.data("builder"),n.data("selectedForDeletion",!0),(e=n).find(".squad-description").fadeOut("fast",function(){return e.find(".squad-delete-confirm").fadeIn("fast")}),y.number_of_selected_squads_to_be_deleted||y.squad_list_modal.find("div.delete-multiple-squads").show(),y.number_of_selected_squads_to_be_deleted+=1}),n.find("button.cancel-delete-squad").click(function(t){t.preventDefault(),t=$(t.target),n=t.closest("li"),g=n.data("builder"),n.data("selectedForDeletion",!1),--y.number_of_selected_squads_to_be_deleted;var e=n;if(e.find(".squad-delete-confirm").fadeOut("fast",function(){return e.find(".squad-description").fadeIn("fast")}),!y.number_of_selected_squads_to_be_deleted)return y.squad_list_modal.find("div.delete-multiple-squads").hide()}),n.find("button.confirm-delete-squad").click(function(t){return t.preventDefault(),t=$(t.target),n=t.closest("li"),g=n.data("builder"),n.find(".cancel-delete-squad").fadeOut("fast"),n.find(".confirm-delete-squad").addClass("disabled"),n.find(".confirm-delete-squad").text("Deleting..."),y.delete(n.data("squad").id,function(t){return t.success?(n.slideUp("fast",function(){return $(n).remove()}),--y.number_of_selected_squads_to_be_deleted,y.number_of_selected_squads_to_be_deleted?void 0:y.squad_list_modal.find("div.delete-multiple-squads").hide()):n.html($.trim("Error deleting "+n.data("squad").name+": <em>"+t.error+"</em>"))})}),n.find("button.confirm-archive-squad").click(function(t){return t.preventDefault(),t=$(t.target),n=t.closest("li"),g=n.data("builder"),n.find(".confirm-delete-squad").addClass("disabled"),n.find(".confirm-delete-squad").text(exportObj.translate("ui","Archiving...")),y.archive(n.data("squad"),n.data("builder").faction,function(t){return t.success?(n.slideUp("fast",function(){return $(n).hide(),$(n).find(".confirm-delete-squad").removeClass("disabled"),$(n).find(".confirm-delete-squad").text(exportObj.translate("ui","Delete")),$(n).data("selectedForDeletion",!1),$(n).find(".squad-delete-confirm").fadeOut("fast",function(){return $(n).find(".squad-description").fadeIn("fast")})}),--y.number_of_selected_squads_to_be_deleted,y.number_of_selected_squads_to_be_deleted?void 0:y.squad_list_modal.find("div.delete-multiple-squads").hide()):n.html($.trim("Error archiving "+n.data("squad").name+": <em>"+t.error+"</em>"))})})}for(f||v.append($.trim('<li class="translated" defaultText="No saved squads"></li>')),y.squad_list_tags.empty(),c=0,h=k.length;c<h;c++)r=(l=k[c]).toLowerCase().replace(/[^a-z0-9]/g,"").replace(/\s+/g,"-"),y.squad_list_tags.append($.trim(' \n<button class="btn '+r+'">'+l+"</button>")),$(y.squad_list_tags.find("."+r)).click(function(t){var t=$(t.target),s=t.attr("class").replace("btn ","").replace("btn-inverse ","");return y.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),y.squad_list_tags.find(".btn").removeClass("btn-inverse"),t.addClass("btn-inverse"),y.squad_list_modal.find(".squad-list li").each(function(t,e){var i,n,a;if(null==$(e).data().squad.additional_data.tag)return $(e).hide();for(i=!1,n=0,a=(o=$(e).data().squad.additional_data.tag.split(",")).length;n<a;n++)l=o[n],s===l.toLowerCase().replace(/[^a-z0-9]/g,"").replace(/\s+/g,"-")&&(i=!0);return i?$(e).show():$(e).hide()})});return exportObj.translateUIElements(v),x.fadeOut("fast"),v.fadeIn("fast")}))},t.prototype.authenticate=function(n){var a,s,e;return null==n&&(n=$.noop),$(this.auth_status.find(".payload")).text(exportObj.translate("ui","Checking auth status...")),this.auth_status.show(),a=this.authenticated,$.ajax({url:this.server+"/ping",success:function(t){return null!=t&&t.success?e.authenticated=!0:e.authenticated=!1,e.maybeAuthenticationChanged(a,n)},error:(s=e=this,function(t,e,i){return s.authenticated=!1,s.maybeAuthenticationChanged(a,n)})})},t.prototype.maybeAuthenticationChanged=function(t,e){return t!==this.authenticated&&$(window).trigger("xwing-backend:authenticationChanged",[this.authenticated,this]),this.oauth_window=null,this.auth_status.hide(),e(this.authenticated),this.authenticated},t.prototype.login=function(){if(this.ui_ready)return this.login_modal.modal("show")},t.prototype.logout=function(n){return null==n&&(n=$.noop),$(this.auth_status.find(".payload")).text(exportObj.translate("ui","Logging out...")),this.auth_status.show(),$.get(this.server+"/auth/logout",(a=this,function(t,e,i){return a.authenticated=!1,$(window).trigger("xwing-backend:authenticationChanged",[a.authenticated,a]),a.auth_status.hide(),n()}));var a},t.prototype.showSaveAsModal=function(t){return this.save_as_modal.data("builder",t),this.save_as_input.val(t.current_squad.name),this.save_as_save_button.addClass("disabled"),this.nameCheck(),this.save_as_modal.modal("show")},t.prototype.showDeleteModal=function(t){return this.delete_modal.data("builder",t),this.delete_name_container.text(t.current_squad.name),this.delete_modal.modal("show")},t.prototype.nameCheck=function(){var t,e;return window.clearInterval(this.save_as_modal.data("timer")),0===(t=$.trim(this.save_as_input.val())).length?(this.name_availability_container.text(""),this.name_availability_container.append($.trim('<i class="fa fa-thumbs-down"></i> '+exportObj.translate("ui","name required")))):$.post(this.server+"/squads/namecheck",{name:t},(e=this,function(t){return e.name_availability_container.text(""),t.available?(e.name_availability_container.append($.trim('<i class="fa fa-thumbs-up"></i> '+exportObj.translate("ui","Name is available"))),e.save_as_save_button.removeClass("disabled")):(e.name_availability_container.append($.trim('<i class="fa fa-thumbs-down"></i> '+exportObj.translate("ui","Name in use"))),e.save_as_save_button.addClass("disabled"))}))},t.prototype.warnUnsaved=function(t,e){return this.unsaved_modal.data("builder",t),this.unsaved_modal.data("callback",e),this.unsaved_modal.modal("show")},t.prototype.setupUI=function(){var e,d,l,o,c,r,i,n,a,s,u,h,p,t,f,m,_,b;return this.auth_status.addClass("disabled"),this.auth_status.click(function(t){return!1}),this.login_modal=$(document.createElement("DIV")),this.login_modal.addClass("modal fade d-print-none"),this.login_modal.tabindex="-1",this.login_modal.role="dialog",$(document.body).append(this.login_modal),this.login_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="Log in with OAuth"></h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <p>\n                <span class="translated" defaultText="select OAuth provider"></span>\n                <a class="login-help translated" href="#" defaultText="What\'s this?"></a>\n            </p>\n            <div class="well well-small oauth-explanation">\n                <span class="translated" defaultText="OAuth explanation"></span>\n                <button class="btn btn-modal translated" defaultText="Got it!"></button>\n            </div>\n            <ul class="login-providers inline"></ul>\n            <p class="translated" defaultText="Continue to OAuth provider"></p>\n            <p class="translated" defaultText="iOS requires cross-site control"></p>\n            <p class="login-in-progress">\n                <em class="translated" defaultText="login in progress"></em>\n            </p>\n        </div>\n    </div>\n</div>')),(e=$(this.login_modal.find(".oauth-explanation"))).hide(),this.login_modal.find(".login-in-progress").hide(),this.login_modal.find("a.login-help").click(function(t){if(t.preventDefault(),!e.is(":visible"))return e.slideDown("fast")}),e.find("button").click(function(t){return t.preventDefault(),e.slideUp("fast")}),$.get(this.server+"/methods",(d=this,function(t,e,i){for(var n,a,s=$(d.login_modal.find("ul.login-providers")),l=t.methods,o=0,r=l.length;o<r;o++)a=l[o],(n=$(document.createElement("A"))).addClass("btn btn-modal"),n.data("url",d.server+"/auth/"+a),n.append('<i class="'+d.method_metadata[a].icon+'"></i>&nbsp;'+d.method_metadata[a].text),n.click(function(t){return t.preventDefault(),s.slideUp("fast"),d.login_modal.find(".login-in-progress").slideDown("fast"),d.oauth_window=window.open($(t.target).data("url"),"xwing_login")}),(a=$(document.createElement("LI"))).append(n),s.append(a);return d.ui_ready=!0})),exportObj.translateUIElements(this.login_modal),this.reload_done_modal=$(document.createElement("DIV")),this.reload_done_modal.addClass("modal fade d-print-none"),this.reload_done_modal.tabindex="-1",this.reload_done_modal.role="dialog",$(document.body).append(this.reload_done_modal),this.reload_done_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3>Reload Done</h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <p class="translated" defaultText="Squads reloaded"></p>\n        </div>\n        <div class="modal-footer">\n            <button class="btn btn-modal btn-primary translated" aria-hidden="true" data-dismiss="modal" defaultText="Well done!"></button>\n        </div>\n    </div>\n</div>')),exportObj.translateUIElements(this.reload_done_modal),this.squad_list_modal=$(document.createElement("DIV")),this.squad_list_modal.addClass("modal fade d-print-none squad-list"),this.squad_list_modal.tabindex="-1",this.squad_list_modal.role="dialog",$(document.body).append(this.squad_list_modal),this.squad_list_modal.append($.trim('<div class="modal-dialog modal-lg modal-dialog-scrollable modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="squad-list-header-placeholder d-none d-lg-block"></h3>\n            <h4 class="squad-list-header-placeholder d-lg-none"></h4>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <ul class="squad-list"></ul>\n            <p class="pagination-centered squad-list-loading">\n                <i class="fa fa-spinner fa-spin fa-3x"></i>\n                <br />\n                <span class="translated" defaultText="Fetching squads..."></span>\n            </p>\n        </div>\n        <div class="modal-footer">\n            <div class="btn-group delete-multiple-squads full-row">\n                <button class="btn btn-modal select-all translated" defaultText="Select All"></button>\n                <button class="btn btn-modal archive-selected translated" defaultText="Archive Selected"></button>\n                <button class="btn btn-modal btn-danger delete-selected translated" defaultText="Delete Selected"></button>\n            </div>\n            <div class="btn-group squad-display-mode full-row">\n                <button class="btn btn-modal btn-inverse show-all-squads translated" defaultText="All"></button>\n                <button class="btn btn-modal show-standard-squads"><span class="d-none d-lg-block translated" defaultText="Standard"></span><span class="d-lg-none"><i class="xwing-miniatures-font xwing-miniatures-font-first-player-1"></i></span></button>\n                <button class="btn btn-modal show-extended-squads"><span class="d-none d-lg-block translated" defaultText="Extended"></span><span class="d-lg-none translated" defaultText="Ext"></span></button>\n                <button class="btn btn-modal show-xwabeta-squads"><span class="d-none d-lg-block translated" defaultText="XWA Beta"></span><span class="d-lg-none"><i class="xwing-miniatures-font xwing-miniatures-font-point" title="Energy"></i></span></button>\n                <button class="btn btn-modal show-quickbuild-squads"><span class="d-none d-lg-block translated" defaultText="Quickbuild"></span><span class="d-lg-none translated" defaultText="QB"></span></button>\n                <button class="btn btn-modal show-epic-squads"><span class="d-none d-lg-block translated" defaultText="Epic"></span><span class="d-lg-none" ><i class="xwing-miniatures-font xwing-miniatures-font-energy" title="Energy"></i></span></button>\n                <button class="btn btn-modal show-archived-squads"><span class="d-none d-lg-block translated" defaultText="Archived"></span><span class="d-lg-none translated" defaultText="Arc"></span></button>\n                <button class="btn btn-modal reload-all" title="Recalculate Points"><span><i class="xwing-miniatures-font xwing-miniatures-font-calculate" title="Calculate"></i></span></button>\n            </div>\n            <div class="btn-group tags-display full-row">\n            </div>\n        </div>\n    </div>\n</div>')),this.squad_list_modal.find("ul.squad-list").hide(),this.squad_list_tags=$(this.squad_list_modal.find("div.tags-display")),this.squad_list_modal.find("div.delete-multiple-squads").hide(),exportObj.translateUIElements(this.squad_list_modal),this.delete_selected_button=$(this.squad_list_modal.find("button.delete-selected")),this.delete_selected_button.click((l=this,function(t){for(var e,i=l.squad_list_modal.find("ul.squad-list").find("li"),n=[],a=0,s=i.length;a<s;a++)e=i[a],(e=$(e)).data("selectedForDeletion")?n.push((e=>(e.find(".cancel-delete-squad").fadeOut("fast"),e.find(".confirm-delete-squad").addClass("disabled"),e.find(".confirm-delete-squad").text(exportObj.translate("ui","Deleting...")),l.delete(e.data("squad").id,function(t){return t.success?(e.slideUp("fast",function(){return $(e).remove()}),--l.number_of_selected_squads_to_be_deleted,l.number_of_selected_squads_to_be_deleted?void 0:l.squad_list_modal.find("div.delete-multiple-squads").hide()):e.html($.trim("Error deleting "+e.data("squad").name+": <em>"+t.error+"</em>"))})))(e)):n.push(void 0);return n})),this.archive_selected_button=$(this.squad_list_modal.find("button.archive-selected")),this.archive_selected_button.click((o=this,function(t){for(var e,i=o.squad_list_modal.find("ul.squad-list").find("li"),n=[],a=0,s=i.length;a<s;a++)e=i[a],(e=$(e)).data("selectedForDeletion")?n.push((e=>(e.find(".confirm-delete-squad").addClass("disabled"),e.find(".confirm-delete-squad").text(exportObj.translate("ui","Archiving...")),o.archive(e.data("squad"),e.data("builder").faction,function(t){return t.success?(e.slideUp("fast",function(){return $(e).hide(),$(e).find(".confirm-delete-squad").removeClass("disabled"),$(e).find(".confirm-delete-squad").text(exportObj.translate("ui","Delete")),$(e).data("selectedForDeletion",!1),$(e).find(".squad-delete-confirm").fadeOut("fast",function(){return $(e).find(".squad-description").fadeIn("fast")})}),--o.number_of_selected_squads_to_be_deleted,o.number_of_selected_squads_to_be_deleted?void 0:o.squad_list_modal.find("div.delete-multiple-squads").hide()):e.html($.trim("Error archiving "+e.data("squad").name+": <em>"+t.error+"</em>"))})))(e)):n.push(void 0);return n})),this.squad_list_modal.find("button.reload-all").click((c=this,function(t){for(var e,i,n=c.squad_list_modal.find("ul.squad-list"),a=[function(){return c.reload_done_modal.modal("show")}],s=[],l=n.find("li"),o=0,r=l.length;o<r;o++)i=l[o],i=$(i),s.push(i.data("squad")),e=i.data("builder"),a.push(function(){var t=s.pop();return e.container.trigger("xwing-backend:squadLoadRequested",[t,function(){var t={points:e.total_points,description:e.describeSquad(),cards:e.listCards(),notes:e.notes.val().substr(0,1024),obstacles:e.getObstacles(),tag:e.tag.val().substr(0,1024)};return c.save(e.serialize(),e.current_squad.id,e.current_squad.name,e.faction,t,a.pop())}])});return c.squad_list_modal.modal("hide"),e.current_squad.dirty?c.warnUnsaved(e,a.pop()):a.pop()()})),this.select_all_button=$(this.squad_list_modal.find("button.select-all")),this.select_all_button.click((r=this,function(t){for(var e,i=r.squad_list_modal.find("ul.squad-list").find("li"),n=[],a=0,s=i.length;a<s;a++)e=i[a],(e=$(e)).data("selectedForDeletion")?n.push(void 0):(e.data("selectedForDeletion",!0),(t=>{t.find(".squad-description").fadeOut("fast",function(){return t.find(".squad-delete-confirm").fadeIn("fast")})})(e),n.push(r.number_of_selected_squads_to_be_deleted+=1));return n})),this.show_all_squads_button=$(this.squad_list_modal.find(".show-all-squads")),this.show_all_squads_button.click((i=this,function(t){if("all"!==i.squad_display_mode)return i.squad_display_mode="all",i.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),i.squad_list_tags.find(".btn").removeClass("btn-inverse"),i.show_all_squads_button.addClass("btn-inverse"),i.squad_list_modal.find(".squad-list li").show()})),this.show_extended_squads_button=$(this.squad_list_modal.find(".show-extended-squads")),this.show_extended_squads_button.click((n=this,function(t){if("extended"!==n.squad_display_mode)return n.squad_display_mode="extended",n.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),n.squad_list_tags.find(".btn").removeClass("btn-inverse"),n.show_extended_squads_button.addClass("btn-inverse"),n.squad_list_modal.find(".squad-list li").each(function(t,e){return $(e).toggle(-1!==$(e).data().squad.serialized.search(/v\d+Zs/))})})),this.show_epic_squads_button=$(this.squad_list_modal.find(".show-epic-squads")),this.show_epic_squads_button.click((a=this,function(t){if("epic"!==a.squad_display_mode)return a.squad_display_mode="epic",a.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),a.squad_list_tags.find(".btn").removeClass("btn-inverse"),a.show_epic_squads_button.addClass("btn-inverse"),a.squad_list_modal.find(".squad-list li").each(function(t,e){return $(e).toggle(-1!==$(e).data().squad.serialized.search(/v\d+Ze/))})})),this.show_standard_squads_button=$(this.squad_list_modal.find(".show-standard-squads")),this.show_standard_squads_button.click((s=this,function(t){if("standard"!==s.squad_display_mode)return s.squad_display_mode="standard",s.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),s.squad_list_tags.find(".btn").removeClass("btn-inverse"),s.show_standard_squads_button.addClass("btn-inverse"),s.squad_list_modal.find(".squad-list li").each(function(t,e){return $(e).toggle(-1!==$(e).data().squad.serialized.search(/v\d+Zh/))})})),this.show_xwabeta_squads_button=$(this.squad_list_modal.find(".show-xwabeta-squads")),this.show_xwabeta_squads_button.click((u=this,function(t){if("xwabeta"!==u.squad_display_mode)return u.squad_display_mode="xwabeta",u.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),u.squad_list_tags.find(".btn").removeClass("btn-inverse"),u.show_xwabeta_squads_button.addClass("btn-inverse"),u.squad_list_modal.find(".squad-list li").each(function(t,e){return $(e).toggle(-1!==$(e).data().squad.serialized.search(/v\d+Zb/))})})),this.show_quickbuild_squads_button=$(this.squad_list_modal.find(".show-quickbuild-squads")),this.show_quickbuild_squads_button.click((h=this,function(t){if("quickbuild"!==h.squad_display_mode)return h.squad_display_mode="quickbuild",h.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),h.squad_list_tags.find(".btn").removeClass("btn-inverse"),h.show_quickbuild_squads_button.addClass("btn-inverse"),h.squad_list_modal.find(".squad-list li").each(function(t,e){return $(e).toggle(-1!==$(e).data().squad.serialized.search(/v\d+Zq/))})})),this.show_archived_squads_button=$(this.squad_list_modal.find(".show-archived-squads")),this.show_archived_squads_button.click((p=this,function(t){return p.show_archived=!p.show_archived,p.show_archived?p.show_archived_squads_button.addClass("btn-inverse"):p.show_archived_squads_button.removeClass("btn-inverse"),p.squad_list_tags.find(".btn").removeClass("btn-inverse"),p.squad_list_modal.find(".squad-list li").each(function(t,e){return $(e).toggle(null!=$(e).data().squad.additional_data.archived===p.show_archived)})})),this.save_as_modal=$(document.createElement("DIV")),this.save_as_modal.addClass("modal fade d-print-none"),this.save_as_modal.tabindex="-1",this.save_as_modal.role="dialog",$(document.body).append(this.save_as_modal),this.save_as_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="Save Squad As..."></h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <label for="xw-be-squad-save-as">\n                <span class="translated" defaultText="New Squad Name"></span>\n                <input id="xw-be-squad-save-as"></input>\n            </label>\n            <span class="name-availability"></span>\n        </div>\n        <div class="modal-footer">\n            <button class="btn btn-primary save translated" aria-hidden="true" defaultText="Save"></button>\n        </div>\n    </div>\n</div>')),this.save_as_modal.on("shown",(t=this,function(){return window.setTimeout(function(){return t.save_as_input.focus(),t.save_as_input.select()},100)})),this.save_as_save_button=this.save_as_modal.find("button.save"),this.save_as_save_button.click((f=this,function(t){var e,i;if(t.preventDefault(),!f.save_as_save_button.hasClass("disabled"))return null!=(t=f.save_as_modal.data("timer"))&&window.clearInterval(t),f.save_as_modal.modal("hide"),t={points:(e=f.save_as_modal.data("builder")).total_points,description:e.describeSquad(),cards:e.listCards(),notes:e.getNotes(),obstacles:e.getObstacles(),tag:e.getTag()},e.backend_save_list_as_button.addClass("disabled"),e.backend_status.html($.trim('<i class="fa fa-sync fa-spin"></i>&nbsp;'+exportObj.translate("ui","Saving squad..."))),e.backend_status.show(),i=$.trim(f.save_as_input.val()),f.save(e.serialize(),null,i,e.faction,t,function(t){return t.success?(e.current_squad.id=t.id,e.current_squad.name=i,e.current_squad.dirty=!1,e.container.trigger("xwing-backend:squadNameChanged"),e.container.trigger("xwing-backend:squadDirtinessChanged"),e.backend_status.html($.trim('<i class="fa fa-check"></i>&nbsp;'+exportObj.translate("ui","New squad saved successfully.")))):e.backend_status.html($.trim('<i class="fa fa-exclamation-circle"></i>&nbsp;'+t.error)),e.backend_save_list_as_button.removeClass("disabled")})})),this.save_as_input=$(this.save_as_modal.find("input")),this.save_as_input.keypress((m=this,function(t){return 13===t.which?(m.save_as_save_button.click(),!1):(m.name_availability_container.text(""),m.name_availability_container.append($.trim('<i class="fa fa-spin fa-spinner"></i> '+exportObj.translate("ui","Checking name availability..."))),null!=(t=m.save_as_modal.data("timer"))&&window.clearInterval(t),m.save_as_modal.data("timer",window.setInterval(m.nameCheck,500)))})),this.name_availability_container=$(this.save_as_modal.find(".name-availability")),exportObj.translateUIElements(this.squad_list_modal),this.delete_modal=$(document.createElement("DIV")),this.delete_modal.addClass("modal fade d-print-none"),this.delete_modal.tabindex="-1",this.delete_modal.role="dialog",$(document.body).append(this.delete_modal),this.delete_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3><span class="translated" defaultText="Really Delete"></span> <span class="squad-name-placeholder"></span>?</h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <p class="translated" defaultText="Sure to delete?"></p>\n        </div>\n        <div class="modal-footer">\n            <button class="btn btn-danger delete" aria-hidden="true"><span class="translated" defaultText="Yes, Delete"></span> <i class="squad-name-placeholder"></i></button>\n            <button class="btn btn-modal translated" data-dismiss="modal" aria-hidden="true" defaultText="Never Mind"></button>\n        </div>\n    </div>\n</div>')),this.delete_name_container=$(this.delete_modal.find(".squad-name-placeholder")),this.delete_button=$(this.delete_modal.find("button.delete")),this.delete_button.click((_=this,function(t){var e;return t.preventDefault(),(e=_.delete_modal.data("builder")).backend_status.html($.trim('<i class="fa fa-sync fa-spin"></i>&nbsp;'+exportObj.translate("ui","Deleting squad..."))),e.backend_status.show(),e.backend_delete_list_button.addClass("disabled"),_.delete_modal.modal("hide"),_.delete(e.current_squad.id,function(t){return t.success?(e.resetCurrentSquad(),e.current_squad.dirty=!0,e.container.trigger("xwing-backend:squadDirtinessChanged"),e.backend_status.html($.trim('<i class="fa fa-check"></i>&nbsp;'+exportObj.translate("ui","Squad deleted.")))):(e.backend_status.html($.trim('<i class="fa fa-exclamation-circle"></i>&nbsp;'+t.error)),e.backend_delete_list_button.removeClass("disabled"))})})),exportObj.translateUIElements(this.delete_modal),this.unsaved_modal=$(document.createElement("DIV")),this.unsaved_modal.addClass("modal fade d-print-none"),this.unsaved_modal.tabindex="-1",this.unsaved_modal.role="dialog",$(document.body).append(this.unsaved_modal),this.unsaved_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="Unsaved Changes"></h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <p class="translated" defaultText="Unsaved Changes Warning"></p>\n        </div>\n        <div class="modal-footer">\n            <button class="btn btn-modal btn-primary translated" aria-hidden="true" data-dismiss="modal" defaultText="Go Back"></button>\n            <button class="btn btn-danger discard translated" aria-hidden="true" defaultText="Discard Changes"></button>\n        </div>\n    </div>\n</div>')),this.unsaved_discard_button=$(this.unsaved_modal.find("button.discard")),this.unsaved_discard_button.click((b=this,function(t){return t.preventDefault(),b.unsaved_modal.data("builder").current_squad.dirty=!1,b.unsaved_modal.data("callback")(),b.unsaved_modal.modal("hide")})),exportObj.translateUIElements(this.unsaved_modal)},t.prototype.setupHandlers=function(){var n,e,i,a,s;return $(window).on("xwing-backend:authenticationChanged",(n=this,function(t,e,i){if(n.updateAuthenticationVisibility(),e)return n.loadCollection()})),this.login_logout_button.click((e=this,function(t){return t.preventDefault(),e.authenticated?e.logout():e.login()})),$(window).on("message",(s=this,function(t){var e,i=t.originalEvent;return i.origin===s.server?"auth_successful"!==(null!=(e=i.data)?e.command:void 0)?console.log("Unexpected command "+(null!=(e=i.data)?e.command:void 0)):(s.authenticate(),s.login_modal.modal("hide"),s.login_modal.find(".login-in-progress").hide(),s.login_modal.find("ul.login-providers").show(),i.source.close()):(console.log("Message received from unapproved origin "+i.origin),window.last_ev=t)})).on("xwing-collection:changed",(a=this,function(t,e){return null!=a.collection_save_timer&&clearTimeout(a.collection_save_timer),a.collection_save_timer=setTimeout(function(){return a.saveCollection(e,function(t){if(t)return $(window).trigger("xwing-collection:saved",e)})},1e3)})).on("xwing-collection:reset",(i=this,function(t,e){return null!=i.collection_save_timer&&clearTimeout(i.collection_save_timer),i.collection_save_timer=setTimeout(function(){return i.resetCollection(e,function(t){if(t)return $(window).trigger("xwing-collection:reset",e)})},1e3)}))},t.prototype.getSettings=function(n){return null==n&&(n=$.noop),$.get(this.server+"/settings").done(function(t,e,i){return n(t.settings)})},t.prototype.set=function(t,e,n){var i;return null==n&&(n=$.noop),(i={_method:"PUT"})[t]=e,$.post(this.server+"/settings",i).done(function(t,e,i){return n(t.set)})},t.prototype.deleteSetting=function(t,n){return null==n&&(n=$.noop),$.post(this.server+"/settings/"+t,{_method:"DELETE"}).done(function(t,e,i){return n(t.deleted)})},t.prototype.getHeaders=function(n){return null==n&&(n=$.noop),$.get(this.server+"/headers").done(function(t,e,i){return n(t.headers)})},t.prototype.getLanguagePreference=function(t,a){var s,l,o=__iced_k_noop,e=iced.findDeferral(arguments);if(null==a&&(a=$.noop),null!=(null!=t?t.language:void 0))return o(a(t.language,10));t=this;var i=function(){var t,e,i,n;if(null!=(null!=s?s.HTTP_ACCEPT_LANGUAGE:void 0))for(t=0,e=(i=s.HTTP_ACCEPT_LANGUAGE.split(",")).length;t<e;t++){n=i[t].split(";"),l=n[0],"*"===l?a("English",-.5):(l=l.split("-")[0])in exportObj.codeToLanguage?a(exportObj.codeToLanguage[l],8):a("English",-1);break}else a("English",-1);return o()};i=new iced.Deferrals(i,{parent:e,funcname:"SquadBuilderBackend.getLanguagePreference"}),t.getHeaders(i.defer({assign_fn:function(){return s=arguments[0]},lineno:1010})),i._fulfill()},t.prototype.getCollectionCheck=function(t,e){return null==e&&(e=$.noop),null!=(null!=t?t.collectioncheck:void 0)?e(t.collectioncheck):e(this.collectioncheck=!0)},t.prototype.resetCollection=function(t,n){return null==n&&(n=$.noop),$.post(this.server+"/collection",{expansions:{},singletons:{},checks:{}}).done(function(t,e,i){return n(t.success)})},t.prototype.saveCollection=function(t,n){return null==n&&(n=$.noop),t={expansions:t.expansions,singletons:t.singletons,checks:t.checks},$.post(this.server+"/collection",t).done(function(t,e,i){return n(t.success)})},t.prototype.loadCollection=function(){return $.get(this.server+"/collection").done(function(t,e,i){t=t.collection;return new exportObj.Collection({expansions:t.expansions,singletons:t.singletons,checks:t.checks})})},t})(),exportObj="undefined"!=typeof exports&&null!==exports?exports:this,TYPES=["pilots","upgrades","ships","damage"],byName=function(t,e){t=(t.display_name||t.name).toLowerCase().replace(/[^a-zA-Z0-9]/g,""),e=(e.display_name||e.name).toLowerCase().replace(/[^a-zA-Z0-9]/g,"");return t<e?-1:e<t?1:0},byPoints=function(t,e){return t.data.points<e.data.points?-1:e.data.points<t.data.points?1:byName(t,e)},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},exportObj.CardBrowser=(()=>{function t(t){this.container=$(t.container),this.currently_selected=null,this.language=null!=(t=exportObj.currentLanguage)?t:"English",this.prepareData(),this.setupUI(),this.setupHandlers()}return t.prototype.setupUI=function(){var t,e,i,n,a,s,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k;for(e in this.container.append($.trim('<div class="container-fluid xwing-card-browser">\n    <div class="row">\n        <div class="col-md-4">\n            <div class="card card-search-container">\n            <h5 class="card-title translated" defaultText="Card Search"></h5>\n                <div class="advanced-search-container">\n                    <div class = "card search-container general-search-container">\n                        <h6 class="card-subtitle mb-3 text-muted version translated" defaultText="General"></h6>\n                        <label class = "text-search advanced-search-label">\n                        <strong class="translated" defaultText="Textsearch:"></strong>\n                            <input type="search" placeholder="'+exportObj.translate("ui","Placeholder Textsearch Browser")+'" class = "card-search-text">\n                        </label>\n                        <div class= "advanced-search-faction-selection-container">\n                            <label class = "advanced-search-label select-available-slots">\n                                <strong class="translated" defaultText="Factions:"></strong>\n                                <select class="advanced-search-selection faction-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","All factions")+'"></select>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-point-selection-container">\n                            <strong class="translated" defaultText="Point cost:"></strong>\n                            <label class = "advanced-search-label set-minimum-points">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-point-cost advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-points">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-point-cost advanced-search-number-input" value="20" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-loadout-selection-container">\n                            <strong class="translated" defaultText="Loadout cost:"></strong>\n                            <label class = "advanced-search-label set-minimum-loadout">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-loadout-cost advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-loadout">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-loadout-cost advanced-search-number-input" value="99" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-collection-container">\n                            <strong class="translated" defaultText="Owned copies:"></strong>\n                            <label class = "advanced-search-label set-minimum-owned-copies">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-owned-copies advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-owened-copies">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-owned-copies advanced-search-number-input" value="99" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-misc-container">\n                            <strong class="translated" defaultText="Misc:"></strong>\n                            <label class = "advanced-search-label toggle-xwa">\n                                <input type="checkbox" class="xwa-checkbox advanced-search-checkbox" checked="checked"/> <span class="translated" defaultText="Use XWA points"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-unique">\n                                <input type="checkbox" class="unique-checkbox advanced-search-checkbox" /> <span class="translated" defaultText="Is unique"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-non-unique">\n                                <input type="checkbox" class="non-unique-checkbox advanced-search-checkbox" /> <span class="translated" defaultText="Is not unique"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-limited">\n                                <input type="checkbox" class="limited-checkbox advanced-search-checkbox" /> <span class="translated" defaultText="Is limited"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-standard">\n                                <input type="checkbox" class="standard-checkbox advanced-search-checkbox" />  <span class="translated" defaultText="Standard legal"></span>\n                            </label>\n                        </div>\n                    </div>\n                    <div class = "card search-container ship-search-container">\n                        <h6 class="card-subtitle mb-3 text-muted version translated" defaultText="Ships and Pilots"></h6>\n                        <div class = "advanced-search-slot-available-container">\n                            <label class = "advanced-search-label select-available-slots">\n                                <strong class="translated" defaultText="Slots:"></strong>\n                                <select class="advanced-search-selection slot-available-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","slots")+'"></select>\n                            </label>\n                            <br />\n                            <label class = "advanced-search-label toggle-unique">\n                                <input type="checkbox" class="duplicate-slots-checkbox advanced-search-checkbox" /> <span class="translated" defaultText="Has multiple of the chosen slots"></span> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-keyword-available-container">\n                            <label class = "advanced-search-label select-available-keywords">\n                                <strong class="translated" defaultText="Keywords:"></strong>\n                                <select class="advanced-search-selection keyword-available-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","keywords")+'"></select>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-actions-available-container">\n                            <label class = "advanced-search-label select-available-actions">\n                                <strong class="translated" defaultText="Actions:"></strong>\n                                <select class="advanced-search-selection action-available-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","actions")+'"></select>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-linkedactions-available-container">\n                            <label class = "advanced-search-label select-available-linkedactions">\n                                <strong class="translated" defaultText="Linked actions:"></strong>\n                                <select class="advanced-search-selection linkedaction-available-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","actions")+'"></select>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-ini-container">\n                            <strong class="translated" defaultText="Initiative:"></strong>\n                            <label class = "advanced-search-label set-minimum-ini">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-ini advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-ini">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-ini advanced-search-number-input" value="6" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-hull-container">\n                            <strong class="translated" defaultText="Hull:"></strong>\n                            <label class = "advanced-search-label set-minimum-hull">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-hull advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-hull">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-hull advanced-search-number-input" value="12" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-shields-container">\n                            <strong class="translated" defaultText="Shields:"></strong>\n                            <label class = "advanced-search-label set-minimum-shields">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-shields advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-shields">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-shields advanced-search-number-input" value="6" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-agility-container">\n                            <strong class="translated" defaultText="Agility:"></strong>\n                            <label class = "advanced-search-label set-minimum-agility">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-agility advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-agility">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-agility advanced-search-number-input" value="3" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-base-size-container">\n                            <strong class="translated" defaultText="Base size:"></strong>\n                            <label class = "advanced-search-label toggle-small-base">\n                                <input type="checkbox" class="small-base-checkbox advanced-search-checkbox" checked="checked"/> <span class="translated" defaultText="Small"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-medium-base">\n                                <input type="checkbox" class="medium-base-checkbox advanced-search-checkbox" checked="checked"/> <span class="translated" defaultText="Medium"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-large-base">\n                                <input type="checkbox" class="large-base-checkbox advanced-search-checkbox" checked="checked"/> <span class="translated" defaultText="Large"></span>\n                            </label>\n                            <label class = "advanced-search-label toggle-huge-base">\n                                <input type="checkbox" class="huge-base-checkbox advanced-search-checkbox" checked="checked"/> <span class="translated" defaultText="Huge"></span>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-attack-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-frontarc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attack">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attack advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attack">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attack advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-attackt-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-singleturretarc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attackt">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackt advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attackt">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackt advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-attackdt-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-doubleturretarc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attackdt">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackdt advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attackdt">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackdt advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-attackf-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-fullfrontarc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attackf">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackf advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attackf">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackf advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-attackb-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-reararc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attackb">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackb advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attackb">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackb advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                        <div class = "advanced-search-attackbull-container">\n                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-bullseyearc"></i>:</strong>\n                            <label class = "advanced-search-label set-minimum-attackbull">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackbull advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-attackbull">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackbull advanced-search-number-input" value="5" /> \n                            </label>\n                        </div>\n                    </div>\n                    <div class = "card search-container other-stuff-search-container">\n                        <h6 class="card-subtitle mb-3 text-muted version translated" defaultText="Other Stuff"></h6>\n                        <div class = "advanced-search-slot-used-container">\n                            <label class = "advanced-search-label select-used-slots">\n                                <strong class="translated" defaultText="Used slot:"></strong>\n                                <select class="advanced-search-selection slot-used-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","slots")+'"></select>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-slot-used-second-slot-container">\n                            <label class = "advanced-search-label select-used-second-slots">\n                                <strong class="translated" defaultText="Used double-slot:"></strong>\n                                <select class="advanced-search-selection slot-used-second-selection" multiple="1" data-placeholder="'+exportObj.translate("ui","noXYselected","slots")+'"></select>\n                            </label>\n                            <br />\n                            <label class = "advanced-search-label has-a-second-slot">\n                                <input type="checkbox" class="advanced-search-checkbox has-a-second-slot-checkbox" /> <span class="translated" defaultText="Only upgrades requiring multiple slots"></span>\n                            </label>\n                        </div>\n                        <div class = "advanced-search-charge-container">\n                            <strong class="translated" defaultText="Charges:"></strong>\n                            <label class = "advanced-search-label set-minimum-charge">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-charge advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-charge">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-charge advanced-search-number-input" value="5" /> \n                            </label>\n                            <br />\n                            <label class = "advanced-search-label has-recurring-charge">\n                                <input type="checkbox" class="advanced-search-checkbox has-recurring-charge-checkbox" checked="checked"/> <span class="translated" defaultText="Recurring"></span>\n                            </label>\n                            <label class = "advanced-search-label has-not-recurring-charge">\n                                <input type="checkbox" class="advanced-search-checkbox has-not-recurring-charge-checkbox" checked="checked"/> <span class="translated" defaultText="Not recurring"></span>\n                            </label>\n                        <div class = "advanced-search-force-container">\n                            <strong class="translated" defaultText="Force:"></strong>\n                            <label class = "advanced-search-label set-minimum-force">\n                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-force advanced-search-number-input" value="0" /> \n                            </label>\n                            <label class = "advanced-search-label set-maximum-force">\n                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-force advanced-search-number-input" value="3" /> \n                            </label>\n                        </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="col-md-4 card-selecting-area">\n            <span class="translate sort-cards-by" defaultText="Sort cards by"></span><span class="translated" defaultText="Sort by">:</span> <select class="sort-by">\n                <option value="name" class="translated" defaultText="Name"></option>\n                <option value="source" class="translated" defaultText="Source"></option>\n                <option value="type-by-points" class="translated" defaultText="Type (by Points)"></option>\n                <option value="type-by-name" selected="1" class="translated" defaultText="Type (by Name)" selected="selected">'+exportObj.translate("ui","Type (by Name)")+'</option>\n            </select>\n            <div class="card-selector-container">\n\n            </div>\n            <br>\n            <div class="card-viewer-conditions-container">\n            </div>\n        </div>\n        <div class="col-md-4">\n            <div class="card-viewer-container">\n            </div>\n        </div>\n    </div>\n</div>')),this.card_selector_container=$(this.container.find(".xwing-card-browser .card-selector-container")),this.card_viewer_container=$(this.container.find(".xwing-card-browser .card-viewer-container")),this.card_viewer_container.append($.trim(exportObj.builders[7].createInfoContainerUI(!1))),this.card_viewer_container.hide(),this.card_viewer_conditions_container=$(this.container.find(".xwing-card-browser .card-viewer-conditions-container")),this.card_viewer_conditions_container.hide(),this.advanced_search_container=$(this.container.find(".xwing-card-browser .advanced-search-container")),this.sort_selector=$(this.container.find("select.sort-by")),this.sort_selector.select2({minimumResultsForSearch:-1}),this.card_search_text=$(this.container.find(".xwing-card-browser .card-search-text"))[0],this.faction_selection=$(this.container.find(".xwing-card-browser select.faction-selection")),v=exportObj.pilotsByFactionXWS)v[e],(d=$(document.createElement("OPTION"))).val(e),d.text(exportObj.translate("faction",e)),this.faction_selection.append(d);for(c in(i=$(document.createElement("OPTION"))).val("Factionless"),i.text(exportObj.translate("faction","Factionless")),this.faction_selection.append(i),this.faction_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.minimum_point_costs=$(this.container.find(".xwing-card-browser .minimum-point-cost"))[0],this.maximum_point_costs=$(this.container.find(".xwing-card-browser .maximum-point-cost"))[0],this.minimum_loadout_costs=$(this.container.find(".xwing-card-browser .minimum-loadout-cost"))[0],this.maximum_loadout_costs=$(this.container.find(".xwing-card-browser .maximum-loadout-cost"))[0],this.use_xwa_points=$(this.container.find(".xwing-card-browser .xwa-checkbox"))[0],this.standard_checkbox=$(this.container.find(".xwing-card-browser .standard-checkbox"))[0],this.unique_checkbox=$(this.container.find(".xwing-card-browser .unique-checkbox"))[0],this.non_unique_checkbox=$(this.container.find(".xwing-card-browser .non-unique-checkbox"))[0],this.limited_checkbox=$(this.container.find(".xwing-card-browser .limited-checkbox"))[0],this.base_size_checkboxes={Small:$(this.container.find(".xwing-card-browser .small-base-checkbox"))[0],Medium:$(this.container.find(".xwing-card-browser .medium-base-checkbox"))[0],Large:$(this.container.find(".xwing-card-browser .large-base-checkbox"))[0],Huge:$(this.container.find(".xwing-card-browser .huge-base-checkbox"))[0]},this.slot_available_selection=$(this.container.find(".xwing-card-browser select.slot-available-selection")),exportObj.upgradesBySlotCanonicalName)(d=$(document.createElement("OPTION"))).val(c),d.text(exportObj.translate("slot",c)),this.slot_available_selection.append(d);for(o in this.slot_available_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.keyword_available_selection=$(this.container.find(".xwing-card-browser select.keyword-available-selection")),l=[],exportObj.pilotsByKeyword)for(u=0,m=(s=o.split(",")).length;u<m;u++)n=s[u],l.indexOf(n)<0&&"undefined"!==n&&l.push(n);for(l.sort(),h=0,_=l.length;h<_;h++)a=l[h],(d=$(document.createElement("OPTION"))).val(a),d.text(exportObj.translate("keyword",a)),this.keyword_available_selection.append(d);for(this.keyword_available_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.duplicateslots=$(this.container.find(".xwing-card-browser .duplicate-slots-checkbox"))[0],this.action_available_selection=$(this.container.find(".xwing-card-browser select.action-available-selection")),p=0,b=(x=["Evade","Focus","Lock","Boost","Barrel Roll","Calculate","Reinforce","Rotate Arc","Coordinate","Slam","Reload","Jam","Cloak"].sort()).length;p<b;p++)t=x[p],(d=$(document.createElement("OPTION"))).text(exportObj.translate("action",t)),d.val(t),this.action_available_selection.append(d);for(this.action_available_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.linkedaction_available_selection=$(this.container.find(".xwing-card-browser select.linkedaction-available-selection")),f=0,g=(k=["Evade","Focus","Lock","Boost","Barrel Roll","Calculate","Reinforce","Rotate Arc","Coordinate","Slam","Reload","Jam","Cloak"].sort()).length;f<g;f++)r=k[f],(d=$(document.createElement("OPTION"))).text(exportObj.translate("action",r)),d.val(r),this.linkedaction_available_selection.append(d);for(c in this.linkedaction_available_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.slot_used_selection=$(this.container.find(".xwing-card-browser select.slot-used-selection")),exportObj.upgradesBySlotCanonicalName)(d=$(document.createElement("OPTION"))).text(exportObj.translate("slot",c)),d.val(c),this.slot_used_selection.append(d);for(c in this.slot_used_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.slot_used_second_selection=$(this.container.find(".xwing-card-browser select.slot-used-second-selection")),exportObj.upgradesBySlotCanonicalName)(d=$(document.createElement("OPTION"))).text(exportObj.translate("slot",c)),d.val(c),this.slot_used_second_selection.append(d);return this.slot_used_second_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.minimum_charge=$(this.container.find(".xwing-card-browser .minimum-charge"))[0],this.maximum_charge=$(this.container.find(".xwing-card-browser .maximum-charge"))[0],this.minimum_ini=$(this.container.find(".xwing-card-browser .minimum-ini"))[0],this.maximum_ini=$(this.container.find(".xwing-card-browser .maximum-ini"))[0],this.minimum_force=$(this.container.find(".xwing-card-browser .minimum-force"))[0],this.maximum_force=$(this.container.find(".xwing-card-browser .maximum-force"))[0],this.minimum_hull=$(this.container.find(".xwing-card-browser .minimum-hull"))[0],this.maximum_hull=$(this.container.find(".xwing-card-browser .maximum-hull"))[0],this.minimum_shields=$(this.container.find(".xwing-card-browser .minimum-shields"))[0],this.maximum_shields=$(this.container.find(".xwing-card-browser .maximum-shields"))[0],this.minimum_agility=$(this.container.find(".xwing-card-browser .minimum-agility"))[0],this.maximum_agility=$(this.container.find(".xwing-card-browser .maximum-agility"))[0],this.minimum_attack=$(this.container.find(".xwing-card-browser .minimum-attack"))[0],this.maximum_attack=$(this.container.find(".xwing-card-browser .maximum-attack"))[0],this.minimum_attackt=$(this.container.find(".xwing-card-browser .minimum-attackt"))[0],this.maximum_attackt=$(this.container.find(".xwing-card-browser .maximum-attackt"))[0],this.minimum_attackdt=$(this.container.find(".xwing-card-browser .minimum-attackdt"))[0],this.maximum_attackdt=$(this.container.find(".xwing-card-browser .maximum-attackdt"))[0],this.minimum_attackf=$(this.container.find(".xwing-card-browser .minimum-attackf"))[0],this.maximum_attackf=$(this.container.find(".xwing-card-browser .maximum-attackf"))[0],this.minimum_attackb=$(this.container.find(".xwing-card-browser .minimum-attackb"))[0],this.maximum_attackb=$(this.container.find(".xwing-card-browser .maximum-attackb"))[0],this.minimum_attackbull=$(this.container.find(".xwing-card-browser .minimum-attackbull"))[0],this.maximum_attackbull=$(this.container.find(".xwing-card-browser .maximum-attackbull"))[0],this.hassecondslot=$(this.container.find(".xwing-card-browser .has-a-second-slot-checkbox"))[0],this.recurring_charge=$(this.container.find(".xwing-card-browser .has-recurring-charge-checkbox"))[0],this.not_recurring_charge=$(this.container.find(".xwing-card-browser .has-not-recurring-charge-checkbox"))[0],this.minimum_owned_copies=$(this.container.find(".xwing-card-browser .minimum-owned-copies"))[0],this.maximum_owned_copies=$(this.container.find(".xwing-card-browser .maximum-owned-copies"))[0],exportObj.translateUIElements(this.container)},t.prototype.setupHandlers=function(){var B,D,e,i,z,M,n,t,a,s,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k,y,w,q,O,S,j,T,C,I,L,A,U,P,E,N,R,F,W,G,X,H,Q,V,Y,Z,J,K,tt;for(B in this.sort_selector.change((e=this,function(t){return e.renderList(e.sort_selector.val())})),$("#browserTab").on("click",(i=this,function(t){return i.renderList(i.sort_selector.val())})),$(window).on("xwing:afterLanguageLoad",(n=this,function(t,e,i){return null==i&&(i=$.noop),n.language=e,n.prepareData()})).on("xwing-collection:created",(M=this,function(t,e){return M.collection=e})).on("xwing-collection:destroyed",(z=this,function(t,e){return z.collection=null})),this.card_search_text.oninput=(t=this,function(){return t.renderList(t.sort_selector.val())}),this.skip_nontext_search=!0,this.faction_selection[0].onchange=(a=this,function(){return a.renderList_advanced(a.sort_selector.val())}),D=this.base_size_checkboxes)D[B].onclick=(t=>function(){return t.renderList_advanced(t.sort_selector.val())})(this);return this.minimum_point_costs.oninput=(s=this,function(){return s.renderList_advanced(s.sort_selector.val())}),this.maximum_point_costs.oninput=(l=this,function(){return l.renderList_advanced(l.sort_selector.val())}),this.minimum_loadout_costs.oninput=(o=this,function(){return o.renderList_advanced(o.sort_selector.val())}),this.maximum_loadout_costs.oninput=(r=this,function(){return r.renderList_advanced(r.sort_selector.val())}),this.standard_checkbox.onclick=(d=this,function(){return d.renderList_advanced(d.sort_selector.val())}),this.use_xwa_points.onclick=(c=this,function(){return c.renderList_advanced(c.sort_selector.val())}),this.unique_checkbox.onclick=(u=this,function(){return u.renderList_advanced(u.sort_selector.val())}),this.non_unique_checkbox.onclick=(h=this,function(){return h.renderList_advanced(h.sort_selector.val())}),this.limited_checkbox.onclick=(p=this,function(){return p.renderList_advanced(p.sort_selector.val())}),this.slot_available_selection[0].onchange=(f=this,function(){return f.renderList_advanced(f.sort_selector.val())}),this.keyword_available_selection[0].onchange=(m=this,function(){return m.renderList_advanced(m.sort_selector.val())}),this.duplicateslots.onclick=(_=this,function(){return _.renderList_advanced(_.sort_selector.val())}),this.action_available_selection[0].onchange=(b=this,function(){return b.renderList_advanced(b.sort_selector.val())}),this.linkedaction_available_selection[0].onchange=(g=this,function(){return g.renderList_advanced(g.sort_selector.val())}),this.slot_used_selection[0].onchange=(v=this,function(){return v.renderList_advanced(v.sort_selector.val())}),this.slot_used_second_selection[0].onchange=(x=this,function(){return x.renderList_advanced(x.sort_selector.val())}),this.not_recurring_charge.onclick=(k=this,function(){return k.renderList_advanced(k.sort_selector.val())}),this.recurring_charge.onclick=(y=this,function(){return y.renderList_advanced(y.sort_selector.val())}),this.hassecondslot.onclick=(w=this,function(){return w.renderList_advanced(w.sort_selector.val())}),this.minimum_charge.oninput=(q=this,function(){return q.renderList_advanced(q.sort_selector.val())}),this.maximum_charge.oninput=(O=this,function(){return O.renderList_advanced(O.sort_selector.val())}),this.minimum_ini.oninput=(S=this,function(){return S.renderList_advanced(S.sort_selector.val())}),this.maximum_ini.oninput=(j=this,function(){return j.renderList_advanced(j.sort_selector.val())}),this.minimum_hull.oninput=(T=this,function(){return T.renderList_advanced(T.sort_selector.val())}),this.maximum_hull.oninput=(C=this,function(){return C.renderList_advanced(C.sort_selector.val())}),this.minimum_force.oninput=(I=this,function(){return I.renderList_advanced(I.sort_selector.val())}),this.maximum_force.oninput=(L=this,function(){return L.renderList_advanced(L.sort_selector.val())}),this.minimum_shields.oninput=(A=this,function(){return A.renderList_advanced(A.sort_selector.val())}),this.maximum_shields.oninput=(U=this,function(){return U.renderList_advanced(U.sort_selector.val())}),this.minimum_agility.oninput=(P=this,function(){return P.renderList_advanced(P.sort_selector.val())}),this.maximum_agility.oninput=(E=this,function(){return E.renderList_advanced(E.sort_selector.val())}),this.minimum_attack.oninput=(N=this,function(){return N.renderList_advanced(N.sort_selector.val())}),this.maximum_attack.oninput=(R=this,function(){return R.renderList_advanced(R.sort_selector.val())}),this.minimum_attackt.oninput=(F=this,function(){return F.renderList_advanced(F.sort_selector.val())}),this.maximum_attackt.oninput=(W=this,function(){return W.renderList_advanced(W.sort_selector.val())}),this.minimum_attackdt.oninput=(G=this,function(){return G.renderList_advanced(G.sort_selector.val())}),this.maximum_attackdt.oninput=(X=this,function(){return X.renderList_advanced(X.sort_selector.val())}),this.minimum_attackf.oninput=(H=this,function(){return H.renderList_advanced(H.sort_selector.val())}),this.maximum_attackf.oninput=(Q=this,function(){return Q.renderList_advanced(Q.sort_selector.val())}),this.minimum_attackb.oninput=(V=this,function(){return V.renderList_advanced(V.sort_selector.val())}),this.maximum_attackb.oninput=(Y=this,function(){return Y.renderList_advanced(Y.sort_selector.val())}),this.minimum_attackbull.oninput=(Z=this,function(){return Z.renderList_advanced(Z.sort_selector.val())}),this.maximum_attackbull.oninput=(J=this,function(){return J.renderList_advanced(J.sort_selector.val())}),this.minimum_owned_copies.oninput=(K=this,function(){return K.renderList_advanced(K.sort_selector.val())}),this.maximum_owned_copies.oninput=(tt=this,function(){return tt.renderList_advanced(tt.sort_selector.val())})},t.prototype.getPoints=function(t){return this.use_xwa_points.checked&&null!=t.pointsbeta?t.pointsbeta:t.points},t.prototype.getLoadout=function(t){return this.use_xwa_points.checked&&null!=t.loadoutbeta?t.loadoutbeta:t.loadout},t.prototype.getSlots=function(t){return this.use_xwa_points.checked&&null!=t.slotsbeta?t.slotsbeta:t.slots},t.prototype.prepareData=function(){var a,i,n,t,e,s,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k,y,w,q;for(this.all_cards=[],r=0,h=TYPES.length;r<h;r++)l=TYPES[r],this.all_cards="upgrades"===l?this.all_cards.concat((()=>{var t=exportObj[l],e=[];for(n in t)i=t[n],e.push({name:i.name,display_name:i.display_name,type:exportObj.translate("ui","upgradeHeader",i.slot),data:i,orig_type:i.slot});return e})()):"damage"===l?this.all_cards.concat((()=>{var t=exportObj[l],e=[];for(n in t)i=t[n],e.push({name:i.name,display_name:i.display_name,type:exportObj.translate("ui","damageHeader",i.type),data:i,orig_type:"Damage"});return e})()):this.all_cards.concat((()=>{var t=exportObj[l],e=[];for(n in t)i=t[n],e.push({name:i.name,display_name:i.display_name,type:exportObj.translate("singular",l),data:i,orig_type:exportObj.translateToLang("English","singular",l)});return e})());for(n in this.types=(()=>{for(var t=["Pilot","Ship"],e=[],i=0,n=t.length;i<n;i++)l=t[i],e.push(exportObj.translate("types",l));return e})(),x=exportObj.upgrades)i=x[n],o=exportObj.translate("ui","upgradeHeader",i.slot),__indexOf.call(this.types,o)<0&&this.types.push(o);for(n in k=exportObj.damage)i=k[n],o=exportObj.translate("ui","damageHeader",i.type),__indexOf.call(this.types,o)<0&&this.types.push(o);for(this.all_cards.sort(byName),this.sources=[],d=0,p=(y=this.all_cards).length;d<p;d++)for(c=0,f=(w=(a=y[d]).data.sources).length;c<f;c++)s=w[c],__indexOf.call(this.sources,s)<0&&this.sources.push(s);for(e=this.types.sort(),t=this.sources.sort(),this.cards_by_type_name={},u=0,m=e.length;u<m;u++)l=e[u],this.cards_by_type_name[l]=function(){for(var t=this.all_cards,e=[],i=0,n=t.length;i<n;i++)(a=t[i]).type===l&&e.push(a);return e}.call(this).sort(byName);for(this.cards_by_type_points={},g=0,_=e.length;g<_;g++)l=e[g],this.cards_by_type_points[l]=function(){for(var t=this.all_cards,e=[],i=0,n=t.length;i<n;i++)(a=t[i]).type===l&&e.push(a);return e}.call(this).sort(byPoints);for(this.cards_by_source={},q=[],v=0,b=t.length;v<b;v++)s=t[v],q.push(this.cards_by_source[s]=function(){for(var t=this.all_cards,e=[],i=0,n=t.length;i<n;i++)a=t[i],0<=__indexOf.call(a.data.sources,s)&&e.push(a);return e}.call(this).sort(byName));return q},t.prototype.renderList_advanced=function(t){return null==t&&(t="name"),this.skip_nontext_search=!1,this.renderList(t)},t.prototype.renderList=function(t){var e,i,n,a,s,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k,y,w,q,O,S,j;switch(null==t&&(t="name"),null!=this.use_xwa_points.checked&&(exportObj.builders[7].isBeta=this.use_xwa_points.checked),null!=this.card_selector?this.card_selector.empty():(this.card_selector=$(document.createElement("SELECT")),this.card_selector.addClass("card-selector"),this.card_selector.attr("size",25),this.card_selector_container.append(this.card_selector)),this.setupSearch(),t){case"type-by-name":for(l=0,c=(x=this.types).length;l<c;l++){for(s=x[l],(n=$(document.createElement("OPTGROUP"))).attr("label",s),i=!1,o=0,u=(k=this.cards_by_type_name[s]).length;o<u;o++)e=k[o],this.checkSearchCriteria(e)&&(this.addCardTo(n,e),i=!0);i&&this.card_selector.append(n)}break;case"type-by-points":for(r=0,h=(y=this.types).length;r<h;r++){for(s=y[r],(n=$(document.createElement("OPTGROUP"))).attr("label",s),i=!1,d=0,p=(w=this.cards_by_type_points[s]).length;d<p;d++)e=w[d],this.checkSearchCriteria(e)&&(this.addCardTo(n,e),i=!0);i&&this.card_selector.append(n)}break;case"source":for(b=0,f=(q=this.sources).length;b<f;b++){for(a=q[b],(n=$(document.createElement("OPTGROUP"))).attr("label",exportObj.translate("sources",a)),i=!1,g=0,m=(O=this.cards_by_source[a]).length;g<m;g++)e=O[g],this.checkSearchCriteria(e)&&(this.addCardTo(n,e),i=!0);i&&this.card_selector.append(n)}break;default:for(v=0,_=(S=this.all_cards).length;v<_;v++)e=S[v],this.checkSearchCriteria(e)&&this.addCardTo(this.card_selector,e)}return this.card_selector.change((j=this,function(t){return j.renderCard($(j.card_selector.find(":selected")))}))},t.prototype.renderCard=function(t){t.data("display_name"),t.data("name");var e,i,n,a,s,l,o,r=t.data("card"),t=t.data("orig_type");if("Pilot"!==t&&"Ship"!==t&&"Quickbuild"!==t&&"Damage"!==t&&(e={addon_type:t},t="Addon"),"Pilot"===t&&this.card_viewer_container.find("tr.info-faction").show(),this.card_viewer_container.show(),exportObj.builders[7].showTooltip(t,r,null!=e?e:{},this.card_viewer_container),null==(null!=r?r.applies_condition:void 0))return this.card_viewer_conditions_container.hide();if(n=new Set,r.applies_condition instanceof Array)for(a=0,s=(l=r.applies_condition).length;a<s;a++)i=l[a],n.add(exportObj.conditionsByCanonicalName[i]);else n.add(exportObj.conditionsByCanonicalName[r.applies_condition]);return this.card_viewer_conditions_container.text(""),n.forEach((o=this,function(t){var e=$(document.createElement("div"));return e.addClass("conditions-container d-flex flex-wrap"),e.append(conditionToHTML(t)),o.card_viewer_conditions_container.append(e)})),this.card_viewer_conditions_container.show()},t.prototype.addCardTo=function(t,e){var i=$(document.createElement("OPTION"));return i.text((e.display_name||e.name)+" ("+(null!=this.getPoints(e.data)?this.getPoints(e.data):null!=e.data.quantity?e.data.quantity+"x":"*")+(null!=this.getLoadout(e.data)?"/"+this.getLoadout(e.data):"")+")"),i.data("name",e.name),i.data("display_name",e.display_name),i.data("type",e.type),i.data("card",e.data),i.data("orig_type",e.orig_type),0===this.getCollectionNumber(e)&&i[0].classList.add("result-not-in-collection"),$(t).append(i)},t.prototype.getCollectionNumber=function(t){var e,i;if(null==exportObj.builders[7].collection||null==exportObj.builders[7].collection.counts)return-1;switch(e=0,t.orig_type){case"Pilot":e=null!=(i=null!=(i=exportObj.builders[7].collection.counts.pilot)?i[t.name]:void 0)?i:0;break;case"Ship":e=null!=(i=null!=(i=exportObj.builders[7].collection.counts.ship)?i[t.name]:void 0)?i:0;break;default:e=null!=(i=null!=(i=exportObj.builders[7].collection.counts.upgrade)?i[t.name]:void 0)?i:0}return e},t.prototype.setupSearch=function(){if(this.searchInputs={text:this.card_search_text.value.toLowerCase(),factions:this.faction_selection.val(),required_slots:this.slot_available_selection.val(),required_actions:this.action_available_selection.val(),required_linked_actions:this.linkedaction_available_selection.val(),required_keywords:this.keyword_available_selection.val(),used_slots:this.slot_used_selection.val(),used_second_slots:this.slot_used_second_selection.val()},0<=__indexOf.call(this.searchInputs.factions,"Factionless"))return this.searchInputs.factions.push(void 0)},t.prototype.checkSearchCriteria=function(t){var e,i,n,a,E,B,s,l,o,r,D,d,c,z,M,N,R,u,h,p,f,m,_,F,W,G,b,g,v,x,k,X,H,Q,V,Y,Z,J,K,tt,et,it,nt,at,st,lt,ot,rt,y,w,q,O,S,$,j,dt,ct,ut,ht,pt,ft,mt,T,_t,C,I,L,A,U,P,bt;if(null!=this.searchInputs.text&&!(-1<t.name.toLowerCase().indexOf(this.searchInputs.text)||t.data.text&&-1<t.data.text.toLowerCase().indexOf(this.searchInputs.text)||t.display_name&&-1<t.display_name.toLowerCase().indexOf(this.searchInputs.text))){if(!t.data.ship)return!1;if((h=t.data.ship)instanceof Array){for(F=!1,g=0,X=h.length;g<X;g++)if(-1<(R=h[g]).toLowerCase().indexOf(this.searchInputs.text)||exportObj.ships[R].display_name&&-1<exportObj.ships[R].display_name.toLowerCase().indexOf(this.searchInputs.text)){F=!0;break}if(!F)return!1}else if(!(-1<h.toLowerCase().indexOf(this.searchInputs.text)||exportObj.ships[h].display_name&&-1<exportObj.ships[h].display_name.toLowerCase().indexOf(this.searchInputs.text)))return!1}if(this.skip_nontext_search)return!0;if(p=(()=>{var t=exportObj.pilotsByFactionXWS,e=[];for(n in t)d=t[n],e.push(n);return e})(),0<(u=this.searchInputs.factions).length){if(j=t.data.faction,!(0<=__indexOf.call(u,j)||"Ship"===t.orig_type||t.data.faction instanceof Array))return!1;if(t.data.faction instanceof Array){for(a=!1,v=0,H=(dt=t.data.faction).length;v<H;v++)if(n=dt[v],0<=__indexOf.call(u,n)){a=!0;break}if(!a)return!1}if("Ship"===t.orig_type){for(a=!1,x=0,et=(ft=t.data.factions).length;x<et;x++)if(n=ft[x],0<=__indexOf.call(u,n)){a=!0;break}if(!a)return!1}}else u=p;if(this.standard_checkbox.checked){for(_=!1,k=0,it=(mt=null!=t.data.faction?Array.isArray(t.data.faction)?t.data.faction:[t.data.faction]:u).length;k<it;k++)n=mt[k],__indexOf.call(u,n)<0||(_=_||exportObj.standardCheckBrowser(t.data,n,t.orig_type));if(!_)return!1}if(0<(N=this.searchInputs.required_slots).length)for(m=this.getSlots(t.data),y=0,nt=N.length;y<nt;y++){if(!(("Torpedo"===(f=N[y])||"Missile"===f||"Cannon"===f)&&null!=m&&0<=__indexOf.call(m,"HardpointShip")||null!=m&&0<=__indexOf.call(m,f)))return!1;if(this.duplicateslots.checked&&0===m.filter(function(t,e,i){return i.indexOf(t)===e&&e!==i.lastIndexOf(t)&&t===f}).length)return!1}if(0<(M=this.searchInputs.required_keywords).length)for(B=t.data.keyword,w=0,at=M.length;w<at;w++)if(E=M[w],!(null!=B&&0<=__indexOf.call(B,E)))return!1;if(j=this.searchInputs.required_actions,p=this.searchInputs.required_linked_actions,(0<j.length||0<p.length)&&(i=null!=(T=t.data.actions)?T:[],"Pilot"===t.orig_type)&&(i=(i=null!=(T=null!=(T=t.data.ship_override)?T.actions:void 0)?T:exportObj.ships[t.data.ship].actions).concat(null!=(T=null!=(T=t.data.ship_override)?T.actionsred:void 0)?T:exportObj.ships[t.data.ship].actionsred),null!=t.data.keyword)&&0<=__indexOf.call(t.data.keyword,"Droid")){for(D=[],q=0,st=i.length;q<st;q++)null!=(e=i[q])&&D.push(e.replace("Focus","Calculate"));i=D}for(O=0,lt=(_t=null!=j?j:[]).length;O<lt;O++)if(e=_t[O],null==i||!(0<=__indexOf.call(i,e)||0<=__indexOf.call(i,"F-"+e)||0<=__indexOf.call(i,"R-"+e)))return!1;for(S=0,ot=(ct=null!=p?p:[]).length;S<ot;S++)if(e=ct[S],!(null!=i&&(0<=__indexOf.call(i,"R> "+e)||0<=__indexOf.call(i,"> "+e))))return!1;if(0<this.minimum_point_costs.value||this.maximum_point_costs.value<20){if(!(this.getPoints(t.data)>=this.minimum_point_costs.value&&this.getPoints(t.data)<=this.maximum_point_costs.value||null!=t.data.variablepoints))return!1;if(null!=t.data.variablepoints&&(o=!1,b=this.getPoints(t.data),Array.isArray(b))){for($=0,rt=b.length;$<rt;$++)if((z=b[$])>=this.minimum_point_costs.value&&z<=this.maximum_point_costs.value){o=!0;break}if(!o)return!1}if("Ship"===t.orig_type){for(o=!1,C=0,Q=u.length;C<Q;C++){for(r in n=u[C],ut=exportObj.pilotsByFactionCanonicalName[n]){for(I=0,V=(c=ut[r]).length;I<V;I++)if((d=c[I]).ship===t.data.name&&this.getPoints(d)>=this.minimum_point_costs.value&&this.getPoints(d)<=this.maximum_point_costs.value){o=!0;break}if(o)break}if(o)break}if(!o)return!1}}if(0<this.minimum_loadout_costs.value||this.maximum_loadout_costs.value<99){if(!(this.getLoadout(t.data)>=this.minimum_loadout_costs.value&&this.getLoadout(t.data)<=this.maximum_loadout_costs.value))return!1;if("Ship"===t.orig_type){for(l=!1,L=0,Y=u.length;L<Y;L++){for(r in n=u[L],ht=exportObj.pilotsByFactionCanonicalName[n]){for(A=0,Z=(c=ht[r]).length;A<Z;A++)if((d=c[A]).ship===t.data.name&&this.getLoadout(d)>=this.minimum_loadout_costs.value&&this.getLoadout(d)<=this.maximum_loadout_costs.value){l=!0;break}if(l)break}if(l)break}if(!l)return!1}}if(0<(G=this.searchInputs.used_slots).length){if(null==t.data.slot)return!1;for(s=!1,U=0,J=G.length;U<J;U++)if(f=G[U],t.data.slot===f){s=!0;break}if(!s)return!1}if(0<(W=this.searchInputs.used_second_slots).length){if(null==t.data.also_occupies_upgrades)return!1;for(s=!1,P=0,K=W.length;P<K;P++)for(f=W[P],bt=0,tt=(pt=t.data.also_occupies_upgrades).length;bt<tt;bt++)if(pt[bt]===f){s=!0;break}if(!s)return!1}if(null==t.data.also_occupies_upgrades&&this.hassecondslot.checked)return!1;if(this.unique_checkbox.checked&&!t.data.unique)return!1;if(this.non_unique_checkbox.checked&&t.data.unique)return!1;if(this.limited_checkbox.checked&&!t.data.max_per_squad)return!1;if(!(null!=t.data.charge&&t.data.charge<=this.maximum_charge.value&&t.data.charge>=this.minimum_charge.value||this.minimum_charge.value<=0&&null==t.data.charge))return!1;if(t.data.recurring&&!this.recurring_charge.checked)return!1;if(t.data.charge&&!t.data.recurring&&!this.not_recurring_charge.checked)return!1;if(null!=(null!=(T=exportObj.builders[7].collection)?T.counts:void 0)&&!((j=this.getCollectionNumber(t))>=this.minimum_owned_copies.value&&j<=this.maximum_owned_copies.value))return!1;if(null!=t.data.skill){if(!(t.data.skill>=this.minimum_ini.value&&t.data.skill<=this.maximum_ini.value))return!1}else if(!(this.minimum_ini.value<=0&&6<=this.maximum_ini.value))return!1;if(this.base_size_checkboxes.Small.checked&&this.base_size_checkboxes.Medium.checked&&this.base_size_checkboxes.Large.checked&&this.base_size_checkboxes.Huge.checked||(p=!1,"Ship"===t.orig_type?p=null!=t.data.base?p||this.base_size_checkboxes[t.data.base].checked:p||this.base_size_checkboxes.Small.checked:"Pilot"===t.orig_type&&(p=null!=(h=exportObj.ships[t.data.ship]).base?p||this.base_size_checkboxes[h.base].checked:p||this.base_size_checkboxes.Small.checked),p))return("0"===this.minimum_hull.value&&"12"===this.maximum_hull.value||null!=t.data.hull&&t.data.hull>=this.minimum_hull.value&&t.data.hull<=this.maximum_hull.value||"Pilot"===t.orig_type&&exportObj.ships[t.data.ship].hull>=this.minimum_hull.value&&exportObj.ships[t.data.ship].hull<=this.maximum_hull.value)&&("0"===this.minimum_shields.value&&"6"===this.maximum_shields.value||null!=t.data.shields&&t.data.shields>=this.minimum_shields.value&&t.data.shields<=this.maximum_shields.value||"Pilot"===t.orig_type&&exportObj.ships[t.data.ship].shields>=this.minimum_shields.value&&exportObj.ships[t.data.ship].shields<=this.maximum_shields.value)&&("0"===this.minimum_agility.value&&"3"===this.maximum_agility.value||null!=t.data.agility&&t.data.agility>=this.minimum_agility.value&&t.data.agility<=this.maximum_agility.value||"Pilot"===t.orig_type&&exportObj.ships[t.data.ship].agility>=this.minimum_agility.value&&exportObj.ships[t.data.ship].agility<=this.maximum_agility.value)&&("0"===this.minimum_attack.value&&"5"===this.maximum_attack.value||null!=t.data.attack&&t.data.attack>=this.minimum_attack.value&&t.data.attack<=this.maximum_attack.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attack&&exportObj.ships[t.data.ship].attack>=this.minimum_attack.value&&exportObj.ships[t.data.ship].attack<=this.maximum_attack.value||null==exportObj.ships[t.data.ship].attack&&this.minimum_attack.value<=0)||"Ship"===t.orig_type&&null==t.data.attack&&this.minimum_attack.value<=0)&&("0"===this.minimum_attackt.value&&"5"===this.maximum_attackt.value||null!=t.data.attackt&&t.data.attackt>=this.minimum_attackt.value&&t.data.attackt<=this.maximum_attackt.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attackt&&exportObj.ships[t.data.ship].attackt>=this.minimum_attackt.value&&exportObj.ships[t.data.ship].attackt<=this.maximum_attackt.value||null==exportObj.ships[t.data.ship].attackt&&this.minimum_attackt.value<=0)||"Ship"===t.orig_type&&null==t.data.attackt&&this.minimum_attackt.value<=0)&&("0"===this.minimum_attackdt.value&&"5"===this.maximum_attackdt.value||null!=t.data.attackdt&&t.data.attackdt>=this.minimum_attackdt.value&&t.data.attackdt<=this.maximum_attackdt.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attackdt&&exportObj.ships[t.data.ship].attackdt>=this.minimum_attackdt.value&&exportObj.ships[t.data.ship].attackdt<=this.maximum_attackdt.value||null==exportObj.ships[t.data.ship].attackdt&&this.minimum_attackdt.value<=0)||"Ship"===t.orig_type&&null==t.data.attackdt&&this.minimum_attackdt.value<=0)&&("0"===this.minimum_attackf.value&&"5"===this.maximum_attackf.value||null!=t.data.attackf&&t.data.attackf>=this.minimum_attackf.value&&t.data.attackf<=this.maximum_attackf.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attackf&&exportObj.ships[t.data.ship].attackf>=this.minimum_attackf.value&&exportObj.ships[t.data.ship].attackf<=this.maximum_attackf.value||null==exportObj.ships[t.data.ship].attackf&&this.minimum_attackf.value<=0)||"Ship"===t.orig_type&&null==t.data.attackf&&this.minimum_attackf.value<=0)&&("0"===this.minimum_attackb.value&&"5"===this.maximum_attackb.value||null!=t.data.attackb&&t.data.attackb>=this.minimum_attackb.value&&t.data.attackb<=this.maximum_attackb.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attackb&&exportObj.ships[t.data.ship].attackb>=this.minimum_attackb.value&&exportObj.ships[t.data.ship].attackb<=this.maximum_attackb.value||null==exportObj.ships[t.data.ship].attackb&&this.minimum_attackb.value<=0)||"Ship"===t.orig_type&&null==t.data.attackb&&this.minimum_attackb.value<=0)&&("0"===this.minimum_attackbull.value&&"5"===this.maximum_attackbull.value||null!=t.data.attackbull&&t.data.attackbull>=this.minimum_attackbull.value&&t.data.attackbull<=this.maximum_attackbull.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attackbull&&exportObj.ships[t.data.ship].attackbull>=this.minimum_attackbull.value&&exportObj.ships[t.data.ship].attackbull<=this.maximum_attackbull.value||null==exportObj.ships[t.data.ship].attackbull&&this.minimum_attackbull.value<=0)||"Ship"===t.orig_type&&null==t.data.attackbull&&this.minimum_attackbull.value<=0)&&("0"===this.minimum_force.value&&"3"===this.maximum_force.value||null!=t.data.force&&t.data.force>=this.minimum_force.value&&t.data.force<=this.maximum_force.value||"Pilot"===t.orig_type&&exportObj.ships[t.data.ship].force>=this.minimum_force.value&&exportObj.ships[t.data.ship].force<=this.maximum_force.value||null==t.data.force&&"0"===this.minimum_force.value);return!1},t})(),(exportObj="undefined"!=typeof exports&&null!==exports?exports:this).RulesBrowser=(()=>{function t(t){this.container=$(t.container),this.language=null!=(t=exportObj.currentLanguage)?t:"English",this.prepareRulesData(),this.setupRuleUI(),this.setupRulesHandlers()}return t.prototype.setupRuleUI=function(){var t,e;return this.container.append($.trim('<div class="container-fluid xwing-rules-browser">\n    <div class="row">\n        <div class="col-md-4">\n            <div class="card card-search-container">\n                <h5 class="card-title translated" defaultText="Rules Search"></h5>\n                <div class="advanced-search-container">\n                    <h6 class="card-subtitle mb-2 text-muted version"><span class="translated" defaultText="Version"></span>: </h6>\n                    <label class = "text-search advanced-search-label">\n                        <strong class="translated" defaultText="Term:"></strong>\n                        <input type="search" placeholder="'+exportObj.translate("ui","Search for game term or card")+'" class = "rule-search-text">\n                    </label>\n                </div>\n                <div class="rules-container card-selector-container">\n                </div>\n            </div>\n        </div>\n        <div class="col-md-8">\n            <div class="card card-viewer-container card-search-container">\n                <h4 class="card-title info-name"></h4>\n                <br />\n                <p class="info-text" />\n            </div>\n        </div>\n    </div>\n</div>')),this.versionlabel=$(this.container.find(".xwing-rules-browser .version")),this.rule_selector_container=$(this.container.find(".xwing-rules-browser .rules-container")),this.rule_viewer_container=$(this.container.find(".xwing-rules-browser .card-viewer-container")),this.rule_viewer_container.hide(),this.advanced_search_container=$(this.container.find(".xwing-rules-browser .advanced-search-container")),exportObj.translateUIElements(this.container),e=this.all_rules.version.number,t=this.all_rules.version.date,this.versionlabel.append(e+", "+t),this.rule_search_rules_text=$(this.container.find(".xwing-rules-browser .rule-search-text"))[0]},t.prototype.setupRulesHandlers=function(){var n,t;return this.renderRulesList(),$(window).on("xwing:afterLanguageLoad",(n=this,function(t,e,i){return null==i&&(i=$.noop),n.language=e,exportObj.loadRules(e),n.prepareRulesData(),n.renderRulesList()})),this.rule_search_rules_text.oninput=(t=this,function(){return t.renderRulesList()})},t.prototype.prepareRulesData=function(){return this.all_rules=exportObj.rulesEntries(),this.ruletype=["glossary","faq"]},t.prototype.renderRulesList=function(){var t,e,i,n,a,s,l,o,r,d;for(null!=this.rule_selector&&this.rule_selector.remove(),this.rule_selector=$(document.createElement("SELECT")),this.rule_selector.addClass("card-selector"),this.rule_selector.attr("size",25),this.rule_selector_container.append(this.rule_selector),s=0,l=(o=this.ruletype).length;s<l;s++){for(n in a=o[s],(t=$(document.createElement("OPTGROUP"))).attr("label",exportObj.translate("rulestypes",a)),e=!1,r=this.all_rules[a])i=r[n],this.checkRulesSearchCriteria(i)&&(this.addRulesTo(t,i),e=!0);e&&this.rule_selector.append(t)}return this.rule_selector.change((d=this,function(t){return d.renderRules($(d.rule_selector.find(":selected")))}))},t.prototype.renderRules=function(t){t={name:t.data("name"),text:t.data("text")};return this.rule_viewer_container.show(),exportObj.builders[0].showTooltip("Rules",t,"undefined"!=typeof add_opts&&null!==add_opts?add_opts:{},this.rule_viewer_container)},t.prototype.addRulesTo=function(t,e){var i=$(document.createElement("OPTION"));return i.text(""+e.name),i.data("name",e.name),i.data("text",exportObj.fixIcons(e)),$(t).append(i)},t.prototype.checkRulesSearchCriteria=function(t){var e=this.rule_search_rules_text.value.toLowerCase();return-1<t.name.toLowerCase().indexOf(e)||-1<(t.text&&t.text.toLowerCase().indexOf(e))},t})(),SHOW_DEBUG_OUT_MISSING_TRANSLATIONS=!(DFL_LANGUAGE="English"),builders=[],(exportObj="undefined"!=typeof exports&&null!==exports?exports:this).languagePriority=-1;try{(()=>{var t,e,i,n,a;if(!(3<exportObj.languagePriority)&&(exportObj.currentLanguage=DFL_LANGUAGE,-1!==exportObj.languagePriority))for(a=[],i=0,n=(e=[navigator.language].concat(navigator.languages)).length;i<n;i++){if((t=(t=e[i]).split("-")[0])in exportObj.codeToLanguage){exportObj.currentLanguage=exportObj.codeToLanguage[t],exportObj.languagePriority=3;break}a.push(void 0)}})()}catch(t){all=t,exportObj.currentLanguage=DFL_LANGUAGE}exportObj.loadCards=function(t){return exportObj.cardLoaders[t]()},exportObj.loadRules=function(t){return t in exportObj.ruleLoaders?(exportObj.rulesLang!==t&&(exportObj.ruleLoaders[t](),exportObj.rulesLang=t),!0):(exportObj.rulesLang!==DFL_LANGUAGE&&(exportObj.ruleLoaders[DFL_LANGUAGE](),exportObj.rulesLang=DFL_LANGUAGE),!1)},exportObj.translate=function(){var t=arguments[0],e=arguments[1],i=3<=arguments.length?__slice.call(arguments,2):[];return exportObj.translateToLang.apply(exportObj,[exportObj.currentLanguage,t,e].concat(__slice.call(i)))},exportObj.translateToLang=function(){var e,t=arguments[0],i=arguments[1],n=arguments[2],a=4<=arguments.length?__slice.call(arguments,3):[];try{e=exportObj.translations[t][i][n]}catch(t){all=t,e=void 0}return null!=e?e instanceof Function?e.apply(null,[exportObj.translate].concat(__slice.call(a))):e:t!==DFL_LANGUAGE?(SHOW_DEBUG_OUT_MISSING_TRANSLATIONS&&console.log(t+" translation for "+String(n)+" (category "+String(i)+") missing"),exportObj.translateToLang.apply(exportObj,[DFL_LANGUAGE,i,n].concat(__slice.call(a)))):n},exportObj.setupTranslationSupport=function(){var t,e,p;return p=builders,$(exportObj).on("xwing:languageChanged",function(t,i,e,n){var a,s,l,o,r,d,c,u=__iced_k_noop,h=iced.findDeferral(arguments);if(null==e&&(e=5),null==n&&(n=$.noop),"reload"!==e){if(e<exportObj.languagePriority)return;exportObj.languagePriority=e,exportObj.currentLanguage=i}if(!(i in exportObj.translations))return u();$(".language-placeholder").text(i),s="",r=(o=p).length,d=0,(c=function(t){var e=function(){return iced.trampoline(function(){return++d,c(t)})};if(!(d<r))return t();a=o[d],s=a.language,l=new iced.Deferrals(e,{parent:h}),a.container.trigger("xwing:beforeLanguageLoad",l.defer({lineno:2309})),l._fulfill()})(function(){var t,e;if(i!==s)exportObj.loadCards(i);for(exportObj.translateUIElements(),t=0,e=p.length;t<e;t++){a=p[t];a.container.trigger("xwing:afterLanguageLoad",i)}return u()})}),t=exportObj.basicCardData(),e=exportObj.basicQuickBuilds(),exportObj.canonicalizeShipNames(t),exportObj.ships=t.ships,exportObj.setupCommonCardData(t),exportObj.setupQuickBuilds(e),exportObj.loadCards(DFL_LANGUAGE),exportObj.loadRules(exportObj.currentLanguage),DFL_LANGUAGE!==exportObj.currentLanguage&&exportObj.loadCards(exportObj.currentLanguage),$(exportObj).trigger("xwing:languageChanged",[exportObj.currentLanguage,"reload"])},exportObj.translateUIElements=function(t){var e,i,n,a,s;for(null==t&&(t=void 0),s=[],i=0,n=(a=$(".translated",t)).length;i<n;i++)e=a[i],s.push(e.innerHTML=exportObj.translate("ui",e.getAttribute("defaultText")));return s},exportObj.setupTranslationUI=function(t){for(var e,n,i=Object.keys(exportObj.cardLoaders).sort(),a=function(e,i){return n.click(function(t){return null!=i&&i.set("language",e),$(exportObj).trigger("xwing:languageChanged",[e,100])})},s=[],l=0,o=i.length;l<o;l++)e=i[l],(n=$(document.createElement("LI"))).text(e),a(e,t),s.push($(".language-picker .dropdown-menu").append(n));return s},exportObj.registerBuilderForTranslation=function(t){if(__indexOf.call(builders,t)<0)return builders.push(t)},(exportObj="undefined"!=typeof exports&&null!==exports?exports:this).sortHelper=function(t,e){var i,n;return t.points===e.points?(i=t.text.replace(/[^a-z0-9]/gi,""))===(n=e.text.replace(/[^a-z0-9]/gi,""))?0:n<i?1:-1:"string"==typeof t.points||t.points>e.points?1:-1},exportObj.toTTS=function(t){return null==t?null:t.replace(/\(.*\)/g,"").replace("�",'"').replace("�",'"')},exportObj.slotsMatching=function(t,e){if(t===e)return!0;switch(t){case"HardpointShip":if("Torpedo"===e||"Cannon"===e||"Missile"===e)return!0;break;case"VersatileShip":if("Torpedo"===e||"Missile"===e)return!0}switch(e){case"HardpointShip":if("Torpedo"===t||"Cannon"===t||"Missile"===t)return!0;break;case"VersatileShip":if("Torpedo"===t||"Missile"===t)return!0}return!1},$.isMobile=function(){return!!(navigator.userAgent.match(/(iPhone|iPod|iPad|Android)/i)||1<navigator.maxTouchPoints)},$.randomInt=function(t){return Math.floor(Math.random()*t)},$.isElementInView=function(t,e){var i=$(window).scrollTop(),n=i+$(window).height(),a=null!=(a=$(t))&&null!=(a=a.offset())?a.top:void 0,t=a+$(t).height();return e?i<a&&t<n:a<=n&&i<=t},$.getParameterByName=function(t){return t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),null===(t=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.search))?"":decodeURIComponent(t[1].replace(/\+/g," "))},Array.prototype.intersects=function(t){for(var e,i=0,n=this.length;i<n;i++)if(e=this[i],0<=__indexOf.call(t,e))return!0;return!1},Array.prototype.removeItem=function(t){t=this.indexOf(t);return-1!==t&&this.splice(t,1),this},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.getXWSBaseName=function(){return this.split("-")[0]},URL_BASE=window.location.protocol+"//"+window.location.host+window.location.pathname,SQUAD_DISPLAY_NAME_MAX_LENGTH=24,statAndEffectiveStat=function(t,e,i){return null!=t?""+t+(null!=e&&null!=e[i]&&e[i]!==t?" ("+e[i]+")":""):null!=e&&null!=e[i]?"0 ("+e[i]+")":"0"},getPrimaryFaction=function(t){switch(t){case"Rebel Alliance":return"Rebel Alliance";case"Galactic Empire":return"Galactic Empire";default:return t}},conditionToHTML=function(t){return $.trim('<div class="condition">\n    <div class="name">'+(t.unique?"&middot;&nbsp;":"")+(t.display_name||t.name)+'</div>\n    <div class="text">'+t.text+"</div>\n</div>")},exportObj.SquadBuilder=(()=>{function t(t){this._makeRandomizerLoopFunc=__bind(this._makeRandomizerLoopFunc,this),this._randomizerLoopBody=__bind(this._randomizerLoopBody,this),this.releaseUnique=__bind(this.releaseUnique,this),this.claimUnique=__bind(this.claimUnique,this),this.updatePrintAndExportTexts=__bind(this.updatePrintAndExportTexts,this),this.onSquadNameChanged=__bind(this.onSquadNameChanged,this),this.onSquadDirtinessChanged=__bind(this.onSquadDirtinessChanged,this),this.onSquadLoadRequested=__bind(this.onSquadLoadRequested,this),this.onPointsUpdated=__bind(this.onPointsUpdated,this),this.onGameTypeChanged=__bind(this.onGameTypeChanged,this),this.onNotesUpdated=__bind(this.onNotesUpdated,this),this.updatePermaLink=__bind(this.updatePermaLink,this),this.updateShipOrder=__bind(this.updateShipOrder,this),this.getPermaLink=__bind(this.getPermaLink,this),this.getPermaLinkParams=__bind(this.getPermaLinkParams,this),this.container=$(t.container),this.faction=$.trim(t.faction),this.printable_container=$(t.printable_container),this.tab=$(t.tab),this.show_points_destroyed=!1,this.ships=[],this.uniques_in_use={Pilot:[],Upgrade:[],Slot:[]},this.standard_list={Upgrade:[],Ship:[]},this.suppress_automatic_new_ship=!1,this.tooltip_currently_displaying=null,this.randomizer_options={sources:null,points:20,ship_limit:0,collection_only:!0,fill_zero_pts:!1},this.total_points=0,this.isStandard=null==(t=null!=(t=exportObj.builders[0])?t.isStandard:void 0)||t,this.isEpic=null!=(t=null!=(t=exportObj.builders[0])?t.isEpic:void 0)&&t,this.isBeta=null!=(t=null!=(t=exportObj.builders[0])?t.isBeta:void 0)&&t,this.isQuickbuild=null!=(t=null!=(t=exportObj.builders[0])?t.isQuickbuild:void 0)&&t,this.backend=null,this.current_squad={},this.language=null!=(t=exportObj.currentLanguage)?t:"English",this.collection=null,this.current_obstacles=[],this.setupUI(),"All"===this.faction?this.game_type_selector.val("epic").trigger("change"):this.game_type_selector.val((null!=(t=exportObj.builders[0])?t:this).game_type_selector.val()),this.setupEventHandlers(),window.setInterval(this.updatePermaLink,250),this.isUpdatingPoints=!1,$.getParameterByName("f")===this.faction?(this.resetCurrentSquad(!0),this.loadFromSerialized($.getParameterByName("d"))):(this.resetCurrentSquad(),this.addShip())}return t.prototype.resetCurrentSquad=function(t){var e,i,n;return null==t&&(t=!1),e=this.uitranslation("Unnamed Squadron"),i=$.trim(this.squad_name_input.val())||e,t&&$.trim($.getParameterByName("sn"))&&(i=$.trim($.getParameterByName("sn"))),n=[],t&&$.trim($.getParameterByName("obs"))?(n=$.trim($.getParameterByName("obs")).split(",").slice(0,3),this.updateObstacleSelect(n)):this.current_obstacles&&(n=this.current_obstacles),this.current_squad={id:null,name:i,dirty:!1,additional_data:{points:this.total_points,description:"",cards:[],notes:"",obstacles:n,tag:""},faction:this.faction},0<this.total_points&&(i===e&&(this.current_squad.name=this.uitranslation("Unsaved Squadron")),this.current_squad.dirty=!0),this.old_version_container.toggleClass("d-none",!0),this.container.trigger("xwing-backend:squadNameChanged"),this.container.trigger("xwing-backend:squadDirtinessChanged")},t.prototype.newSquadFromScratch=function(t){return null==t&&(t=this.uitranslation("New Squadron")),this.squad_name_input.val(t),this.removeAllShips(),this.suppress_automatic_new_ship||this.addShip(),this.updateObstacleSelect([]),this.resetCurrentSquad(),this.notes.val(""),this.tag.val("")},t.prototype.uitranslation=function(){var t=arguments[0],e=2<=arguments.length?__slice.call(arguments,1):[];return exportObj.translate("ui",t,e)},t.prototype.setupUI=function(){var t,e,i,n,a,s,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k,B,y,w,q,O,S,D,j,T,C,I,L,A,U,P,E,z;for(this.status_container=$(document.createElement("DIV")),this.status_container.addClass("container-fluid"),this.status_container.append($.trim('<div class="row squad-name-and-points-row">\n    <div class="col-md-3 squad-name-container">\n        <div class="display-name">\n            <span class="squad-name"></span>\n            <i class="far fa-edit"></i>\n        </div>\n        <div class="input-append">\n            <input type="text" maxlength="64" placeholder="'+this.uitranslation("Name your squad...")+'" />\n            <button class="btn save"><i class="fa fa-pen-square"></i></button>\n        </div>\n        <br class="hide-on-mobile" />\n        <select class="game-type-selector">\n            <option value="xwabeta" class="translated" defaultText="XWA Beta">'+this.uitranslation("XWA Beta")+'</option>\n            <option value="standard" class="translated" defaultText="Standard" selected="selected">'+this.uitranslation("Standard")+'</option>\n            <option value="extended" class="translated" defaultText="Extended">'+this.uitranslation("Extended")+'</option>\n            <option value="epic" class="translated" defaultText="Epic">'+this.uitranslation("Epic")+'</option>\n            <option value="quickbuild" class="translated" defaultText="Quickbuild">'+this.uitranslation("Standard")+'</option>\n        </select>\n    </div>\n    <div class="col-md-4 points-display-container">\n        Points: <span class="total-points">0</span> / <input type="number" class="desired-points" value="20">\n        <span class="points-remaining-container">(<span class="points-remaining"></span>&nbsp;left) <span class="points-destroyed red"></span></span>\n        <span class="content-warning unreleased-content-used d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Unreleased content warning"></span></span>\n        <span class="content-warning loading-failed-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Broken squad link warning"></span></span>\n        <span class="content-warning old-version-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="This squad was created for an older version of X-Wing."></span></span>\n        <span class="content-warning collection-invalid d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Collection warning"></span></span>\n        <span class="content-warning ship-number-invalid-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Ship number warning"></span></span>\n        <span class="content-warning multi-faction-warning-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Multi-Faction warning"></span></span>\n        <span class="content-warning epic-not-legal-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Epic Unofficial"></span></span>\n    </div>\n    <div class="col-md-5 float-right button-container">\n        <div class="btn-group float-right">\n\n            <button class="btn btn-info view-as-text"><span class="d-none d-lg-block"><i class="fa fa-print"></i>&nbsp;<span class="translated" defaultText="Print/Export"></span></span><span class="d-lg-none"><i class="fa fa-print"></i></span></button>\n            <a class="btn btn-primary d-none collection"><span class="d-none d-lg-block"><i class="fa fa-folder-open"></i> <span class="translated" defaultText="Your Collection"></span></span><span class="d-lg-none"><i class="fa fa-folder-open"></i></span></a>\n            \x3c!-- Randomize button is marked as danger, since it creates a new squad --\x3e\n            <button class="btn btn-danger randomize"><span class="d-none d-lg-block"><i class="fa fa-random"></i> <span class="translated" defaultText="Randomize!"></span></span><span class="d-lg-none"><i class="fa fa-random"></i></span></button>\n            <button class="btn btn-danger dropdown-toggle" data-toggle="dropdown">\n                <span class="caret"></span>\n            </button>\n             <ul class="dropdown-menu dropdown-menu-right">\n                <li><a class="dropdown-item randomize-options translated" defaultText="Randomizer Options"></a></li>\n                <li><a class="dropdown-item misc-settings translated" defaultText="Misc Settings"></a></li>\n            </ul>\n        </div>\n    </div>\n</div>\n\n<div class="row squad-save-buttons">\n    <div class="col-md-12 squad-save-buttons-container">\n        <button class="show-authenticated btn btn-primary save-list"><i class="far fa-save"></i>&nbsp;<span class="translated" defaultText="Save"></span></button>\n        <button class="show-authenticated btn btn-primary save-list-as"><i class="far fa-file"></i>&nbsp;<span class="translated" defaultText="Save As..."></span></button>\n        <button class="show-authenticated btn btn-primary delete-list disabled"><i class="fa fa-trash"></i>&nbsp;<span class="translated" defaultText="Delete"></span></button>\n        <button class="show-authenticated btn btn-info backend-list-my-squads show-authenticated"><i class="fa fa-download"></i>&nbsp;<span class = "translated" defaultText="Load Squad"></span></button>\n        <button class="btn btn-info import-squad"><i class="fa fa-file-import"></i>&nbsp;<span class="translated" defaultText="Import"></span></button>\n        <button class="btn btn-info show-points-destroyed"><i class="fas fa-bullseye"></i>&nbsp;<span class="show-points-destroyed-span translated" defaultText="'+this.uitranslation("Show Points Destroyed")+'"></span></button>                    \n        <button class="btn btn-danger clear-squad"><i class="fa fa-plus-circle"></i>&nbsp;<span class="translated" defaultText="New Squad"></span></button>\n        <span class="show-authenticated backend-status"></span>\n    </div>\n</div>')),this.container.append(this.status_container),this.xws_import_modal=$(document.createElement("DIV")),this.xws_import_modal.addClass("modal fade import-modal d-print-none"),this.xws_import_modal.tabindex="-1",this.xws_import_modal.role="dialog",this.xws_import_modal.append($.trim('<div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="XWS Import"></h3>\n            <button type="button" class="close d-print-none" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <span class="translated" defaultText="XWS Import Dialog"></span>\n            <div class="container-fluid">\n                <textarea class="xws-content" placeholder=\''+this.uitranslation("Paste XWS here")+'\'></textarea>\n            </div>\n        </div>\n        <div class="modal-footer d-print-none">\n            <span class="xws-import-status"></span>&nbsp;\n            <button class="btn btn-danger import-xws translated" defaultText="Import"></button>\n        </div>\n    </div>\n</div>')),this.from_xws_button=this.container.find("button.import-squad"),this.from_xws_button.click((l=this,function(t){return t.preventDefault(),l.xws_import_modal.find(".xws-import-status").text(" "),l.xws_import_modal.modal("show")})),this.load_xws_button=$(this.xws_import_modal.find("button.import-xws")),this.load_xws_button.click((o=this,function(t){return t.preventDefault(),exportObj.loadXWSButton(o.xws_import_modal)})),this.container.append(this.xws_import_modal),this.list_modal=$(document.createElement("DIV")),this.list_modal.addClass("modal fade text-list-modal"),this.list_modal.tabindex="-1",this.list_modal.role="dialog",this.container.append(this.list_modal),this.list_modal.append($.trim('<div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <div class="d-print-none">\n                <h4 class="modal-title"><span class="squad-name"></span> <span class="total-points"></span></h4>\n            </div>\n            <div class="d-none d-print-block">\n                <div class="fancy-header">\n                    <div class="squad-name"></div>\n                    <div class="squad-faction"></div>\n                    <div class="mask">\n                        <div class="outer-circle">\n                            <div class="inner-circle">\n                                <span class="total-points"></span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="fancy-under-header"></div>\n            </div>\n            <button type="button" class="close d-print-none" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <div class="fancy-list"></div>\n            <div class="simple-list"></div>\n            <div class="simplecopy-list">\n                <span class="translated" defaultText="Copy below simple text"></span>\n                <textarea></textarea><button class="btn btn-modal btn-copy translated" defaultText="Copy"></button>\n            </div>\n            <div class="reddit-list">\n                <span class="translated" defaultText="Copy below markdown"></span>\n                <textarea></textarea><button class="btn btn-modal btn-copy translated" defaultText="Copy"></button>\n            </div>\n            <div class="tts-list">\n                <span class="translated" defaultText="Copy below TTS"></span>\n                <textarea></textarea><button class="btn btn-modal btn-copy translated" defaultText="Copy"></button>\n            </div>\n            <div class="xws-list">\n                <span class="translated" defaultText="Copy below XWS"></span>\n                <div class="row full-row">\n                    <div class="col d-inline-block d-none d-sm-block"><textarea></textarea><br /><button class="btn btn-modal btn-copy translated" defaultText="Copy"></button></div>\n                    <div class="col d-inline-block d-none d-sm-block qrcode-container" id="xws-qrcode-container"></div>\n                </div>\n            </div>\n        </div>\n        <div class="container-fluid modal-footer d-print-none">\n            <div class="row full-row">\n                <div class="col d-inline-block d-none d-sm-block right-col">\n                    <label class="color-skip-text-checkbox">\n                        <span class="translated" defaultText="Skip Card Text"></span> <input type="checkbox" class="toggle-skip-text-print" />\n                    </label><br />\n                    <label class="horizontal-space-checkbox">\n                        <span class="translated" defaultText="Space for Cards"></span> <input type="checkbox" class="toggle-horizontal-space" />\n                    </label><br />\n                    <label class="maneuver-print-checkbox">\n                        <span class="translated" defaultText="Include Maneuvers Chart"></span> <input type="checkbox" class="toggle-maneuver-print" />\n                    </label><br />\n                    <label class="expanded-shield-hull-print-checkbox">\n                        <span class="translated" defaultText="Expand Shield and Hull"></span> <input type="checkbox" class="toggle-expanded-shield-hull-print" />\n                    </label>\n                </div>\n                <div class="col d-inline-block d-none d-sm-block right-col">\n                    <label class="color-print-checkbox">\n                        <span class="translated" defaultText="Print Color"></span> <input type="checkbox" class="toggle-color-print" checked="checked" />\n                    </label><br />\n                    <label class="qrcode-checkbox">\n                        <span class="translated" defaultText="Include QR codes"></span> <input type="checkbox" class="toggle-juggler-qrcode" checked="checked" />\n                    </label><br />\n                    <label class="obstacles-checkbox">\n                        <span class="translated" defaultText="Include Obstacle Choices"></span> <input type="checkbox" class="toggle-obstacles" checked="checked" />\n                    </label>\n                </div>\n            </div>\n            <div class="row btn-group list-display-mode">\n                <button class="btn btn-modal select-simple-view translated" defaultText="Simple"></button>\n                <button class="btn btn-modal select-fancy-view translated" defaultText="Fancy"></button>\n                <button class="btn btn-modal select-simplecopy-view translated" defaultText="Text"></button>\n                <button class="btn btn-modal select-reddit-view translated" defaultText="Reddit"></button>\n                <button class="btn btn-modal select-tts-view d-none d-sm-block translated" defaultText="TTS"></button>\n                <button class="btn btn-modal select-xws-view translated" defaultText="XWS"></button>\n            </div>\n            <div class="row btn-group list-display-mode">\n                <button class="btn btn-modal copy-url translated" defaultText="Copy URL"></button>\n                <button class="btn btn-modal print-list d-sm-block"><span class="d-none d-lg-block"><i class="fa fa-print"></i>&nbsp;<span class="translated" defaultText="Print"></span></span><span class="d-lg-none"><i class="fa fa-print"></i></span></button>\n            </div>\n        </div>\n    </div>\n</div>')),this.fancy_container=$(this.list_modal.find(".fancy-list")),this.fancy_total_points_container=$(this.list_modal.find("div.modal-header .total-points")),this.simple_container=$(this.list_modal.find("div.modal-body .simple-list")),this.reddit_container=$(this.list_modal.find("div.modal-body .reddit-list")),this.reddit_textarea=$(this.reddit_container.find("textarea")),this.reddit_textarea.attr("readonly","readonly"),this.simplecopy_container=$(this.list_modal.find("div.modal-body .simplecopy-list")),this.simplecopy_textarea=$(this.simplecopy_container.find("textarea")),this.simplecopy_textarea.attr("readonly","readonly"),this.tts_container=$(this.list_modal.find("div.modal-body .tts-list")),this.tts_textarea=$(this.tts_container.find("textarea")),this.tts_textarea.attr("readonly","readonly"),this.xws_container=$(this.list_modal.find("div.modal-body .xws-list")),this.xws_textarea=$(this.xws_container.find("textarea")),this.xws_textarea.attr("readonly","readonly"),this.toggle_vertical_space_container=$(this.list_modal.find(".horizontal-space-checkbox")),this.toggle_color_print_container=$(this.list_modal.find(".color-print-checkbox")),this.toggle_color_skip_text=$(this.list_modal.find(".color-skip-text-checkbox")),this.toggle_maneuver_dial_container=$(this.list_modal.find(".maneuver-print-checkbox")),this.toggle_expanded_shield_hull_container=$(this.list_modal.find(".expanded-shield-hull-print-checkbox")),this.toggle_qrcode_container=$(this.list_modal.find(".qrcode-checkbox")),this.toggle_obstacle_container=$(this.list_modal.find(".obstacles-checkbox")),this.btn_print_list=$(this.list_modal.find(".print-list"))[0],this.btn_copy_url=$(this.list_modal.find(".copy-url")),this.btn_copy_url.click((r=this,function(t){if(r.success=window.navigator.clipboard.writeText(window.location.href),r.self=$(t.currentTarget),r.success)return r.self.addClass("btn-success"),setTimeout(function(){return r.self.removeClass("btn-success")},1e3)})),["fullscreen","standalone","minimal-ui"].some(function(t){return window.matchMedia("(display-mode: "+t+")").matches})||this.btn_copy_url.hide(),this.list_modal.on("click","button.btn-copy",(d=this,function(t){if(d.self=$(t.currentTarget),d.self.siblings("textarea").select(),d.success=document.execCommand("copy"),d.success)return d.self.addClass("btn-success"),setTimeout(function(){return d.self.removeClass("btn-success")},1e3)})),this.select_simple_view_button=$(this.list_modal.find(".select-simple-view")),this.select_simple_view_button.click((c=this,function(t){if(c.select_simple_view_button.blur(),"simple"!==c.list_display_mode)return c.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),c.select_simple_view_button.addClass("btn-inverse"),c.list_display_mode="simple",c.simple_container.show(),c.fancy_container.hide(),c.simplecopy_container.hide(),c.reddit_container.hide(),c.tts_container.hide(),c.xws_container.hide(),c.toggle_vertical_space_container.hide(),c.toggle_color_print_container.hide(),c.toggle_color_skip_text.hide(),c.toggle_maneuver_dial_container.hide(),c.toggle_expanded_shield_hull_container.hide(),c.toggle_qrcode_container.show(),c.toggle_obstacle_container.show(),c.btn_print_list.disabled=!1})),this.select_fancy_view_button=$(this.list_modal.find(".select-fancy-view")),this.select_fancy_view_button.click((u=this,function(t){if(u.select_fancy_view_button.blur(),"fancy"!==u.list_display_mode)return u.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),u.select_fancy_view_button.addClass("btn-inverse"),u.list_display_mode="fancy",u.fancy_container.show(),u.simple_container.hide(),u.simplecopy_container.hide(),u.reddit_container.hide(),u.tts_container.hide(),u.xws_container.hide(),u.toggle_vertical_space_container.show(),u.toggle_color_print_container.show(),u.toggle_color_skip_text.show(),u.toggle_maneuver_dial_container.show(),u.toggle_expanded_shield_hull_container.show(),u.toggle_qrcode_container.show(),u.toggle_obstacle_container.show(),u.btn_print_list.disabled=!1})),this.select_reddit_view_button=$(this.list_modal.find(".select-reddit-view")),this.select_reddit_view_button.click((h=this,function(t){if(h.select_reddit_view_button.blur(),"reddit"!==h.list_display_mode)return h.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),h.select_reddit_view_button.addClass("btn-inverse"),h.list_display_mode="reddit",h.reddit_container.show(),h.simplecopy_container.hide(),h.tts_container.hide(),h.xws_container.hide(),h.simple_container.hide(),h.fancy_container.hide(),h.reddit_textarea.select(),h.reddit_textarea.focus(),h.toggle_vertical_space_container.hide(),h.toggle_color_print_container.hide(),h.toggle_color_skip_text.hide(),h.toggle_maneuver_dial_container.hide(),h.toggle_expanded_shield_hull_container.hide(),h.toggle_qrcode_container.hide(),h.toggle_obstacle_container.hide(),h.btn_print_list.disabled=!0})),this.select_simplecopy_view_button=$(this.list_modal.find(".select-simplecopy-view")),this.select_simplecopy_view_button.click((p=this,function(t){if(p.select_simplecopy_view_button.blur(),"simplecopy"!==p.list_display_mode)return p.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),p.select_simplecopy_view_button.addClass("btn-inverse"),p.list_display_mode="simplecopy",p.reddit_container.hide(),p.simplecopy_container.show(),p.tts_container.hide(),p.xws_container.hide(),p.simple_container.hide(),p.fancy_container.hide(),p.simplecopy_textarea.select(),p.simplecopy_textarea.focus(),p.toggle_vertical_space_container.hide(),p.toggle_color_print_container.hide(),p.toggle_color_skip_text.hide(),p.toggle_maneuver_dial_container.hide(),p.toggle_expanded_shield_hull_container.hide(),p.toggle_qrcode_container.hide(),p.toggle_obstacle_container.hide(),p.btn_print_list.disabled=!0})),this.select_tts_view_button=$(this.list_modal.find(".select-tts-view")),this.select_tts_view_button.click((f=this,function(t){if(f.select_tts_view_button.blur(),"tts"!==f.list_display_mode)return f.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),f.select_tts_view_button.addClass("btn-inverse"),f.list_display_mode="tts",f.tts_container.show(),f.xws_container.hide(),f.simple_container.hide(),f.simplecopy_container.hide(),f.reddit_container.hide(),f.fancy_container.hide(),f.tts_textarea.select(),f.tts_textarea.focus(),f.toggle_vertical_space_container.hide(),f.toggle_color_print_container.hide(),f.toggle_color_skip_text.hide(),f.toggle_maneuver_dial_container.hide(),f.toggle_expanded_shield_hull_container.hide(),f.toggle_qrcode_container.hide(),f.toggle_obstacle_container.hide(),f.btn_print_list.disabled=!0})),this.select_xws_view_button=$(this.list_modal.find(".select-xws-view")),this.select_xws_view_button.click((m=this,function(t){return m.select_xws_view()})),(768<=$(window).width()?(this.simple_container.hide(),this.select_fancy_view_button):this.select_simple_view_button).click(),this.clear_squad_button=$(this.status_container.find(".clear-squad")),this.clear_squad_button.click((_=this,function(t){return _.current_squad.dirty&&null!=_.backend?_.backend.warnUnsaved(_,function(){return _.newSquadFromScratch()}):_.newSquadFromScratch()})),this.show_points_destroyed_button=$(this.status_container.find(".show-points-destroyed")),this.show_points_destroyed_button_span=$(this.status_container.find(".show-points-destroyed-span")),this.show_points_destroyed_button.click((b=this,function(t){var e,i,n,a,s;for(b.show_points_destroyed=!b.show_points_destroyed,!1===b.show_points_destroyed?b.points_destroyed_span.hide():b.points_destroyed_span.show(),s=[],i=0,n=(a=b.ships).length;i<n;i++)null!=(e=a[i]).pilot?!1===b.show_points_destroyed?(b.show_points_destroyed_button_span.text(b.uitranslation("Show Points Destroyed")),s.push(e.points_destroyed_button.hide())):(b.show_points_destroyed_button_span.text(b.uitranslation("Hide Points Destroyed")),s.push(e.points_destroyed_button.show())):s.push(void 0);return s})),this.squad_name_container=$(this.status_container.find("div.squad-name-container")),this.squad_name_display=$(this.container.find(".display-name")),this.squad_name_placeholder=$(this.container.find(".squad-name")),this.squad_name_input=$(this.squad_name_container.find("input")),this.squad_name_save_button=$(this.squad_name_container.find("button.save")),this.squad_name_input.closest("div").hide(),this.points_container=$(this.status_container.find("div.points-display-container")),this.total_points_span=$(this.points_container.find(".total-points")),this.game_type_selector=$(this.status_container.find(".game-type-selector")),this.game_type_selector.select2({minimumResultsForSearch:-1}),this.game_type_selector.change((g=this,function(t){return g.onGameTypeChanged(g.game_type_selector.val())})),this.desired_points_input=$(this.points_container.find(".desired-points")),this.desired_points_input.change((v=this,function(t){return v.onPointsUpdated($.noop)})),this.points_remaining_span=$(this.points_container.find(".points-remaining")),this.points_destroyed_span=$(this.points_container.find(".points-destroyed")),this.points_remaining_container=$(this.points_container.find(".points-remaining-container")),this.unreleased_content_used_container=$(this.points_container.find(".unreleased-content-used")),this.loading_failed_container=$(this.points_container.find(".loading-failed-container")),this.old_version_container=$(this.points_container.find(".old-version-container")),this.ship_number_invalid_container=$(this.points_container.find(".ship-number-invalid-container")),this.multi_faction_warning_container=$(this.points_container.find(".multi-faction-warning-container")),this.epic_not_legal_container=$(this.points_container.find(".epic-not-legal-container")),this.collection_invalid_container=$(this.points_container.find(".collection-invalid")),this.view_list_button=$(this.status_container.find("div.button-container button.view-as-text")),this.randomize_button=$(this.status_container.find("div.button-container button.randomize")),this.customize_randomizer=$(this.status_container.find("div.button-container a.randomize-options")),this.misc_settings=$(this.status_container.find("div.button-container a.misc-settings")),this.backend_status=$(this.status_container.find(".backend-status")),this.backend_status.hide(),this.collection_button=$(this.status_container.find("div.button-container a.collection")),this.collection_button.click((x=this,function(t){if(t.preventDefault(),!x.collection_button.prop("disabled"))return x.collection.modal.modal("show")})),this.squad_name_input.keypress((k=this,function(t){if(13===t.which)return k.squad_name_save_button.click(),!1})),this.squad_name_input.change((B=this,function(t){return B.backend_status.fadeOut("slow")})),this.squad_name_input.blur((y=this,function(t){return y.squad_name_input.change(),y.squad_name_save_button.click()})),this.squad_name_display.click((w=this,function(t){return t.preventDefault(),w.squad_name_display.hide(),w.squad_name_input.val($.trim(w.current_squad.name)),window.setTimeout(function(){return w.squad_name_input.focus(),w.squad_name_input.select()},100),w.squad_name_input.closest("div").show()})),this.squad_name_save_button.click((q=this,function(t){if(t.preventDefault(),q.current_squad.dirty=!0,q.container.trigger("xwing-backend:squadDirtinessChanged"),0<(q.current_squad.name=$.trim(q.squad_name_input.val())).length)return q.squad_name_display.show(),q.container.trigger("xwing-backend:squadNameChanged"),q.squad_name_input.closest("div").hide()})),this.randomizer_options_modal=$(document.createElement("DIV")),this.randomizer_options_modal.addClass("modal fade randomizer-modal"),this.randomizer_options_modal.tabindex="-1",this.randomizer_options_modal.role="dialog",$("body").append(this.randomizer_options_modal),this.randomizer_options_modal.append($.trim('<div class="modal-dialog modal-dialog-scrollable modal-dialog-centered" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="Random Squad Builder Options"></h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <form>\n                <label>\n                    <span class="translated" defaultText="Maximum Ship Count"></span>\n                    <input type="number" class="randomizer-ship-limit" value="0" placeholder="0" />\n                </label><br />\n                <label>\n                    <input type="checkbox" class="randomizer-collection-only" checked="checked"/> \n                    <span class="translated" defaultText="Limit to collection"></span>\n                </label><br />\n                <label>\n                    <span class="translated" defaultText="Sets and Expansions"></span>\n                    <select class="randomizer-sources" multiple="1" data-placeholder=\''+this.uitranslation("All sets and expansions")+'\'>\n                    </select>\n                </label><br />\n                <label>\n                    <input type="checkbox" class="randomizer-fill-zero-pts" /> \n                    <span class="translated" defaultText="Always fill 0-point slots"></span>\n                </label><br />\n                <label>\n                    <span class="translated" defaultText="Maximum Seconds to Spend Randomizing"></span>\n                    <input type="number" class="randomizer-timeout" value="4" placeholder="4" />\n                </label>\n            </form>\n        </div>\n        <div class="modal-footer">\n            <button class="btn btn-primary do-randomize translated" aria-hidden="true" defaultText="Roll!"></button>\n            <button class="btn translated" data-dismiss="modal" aria-hidden="true" defaultText="Close"></button>\n        </div>\n    </div>\n</div>')),exportObj.translateUIElements(this.randomizer_options_modal),this.randomizer_source_selector=$(this.randomizer_options_modal.find("select.randomizer-sources")),n=0,a=(s=exportObj.expansions).length;n<a;n++)t=s[n],(i=$(document.createElement("OPTION"))).text(t),this.randomizer_source_selector.append(i);return this.randomizer_source_selector.select2({width:"100%",minimumResultsForSearch:$.isMobile()?-1:0}),this.randomizer_collection_selector=$(this.randomizer_options_modal.find(".randomizer-collection-only"))[0],this.randomizer_fill_zero_pts=$(this.randomizer_options_modal.find(".randomizer-fill-zero-pts"))[0],this.randomize_button.click((O=this,function(t){var e,i;return t.preventDefault(),O.current_squad.dirty&&null!=O.backend?O.backend.warnUnsaved(O,function(){return O.randomize_button.click()}):(t=parseInt(O.desired_points_input.val()),(isNaN(t)||t<=0)&&(t=20),e=parseInt($(O.randomizer_options_modal.find(".randomizer-ship-limit")).val()),(isNaN(e)||e<0)&&(e=0),i=parseInt($(O.randomizer_options_modal.find(".randomizer-timeout")).val()),(isNaN(i)||i<=0)&&(i=4),O.randomSquad(t,O.randomizer_source_selector.val(),1e3*i,e,O.randomizer_collection_selector.checked,O.randomizer_fill_zero_pts.checked))})),this.randomizer_options_modal.find("button.do-randomize").click((S=this,function(t){return t.preventDefault(),S.randomizer_options_modal.modal("hide"),S.randomize_button.click()})),this.customize_randomizer.click((D=this,function(t){return t.preventDefault(),D.randomizer_options_modal.modal()})),this.misc_settings_modal=$(document.createElement("DIV")),this.misc_settings_modal.addClass("modal fade"),this.misc_settings_modal.tabindex="-1",this.misc_settings_modal.role="dialog",$("body").append(this.misc_settings_modal),this.misc_settings_modal.append($.trim('<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <h3 class="translated" defaultText="Miscellaneous Settings"></h3>\n            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        </div>\n        <div class="modal-body">\n            <label class = "toggle-initiative-prefix-names misc-settings-label">\n                <input type="checkbox" class="initiative-prefix-names-checkbox misc-settings-checkbox" /> <span class="translated" defaultText="Use INI prefix"></span> \n            </label><br />\n            <label class = "enable-ban-list misc-settings-label">\n                <input type="checkbox" class="enable-ban-list-checkbox misc-settings-checkbox" /> <span class="translated" defaultText="Enable Ban List (Not Standard)"></span> \n            </label><br />\n        </div>\n        <div class="modal-footer">\n            <span class="misc-settings-infoline"></span>\n            &nbsp;\n            <button class="btn translated" data-dismiss="modal" aria-hidden="true" defaultText="Close"></button>\n        </div>\n    </div>\n</div>')),this.misc_settings_infoline=$(this.misc_settings_modal.find(".misc-settings-infoline")),this.misc_settings_initiative_prefix=$(this.misc_settings_modal.find(".initiative-prefix-names-checkbox")),this.misc_settings_ban_list=$(this.misc_settings_modal.find(".enable-ban-list-checkbox")),null!=this.backend?this.backend.getSettings((T=this,function(t){if(null==exportObj.settings&&(exportObj.settings=[]),exportObj.settings.initiative_prefix=null!=t.showInitiativeInFrontOfPilotName,null!=t.showInitiativeInFrontOfPilotName&&T.misc_settings_initiative_prefix.prop("checked",!0),exportObj.settings.ban_list=null!=t.enableBanList,null!=t.enableBanList)return T.misc_settings_ban_list.prop("checked",!0)})):(null==this.waiting_for_backend&&(this.waiting_for_backend=[]),this.waiting_for_backend.push((j=this,function(){return j.backend.getSettings(function(t){if(null==exportObj.settings&&(exportObj.settings=[]),exportObj.settings.initiative_prefix=null!=t.showInitiativeInFrontOfPilotName,null!=t.showInitiativeInFrontOfPilotName&&j.misc_settings_initiative_prefix.prop("checked",!0),exportObj.settings.ban_list=null!=t.enableBanList,null!=t.enableBanList)return j.misc_settings_ban_list.prop("checked",!0)})}))),this.misc_settings_initiative_prefix.click((C=this,function(t){if(null==exportObj.settings&&(exportObj.settings=[]),exportObj.settings.initiative_prefix=C.misc_settings_initiative_prefix.prop("checked"),null!=C.backend)return C.misc_settings_initiative_prefix.prop("checked")?C.backend.set("showInitiativeInFrontOfPilotName","1",function(t){return C.misc_settings_infoline.text(C.uitranslation("Changes Saved")),C.misc_settings_infoline.fadeIn(100,function(){return C.misc_settings_infoline.fadeOut(3e3)})}):C.backend.deleteSetting("showInitiativeInFrontOfPilotName",function(t){return C.misc_settings_infoline.text(C.uitranslation("Changes Saved")),C.misc_settings_infoline.fadeIn(100,function(){return C.misc_settings_infoline.fadeOut(3e3)})})})),this.misc_settings_ban_list.click((I=this,function(t){if(null==exportObj.settings&&(exportObj.settings=[]),exportObj.settings.ban_list=I.misc_settings_ban_list.prop("checked"),null!=I.backend)return I.misc_settings_ban_list.prop("checked")?I.backend.set("enableBanList","1",function(t){return I.misc_settings_infoline.text(I.uitranslation("Changes Saved")),I.misc_settings_infoline.fadeIn(100,function(){return I.misc_settings_infoline.fadeOut(3e3)})}):I.backend.deleteSetting("enableBanList",function(t){return I.misc_settings_infoline.text(I.uitranslation("Changes Saved")),I.misc_settings_infoline.fadeIn(100,function(){return I.misc_settings_infoline.fadeOut(3e3)})})})),this.misc_settings.click((L=this,function(t){return t.preventDefault(),L.misc_settings_modal.modal(),L.misc_settings_initiative_prefix.prop("checked",null!=(null!=(t=exportObj.settings)?t.initiative_prefix:void 0)&&exportObj.settings.initiative_prefix)})),exportObj.translateUIElements(this.misc_settings_modal),this.choose_obstacles_modal=$(document.createElement("DIV")),this.choose_obstacles_modal.addClass("modal fade choose-obstacles-modal"),this.choose_obstacles_modal.tabindex="-1",this.choose_obstacles_modal.role="dialog",this.container.append(this.choose_obstacles_modal),this.choose_obstacles_modal.append($.trim('<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n            <label class=\'choose-obstacles-description translated\' defaultText="Choose obstacles dialog"></label>\n        </div>\n        <div class="modal-body row">\n            <div class="obstacle-select-container col-md-12">\n            </div>\n            <div>\n                <div class="obstacle-sources-container">\n                    <span class="info-header obstacle-sources translated" defaultText="Sources:" style="padding-left: 8px;"></span> <br>\n                    <div class="info-data obstacle-sources" style="padding-left: 8px;padding-right:10px;"></div>\n                </div>\n            </div>\n        </div>\n        <div class="modal-footer d-print-none">\n            <button class="btn btn-danger reset-obstacles translated" defaultText="Reset Obstacles"></button>\n            <button class="btn btn-danger close-print-dialog translated" data-dismiss="modal" aria-hidden="true" defaultText="Close"></button>\n        </div>\n    </div>\n</div>')),this.obstacles_reset=this.choose_obstacles_modal.find(".reset-obstacles"),this.obstacles_select=this.choose_obstacles_modal.find(".obstacle-select-container"),this.obstacles_select_sources=this.choose_obstacles_modal.find(".info-data.obstacle-sources"),e=function(t){return"<img class='obstacle' src='"+("images/"+t.id+".png")+"' style='height: 100px;' /></br>"+t.text},this.obstacle_data=[{id:"coreasteroid0",text:"Core Asteroid 1"},{id:"coreasteroid1",text:"Core Asteroid 2"},{id:"coreasteroid2",text:"Core Asteroid 3"},{id:"coreasteroid3",text:"Core Asteroid 4"},{id:"coreasteroid4",text:"Core Asteroid 5"},{id:"coreasteroid5",text:"Core Asteroid 6"},{id:"yt2400debris0",text:"YT2400 Debris 1"},{id:"yt2400debris1",text:"YT2400 Debris 2"},{id:"yt2400debris2",text:"YT2400 Debris 3"},{id:"vt49decimatordebris0",text:"VT49 Debris 1"},{id:"vt49decimatordebris1",text:"VT49 Debris 2"},{id:"vt49decimatordebris2",text:"VT49 Debris 3"},{id:"core2asteroid0",text:"FA Asteroid 1"},{id:"core2asteroid1",text:"FA Asteroid 2"},{id:"core2asteroid2",text:"FA Asteroid 3"},{id:"core2asteroid3",text:"FA Asteroid 4"},{id:"core2asteroid4",text:"FA Asteroid 5"},{id:"core2asteroid5",text:"FA Asteroid 6"},{id:"gascloud1",text:"Gas Cloud 1"},{id:"gascloud2",text:"Gas Cloud 2"},{id:"gascloud3",text:"Gas Cloud 3"},{id:"gascloud4",text:"Gas Cloud 4"},{id:"gascloud5",text:"Gas Cloud 5"},{id:"gascloud6",text:"Gas Cloud 6"},{id:"pomasteroid1",text:"PoM Rock 1"},{id:"pomasteroid2",text:"PoM Rock 2"},{id:"pomasteroid3",text:"PoM Rock 3"},{id:"pomdebris1",text:"PoM Debris 1"},{id:"pomdebris2",text:"PoM Debris 2"},{id:"pomdebris3",text:"PoM Debris 3"}],this.obstacles_select.select2({data:this.obstacle_data,width:"90%",multiple:!0,maximumSelectionSize:3,placeholder:"Select an Obstacle",minimumResultsForSearch:$.isMobile()?-1:0,formatResult:e,formatSelection:e}),$.isMobile()&&(this.obstacles_select.select2.minimumResultsForSearch=-1),this.backend_list_squads_button=$(this.container.find("button.backend-list-my-squads")),this.backend_list_squads_button.click((A=this,function(t){if(t.preventDefault(),null!=A.backend)return A.backend.list(A)})),this.backend_save_list_button=$(this.container.find("button.save-list")),this.backend_save_list_button.click((U=this,function(t){var e,i=__iced_k_noop,n=iced.findDeferral(arguments);if(t.preventDefault(),null==U.backend||U.backend_save_list_button.hasClass("disabled"))return i();t={points:U.total_points,description:U.describeSquad(),cards:U.listCards(),notes:U.notes.val().substr(0,1024),obstacles:U.getObstacles(),tag:U.tag.val().substr(0,1024)},U.backend_status.html($.trim('<i class="fa fa-sync fa-spin"></i>&nbsp;<span class="translated" defaultText="Saving squad..."></span>')),U.backend_status.show(),U.backend_save_list_button.addClass("disabled"),n=new iced.Deferrals(function(){return i(e.success?(U.current_squad.dirty=false,U.current_squad.id!=null?U.backend_status.html($.trim('<i class="fa fa-check"></i>&nbsp;<span class="translated" defaultText="Squad updated successfully."></span>')):(U.backend_status.html($.trim('<i class="fa fa-check"></i>&nbsp;<span class="translated" defaultText="New squad saved successfully."></span>')),U.current_squad.id=e.id),U.container.trigger("xwing-backend:squadDirtinessChanged")):(U.backend_status.html($.trim('<i class="fa fa-exclamation-circle"></i>&nbsp;'+e.error)),U.backend_save_list_button.removeClass("disabled")))},{parent:n}),U.backend.save(U.serialize(),U.current_squad.id,U.current_squad.name,U.faction,t,n.defer({assign_fn:function(){return e=arguments[0]},lineno:3425})),n._fulfill()})),this.backend_save_list_as_button=$(this.container.find("button.save-list-as")),this.backend_save_list_as_button.addClass("disabled"),this.backend_save_list_as_button.click((P=this,function(t){if(t.preventDefault(),null!=P.backend&&!P.backend_save_list_as_button.hasClass("disabled"))return P.backend.showSaveAsModal(P)})),this.backend_delete_list_button=$(this.container.find("button.delete-list")),this.backend_delete_list_button.click((E=this,function(t){if(t.preventDefault(),null!=E.backend&&!E.backend_delete_list_button.hasClass("disabled"))return E.backend.showDeleteModal(E)})),(e=$(document.createElement("DIV"))).addClass("container-fluid"),this.container.append(e),e.append($.trim('<div class="row">\n    <div class="col-md-9 ship-container">\n        <label class="unsortable notes-container show-authenticated col-md-10">\n            <span class="notes-name translated" defaultText="Squad Notes:"></span>\n            <br />\n            <textarea class="squad-notes"></textarea>\n            <br />\n            <span class="tag-name translated" defaultText="Tag:"></span>\n            <input type="search" class="squad-tag"></input>\n        </label>\n        <div class="unsortable obstacles-container">\n                <button class="btn btn-info choose-obstacles"><i class="fa fa-cloud"></i>&nbsp;<span class="translated" defaultText="Choose Obstacles"</span></button>\n        </div>\n    </div>\n    <div class="col-md-3 info-container" id="info-container">\n    </div>\n</div>')),this.ship_container=$(e.find("div.ship-container")),this.info_container=$(e.find("div.info-container")),this.obstacles_container=e.find(".obstacles-container"),this.notes_container=$(e.find(".notes-container")),this.notes=$(this.notes_container.find("textarea.squad-notes")),this.tag=$(this.notes_container.find("input.squad-tag")),this.ship_container.sortable({cancel:".unsortable"}),this.info_container.append($.trim(this.createInfoContainerUI())),this.info_container.find(".info-well").hide(),this.info_intro=this.info_container.find(".intro"),this.print_list_button=$(this.container.find("button.print-list")),this.container.find("[rel=tooltip]").tooltip(),this.obstacles_button=$(this.container.find("button.choose-obstacles")),this.obstacles_button.click((z=this,function(t){return t.preventDefault(),z.showChooseObstaclesModal()})),this.condition_container=$(document.createElement("div")),this.condition_container.addClass("conditions-container d-flex flex-wrap"),this.container.append(this.condition_container),this.mobile_tooltip_modal=$(document.createElement("DIV")),this.mobile_tooltip_modal.addClass("modal fade choose-obstacles-modal d-print-none"),this.mobile_tooltip_modal.tabindex="-1",this.mobile_tooltip_modal.role="dialog",this.container.append(this.mobile_tooltip_modal),this.mobile_tooltip_modal.append($.trim('<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">\n    <div class="modal-content">\n        <div class="modal-header">\n        </div>\n        <div class="modal-body">'+this.createInfoContainerUI(!1)+'        </div>\n        <div class="modal-footer">\n            <button class="btn btn-danger close-print-dialog translated" data-dismiss="modal" aria-hidden="true" defaultText="Close"></button>\n        </div>\n    </div>\n</div>')),this.mobile_tooltip_modal.find("intro").hide(),exportObj.translateUIElements(this.container)},t.prototype.createInfoContainerUI=function(t){return(!0===(t=null==t?!0:t)?'<div class="card intro translated" defaultText="Intro Card YASB">\n</div>':"")+'\n<div class="card info-well">\n    <div class="info-name"></div>\n    <div class="info-type"></div>\n    <span class="info-collection"></span>\n    <div class="row">\n        <div class="col-sm-5">\n            <table class="table-sm">\n                <tbody>\n                    <tr class="info-attack-bullseye">\n                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-bullseyearc"></i></td>\n                        <td class="info-data info-attack"></td>\n                    </tr>\n                    <tr class="info-attack">\n                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-frontarc"></i></td>\n                        <td class="info-data info-attack"></td>\n                    </tr>\n                    <tr class="info-attack-fullfront">\n                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-fullfrontarc"></i></td>\n                        <td class="info-data info-attack"></td>\n                    </tr>\n                    <tr class="info-attack-left">\n                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-leftarc"></i></td>\n                        <td class="info-data info-attack"></td>\n                    </tr>\n                    <tr class="info-attack-right">\n                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-rightarc"></i></td>\n                        <td class="info-data info-attack"></td>\n                    </tr>\n                    <tr class="info-attack-back">\n                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-reararc"></i></td>\n                        <td class="info-data info-attack"></td>\n                    </tr>\n                    <tr class="info-attack-turret">\n                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-singleturretarc"></i></td>\n                        <td class="info-data info-attack"></td>\n                    </tr>\n                    <tr class="info-attack-doubleturret">\n                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-doubleturretarc"></i></td>\n                        <td class="info-data info-attack"></td>\n                    </tr>\n                    <tr class="info-agility">\n                        <td class="info-header"><i class="xwing-miniatures-font header-agility xwing-miniatures-font-agility"></i></td>\n                        <td class="info-data info-agility"></td>\n                    </tr>\n                    <tr class="info-hull">\n                        <td class="info-header"><i class="xwing-miniatures-font header-hull xwing-miniatures-font-hull"></i></td>\n                        <td class="info-data info-hull"></td>\n                    </tr>\n                    <tr class="info-shields">\n                        <td class="info-header"><i class="xwing-miniatures-font header-shield xwing-miniatures-font-shield"></i></td>\n                        <td class="info-data info-shields"></td>\n                    </tr>\n                    <tr class="info-force">\n                        <td class="info-header"><i class="xwing-miniatures-font header-force xwing-miniatures-font-forcecharge"></i></td>\n                        <td class="info-data info-force"></td>\n                    </tr>\n                    <tr class="info-charge">\n                        <td class="info-header"><i class="xwing-miniatures-font header-charge xwing-miniatures-font-charge"></i></td>\n                        <td class="info-data info-charge"></td>\n                    </tr>\n                    <tr class="info-energy">\n                        <td class="info-header"><i class="xwing-miniatures-font header-energy xwing-miniatures-font-energy"></i></td>\n                        <td class="info-data info-energy"></td>\n                    </tr>\n                    <tr class="info-range">\n                        <td class="info-header translated" defaultText="Range"></td>\n                        <td class="info-data info-range"></td><td class="info-rangebonus"><i class="xwing-miniatures-font red header-range xwing-miniatures-font-rangebonusindicator"></i></td>\n                    </tr>\n                </tbody>\n            </table>\n        </div>\n        <div class="col-sm-7">\n            <table class="table-sm">\n                <tbody>\n                    <tr class="info-skill">\n                        <td class="info-header translated" defaultText="Initiative"></td>\n                        <td class="info-data info-skill"></td>\n                    </tr>\n                    <tr class="info-engagement">\n                        <td class="info-header translated" defaultText="Engagement"></td>\n                        <td class="info-data info-engagement"></td>\n                    </tr>\n                    <tr class="info-faction">\n                        <td class="info-header translated" defaultText="Faction"></td>\n                        <td class="info-data"></td>\n                    </tr>\n                    <tr class="info-base">\n                        <td class="info-header translated" defaultText="Base"></td>\n                        <td class="info-data"></td> \n                    </tr>\n                    <tr class="info-points">\n                        <td class="info-header translated" defaultText="Points"></td>\n                        <td class="info-data info-points"></td>\n                    </tr>\n                    <tr class="info-loadout">\n                        <td class="info-header translated" defaultText="Loadout"></td>\n                        <td class="info-data info-loadout"></td>\n                    </tr>\n                </tbody>\n            </table>\n        </div>\n    </div>\n    <table class="table-sm">\n        <tbody>\n            <tr class="info-ship">\n                <td class="info-header translated" defaultText="Ship"></td>\n                <td class="info-data"></td>\n            </tr>\n            <tr class="info-actions">\n                <td class="info-header translated" defaultText="Actions"></td>\n                <td class="info-data"></td>\n            </tr>\n            <tr class="info-upgrades">\n                <td class="info-header translated" defaultText="Upgrades"></td>\n                <td class="info-data"></td>\n            </tr>\n        </tbody>\n    </table>\n    <p class="info-restrictions"></p>\n    <p class="info-text"></p>\n    <p class="info-chassis"></p>\n    <p class="info-maneuvers"></p>\n    <br />\n    <span class="info-header info-sources translated" defaultText="Sources:"></span> \n    <span class="info-data info-sources"></span>\n</div>'},t.prototype.setupEventHandlers=function(){var o,l,i,e,n,a,s,r,d,c,u,h,p,f,m,_,b,g,v,x,k,I,y;return this.container.on("xwing:claimUnique",(d=this,function(t,e,i,n){return d.claimUnique(e,i,n)})).on("xwing:releaseUnique",(r=this,function(t,e,i,n){return r.releaseUnique(e,i,n)})).on("xwing:pointsUpdated",(s=this,function(t,e){return null==e&&(e=$.noop),s.isUpdatingPoints?e():(s.isUpdatingPoints=!0,s.onPointsUpdated(function(){return s.isUpdatingPoints=!1,e()}))})).on("xwing-backend:squadLoadRequested",(a=this,function(t,e,i){return null==i&&(i=$.noop),a.onSquadLoadRequested(e),i()})).on("xwing-backend:squadDirtinessChanged",(n=this,function(t){return n.onSquadDirtinessChanged()})).on("xwing-backend:squadNameChanged",(e=this,function(t){return e.onSquadNameChanged()})).on("xwing:beforeLanguageLoad",(i=this,function(t,e){return null==e&&(e=$.noop),i.pretranslation_serialized=i.serialize(),e()})).on("xwing:afterLanguageLoad",(l=this,function(t,e,i){var n,a,s;if(null==i&&(i=$.noop),l.language!==e){for(l.language=e,e=l.current_squad.dirty,null!=l.pretranslation_serialized.length&&l.loadFromSerialized(l.pretranslation_serialized),n=0,a=(s=l.ships).length;n<a;n++)s[n].updateSelections();l.current_squad.dirty=e,l.pretranslation_serialized=void 0}return i()})).on("xwing:shipUpdated",(o=this,function(t,e){var i,n,a,s,l;for(null==e&&(e=$.noop),i=!0,a=0,s=(l=o.ships).length;a<s;a++)(n=l[a]).updateSelections(),""===n.ship_selector.val()&&(i=!1);if(i&&!o.suppress_automatic_new_ship)return o.addShip()})),$(window).on("xwing-backend:authenticationChanged",(_=this,function(t){return _.resetCurrentSquad()})).on("xwing-collection:created",(m=this,function(t,e){return m.collection=e,m.checkCollection(),m.collection_button.removeClass("d-none")})).on("xwing-collection:changed",(f=this,function(t,e){return f.checkCollection()})).on("xwing-collection:destroyed",(p=this,function(t,e){return p.collection=null,p.collection_button.addClass("d-none")})).on("xwing:pingActiveBuilder",(h=this,function(t,e){if(h.container.is(":visible"))return e(h)})).on("xwing:activateBuilder",(u=this,function(t,e,i){if(e===u.faction)return u.tab.tab("show"),i(u)})).on("xwing:gameTypeChanged",(c=this,function(t,e,i){if(null==i&&(i=$.noop),c.onGameTypeChanged(e,i),c.game_type_selector.val()!==e)return c.game_type_selector.val(e).trigger("change")})),this.ship_container.on("sortstart",(g=this,function(t,e){return g.oldIndex=e.item.index()})).on("sortstop",(b=this,function(t,e){return b.updateShipOrder(b.oldIndex,e.item.index())})),this.obstacles_reset.click((v=this,function(t){if(v.current_obstacles!==[])return v.current_obstacles=[],v.obstacles_select.select2("data",null),v.current_squad.additional_data.obstacles=v.current_obstacles,v.current_squad.dirty=!0,v.container.trigger("xwing-backend:squadDirtinessChanged"),v.container.trigger("xwing:pointsUpdated")})),this.obstacles_select.change((x=this,function(t){return x.current_obstacles=x.obstacles_select.val().split(","),x.current_squad.additional_data.obstacles=x.current_obstacles,x.current_squad.dirty=!0,x.showObstaclesSelectInfo(),x.container.trigger("xwing-backend:squadDirtinessChanged"),x.container.trigger("xwing:pointsUpdated")})),this.view_list_button.click((k=this,function(t){return t.preventDefault(),k.showTextListModal()})),this.print_list_button.click((I=this,function(t){var e,i,n,a,s,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k,y,w,q,O,S,j,T,C;if(t.preventDefault(),I.printable_container.find(".printable-header").html(I.list_modal.find(".modal-header").html()),I.printable_container.find(".printable-body").text(""),"simple"===I.list_display_mode)I.printable_container.find(".printable-body").html(I.simple_container.html());else{for(d=0,p=(w=I.ships).length;d<p;d++)null!=(s=w[d]).pilot&&I.printable_container.find(".printable-body").append(s.toHTML());if(I.list_modal.find(".toggle-horizontal-space").prop("checked")&&I.printable_container.find(".upgrade-container").addClass("wide"),I.printable_container.find(".printable-body").toggleClass("bw",!I.list_modal.find(".toggle-color-print").prop("checked")),I.list_modal.find(".toggle-skip-text-print").prop("checked"))for(c=0,f=(q=I.printable_container.find(".upgrade-text, .fancy-pilot-text")).length;c<f;c++)(l=q[c]).hidden=!0;for(I.list_modal.find(".toggle-maneuver-print").prop("checked")&&I.printable_container.find(".printable-body").append(I.getSquadDialsAsHTML()),e=I.list_modal.find(".toggle-expanded-shield-hull-print").prop("checked"),u=0,m=(O=I.printable_container.find(".expanded-hull-or-shield")).length;u<m;u++)O[u].hidden=!e;for(h=0,_=(S=I.printable_container.find(".simple-hull-or-shield")).length;h<_;h++)S[h].hidden=e;t=function(){switch(this.faction){case"Rebel Alliance":return"rebel";case"Galactic Empire":return"empire";case"Scum and Villainy":return"scum";case"Resistance":return"rebel-outline";case"First Order":return"firstorder";case"Galactic Republic":return"republic";case"Separatist Alliance":return"separatists";case"All":return"first-player-4"}}.call(I),I.list_modal.find(".toggle-color-print").prop("checked")&&I.printable_container.find(".fancy-header").addClass(t),I.list_modal.find(".toggle-color-print").prop("checked")&&I.printable_container.find(".fancy-pilot-header").addClass(t+"-pilot"),I.printable_container.find(".squad-faction").html('<i class="xwing-miniatures-font xwing-miniatures-font-'+t+'"></i>')}if(I.isStandard&&I.printable_container.find(".squad-name").append(' <i class="xwing-miniatures-font xwing-miniatures-font-first-player-1"></i>'),I.isEpic&&I.printable_container.find(".squad-name").append(' <i class="xwing-miniatures-font xwing-miniatures-font-energy"></i>'),I.isBeta&&I.printable_container.find(".squad-name").append(' <i class="xwing-miniatures-font xwing-miniatures-font-point"></i>'),t="09/06/2024",a="AMG",I.isBeta&&(t="BV4",a="XWA"),I.printable_container.find(".fancy-under-header").append($.trim('<div class="version">Points Version: '+a+" - "+t+"</div>")),""!==$.trim(I.notes.val())&&(I.printable_container.find(".printable-body").append($.trim('<h5 class="print-notes translated" defaultText="Notes:"></h5>\n<pre class="print-notes"></pre>')),I.printable_container.find(".printable-body pre.print-notes").text(I.notes.val())),I.printable_container.find(".printable-body").append($.trim('<div class="print-conditions"></div>')),I.printable_container.find(".printable-body .print-conditions").html(I.condition_container.html()),I.list_modal.find(".toggle-obstacles").prop("checked")){for(i="",x=0,b=(n=I.getObstacles()).length;x<b;x++)i+='<img class="obstacle-silhouettes" src="images/'+n[x]+'.png" />';I.printable_container.find(".printable-body").append($.trim('<div class="obstacles">\n    <div>Chosen Obstacles:<br>'+i+"</div>\n</div>"))}for(null!=(a=I.getPermaLinkParams(["sn","obs"]))&&I.list_modal.find(".toggle-juggler-qrcode").prop("checked")&&(I.printable_container.find(".printable-body").append($.trim('<div class="qrcode-container">\n    <div class="permalink-container">\n        <div class="qrcode">YASB Link</div>\n        <div class="qrcode-text translated" defaultText="Scan QR-Code"></div>\n    </div>\n    <div class="xws-container">\n        <div class="qrcode">XWS Data</div>\n        <div class="qrcode-text translated" defaultText="XWS QR-Code"></div>\n    </div>\n</div>')),l=JSON.stringify(I.toXWS()),console.log(""+l),I.printable_container.find(".xws-container .qrcode").qrcode({render:"div",ec:"M",size:l.length<144?144:256,text:l}),l="https://yasb.app/"+a,I.printable_container.find(".permalink-container .qrcode").qrcode({render:"div",ec:"M",size:l.length<144?144:256,text:l})),o="while you perform",k=0,g=(j=I.ships).length;k<g;k++)for(null!=(null!=(T=(s=j[k]).pilot)?T.text:void 0)&&-1<s.pilot.text.match(o)&&s.pilot.name,y=0,v=(C=s.upgrades).length;y<v;y++)null!=(r=C[y]).text&&-1<r.text.match(o)&&r.name;return window.print()})),$(window).resize((y=this,function(){var t,e,i,n,a;for($(window).width()<768&&"simple"!==y.list_display_mode&&y.select_simple_view_button.click(),a=[],e=0,i=(n=y.ships).length;e<i;e++)t=n[e],a.push(t.checkPilotSelectorQueryModal());return a})),this.notes.change(this.onNotesUpdated),this.tag.change(this.onNotesUpdated),this.notes.on("keyup",this.onNotesUpdated),this.tag.on("keyup",this.onNotesUpdated)},t.prototype.getPermaLinkParams=function(t){var e,i,n={};return __indexOf.call(t=null==t?[]:t,"f")<0&&(n.f=encodeURI(this.faction)),__indexOf.call(t,"d")<0&&(n.d=encodeURI(this.serialize())),__indexOf.call(t,"sn")<0&&(n.sn=encodeURIComponent(this.current_squad.name)),__indexOf.call(t,"obs")<0&&(n.obs=encodeURI(this.current_squad.additional_data.obstacles||"")),"?"+(()=>{var t=[];for(e in n)i=n[e],t.push(e+"="+i);return t})().join("&")},t.prototype.getPermaLink=function(t){return null==t&&(t=this.getPermaLinkParams()),""+URL_BASE+t},t.prototype.updateShipOrder=function(t,e){var i=this.ships[t];if(this.ships.splice(t,1),this.ships.splice(e,0,i),this.updatePermaLink,t!==e)return this.current_squad.dirty=!0,this.container.trigger("xwing-backend:squadDirtinessChanged")},t.prototype.updatePermaLink=function(){var t;if(this.container.is(":visible"))return t=this.getPermaLinkParams(),window.location.search!==t?window.history.replaceState(t,"",this.getPermaLink(t)):void 0},t.prototype.onNotesUpdated=function(){if(0<this.total_points)return this.current_squad.dirty=!0,this.container.trigger("xwing-backend:squadDirtinessChanged")},t.prototype.onGameTypeChanged=function(t,e){var i,n;switch(null==e&&(e=$.noop),i=this.isQuickbuild,this.isStandard=!1,this.isBeta=!1,this.isEpic=!1,this.isQuickbuild=!1,this.epic_not_legal_container.toggleClass("d-none",!0),t){case"xwabeta":this.isBeta=!0,this.desired_points_input.val(20);break;case"extended":this.desired_points_input.val(20);break;case"epic":this.isEpic=!0,this.isBeta=!0,this.desired_points_input.val(20),this.epic_not_legal_container.toggleClass("d-none",!1);break;case"quickbuild":this.isQuickbuild=!0,this.desired_points_input.val(8);break;default:this.isStandard=!0,this.desired_points_input.val(20)}return i!==this.isQuickbuild?(n=this.current_squad.id,this.newSquadFromScratch($.trim(this.current_squad.name)),this.current_squad.id=n):(n=this.current_squad.id,this.container.trigger("xwing:pointsUpdated",$.noop),this.container.trigger("xwing:shipUpdated")),e()},t.prototype.addStandardizedToList=function(t){return t.addStandardizedUpgrades()},t.prototype.onPointsUpdated=function(t){var e,i,n,a,s,l,o,r,d,c,u,h,p,f,m;for(null==t&&(t=$.noop),a=r=0,d=!1,n=c=p=this.ships.length-1;p<=-1?c<-1:-1<c;n=p<=-1?++c:--c)(l=this.ships[n]).validate(),l&&(this.addStandardizedToList(l),r+=l.getPoints(),1===l.destroystate?a+=Math.floor(l.getPoints()/2):2===l.destroystate&&(a+=l.getPoints()),o=l.checkUnreleasedContent())&&(d=o);if(this.total_points=r,this.points_destroyed=a,this.total_points_span.text(this.total_points),s=parseInt(this.desired_points_input.val())-this.total_points,parseInt(this.total_points),this.points_remaining_span.text(s),this.points_destroyed_span.html(0!==a?'<i class="xwing-miniatures-font xwing-miniatures-font-hit"></i>'+a:""),this.points_remaining_container.toggleClass("red",s<0),this.unreleased_content_used_container.toggleClass("d-none",!d),s=!1===this.isStandard?"(Extended)":"(Standard)",this.isBeta&&(s="(XWA Beta)"),this.isEpic&&(s="(Epic)"),this.fancy_total_points_container.text("("+this.total_points+") "+s),this.updatePrintAndExportTexts(),this.checkCollection(),"undefined"!=typeof Set&&null!==Set){for(i=new Set,u=0,h=(f=this.ships).length;u<h;u++)(l=f[u]).getConditions().forEach(function(t){return i.add(t)});e=[],i.forEach(function(t){return e.push(t)}),e.sort(function(t,e){return t.name.canonicalize()<e.name.canonicalize()?-1:e.name.canonicalize()>t.name.canonicalize()?1:0}),this.condition_container.text(""),e.forEach((m=this,function(t){return m.condition_container.append(conditionToHTML(t))}))}return t(this.total_points)},t.prototype.onSquadLoadRequested=function(t){var e;return this.current_squad=t,this.backend_delete_list_button.removeClass("disabled"),this.updateObstacleSelect(this.current_squad.additional_data.obstacles),null!=t.serialized.length&&this.loadFromSerialized(t.serialized),this.notes.val(null!=(e=t.additional_data.notes)?e:""),this.tag.val(null!=(e=t.additional_data.tag)?e:""),this.backend_status.fadeOut("slow"),this.current_squad.dirty=!1,this.container.trigger("xwing-backend:squadNameChanged"),this.container.trigger("xwing-backend:squadDirtinessChanged")},t.prototype.onSquadDirtinessChanged=function(){return this.backend_save_list_button.toggleClass("disabled",!(this.current_squad.dirty&&0<this.total_points)),this.backend_save_list_as_button.toggleClass("disabled",0===this.total_points),this.backend_delete_list_button.toggleClass("disabled",null==this.current_squad.id),1<this.ships.length?$('meta[property="og:description"]').attr("content",this.uitranslation("X-Wing Squadron by YASB: ")+this.current_squad.name+": "+this.describeSquad()):$('meta[property="og:description"]').attr("content",this.uitranslation("YASB advertisment"))},t.prototype.onSquadNameChanged=function(){var t=this.current_squad.name.length>SQUAD_DISPLAY_NAME_MAX_LENGTH?this.current_squad.name.substr(0,SQUAD_DISPLAY_NAME_MAX_LENGTH)+"&hellip;":this.current_squad.name;if(this.squad_name_placeholder.text(""),this.squad_name_placeholder.append(t),this.squad_name_input.val(this.current_squad.name),$.getParameterByName("f")===this.faction)return this.current_squad.name!==this.uitranslation("Unnamed Squadron")&&this.current_squad.name!==this.uitranslation("Unsaved Squadron")?document.title!=="YASB - "+this.current_squad.name&&(document.title="YASB - "+this.current_squad.name):document.title="YASB",this.updatePrintAndExportTexts()},t.prototype.updatePrintAndExportTexts=function(){var t,e,i,n,a,s,l,o,r,d,c,u;for(this.fancy_container.text(""),this.simple_container.html('<table class="simple-table"></table>'),a=[],i=[],l=[],o=0,d=(u=this.ships).length;o<d;o++)null!=(n=u[o]).pilot&&(this.fancy_container.append(n.toHTML()),this.simple_container.find("table").append(n.toTableRow()),a.push(n.toSimpleCopy()),i.push(n.toRedditText()),l.push(n.toTTSText()));if(this.reddit_container.find("textarea").val($.trim(i.join("    \n")+"    \n**"+this.uitranslation("Total")+":** *"+this.total_points+"*    \n    \n["+this.uitranslation("View in YASB")+"]("+this.getPermaLink()+")")),this.simplecopy_container.find("textarea").val($.trim(a.join("")+"    \n"+this.uitranslation("Total")+": "+this.total_points+"    \n    \n"+this.uitranslation("View in YASB")+": "+this.getPermaLink())),null!=(e=this.getObstacles())&&0<e.length&&0<l.length){for(l[l.length-1]=l[l.length-1].slice(0,-2),s=" |",r=0,c=e.length;r<c;r++)null!=(t=e[r])&&(s+=" "+t+" /");s=s.slice(0,-1),l.push(s)}return this.tts_textarea.val($.trim(""+l.join(""))),this.xws_textarea.val($.trim(JSON.stringify(this.toXWS()))),$("#xws-qrcode-container").text(""),$("#xws-qrcode-container").qrcode({render:"canvas",text:JSON.stringify(this.toMinimalXWS()),ec:"L",size:128})},t.prototype.removeAllShips=function(){for(;0<this.ships.length;)this.removeShip(this.ships[0]);if(0<this.ships.length)throw new Error(this.uitranslation("Ships not emptied"))},t.prototype.showTextListModal=function(){return this.list_modal.modal("show")},t.prototype.showXWSModal=function(t){return this.select_xws_view(),this.showTextListModal()},t.prototype.showChooseObstaclesModal=function(){return this.obstacles_select.select2("val",this.current_squad.additional_data.obstacles),this.choose_obstacles_modal.modal("show")},t.prototype.showObstaclesSelectInfo=function(){var t,e,i,n,a,s=this.obstacles_select.val().split(",");if(s===[])return this.obstacles_select_sources.html("");for(t="",e=0,i=s.length;e<i;e++)t+="<u>"+(n=s[e])+"</u>: "+(1<(n=null!=(n=null!=(n=exportObj.obstacles[n])?n.sources:void 0)?n:[]).length||(a=exportObj.translate("sources","Loose Ships"),!(0<=__indexOf.call(n,a)))?0<n.length?n.join(", "):exportObj.translate("ui","unreleased"):this.uitranslation("Only available from 1st edition"))+"</br>";return this.obstacles_select_sources.html($.trim(t))},t.prototype.updateObstacleSelect=function(t){return this.current_obstacles=null!=t?t:[],this.obstacles_select.select2("val",t),this.showObstaclesSelectInfo()},t.prototype.serialize=function(){var a;return"v9Z"+function(){switch(this.game_type_selector.val()){case"standard":return"h";case"extended":return"s";case"xwabeta":return"b";case"epic":return"e";case"quickbuild":return"q"}}.call(this)+"Z"+$.trim(this.desired_points_input.val())+"Z"+function(){for(var t=this.ships,e=[],i=0,n=t.length;i<n;i++)null==(a=t[i]).pilot||this.isQuickbuild&&!a.primary||e.push(a.toSerialized());return e}.call(this).join("Y")},t.prototype.changeGameTypeOnSquadLoad=function(t){if(this.game_type_selector.val()!==t)return $(window).trigger("xwing:gameTypeChanged",t)},t.prototype.loadFromSerialized=function(t){var e,i,n,a,s,l,o,r,d,c,u,h,p,f,m;if(this.suppress_automatic_new_ship=!0,this.removeAllShips(),null!=(t=(0<=__indexOf.call(t,"Z")?/^v(\d+)Z(.*)/:/^v(\d+)!(.*)/).exec(t))){if(o=7<(d=parseInt(t[1]))?"Y":";",i=(t=7<d?(e=(f=t[2].split("Z"))[0],s=f[1],f=f[2],[e,parseInt(s),f]):(i=(t=t[2].split("!"))[0],f=t[1],s=parseInt(i.split("=")[1])?parseInt(i.split("=")[1]):20,[e=i.split("=")[0],s,f]))[0],e=t[1],s=t[2],d<9)return this.old_version_container.toggleClass("d-none",!1),this.suppress_automatic_new_ship=!1,void this.addShip();if(null==s)return this.loading_failed_container.toggleClass("d-none",!1),this.suppress_automatic_new_ship=!1,void this.addShip();switch(i){case"s":this.changeGameTypeOnSquadLoad("extended");break;case"h":this.changeGameTypeOnSquadLoad("standard");break;case"b":this.changeGameTypeOnSquadLoad("xwabeta");break;case"e":this.changeGameTypeOnSquadLoad("epic");break;case"q":this.changeGameTypeOnSquadLoad("quickbuild")}if(this.desired_points_input.val(e),this.desired_points_input.change(),r=[],null!=s.length){for(c=0,h=(m=s.split(o)).length;c<h;c++)""===(a=m[c])||(n=this.addShip()).fromSerialized(d,a)&&n.pilot||r.push([n,a]);for(u=0,p=r.length;u<p;u++)(l=r[u])[0].pilot||(l[0]=this.addShip()),l[0].fromSerialized(d,l[1])}}return this.suppress_automatic_new_ship=!1,this.addShip()},t.prototype.select_xws_view=function(){if(this.select_xws_view_button.blur(),"xws"!==this.list_display_mode)return this.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),this.select_xws_view_button.addClass("btn-inverse"),this.list_display_mode="xws",this.xws_container.show(),this.simple_container.hide(),this.simplecopy_container.hide(),this.reddit_container.hide(),this.fancy_container.hide(),this.tts_container.hide(),this.xws_textarea.select(),this.xws_textarea.focus(),this.toggle_vertical_space_container.hide(),this.toggle_color_print_container.hide(),this.toggle_color_skip_text.hide(),this.toggle_maneuver_dial_container.hide(),this.toggle_expanded_shield_hull_container.hide(),this.toggle_qrcode_container.hide(),this.toggle_obstacle_container.hide(),this.btn_print_list.disabled=!0},t.prototype.uniqueIndex=function(t,e){if(e in this.uniques_in_use)return this.uniques_in_use[e].indexOf(t);throw new Error("Invalid unique type '"+e+"'")},t.prototype.claimUnique=function(t,e,i){var n,a,s,l,o,r,d;if(!(this.uniqueIndex(t,e)<0))throw new Error("Unique "+e+" '"+t.name+"' already claimed");for(a=0,l=(r=exportObj.pilotsByUniqueName[t.canonical_name.getXWSBaseName()]||[]).length;a<l;a++)if(t!==(n=r[a])){if(!(this.uniqueIndex(n,"Pilot")<0))throw new Error("Unique "+e+" '"+t.name+"' already claimed as pilot");this.uniques_in_use.Pilot.push(n)}for(s=0,o=(d=exportObj.upgradesByUniqueName[t.canonical_name.getXWSBaseName()]||[]).length;s<o;s++){if(n=d[s],!(this.uniqueIndex(n,"Upgrade")<0))throw new Error("Unique "+e+" '"+n.name+"' already claimed as pilot");this.uniques_in_use.Upgrade.push(n)}return null!=t.solitary&&this.uniques_in_use.Slot.push(t.slot),this.uniques_in_use[e].push(t),i()},t.prototype.releaseUnique=function(t,e,i){var n,a,s,l,o,r,d;if(!(0<=this.uniqueIndex(t,e)))throw new Error("Unique "+e+" '"+t.name+"' not in use");for(e in d=this.uniques_in_use)if(a=d[e],"Slot"===e){if(null!=t.solitary)for(this.uniques_in_use[e]=[],s=0,o=a.length;s<o;s++)(n=a[s])!==t.slot&&this.uniques_in_use[e].push(n.slot)}else for(this.uniques_in_use[e]=[],l=0,r=a.length;l<r;l++)(n=a[l]).canonical_name.getXWSBaseName()!==t.canonical_name.getXWSBaseName()&&this.uniques_in_use[e].push(n);return i()},t.prototype.addShip=function(){var t=new Ship({builder:this,container:this.ship_container});return this.ships.push(t),this.ship_number_invalid_container.toggleClass("d-none",this.ships.length<10&&3<this.ships.length),this.multi_faction_warning_container.toggleClass("d-none","All"!==this.faction),t},t.prototype.removeShip=function(t,e){__iced_k_noop;var i,n,a=iced.findDeferral(arguments),s=(null==e&&(e=$.noop),n=this,function(){return e()});null==(null!=t?t.destroy:void 0)?s():(i=new iced.Deferrals(function(){var t=function(){n.current_squad.dirty=true;n.container.trigger("xwing-backend:squadDirtinessChanged");n.ship_number_invalid_container.toggleClass("d-none",n.ships.length<10&&n.ships.length>3);return s(n.multi_faction_warning_container.toggleClass("d-none",n.faction!=="All"))};i=new iced.Deferrals(t,{parent:a,funcname:"SquadBuilder.removeShip"}),n.container.trigger("xwing:pointsUpdated",i.defer({lineno:4359})),i._fulfill()},{parent:a,funcname:"SquadBuilder.removeShip"}),t.destroy(i.defer({lineno:4358})),i._fulfill())},t.prototype.matcher=function(t,e){return 0<=t.toUpperCase().indexOf(e.toUpperCase())},t.prototype.isOurFaction=function(t,e){var i,n,a,s;if(null==e&&(e=""),i=this.faction,"All"===this.faction){if(""===e)return!0;i=e}if(t instanceof Array){for(a=0,s=t.length;a<s;a++)if(n=t[a],getPrimaryFaction(n)===i)return!0;return!1}return getPrimaryFaction(t)===i},t.prototype.isItemAvailable=function(t,e){var i;return null==e&&(e=!1),!!this.isQuickbuild||(this.isStandard?exportObj.standardCheck(t,this.faction,e):this.isEpic?!(null!=(null!=(i=exportObj.settings)?i.ban_list:void 0)&&exportObj.settings.ban_list&&!exportObj.standardCheck(t,this.faction,e,!0)):!(null!=(null!=(i=exportObj.settings)?i.ban_list:void 0)&&exportObj.settings.ban_list&&!exportObj.standardCheck(t,this.faction,e,!0))&&exportObj.epicExclusions(t))},t.prototype.getAvailableShipsMatching=function(t,e,i){var n,a,s,l;for(a in null==t&&(t=""),null==e&&(e=!0),null==i&&(i=!1),s=[],l=exportObj.ships)n=l[a],this.isOurFaction(n.factions)&&(this.matcher(n.name,t)||n.display_name&&this.matcher(n.display_name,t))&&this.isItemAvailable(n,!0)&&(!i||null!=this.collection&&"true"===this.collection.checks.collectioncheck&&this.collection.checkShelf("ship",n.name))&&s.push({id:n.name,text:n.display_name||n.name,chassis:n.chassis,name:n.name,display_name:n.display_name,canonical_name:n.canonical_name,xws:n.name.canonicalize(),icon:n.icon||n.name.canonicalize()});return e&&s.sort(exportObj.sortHelper),s},t.prototype.getAvailableShipsMatchingAndCheapEnough=function(t,e,i,n){for(var a,s,l,o=[],r=0,d=(s=this.getAvailableShipsMatching(e=null==e?"":e,i=null==i?!1:i,n=null==n?!1:n)).length;r<d;r++)l=s[r],(a=this.getAvailablePilotsForShipIncluding(l.name,null,"",!0)).length&&a[0].points<=t&&o.push(l);return o},t.prototype.getAvailablePilotsForShipIncluding=function(i,e,n,t,l){var o,a,s,r,d,c,u,h,p,f,m,_,b,g,v,x,k,y,w,q,O,S,$,j,T;if(null==n&&(n=""),null==t&&(t=!0),null==l&&(l=null),_=[],this.isQuickbuild){if(m=function(){var t=exportObj.quickbuildsById,e=[];for(r in t)f=t[r],(null==i||f.ship===i)&&this.isOurFaction(f.faction)&&(this.matcher(f.pilot,n)||null!=exportObj.pilots[f.pilot].display_name&&this.matcher(exportObj.pilots[f.pilot].display_name,n))&&e.push(f);return e}.call(this),b=[],null!=e&&-1!==e){if(d=exportObj.quickbuildsById[e],null!=($=exportObj.pilots[d.pilot]).unique)for(b.push($),x=0,w=(S=exportObj.pilotsByUniqueName[$.canonical_name.getXWSBaseName()]||[]).length;x<w;x++)null!=(u=S[x])&&b.push(u);for(k=0,q=(j=null!=($=d.upgrades)?$:[]).length;k<q;k++){if(c=j[k],null!=(c=exportObj.upgrades[c]).unique)for(b.push(u),y=0,O=(T=exportObj.pilotsByUniqueName[c.canonical_name.getXWSBaseName()]||[]).length;y<O;y++)null!=(u=T[y])&&b.push(u);null!=c.solitary&&b.push(c.slot)}}o=[],function(){var t,e=[];for(r in m)f=m[r],null!=(null!=(t=exportObj.pilots[f.pilot])?t.unique:void 0)&&(t=exportObj.pilots[f.pilot],0<=__indexOf.call(this.uniques_in_use.Pilot,t))&&(t=exportObj.pilots[f.pilot],!(0<=__indexOf.call(b,t)))||null!=(null!=(t=exportObj.pilots[f.pilot])?t.max_per_squad:void 0)&&this.countPilots(exportObj.pilots[f.pilot].canonical_name)>=exportObj.pilots[f.pilot].max_per_squad&&(t=exportObj.pilots[f.pilot],!(0<=__indexOf.call(b,t)))?o.push(f.id):e.push(null!=f.upgrades?function(){for(var t,e,i=f.upgrades,n=[],a=0,s=i.length;a<s;a++)if(g=i[a],null==(v=exportObj.upgrades[g]))console.log("There was an Issue including the upgrade "+g+" in some quickbuild. Please report that Issue!");else{if(null!=v.unique&&0<=__indexOf.call(this.uniques_in_use.Upgrade,v)&&!(0<=__indexOf.call(b,v))&&(null===l||!(0<=__indexOf.call(exportObj.quickbuildsById[l.quickbuildId].upgrades,g)||l.linkedShip&&0<=__indexOf.call(null!=(t=exportObj.quickbuildsById[null!=(t=l.linkedShip)?t.quickbuildId:void 0].upgrades)?t:[],g)))){o.push(f.id);break}if(null!=v.solitary&&(t=v.slot,0<=__indexOf.call(this.uniques_in_use.Slot,t))&&(e=v.slot,!(0<=__indexOf.call(b,e)))){o.push(f.id);break}n.push(void 0)}return n}.call(this):void 0);return e}.call(this),_=(()=>{for(var t,e=[],i=0,n=m.length;i<n;i++)f=m[i],e.push({id:f.id,text:(null!=(null!=(t=exportObj.settings)?t.initiative_prefix:void 0)&&exportObj.settings.initiative_prefix?exportObj.pilots[f.pilot].skill+" - ":"")+(exportObj.pilots[f.pilot].display_name||f.pilot)+f.suffix+" ("+f.threat+")",points:f.threat,ship:f.ship,disabled:(t=f.id,0<=__indexOf.call(o,t))});return e})()}else a=function(){var t=exportObj.pilots,e=[];for(p in t)h=t[p],(null==i||h.ship===i)&&this.isOurFaction(h.faction)&&(this.matcher(p,n)||h.display_name&&this.matcher(h.display_name,n))&&this.isItemAvailable(h,!0)&&e.push(h);return e}.call(this),s=function(){var t=[];for(p in a)(null==(h=a[p]).unique||__indexOf.call(this.uniques_in_use.Pilot,h)<0||h.canonical_name.getXWSBaseName()===(null!=e?e.canonical_name.getXWSBaseName():void 0))&&(null==h.max_per_squad||this.countPilots(h.canonical_name)<h.max_per_squad||h.canonical_name.getXWSBaseName()===(null!=e?e.canonical_name.getXWSBaseName():void 0))&&(null==h.upgrades||this.standard_restriction_check(h,e))&&(null==h.restriction_func||h.restriction_func({builder:this},h))&&t.push(h);return t}.call(this),null!=e&&null!=e.unique&&(this.matcher(e.name,n)||e.display_name&&this.matcher(e.display_name,n))&&s.push(e),_=function(){for(var t,e=[],i=0,n=a.length;i<n;i++)h=a[i],e.push({id:h.id,text:(null!=(null!=(t=exportObj.settings)?t.initiative_prefix:void 0)&&exportObj.settings.initiative_prefix?h.skill+" - ":"")+(h.display_name||h.name)+" ("+(this.isBeta&&null!=h.pointsbeta?h.pointsbeta:h.points)+(null!=h.loadout?this.isBeta&&null!=h.loadoutbeta?"/"+h.loadoutbeta:"/"+h.loadout:"")+")",points:this.isBeta&&null!=h.pointsbeta?h.pointsbeta:h.points,ship:h.ship,name:h.name,display_name:h.display_name,disabled:__indexOf.call(s,h)<0});return e}.call(this);return _=t?_.sort(exportObj.sortHelper):_},t.prototype.standard_restriction_check=function(t,e){var i,n,a,s,l,o,r,d,c,u,h,p,f,m;if(null!=t.upgrades)for(s=0,r=(u=t.upgrades).length;s<r;s++)if(n=u[s],null!=(a=exportObj.upgrades[n]).unique)for(l=0,d=(h=this.ships).length;l<d;l++)if(null==(null!=(p=(i=h[l]).pilot)?p.name:void 0)||null==(null!=e?e.name:void 0)||i.pilot.name!==e.name)for(o=0,c=(f=i.upgrades).length;o<c;o++)if((null!=(m=f[o])&&null!=(m=m.data)?m.canonical_name:void 0)===a.canonical_name)return!1;return!0},t.prototype.countUpgrades=function(t){for(var e,i,n,a,s,l,o=0,r=this.ships,d=0,c=r.length;d<c;d++)if(null==(null!=(a=(e=r[d]).pilot)?a.upgrades:void 0))for(i=0,n=(s=e.upgrades).length;i<n;i++)(null!=(l=s[i])&&null!=(l=l.data)?l.canonical_name:void 0)===t&&o++;return o},t.prototype.countPilots=function(t){for(var e,i=0,n=this.ships,a=0,s=n.length;a<s;a++)(null!=(e=n[a])&&null!=(e=e.pilot)?e.canonical_name.getXWSBaseName():void 0)===t.getXWSBaseName()&&i++;return i},t.prototype.isShip=function(t,e){var i,n;if(t instanceof Array){for(i=0,n=t.length;i<n;i++)if(t[i]===e)return!0;return!1}return t===e},t.prototype.getAvailableUpgradesIncluding=function(i,n,a,s,l,o,t){var r,d,e,c,u,h,p,f,m,_,b,g,v,x;for(null==l&&(l=""),null==o&&(o=this.dfl_filter_func),null==t&&(t=!0),f=(()=>{for(var t=a.upgrades,e=[],i=0,n=t.length;i<n;i++)h=t[i],e.push(h.data);return e})(),r=function(){var t=exportObj.upgrades,e=[];for(p in t)h=t[p],exportObj.slotsMatching(h.slot,i)&&(this.matcher(p,l)||h.display_name&&this.matcher(h.display_name,l))&&(null==h.ship||this.isShip(h.ship,a.data.name))&&(null==h.faction||this.isOurFaction(h.faction,a.pilot.faction))&&this.isItemAvailable(h)&&null==h.standard&&e.push(h);return e}.call(this),o!==this.dfl_filter_func&&(r=(()=>{for(var t=[],e=0,i=r.length;e<i;e++)h=r[e],o(h)&&t.push(h);return t})()),c=a.upgrade_points_total-s.getPoints(n),d=function(){var t,e=[];for(p in r)h=r[p],__indexOf.call(this.uniques_in_use.Upgrade,h)<0&&a.standardized_check(h)&&a.restriction_check(a.builder.isBeta&&null!=h.restrictionsbeta?h.restrictionsbeta:h.restrictions||void 0,s,s.getPoints(h),c,h)&&__indexOf.call(f,h)<0&&(null==h.max_per_squad||a.builder.countUpgrades(h.canonical_name)<h.max_per_squad)&&(null==h.solitary||(t=h.slot,__indexOf.call(this.uniques_in_use.Slot,t)<0)||null!=(null!=n?n.solitary:void 0))&&e.push(h);return e}.call(this),m=0,b=(v=(()=>{for(var t=a.upgrades,e=[],i=0,n=t.length;i<n;i++)null!=(null!=(h=t[i])?h.data:void 0)&&e.push(h.data);return e})()).length;m<b;m++)e=v[m],d.removeItem(e);if(null!=n&&(this.matcher(n.name,l)||n.display_name&&this.matcher(n.display_name,l))&&d.push(n),u=(()=>{for(var t=[],e=0,i=r.length;e<i;e++)h=r[e],t.push({id:h.id,text:(h.display_name||h.name)+" ("+s.getPoints(h)+(h.variablepoints?"*":"")+")",points:s.getPoints(h),name:h.name,display_name:h.display_name,disabled:__indexOf.call(d,h)<0});return t})(),t&&(u=u.sort(exportObj.sortHelper)),"function"==typeof s&&s("undefined"!=typeof adjustment_func&&null!==adjustment_func)){for(x=[],_=0,g=u.length;_<g;_++)h=u[_],x.push(s.adjustment_func(h));return x}return u},t.prototype.getSquadDialsAsHTML=function(){for(var t,e,i,n,a="",s={},l=this.ships,o=0,r=l.length;o<r;o++)null!=(i=l[o]).pilot&&(e=i.data.maneuvers,t=i.effectiveStats().maneuvers,null!=s[i.data.name]&&(n=t.toString(),0<=__indexOf.call(s[i.data.name],n))||(s[i.data.name]=(null!=(n=s[i.data.name])?n:[]).concat([t.toString()]),a+='<div class="fancy-dial"><h4 class="ship-name-dial">'+(null!=i.data.display_name?i.data.display_name:i.data.name)+(t.toString()!==e.toString()?" ("+this.uitranslation("modified")+")":"")+"</h4>"+this.getManeuverTableHTML(t,e)+"</div>"));return'<div class="print-dials-container">\n    '+a+"\n</div>"},t.prototype.getManeuverTableHTML=function(i,t){var e,n,a,s,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k,y,w,q,O,S,j,T,C;if(null==i||0===i.length)return this.uitranslation("Missing maneuver info.");for(a=function(){C=[];for(var t=0,e=i[0].length;0<=e?t<e:e<t;0<=e?t++:t--)C.push(t);return C}.apply(this),g=0,k=i.length;g<k;g++)for(e=v=0,y=(n=i[g]).length;v<y;e=++v)0<n[e]&&a.removeItem(e);for(h="<table><tbody>",f=x=S=i.length-1;S<=0?x<=0:0<=x;f=S<=0?++x:--x){for(o=!1,q=0,w=(j=i[f]).length;q<w;q++)if(0<j[q]){o=!0;break}if(o){for(h+="<tr><td>"+f+"</td>",b=O=0,T=i[f].length;0<=T?O<T:T<O;b=0<=T?++O:--O)if(!(0<=__indexOf.call(a,b))){if(h+="<td>",0<i[f][b]){if(l=(()=>{switch(i[f][b]){case 1:return"dodgerblue";case 2:return"white";case 3:return"red";case 4:return"purple"}})(),c=(()=>{switch(i[f][b]){case 1:return"svg-blue-maneuver";case 2:return"svg-white-maneuver";case 3:return"svg-red-maneuver";case 4:return"svg-purple-maneuver"}})(),h+='<svg xmlns="http://www.w3.org/2000/svg" width="30px" height="30px" viewBox="0 0 200 200">',p="black",u="svg-base-maneuver",i[f][b]!==t[f][b]&&(p="DarkSlateGrey",u="svg-modified-maneuver"),0===f&&2===b)h+='<rect class="svg-maneuver-stop '+c+" "+u+'" x="50" y="50" width="100" height="100" style="fill:'+l+"; stroke-width:5; stroke:"+p+'" />';else{switch(s=m="",b){case 0:d="M160,180 L160,70 80,70",r="M160,175 L160,70 70,70",_="M80,100 V40 L30,70 Z";break;case 1:d="M150,180 S150,120 80,60",r="M150,175 S150,120 80,60",_="M80,100 V40 L30,70 Z",m="transform='translate(-5 -15) rotate(45 70 90)' ";break;case 2:d="M100,180 L100,100 100,80",r="M100,175 L100,120 100,70",_="M70,80 H130 L100,30 Z";break;case 3:d="M50,180 S50,120 120,60",r="M50,175 S50,120 120,60",_="M120,100 V40 L170,70 Z",m="transform='translate(5 -15) rotate(-45 130 90)' ";break;case 4:d="M40,180 L40,70 120,70",r="M40,175 L40,70 130,70",_="M120,100 V40 L170,70 Z";break;case 5:d="M50,180 L50,100 C50,10 140,10 140,100 L140,120",r="M50,175 L50,100 C50,10 140,10 140,100 L140,130",_="M170,120 H110 L140,180 Z";break;case 6:d="M150,180 S150,120 80,60",r="M150,175 S150,120 85,65",_="M80,100 V40 L30,70 Z",m="transform='translate(0 50)'";break;case 7:d="M50,180 S50,120 120,60",r="M50,175 S50,120 115,65",_="M120,100 V40 L170,70 Z",m="transform='translate(0 50)'";break;case 8:d="M160,180 L160,70 80,70",r="M160,175 L160,70 85,70",_="M60,100 H100 L80,140 Z";break;case 9:d="M40,180 L40,70 120,70",r="M40,175 L40,70 115,70",_="M100,100 H140 L120,140 Z";break;case 10:d="M50,180 S50,120 120,60",r="M50,175 S50,120 120,60",_="M120,100 V40 L170,70 Z",m="transform='translate(5 -15) rotate(-45 130 90)' ",s="backwards";break;case 11:d="M100,180 L100,100 100,80",r="M100,175 L100,100 100,70",_="M70,80 H130 L100,30 Z",s="backwards";break;case 12:d="M150,180 S150,120 80,60",r="M150,175 S150,120 80,60",_="M80,100 V40 L30,70 Z",m="transform='translate(-5 -15) rotate(45 70 90)' ",s="backwards"}h+=$.trim('<g class="maneuver '+s+"\">\n  <path class = 'svg-maneuver-outer "+c+" "+u+"' stroke-width='25' fill='none' stroke='"+p+"' d='"+d+"' />\n  <path class = 'svg-maneuver-triangle "+c+" "+u+"' d='"+_+"' fill='"+l+"' stroke-width='5' stroke='"+p+"' "+m+"/>\n  <path class = 'svg-maneuver-inner "+c+" "+u+"' stroke-width='15' fill='none' stroke='"+l+"' d='"+r+"' />\n</g>")}h+="</svg>"}h+="</td>"}h+="</tr>"}}return h+="</tbody></table>"},t.prototype.formatActions=function(t,e,i){var n,a,s,l,o,r;for(null==i&&(i=[]),a=[],o=0,r=t.length;o<r;o++)n=t[o],s="",l=e,-1!==(n=0<=__indexOf.call(i,"Droid")?n.replace("Focus","Calculate"):n).search("> ")&&(n=n.replace(/> /gi,""),l=' <i class="xwing-miniatures-font xwing-miniatures-font-linked"></i> '),-1!==n.search("F-")&&(s="force ",n=n.replace(/F-/gi,"")),-1!==n.search("W-")?(l="White ",n=n.replace(/W-/gi,"")):-1!==n.search("R-")&&(s="red ",n=n.replace(/R-/gi,"")),n=n.toLowerCase().replace(/[^0-9a-z]/gi,""),a.push(l+'<i class="xwing-miniatures-font '+s+"xwing-miniatures-font-"+n+'"></i>');return a.join("").replace(e,"")},t.prototype.listStandardUpgrades=function(t){for(var e="",i=0,n=t.length;i<n;i++)e+=", "+t[i].split(" (")[0];return e.substr(2)},t.prototype.getPilotsMatchingUpgrade=function(t,e){var i,n,a,s,l,o,r,d;for(n in null==t&&(t=""),null==e&&(e=!0),a=[],r=exportObj.pilots)if(null!=(i=r[n]).upgrades)for(l=0,o=(d=i.upgrades).length;l<o;l++)s=d[l],this.matcher(s,t)&&a.push({id:i.name,name:i.name,display_name:i.display_name,chassis:i.chassis,canonical_name:i.canonical_name,xws:i.name.canonicalize(),icon:i.icon||i.name.canonicalize()});return e&&a.sort(exportObj.sortHelper),a},t.prototype.showTooltip=function(t,s,e,i,n){var a,l,B,o,D,r,d,c,z,u,M,h,N,p,f,m,_,b,g,v,x,k,y,w,q,O,S,j,T,R,F,W,G,C,I,X,H,Q,V,L,A,U,P,E,Y,Z;if(null==i&&(i=this.info_container),null==n&&(n=!1),s!==this.tooltip_currently_displaying||n){switch(t){case"Ship":for(k in b=[],_=[],g=[],y={},exportObj.upgradesBySlotCanonicalName)y[k]=-1;for(N in X=exportObj.pilots)if((p=X[N]).ship===s.name&&this.isOurFaction(p.faction)&&(H=p.skill,0<=__indexOf.call(b,H)||b.push(p.skill),this.isBeta&&null!=p.pointsbeta?_.push(p.pointsbeta):_.push(p.points),this.isBeta&&null!=p.loadoutbeta?g.push(p.loadoutbeta):null!=p.loadout&&g.push(p.loadout),null!=p.slots))for(k in y)switch(q=y[k],p.slots.filter(function(t){return t===k}).length){case 1:switch(q){case-1:y[k]=1;break;case 0:y[k]=2;break;case 3:y[k]=4}break;case 0:switch(q){case-1:y[k]=0;break;case 1:y[k]=2;break;case 3:case 4:y[k]=5}break;case 2:switch(q){case-1:y[k]=3;break;case 0:case 2:y[k]=5;break;case 1:y[k]=4}break;case 3:y[k]=6}for(b.sort(),i.find(".info-type").text(exportObj.translate("types",t)),i.find(".info-name").html(""+(s.display_name||s.name)+(exportObj.isReleased(s)?"":" ("+this.uitranslation("unreleased")+")")),null!=(null!=(E=this.collection)?E.counts:void 0)?(L=null!=(E=null!=(E=this.collection.counts)&&null!=(E=E.ship)?E[s.name]:void 0)?E:0,i.find(".info-collection").text(this.uitranslation("collectionContentShips",L)),i.find(".info-collection").show()):i.find(".info-collection").hide(),r=!0,z=String(b[0]),j=0,R=b.length;j<R;j++)c=b[j],r||(z+=", "+c),r=!1;for(i.find("tr.info-skill td.info-data").text(z),i.find("tr.info-skill").toggle(void 0!==c),E=Math.min.apply(Math,_)+" - "+Math.max.apply(Math,_),i.find("tr.info-points td.info-data").text(E),E=Math.min.apply(Math,g)+" - "+Math.max.apply(Math,g),i.find("tr.info-loadout td.info-data").text(E),i.find("tr.info-points").toggle(0<_.length),i.find("tr.info-loadout").toggle(0<g.length),i.find("tr.info-engagement").hide(),i.find("tr.info-attack td.info-data").text(s.attack),i.find("tr.info-attack-bullseye td.info-data").text(s.attackbull),i.find("tr.info-attack-fullfront td.info-data").text(s.attackf),i.find("tr.info-attack-left td.info-data").text(s.attackl),i.find("tr.info-attack-right td.info-data").text(s.attackr),i.find("tr.info-attack-back td.info-data").text(s.attackb),i.find("tr.info-attack-turret td.info-data").text(s.attackt),i.find("tr.info-attack-doubleturret td.info-data").text(s.attackdt),i.find("tr.info-attack").toggle(null!=s.attack),i.find("tr.info-attack-bullseye").toggle(null!=s.attackbull),i.find("tr.info-attack-fullfront").toggle(null!=s.attackf),i.find("tr.info-attack-left").toggle(null!=s.attackl),i.find("tr.info-attack-right").toggle(null!=s.attackr),i.find("tr.info-attack-back").toggle(null!=s.attackb),i.find("tr.info-attack-turret").toggle(null!=s.attackt),i.find("tr.info-attack-doubleturret").toggle(null!=s.attackdt),i.find("tr.info-ship").hide(),null!=s.base?i.find("tr.info-base td.info-data").text(exportObj.translate("gameterms",s.base)):i.find("tr.info-base td.info-data").text(exportObj.translate("gameterms","Small")),i.find("tr.info-base").show(),i.find("tr.info-faction td.info-data").text([(()=>{for(var t=s.factions,e=[],i=0,n=t.length;i<n;i++)D=t[i],e.push(exportObj.translate("faction",D));return e})()]),i.find("tr.info-faction").hide(),i.find("p.info-restrictions").hide(),T=0,F=(Q=i.find("tr.info-attack td.info-header i.xwing-miniatures-font")[0].classList).length;T<F;T++)(B=Q[T]).startsWith("xwing-miniatures-font-attack")&&i.find("tr.info-attack td.info-header i.xwing-miniatures-font").removeClass(B);if(i.find("tr.info-attack td.info-header i.xwing-miniatures-font").addClass(null!=(E=s.attack_icon)?E:"xwing-miniatures-font-attack"),i.find("tr.info-range").hide(),i.find("tr.info-agility td.info-data").text(s.agility),i.find("tr.info-agility").toggle(null!=s.agility),i.find("tr.info-hull td.info-data").text(s.hull),i.find("tr.info-hull").toggle(null!=s.hull),v="",null!=s.shieldrecurr)for(o=0;o<s.shieldrecurr;)v+='<sup><i class="fas fa-caret-up"></i></sup>',++o;if(i.find("tr.info-shields td.info-data").html(s.shields+v),i.find("tr.info-shields").toggle(null!=s.shields),v="",null!=s.energyrecurr)for(o=0;o<s.energyrecurr;)v+='<sup><i class="fas fa-caret-up"></i></sup>',++o;i.find("tr.info-energy td.info-data").html(s.energy+v),i.find("tr.info-energy").toggle(null!=s.energy),i.find("tr.info-force").hide(),i.find("tr.info-charge").hide(),i.find("tr.info-actions td.info-data").html(this.formatActions(s.actions,", ",null!=(E=s.keyword)?E:[])),i.find("tr.info-actions").show(),i.find("tr.info-upgrades").show(),i.find("tr.info-upgrades td.info-data").html((()=>{var t=[];for(k in y)q=y[k],t.push(1===q?exportObj.translate("sloticon",k):2===q?"("+exportObj.translate("sloticon",k)+")":3===q?exportObj.translate("sloticon",k)+exportObj.translate("sloticon",k):4===q?exportObj.translate("sloticon",k)+"("+exportObj.translate("sloticon",k)+")":5===q?"("+exportObj.translate("sloticon",k)+exportObj.translate("sloticon",k)+")":6===q?exportObj.translate("sloticon",k)+exportObj.translate("sloticon",k)+exportObj.translate("sloticon",k):void 0);return t})().join(" ")||"None"),i.find("p.info-text").hide(),i.find("p.info-chassis").show(),i.find("p.info-chassis").html(null!=s.chassis?"<strong>"+(null!=(E=null!=(E=exportObj.chassis[s.chassis])?E.display_name:void 0)?E:s.chassis)+":</strong> "+exportObj.chassis[s.chassis].text:""),i.find("p.info-maneuvers").show(),i.find("p.info-maneuvers").html(this.getManeuverTableHTML(s.maneuvers,s.maneuvers)),E=(()=>{for(var t=s.sources,e=[],i=0,n=t.length;i<n;i++)w=t[i],e.push(exportObj.translate("sources",w));return e})().sort(),i.find(".info-sources.info-data").text(1<E.length||(P=exportObj.translate("sources","Loose Ships"),!(0<=__indexOf.call(E,P)))?0<E.length?E.join(", "):exportObj.translate("ui","unreleased"):this.uitranslation("Only available from 1st edition")),i.find(".info-sources").show();break;case"Pilot":if(i.find(".info-type").text(exportObj.translate("types",t)),i.find(".info-sources.info-data").text((()=>{for(var t=s.sources,e=[],i=0,n=t.length;i<n;i++)w=t[i],e.push(exportObj.translate("sources",w));return e})().sort().join(", ")),i.find(".info-sources").show(),null!=(null!=(P=this.collection)?P.counts:void 0)?(P=null!=(E=null!=(E=this.collection.counts)&&null!=(P=E.pilot)?P[s.name]:void 0)?E:0,L=null!=(E=null!=(E=this.collection.counts.ship)?E[s.ship]:void 0)?E:0,i.find(".info-collection").text(this.uitranslation("collectionContentShipsAndPilots",L,P)),i.find(".info-collection").show()):i.find(".info-collection").hide(),null!=(null!=e?e.effectiveStats:void 0)&&(U=e.effectiveStats()),null!=s.unique)O="&middot;&nbsp;";else if(null!=s.max_per_squad){for(o=0,O="";o<s.max_per_squad;)O=O.concat("&middot;"),++o;O=O.concat("&nbsp;")}else O="";if(i.find(".info-name").html(""+O+(s.display_name||s.name)+(exportObj.isReleased(s)?"":" ("+exportObj.translate("ui","unreleased")+")")),""!==(A=this.restriction_text(s)+this.upgrade_effect(s))&&"Conversion"!==s.ship?(i.find("p.info-restrictions").html(A),i.find("p.info-restrictions").show()):i.find("p.info-restrictions").hide(),i.find("p.info-text").html(null!=(E=s.text)?E:""),i.find("p.info-text").show(),x=exportObj.ships[s.ship],""!==(L=null!=(null!=U?U.chassis:void 0)&&""!==U.chassis?U.chassis:null!=s.chassis?s.chassis:null!=x.chassis?x.chassis:"")?(i.find("p.info-chassis").html("<strong>"+(null!=(E=null!=(P=exportObj.chassis[L])?P.display_name:void 0)?E:L)+":</strong> "+exportObj.chassis[L].text),i.find("p.info-chassis").show()):i.find("p.info-chassis").hide(),i.find("tr.info-ship td.info-data").text(s.ship),i.find("tr.info-ship").show(),i.find("tr.info-faction td.info-data").text(exportObj.translate("faction",s.faction)),i.find("tr.info-faction").hide(),null!=x.base?i.find("tr.info-base td.info-data").text(exportObj.translate("gameterms",x.base)):i.find("tr.info-base td.info-data").text(exportObj.translate("gameterms","Small")),i.find("tr.info-base").show(),i.find("tr.info-skill td.info-data").text(s.skill),i.find("tr.info-skill").toggle(null!=s.skill),i.find("tr.info-points td.info-data").text(this.isBeta&&null!=s.pointsbeta?s.pointsbeta:s.points),i.find("tr.info-points").show(),i.find("tr.info-loadout td.info-data").text(this.isBeta&&null!=s.loadoutbeta?s.loadoutbeta:s.loadout),null!=s.upgrades?i.find("tr.info-loadout").hide():i.find("tr.info-loadout").show(),null!=s.engagement?(i.find("tr.info-engagement td.info-data").text(s.engagement),i.find("tr.info-engagement").show()):i.find("tr.info-engagement").hide(),i.find("tr.info-attack td.info-header i.xwing-miniatures-font").addClass(null!=(P=x.attack_icon)?P:"xwing-miniatures-font-attack"),i.find("tr.info-attack td.info-data").text(statAndEffectiveStat(null!=(L=null!=(E=s.ship_override)?E.attack:void 0)?L:x.attack,U,"attack")),i.find("tr.info-attack").toggle(0<(null!=(E=null!=(P=s.ship_override)?P.attack:void 0)?E:x.attack)||null!=(null!=U?U.attack:void 0)&&0<(null!=U?U.attack:void 0)),i.find("tr.info-attack-fullfront td.info-data").text(statAndEffectiveStat(null!=(P=null!=(L=s.ship_override)?L.attackf:void 0)?P:x.attackf,U,"attackf")),i.find("tr.info-attack-fullfront").toggle(null!=x.attackf||null!=(null!=U?U.attackf:void 0)),i.find("tr.info-attack-bullseye td.info-data").text(statAndEffectiveStat(null!=(L=null!=(E=s.ship_override)?E.attackbull:void 0)?L:x.attackbull,U,"attackbull")),i.find("tr.info-attack-bullseye").toggle(null!=x.attackbull||null!=(null!=U?U.attackbull:void 0)),i.find("tr.info-attack-left td.info-data").text(statAndEffectiveStat(null!=(E=null!=(P=s.ship_override)?P.attackl:void 0)?E:x.attackl,U,"attackl")),i.find("tr.info-attack-left").toggle(null!=x.attackl||null!=(null!=U?U.attackl:void 0)),i.find("tr.info-attack-right td.info-data").text(statAndEffectiveStat(null!=(P=null!=(L=s.ship_override)?L.attackr:void 0)?P:x.attackr,U,"attackr")),i.find("tr.info-attack-right").toggle(null!=x.attackr||null!=(null!=U?U.attackr:void 0)),i.find("tr.info-attack-back td.info-data").text(statAndEffectiveStat(null!=(L=null!=(E=s.ship_override)?E.attackb:void 0)?L:x.attackb,U,"attackb")),i.find("tr.info-attack-back").toggle(null!=x.attackb||null!=(null!=U?U.attackb:void 0)),i.find("tr.info-attack-turret td.info-data").text(statAndEffectiveStat(null!=(E=null!=(P=s.ship_override)?P.attackt:void 0)?E:x.attackt,U,"attackt")),i.find("tr.info-attack-turret").toggle(null!=(null!=(L=s.ship_override)?L.attackt:void 0)||null!=x.attackt||null!=(null!=U?U.attackt:void 0)),i.find("tr.info-attack-doubleturret td.info-data").text(statAndEffectiveStat(null!=(E=null!=(P=s.ship_override)?P.attackdt:void 0)?E:x.attackdt,U,"attackdt")),i.find("tr.info-attack-doubleturret").toggle(null!=x.attackdt||null!=(null!=U?U.attackdt:void 0)),i.find("tr.info-range").hide(),i.find("td.info-rangebonus").hide(),i.find("tr.info-agility td.info-data").text(statAndEffectiveStat(null!=(P=null!=(L=s.ship_override)?L.agility:void 0)?P:x.agility,U,"agility")),i.find("tr.info-agility").toggle(null!=(null!=(E=s.ship_override)?E.agility:void 0)||null!=x.agility),i.find("tr.info-hull td.info-data").text(statAndEffectiveStat(null!=(P=null!=(L=s.ship_override)?L.hull:void 0)?P:x.hull,U,"hull")),i.find("tr.info-hull").toggle(null!=(null!=(E=s.ship_override)?E.hull:void 0)||null!=x.hull),v="",null!=x.shieldrecurr)for(o=0;o<x.shieldrecurr;)v+='<sup><i class="fas fa-caret-up"></i></sup>',++o;if(i.find("tr.info-shields td.info-data").html(statAndEffectiveStat(null!=(P=null!=(L=s.ship_override)?L.shields:void 0)?P:x.shields,U,"shields")+v),i.find("tr.info-shields").toggle(null!=(null!=(E=s.ship_override)?E.shields:void 0)||null!=x.shields),v="",null!=x.energyrecurr)for(o=0;o<x.energyrecurr;)v+='<sup><i class="fas fa-caret-up"></i></sup>',++o;if(i.find("tr.info-energy td.info-data").html(statAndEffectiveStat(null!=(P=null!=(L=s.ship_override)?L.energy:void 0)?P:x.energy,U,"energy")+v),i.find("tr.info-energy").toggle(null!=(null!=(E=s.ship_override)?E.energy:void 0)||null!=x.energy),null!=(null!=U?U.force:void 0)&&0<U.force||null!=s.force){for(v="",d=1,null!=(null!=U?U.forcerecurring:void 0)?d=U.forcerecurring:null!=s.forcerecurring&&(d=s.forcerecurring),o=0;o<d;)v+='<sup><i class="fas fa-caret-up"></i></sup>',++o;i.find("tr.info-force td.info-data").html(statAndEffectiveStat(null!=(P=null!=(L=s.ship_override)?L.force:void 0)?P:s.force,U,"force")+v),i.find("tr.info-force").show()}else i.find("tr.info-force").hide();if(null!=s.charge){if(v="",null!=s.recurring)if(0<s.recurring)for(o=0;o<s.recurring;)v+='<sup><i class="fas fa-caret-up"></i></sup>',++o;else for(o=s.recurring;o<0;)v+='<sub><i class="fas fa-caret-down"></i></sub>',++o;l=$.trim(""+s.charge+v),i.find("tr.info-charge td.info-data").html(l),i.find("tr.info-charge").show()}else i.find("tr.info-charge").hide();null!=(null!=U?U.actions:void 0)?i.find("tr.info-actions td.info-data").html(this.formatActions(null!=(L=null!=(E=s.ship_override)?E.actions:void 0)?L:U.actions,", ")):i.find("tr.info-actions td.info-data").html(this.formatActions(null!=(E=null!=(P=s.ship_override)?P.actions:void 0)?E:x.actions,", ",null!=(L=s.keyword)?L:[])),i.find("tr.info-actions").show(),this.isQuickbuild?i.find("tr.info-upgrades").hide():(i.find("tr.info-upgrades").show(),this.isBeta&&null!=s.slotsbeta?i.find("tr.info-upgrades td.info-data").html(null!=s.slotsbeta?(()=>{for(var t=s.slotsbeta,e=[],i=0,n=t.length;i<n;i++)k=t[i],e.push(exportObj.translate("sloticon",k));return e})().join(" "):null!=s.upgrades?this.listStandardUpgrades(s.upgrades):"None"):i.find("tr.info-upgrades td.info-data").html(null!=s.slots?(()=>{for(var t=s.slots,e=[],i=0,n=t.length;i<n;i++)k=t[i],e.push(exportObj.translate("sloticon",k));return e})().join(" "):null!=s.upgrades?this.listStandardUpgrades(s.upgrades):"None")),i.find("p.info-maneuvers").show(),i.find("p.info-maneuvers").html(this.getManeuverTableHTML(null!=(P=null!=U?U.maneuvers:void 0)?P:x.maneuvers,x.maneuvers));break;case"Quickbuild":if(i.find(".info-type").text(this.uitranslation("Quickbuild")),i.find(".info-sources").hide(),i.find(".info-collection").hide(),p=exportObj.pilots[s.pilot],x=exportObj.ships[s.ship],null!=p.unique)O="&middot;&nbsp;";else if(null!=p.max_per_squad){for(o=0,O="";o<s.max_per_squad;)O=O.concat("&middot;"),++o;O=O.concat("&nbsp;")}else O="";if(i.find(".info-name").html(""+O+(p.display_name||p.name)+(null!=s.suffix?s.suffix:"")+(exportObj.isReleased(p)?"":" ("+exportObj.translate("ui","unreleased")+")")),""!==(A=this.restriction_text(s)+this.upgrade_effect(s))?(i.find("p.info-restrictions").html(null!=A?A:""),i.find("p.info-restrictions").show()):i.find("p.info-restrictions").hide(),i.find("p.info-text").html(null!=(E=p.text)?E:""),i.find("p.info-text").show(),i.find("p.info-chassis").html(null!=p.chassis?"<strong>"+(null!=(P=null!=(L=exportObj.chassis[p.chassis])?L.display_name:void 0)?P:p.chassis)+":</strong> "+exportObj.chassis[p.chassis].text:null!=x.chassis?"<strong>"+x.chassis+":</strong> "+exportObj.chassis[x.chassis].text:""),i.find("p.info-chassis").show(),i.find("tr.info-ship td.info-data").text(s.ship),i.find("tr.info-ship").show(),i.find("tr.info-faction td.info-data").text(exportObj.translate("faction",s.faction)),i.find("tr.info-faction").hide(),null!=x.base?i.find("tr.info-base td.info-data").text(exportObj.translate("gameterms",x.base)):i.find("tr.info-base td.info-data").text(exportObj.translate("gameterms","Small")),i.find("tr.info-base").show(),i.find("tr.info-skill td.info-data").text(p.skill),i.find("tr.info-skill").show(),i.find("tr.info-points").hide(),i.find("tr.info-loadout").hide(),i.find("tr.info-engagement td.info-data").text(p.skill),i.find("tr.info-engagement").show(),i.find("tr.info-attack td.info-data").text(null!=(L=null!=(E=p.ship_override)?E.attack:void 0)?L:x.attack),i.find("tr.info-attack").toggle(0<(null!=(E=null!=(P=p.data.ship_override)?P.attack:void 0)?E:x.attack)),i.find("tr.info-attack-fullfront td.info-data").text(x.attackf),i.find("tr.info-attack-fullfront").toggle(null!=x.attackf),i.find("tr.info-attack-bullseye td.info-data").text(x.attackbull),i.find("tr.info-attack-bullseye").toggle(null!=x.attackbull),i.find("tr.info-attack-left td.info-data").text(x.attackl),i.find("tr.info-attack-left").toggle(null!=x.attackl),i.find("tr.info-attack-right td.info-data").text(x.attackr),i.find("tr.info-attack-right").toggle(null!=x.attackr),i.find("tr.info-attack-back td.info-data").text(x.attackb),i.find("tr.info-attack-back").toggle(null!=x.attackb),i.find("tr.info-attack-turret td.info-data").text(x.attackt),i.find("tr.info-attack-turret").toggle(null!=x.attackt),i.find("tr.info-attack-doubleturret td.info-data").text(x.attackdt),i.find("tr.info-attack-doubleturret").toggle(null!=x.attackdt),i.find("tr.info-attack td.info-header i.xwing-miniatures-font").addClass(null!=(L=x.attack_icon)?L:"xwing-miniatures-font-frontarc"),i.find("tr.info-energy td.info-data").text(null!=(E=null!=(P=p.ship_override)?P.energy:void 0)?E:x.energy),i.find("tr.info-energy").toggle(null!=(null!=(L=p.ship_override)?L.energy:void 0)||null!=x.energy),i.find("tr.info-range").hide(),i.find("td.info-rangebonus").hide(),i.find("tr.info-agility td.info-data").text(null!=(E=null!=(P=p.ship_override)?P.agility:void 0)?E:x.agility),i.find("tr.info-agility").show(),i.find("tr.info-hull td.info-data").text(null!=(P=null!=(L=p.ship_override)?L.hull:void 0)?P:x.hull),i.find("tr.info-hull").show(),i.find("tr.info-shields td.info-data").text(null!=(L=null!=(E=p.ship_override)?E.shields:void 0)?L:x.shields),i.find("tr.info-shields").show(),null!=(null!=U?U.force:void 0)||null!=s.force){for(v="",d=1,null!=(null!=U?U.forcerecurring:void 0)&&(d=U.forcerecurring),o=0;o<d;)v+='<sup><i class="fas fa-caret-up"></i></sup>',++o;i.find("tr.info-force td.info-data").html((null!=(E=null!=(P=p.ship_override)?P.force:void 0)?E:p.force)+v),i.find("tr.info-force").show()}else i.find("tr.info-force").hide();if(null!=s.charge){if(v="",null!=s.recurring)if(0<s.recurring)for(o=0;o<s.recurring;)v+='<sup><i class="fas fa-caret-up"></i></sup>',++o;else for(o=s.recurring;o<0;)v+='<sub><i class="fas fa-caret-down"></i></sub>',++o;l=$.trim(""+s.charge+v),i.find("tr.info-charge td.info-data").html(l),i.find("tr.info-charge").show()}else i.find("tr.info-charge").hide();i.find("tr.info-actions td.info-data").html(this.formatActions(null!=(U=null!=(L=p.ship_override)?L.actions:void 0)?U:exportObj.ships[s.ship].actions,", ",null!=(P=p.keyword)?P:[])),i.find("tr.info-actions").show(),i.find("tr.info-upgrades").show(),i.find("tr.info-upgrades td.info-data").html((()=>{for(var t,e=null!=(t=s.upgrades)?t:[],i=[],n=0,a=e.length;n<a;n++)S=e[n],i.push(null!=exportObj.upgrades[S].display_name?exportObj.upgrades[S].display_name:S);return i})().join(", ")||"None"),i.find("p.info-maneuvers").show(),i.find("p.info-maneuvers").html(this.getManeuverTableHTML(x.maneuvers,x.maneuvers));break;case"Addon":if(i.find(".info-type").text(exportObj.translate("slot",e.addon_type)),null!=s.standard?(M=this.getPilotsMatchingUpgrade(s.name,!1),i.find(".info-sources.info-data").text((()=>{for(var t=[],e=0,i=M.length;e<i;e++)p=M[e],t.push(p.display_name);return t})().sort().join(", "))):i.find(".info-sources.info-data").text((()=>{for(var t=s.sources,e=[],i=0,n=t.length;i<n;i++)w=t[i],e.push(exportObj.translate("sources",w));return e})().sort().join(", ")),i.find(".info-sources").show(),null!=s.unique)O="&middot;&nbsp;";else if(null!=s.max_per_squad){for(o=0,O="";o<s.max_per_squad;)O=O.concat("&middot;"),++o;O=O.concat("&nbsp;")}else O="";if(null!=(null!=(E=this.collection)?E.counts:void 0)&&null==s.standard?(a=null!=(P=null!=(L=this.collection.counts)&&null!=(U=L.upgrade)?U[s.name]:void 0)?P:0,i.find(".info-collection").text(this.uitranslation("collectionContentUpgrades",a)),i.find(".info-collection").show()):i.find(".info-collection").hide(),i.find(".info-name").html(""+O+(s.display_name||s.name)+(exportObj.isReleased(s)||null!=s.standard?"":" ("+this.uitranslation("unreleased")+")")+(null!=s.standard?" (S)":"")),m=this.isBeta&&null!=s.pointsbeta?s.pointsbeta:s.points,Array.isArray(m)){switch(f="<i>"+this.uitranslation("varPointCostsPoints",m),s.variablepoints){case"Agility":f+=this.uitranslation("varPointCostsConditionAgility",function(){Y=[];for(var t=0,e=m.length-1;0<=e?t<=e:e<=t;0<=e?t++:t--)Y.push(t);return Y}.apply(this));break;case"Initiative":f+=this.uitranslation("varPointCostsConditionIni",function(){Z=[];for(var t=0,e=m.length-1;0<=e?t<=e:e<=t;0<=e?t++:t--)Z.push(t);return Z}.apply(this));break;case"Base":f+=this.uitranslation("varPointCostsConditionBase");break;case"Faction":f+=this.uitranslation("varPointCostsConditionFaction",s.faction)}f+="</i>"}if(A=this.restriction_text(s)+this.upgrade_effect(s),null!=f||""!==A?(null!=f&&""!==A&&(f+="<br/>"),i.find("p.info-restrictions").html((null!=f?f:"")+A),i.find("p.info-restrictions").show()):i.find("p.info-restrictions").hide(),i.find("p.info-text").html(null!=(E=s.text)?E:""),i.find("p.info-text").show(),i.find("p.info-chassis").hide(),i.find("tr.info-ship").hide(),i.find("tr.info-faction").hide(),i.find("tr.info-base").hide(),i.find("tr.info-skill").hide(),i.find("tr.info-points").hide(),i.find("tr.info-loadout").hide(),i.find("tr.info-engagement").hide(),null!=s.energy?(i.find("tr.info-energy td.info-data").text(s.energy),i.find("tr.info-energy").show()):i.find("tr.info-energy").hide(),null!=s.attack?(i.find("tr.info-attack td.info-data").text(s.attack),i.find("tr.info-attack").show()):i.find("tr.info-attack").hide(),null!=s.attackb?(i.find("tr.info-attack-back td.info-data").text(s.attackb),i.find("tr.info-attack-back").show()):i.find("tr.info-attack-back").hide(),null!=s.attackt?(i.find("tr.info-attack-turret td.info-data").text(s.attackt),i.find("tr.info-attack-turret").show()):i.find("tr.info-attack-turret").hide(),null!=s.attackr?(i.find("tr.info-attack-right td.info-data").text(s.attackr),i.find("tr.info-attack-right").show()):i.find("tr.info-attack-right").hide(),null!=s.attackl?(i.find("tr.info-attack-left td.info-data").text(s.attackl),i.find("tr.info-attack-left").show()):i.find("tr.info-attack-left").hide(),null!=s.attackdt?(i.find("tr.info-attack-doubleturret td.info-data").text(s.attackdt),i.find("tr.info-attack-doubleturret").show()):i.find("tr.info-attack-doubleturret").hide(),null!=s.attackbull?(i.find("tr.info-attack-bullseye td.info-data").text(s.attackbull),i.find("tr.info-attack-bullseye").show()):i.find("tr.info-attack-bullseye").hide(),null!=s.attackf?(i.find("tr.info-attack-fullfront td.info-data").text(s.attackf),i.find("tr.info-attack-fullfront").show()):i.find("tr.info-attack-fullfront").hide(),null!=s.charge){if(v="",null!=s.recurring)if(0<s.recurring)for(o=0;o<s.recurring;)v+='<sup><i class="fas fa-caret-up"></i></sup>',++o;else for(o=s.recurring;o<0;)v+='<sub><i class="fas fa-caret-down"></i></sub>',++o;l=$.trim(""+s.charge+v),i.find("tr.info-charge td.info-data").html(l)}if(i.find("tr.info-charge").toggle(null!=s.charge),null!=s.range?(i.find("tr.info-range td.info-data").text(s.range),i.find("tr.info-range").show()):i.find("tr.info-range").hide(),null!=s.rangebonus?i.find("td.info-rangebonus").show():i.find("td.info-rangebonus").hide(),null!=s.force){for(v="",d=1,null!=s.forcerecurring&&(d=s.forcerecurring),o=0;o<d;)v+='<sup><i class="fas fa-caret-up"></i></sup>',++o;i.find("tr.info-force td.info-data").html(s.force+v)}i.find("tr.info-force").toggle(null!=s.force),i.find("tr.info-agility").hide(),i.find("tr.info-hull").hide(),i.find("tr.info-shields").hide(),i.find("tr.info-actions").hide(),i.find("tr.info-upgrades").hide(),i.find("p.info-maneuvers").hide();break;case"Rules":i.find(".info-type").hide(),i.find(".info-sources").hide(),i.find(".info-collection").hide(),i.find(".info-name").html(s.name),i.find(".info-name").show(),i.find("p.info-restrictions").hide(),i.find("p.info-text").html(s.text),i.find("p.info-text").show(),i.find("tr.info-ship").hide(),i.find("tr.info-faction").hide(),i.find("tr.info-base").hide(),i.find("tr.info-skill").hide(),i.find("tr.info-points").hide(),i.find("tr.info-loadout").hide(),i.find("tr.info-agility").hide(),i.find("tr.info-hull").hide(),i.find("tr.info-shields").hide(),i.find("tr.info-actions").hide(),i.find("tr.info-upgrades").hide(),i.find("p.info-maneuvers").hide(),i.find("tr.info-energy").hide(),i.find("tr.info-attack").hide(),i.find("tr.info-attack-turret").hide(),i.find("tr.info-attack-bullseye").hide(),i.find("tr.info-attack-fullfront").hide(),i.find("tr.info-attack-back").hide(),i.find("tr.info-attack-doubleturret").hide(),i.find("tr.info-charge").hide(),i.find("td.info-rangebonus").hide(),i.find("tr.info-range").hide(),i.find("tr.info-force").hide();break;case"MissingStuff":for(i.find(".info-type").text(this.uitranslation("List of Missing items")),i.find(".info-sources").hide(),i.find(".info-collection").hide(),i.find(".info-name").html(this.uitranslation("Missing items")),i.find(".info-name").show(),h=this.uitranslation("Missing Item List:")+"<ul>",C=0,W=s.length;C<W;C++){for(h+="<li><strong>"+(null!=(u=s[C]).display_name?u.display_name:u.name)+"</strong> (",r=!0,I=0,G=(V=u.sources).length;I<G;I++)r||(h+=", "),h+=w=V[I],r=!1;h+=")</li>"}h+="</ul>",i.find("p.info-restrictions").hide(),i.find("p.info-text").html(h),i.find("p.info-text").show(),i.find("tr.info-ship").hide(),i.find("tr.info-faction").hide(),i.find("tr.info-base").hide(),i.find("tr.info-skill").hide(),i.find("tr.info-points").hide(),i.find("tr.info-loadout").hide(),i.find("tr.info-agility").hide(),i.find("tr.info-hull").hide(),i.find("tr.info-shields").hide(),i.find("tr.info-actions").hide(),i.find("tr.info-upgrades").hide(),i.find("p.info-maneuvers").hide(),i.find("tr.info-energy").hide(),i.find("tr.info-attack").hide(),i.find("tr.info-attack-turret").hide(),i.find("tr.info-attack-bullseye").hide(),i.find("tr.info-attack-fullfront").hide(),i.find("tr.info-attack-back").hide(),i.find("tr.info-attack-doubleturret").hide(),i.find("tr.info-charge").hide(),i.find("td.info-rangebonus").hide(),i.find("tr.info-range").hide(),i.find("tr.info-force").hide();break;case"Damage":i.find(".info-type").text(exportObj.translate("types",s.type)),i.find(".info-sources.info-data").text((()=>{for(var t=s.sources,e=[],i=0,n=t.length;i<n;i++)w=t[i],e.push(exportObj.translate("sources",w));return e})().sort().join(", ")),i.find(".info-sources").show(),null!=(null!=(L=this.collection)?L.counts:void 0)?(a=null!=(A=null!=(U=this.collection.counts)&&null!=(P=U.damage)?P[s.name]:void 0)?A:0,i.find(".info-collection").text(this.uitranslation("collectionContentUpgrades",a)),i.find(".info-collection").show()):i.find(".info-collection").hide(),i.find(".info-name").html((s.display_name||s.name)+" ("+s.quantity+"x)"),i.find("p.info-restrictions").hide(),i.find("p.info-text").html(null!=(E=s.text)?E:""),i.find("p.info-text").show(),i.find("p.info-chassis").hide(),i.find("tr.info-ship").hide(),i.find("tr.info-faction").hide(),i.find("tr.info-base").hide(),i.find("tr.info-skill").hide(),i.find("tr.info-points").hide(),i.find("tr.info-loadout").hide(),i.find("tr.info-engagement").hide(),i.find("tr.info-energy").hide(),i.find("tr.info-attack").hide(),i.find("tr.info-attack-back").hide(),i.find("tr.info-attack-turret").hide(),i.find("tr.info-attack-right").hide(),i.find("tr.info-attack-left").hide(),i.find("tr.info-attack-doubleturret").hide(),i.find("tr.info-attack-bullseye").hide(),i.find("tr.info-attack-fullfront").hide(),i.find("tr.info-charge").hide(),i.find("tr.info-range").hide(),i.find("td.info-rangebonus").hide(),i.find("tr.info-force").hide(),i.find("tr.info-agility").hide(),i.find("tr.info-hull").hide(),i.find("tr.info-shields").hide(),i.find("tr.info-actions").hide(),i.find("tr.info-upgrades").hide(),i.find("p.info-maneuvers").hide()}if(i!==this.mobile_tooltip_modal&&(i.find(".info-well").show(),i.find(".intro").hide()),this.tooltip_currently_displaying=s,768<=$(window).width())return n=i.find(".info-well"),$.isElementInView(n,!0)?n.css("position","fixed"):n.css("position","static")}},t.prototype._randomizerLoopBody=function(a){var s,t,e,l,i,n,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k,y;if(a.keep_running){if(this.total_points===a.max_points){if(a.keep_running=!1,this.isQuickbuild)return void(a.keep_running=!1);for(r=0,h=(g=this.ships).length;r<h;r++)if(e=[],null!=(l=g[r]).pilot.loadout&&null==l.pilot.upgrades)for(;l.upgrade_points_total<l.pilot.loadout;){for(n=[],d=0,p=(v=l.upgrades).length;d<p;d++)null!=(o=v[d]).data||null!=o.occupied_by&&null!==o.occupied_by||0<=__indexOf.call(e,o)||n.push(o);if(0===n.length)break;s=n[$.randomInt(n.length)],0<(t=function(){for(var t=this.getAvailableUpgradesIncluding(s.slot,null,l,s,"",this.dfl_filter_func,!1),e=[],i=0,n=t.length;i<n;i++)o=t[i],!exportObj.upgradesById[o.id].sources.intersects(a.allowed_sources)||a.collection_only&&!this.collection.checkShelf("upgrade",o.name)||o.disabled||e.push(o);return e}.call(this)).length?(o=t[$.randomInt(t.length)],s.setById(o.id)):e.push(s)}}else if(this.total_points<a.max_points){if(0<(i=0===(i=this.getAvailableShipsMatchingAndCheapEnough(a.max_points-this.total_points,"",!1,a.collection_only)).length?this.getAvailableShipsMatching("",!1,a.collection_only):i).length&&(this.ships.length<a.ship_limit||0===a.ship_limit)){if(i=i[$.randomInt(i.length)].name,0===(i=this.getAvailablePilotsForShipIncluding(i)).length)return;(i=i[$.randomInt(i.length)]).disabled||!(this.isQuickbuild?exportObj.pilots[exportObj.quickbuildsById[i.id].pilot]:exportObj.pilotsById[i.id]).sources.intersects(a.allowed_sources)||a.collection_only&&!this.collection.checkShelf("pilot",this.isQuickbuild?exportObj.quickbuildsById[i.id]:i.name)||this.addShip().setPilotById(i.id)}}else this.removeShip(this.ships[$.randomInt(this.ships.length)]);return window.setTimeout(this._makeRandomizerLoopFunc(a),0)}for(;this.total_points>a.max_points;)this.removeShip(this.ships[$.randomInt(this.ships.length)]);if(a.fill_zero_pts)for(c=0,f=(x=this.ships).length;c<f;c++)for(u=0,m=(k=(l=x[c]).upgrades).length;u<m;u++)null!=(s=k[u]).data||null!=s.occupied_by&&null!==s.occupied_by||(o=0<(t=function(){for(var t=this.getAvailableUpgradesIncluding(s.slot,null,s.ship,s,"",this.dfl_filter_func,!1),e=[],i=0,n=t.length;i<n;i++)o=t[i],exportObj.upgradesById[o.id].sources.intersects(a.allowed_sources)&&o.points<1&&(!a.collection_only||this.collection.checkShelf("upgrade",o.name))&&e.push(o);return e}.call(this)).length?t[$.randomInt(t.length)]:void 0)&&!o.disabled&&s.setById(o.id);for(window.clearTimeout(a.timer),b=0,_=(y=this.ships).length;b<_;b++)(l=y[b]).updateSelections();return this.suppress_automatic_new_ship=!1,this.addShip()},t.prototype._makeRandomizerLoopFunc=function(t){return e=this,function(){return e._randomizerLoopBody(t)};var e},t.prototype.randomSquad=function(t,e,i,n,a,s){var l;for(null==t&&(t=200),null==e&&(e=null),null==i&&(i=1e3),null==n&&(n=0),null==a&&(a=!0),null==s&&(s=!1),this.backend_status.fadeOut("slow"),this.suppress_automatic_new_ship=!0,e.length<1&&(e=null);0<this.ships.length;)this.removeShip(this.ships[0]);if(0<this.ships.length)throw new Error("Ships not emptied");return(l={max_points:t,ship_limit:n,keep_running:!0,allowed_sources:null!=e?e:exportObj.expansions,collection_only:null!=this.collection&&"true"===this.collection.checks.collectioncheck&&a,fill_zero_pts:s}).timer=window.setTimeout(function(){return l.keep_running=!1},i),window.setTimeout(this._makeRandomizerLoopFunc(l),0),this.resetCurrentSquad(),this.current_squad.name=this.uitranslation("Random Squad"),this.container.trigger("xwing-backend:squadNameChanged")},t.prototype.setBackend=function(t){var e,i,n,a,s;if(this.backend=t,null!=this.waiting_for_backend){for(s=[],i=0,n=(a=this.waiting_for_backend).length;i<n;i++)e=a[i],s.push(e());return s}},t.prototype.upgrade_effect=function(t){var e,i,n,a,s,l,o,r,d,c,u=a=i="";if(t.modifier_func&&(t.modifier_func(n={attack:0,attackf:0,attackbull:0,attackb:0,attackt:0,attackl:0,attackr:0,attackdt:0,energy:0,agility:0,hull:0,shields:0,force:0,actions:[],maneuvers:[0,0]}),0!==n.attack&&(a+=i+"%FRONTARC% ("+n.attack+")",i=", "),0!==n.attackf&&(a+=i+"%FULLFRONTARC% ("+n.attackf+")",i=", "),0!==n.attackbull&&(a+=i+"%BULLSEYEARC% ("+n.attackbull+")",i=", "),0!==n.attackb&&(a+=i+"%REARARC% ("+n.attackb+")",i=", "),0!==n.attackt&&(a+=i+"%SINGLETURRETARC% ("+n.attackt+")",i=", "),0!==n.attackl&&(a+=i+"%LEFTARC% ("+n.attackl+")",i=", "),0!==n.attackr&&(a+=i+"%RIGHTARC% ("+n.attackr+")",i=", "),0!==n.attackdt&&(a+=i+"%DOUBLETURRETARC% ("+n.attackdt+")",i=", "),0!==n.energy&&(a+=i+"%ENERGY% ("+n.energy+")",i=", "),0!==n.agility&&(a+=i+"%AGILITY% ("+n.agility+")",i=", "),0!==n.hull&&(a+=i+"%HULL% ("+n.hull+")",i=", "),0!==n.shields&&(a+=i+"%SHIELD% ("+n.shields+")",i=", "),0<n.actions.length)&&(a+=i+this.formatActions(n.actions,", "),i=", "),t.confersAddons)for(s=0,o=(d=t.confersAddons).length;s<o;s++)"Force"===(e=d[s]).slot?a+=i+"%FORCEPOWER%":a+=i+("%"+e.slot.toUpperCase().replace(/[^a-z0-9]/gi,""))+"%",i=", ";if(t.unequips_upgrades)for(i="",l=0,r=(c=t.unequips_upgrades).length;l<r;l++)u+=i+("%"+c[l].toUpperCase().replace(/[^a-z0-9]/gi,""))+"%",i=", ";return""!==a?(n={text:"</br><b>"+this.uitranslation("adds",a)+"</b>"},""!==u&&(n.text+="</br><b>"+this.uitranslation("removes",u)+"</b>"),exportObj.fixIcons(n)):""},t.prototype.restriction_text=function(t){var e,i,n,a,s,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x=a=o=d="",k=!1,y=null!=t.standardized;if(this.isBeta&&null!=t.standardizedbeta&&(y=t.standardizedbeta),null!=t.restrictions&&(n=t.restrictions),null!=(n=this.isBeta&&null!=t.restrictionsbeta?t.restrictionsbeta:n))for(c=0,f=n.length;c<f;c++){switch((r=n[c])[0]){case"FactionOrUnique":o+=a+exportObj.translate("faction",""+r[2]),x=exportObj.translate("restrictions"," or Squad Including")+(" "+r[1]);break;case"Base":for(l=u=0,m=r.length;u<m;l=++u)"Base"===(i=r[l])?d+=a:(d+=i+" ",l<r.length-1?d+="or ":d+=exportObj.translate("restrictions","Ship"));break;case"Action":e=[r[1]],d+=a+this.formatActions(e,"",[]);break;case"Equipped":d+=a+("%"+r[1].toUpperCase().replace(/[^a-z0-9]/gi,""))+"% Equipped";break;case"Slot":d+=a+exportObj.translate("restrictions","Extra")+(" %"+r[1].toUpperCase().replace(/[^a-z0-9]/gi,""))+"%";break;case"Keyword":d+=a+exportObj.translate("restrictions",""+r[1]),k=!0;break;case"AttackArc":d+=a+"%REARARC%";break;case"ShieldsGreaterThan":d+=a+("%SHIELD% > "+r[1]);break;case"EnergyGreatterThan":d+=a+("%ENERGY% > "+r[1]);break;case"InitiativeGreaterThan":d+=a+exportObj.translate("restrictions","Initiative")+(" > "+r[1]);break;case"InitiativeLessThan":d+=a+exportObj.translate("restrictions","Initiative")+(" < "+r[1]);break;case"HasForce":d+=a+(r[1]?"":"No ")+"%FORCE%";break;case"AgilityEquals":d+=a+exportObj.translate("restrictions","Agility")+(" = "+r[1]);break;case"isUnique":!0===r[1]?d+=a+exportObj.translate("restrictions","Limited"):d+=a+exportObj.translate("restrictions","Non-Limited");break;case"Format":d+=a+exportObj.translate("restrictions",r[1]+" Ship");break;case"Faction":o+=a+exportObj.translate("faction",""+r[1])}a=", "}if(!t.skill){if(""===o&&t.faction){if(t.faction instanceof Array)for(h=0,_=(g=t.faction).length;h<_;h++)s=g[h],o+=a+exportObj.translate("faction",""+s),a=" or ";else o+=a+exportObj.translate("faction",""+t.faction);a=", "}if(t.ship&&!1===k){if(t.ship instanceof Array)for(p=0,b=(v=t.ship).length;p<b;p++)o+=a+v[p],a=" or ";else o+=a+t.ship;a=", "}t.solitary&&(o+=a+exportObj.translate("gameterms","Solitary"),a=", "),y&&(o+=a+exportObj.translate("gameterms","Standardized"),a=", ")}return""!==(d+=o+x)?(t={text:"<i><b>"+exportObj.translate("restrictions","Restrictions")+":</b> "+d+"</i>"},exportObj.fixIcons(t)):""},t.prototype.describeSquad=function(){var a;return""===this.getNotes().trim()?function(){for(var t=this.ships,e=[],i=0,n=t.length;i<n;i++)null!=(a=t[i]).pilot&&e.push(a.pilot.name);return e}.call(this).join(", "):this.getNotes()},t.prototype.listCards=function(){for(var t,e,i,n,a,s={},l=this.ships,o=0,r=l.length;o<r;o++)if(null!=(t=l[o]).pilot)for(s[t.pilot.name]=null,i=0,n=(a=t.upgrades).length;i<n;i++)null!=(e=a[i]).data&&(s[e.data.name]=null);return Object.keys(s).sort()},t.prototype.getNotes=function(){return this.notes.val()},t.prototype.getTag=function(){return this.tag.val()},t.prototype.getObstacles=function(){return this.current_obstacles},t.prototype.isSquadPossibleWithCollection=function(){var t,e,i,n,a,s,l,o,r,d,c,u,h,p;if(0===Object.keys(null!=(u=null!=(u=this.collection)?u.expansions:void 0)?u:{}).length)return[!0,[]];if("true"!==(null!=(u=this.collection)?u.checks.collectioncheck:void 0))return[!0,[]];for(this.collection.reset(),l=!0,t=[],o=0,d=(h=this.ships).length;o<d;o++)if(null!=(i=h[o]).pilot&&(n=this.collection.use("ship",i.pilot.ship),e=this.collection.use("pilot",i.pilot.name),n&&e||(l=!1),n||t.push(i.data),e||t.push(i.pilot),null==i.pilot.upgrades))for(r=0,c=(p=i.upgrades).length;r<c;r++)null!=(a=p[r]).data&&((s=this.collection.use("upgrade",a.data.name))||null!=a.data.standard||(l=!1),s||null!=a.data.standard||t.push(a.data));return[l,t]},t.prototype.checkCollection=function(){var e,t,i,n;if(null!=this.collection)return t=(i=this.isSquadPossibleWithCollection())[0],e=i[1],this.collection_invalid_container.toggleClass("d-none",t),this.collection_invalid_container.on("mouseover",(n=this,function(t){return n.showTooltip("MissingStuff",e)}))},t.prototype.toXWS=function(){var t,e,i,n,a,s,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k,y,w,q="09/06/2024",O="AMG";for(this.isBeta&&(q="BV4",O="XWA"),d={description:this.getNotes(),faction:exportObj.toXWSFaction[this.faction],name:this.current_squad.name,pilots:[],points:this.total_points,vendor:{yasb:{builder:"YASB - X-Wing 2.5",builder_url:window.location.href.split("?")[0],link:this.getPermaLink()}},version:q,ruleset:O},c=0,f=(x=this.ships).length;c<f;c++)null!=(l=x[c]).pilot&&d.pilots.push(l.toXWS());for(a={},e=0,o=(()=>{for(var t=d.pilots,e=[],i=0,n=t.length;i<n;i++)null!=(s=t[i]).multisection&&e.push(s);return e})(),u=0,k=Math.pow(o.length,2);(0<=k?u<k:k<u)&&0!==o.length&&(null==(r=o.shift()).multisection_id&&(r.multisection_id=e++),null==a[v=r.multisection_id]&&(a[v]=[r]),0!==o.length);0<=k?++u:--u){for(n=[],h=0,m=o.length;h<m&&(t=o[h],y=r.name,!(0<=__indexOf.call(t.multisection,y)&&(n.push(t),r.multisection.removeItem(t.name),t.multisection.removeItem(r.name),t.multisection_id=r.multisection_id,a[t.multisection_id].push(t),0===r.multisection.length)));h++);for(p=0,_=n.length;p<_;p++)0===(i=n[p]).multisection.length&&o.removeItem(i)}for(g=0,b=(w=d.pilots).length;g<b;g++)null!=(s=w[g]).multisection&&delete s.multisection;return null!=(q=this.getObstacles())&&0<q.length&&(d.obstacles=q),d},t.prototype.toMinimalXWS=function(){var t,e,i=this.toXWS();for(t in i)__hasProp.call(i,t)&&(i[t],"faction"!==t)&&"pilots"!==t&&"version"!==t&&delete i[t];for(t in e=i.pilots)__hasProp.call(e,t)&&(e[t],"id"!==t)&&"upgrades"!==t&&"multisection_id"!==t&&delete i[t];return i},t.prototype.loadFromXWS=function(a,t){var e,i,n,s,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k,y,w,q,O=null,S=null,$=null!=a.version?(()=>{for(var t=a.version.split("."),e=[],i=0,n=t.length;i<n;i++)u=t[i],e.push(parseInt(u));return e})():[0,2];if(!1==!([0,1]<$)){if(h=exportObj.fromXWSFaction[a.faction],this.faction!==h)throw new Error("Attempted to load XWS for "+a.faction+" but builder is "+this.faction);for(null!=a.name&&(this.current_squad.name=a.name),null!=a.description&&this.notes.val(a.description),null!=a.obstacles&&(this.current_squad.additional_data.obstacles=a.obstacles),this.suppress_automatic_new_ship=!0,this.removeAllShips(),O=!0,e=this.isStandard?"h":this.isEpic?"e":this.isBeta?"b":"s",o=S="",f=0,b=(x=a.pilots).length;f<b;f++){if(y=x[f],this.addShip(),y.id)n=y.id;else{if(!y.name){O=!1,S="Pilot without identifier";break}n=y.name}if(null!=exportObj.pilotsByFactionXWS[h][n])o+=exportObj.pilotsByFactionXWS[h][n][0].id;else if(exportObj.pilotsByUniqueName[n]&&1===exportObj.pilotsByUniqueName[n].length)o+=exportObj.pilotsByUniqueName[n][0].id;else for(i in k=exportObj.pilotsByUniqueName)for(m=0,g=(l=k[i]).length;m<g;m++)if((s=l[m]).xws&&s.xws===n||!s.xws&&i===n){o+=s.id;break}for(c in exportObj.standardCheck(y,!0)||"h"!==e||(e="s"),o+="X",w=null!=(y=y.upgrades)?y:{})for(_=0,v=(d=w[c]).length;_<v;_++)r=d[_],q=null!=(q=exportObj.fromXWSUpgrade[c])?q:c.capitalize(),null!=r&&(null==(p=null!=(p=exportObj.upgradesBySlotXWSName[q])[r]?p[r]:p[r]=exportObj.upgradesBySlotCanonicalName[q][r])?(console.log("Failed to load xws upgrade: "+r),S+="Skipped upgrade "+r,O=!1):(o=o+p.id+"W",exportObj.standardCheck(p,!0)||"h"!==e||(e="s")));o+="XY"}this.loadFromSerialized(o="v9Z"+e+"Z20Z"+o),this.current_squad.dirty=!0,this.container.trigger("xwing-backend:squadNameChanged"),this.container.trigger("xwing-backend:squadDirtinessChanged")}return t({success:O,error:S})},t})(),Ship=(()=>{function t(t){this.builder=t.builder,this.container=t.container,this.pilot=null,this.data=null,this.quickbuildId=-1,this.linkedShip=null,this.primary=!0,this.upgrades=[],this.upgrade_points_total=0,this.wingmates=[],this.destroystate=0,this.uitranslation=this.builder.uitranslation,this.setupUI()}return t.prototype.destroy=function(t){__iced_k_noop;var e,i,n=iced.findDeferral(arguments);if(this.resetPilot(),this.resetAddons(),this.teardownUI(),(a=this.builder.ships.indexOf(this))<0)throw new Error("Ship not registered with builder");this.builder.ships.splice(a,1),0<this.wingmates.length&&this.setWingmates(0);var a=function(){return t()};null===(e=this).linkedShip?a():(a=a,0<(null!=(i=e.linkedShip.wingmates)?i.length:void 0)&&0<=__indexOf.call(e.linkedShip.wingmates,e)?a(e.linkedShip.removeFromWing(e)):(e.linkedShip.linkedShip=null,i=new iced.Deferrals(a,{parent:n,funcname:"Ship.destroy"}),e.builder.removeShip(e.linkedShip,i.defer({lineno:6138})),i._fulfill()))},t.prototype.copyFrom=function(a){var t,e,i,n,s,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k,y,w,q;if(a===this)throw new Error("Cannot copy from self");if(null!=a.pilot&&null!=a.data){if(this.builder.isQuickbuild){if(n=!(a.pilot.unique||null!=a.pilot.max_per_squad&&this.builder.countPilots(a.pilot.canonical_name)>=a.pilot.max_per_squad))for(d=0,p=(g=a.upgrades).length;d<p;d++)(null!=(null!=(v=(r=g[d]).data)?v.unique:void 0)&&r.data.unique||null!=(null!=(v=r.data)?v.max_per_squad:void 0)&&this.builder.countUpgrades(r.data.canonical_name)>=r.data.max_per_squad||null!=(null!=(v=r.data)?v.solitary:void 0))&&(n=!1);if(n)this.setPilotById(a.quickbuildId);else{if(!(0<(t=function(){for(var t=this.builder.getAvailablePilotsForShipIncluding(a.data.name),e=[],i=0,n=t.length;i<n;i++)(o=t[i]).disabled||e.push(o);return e}.call(this)).length))return;this.setPilotById(t[0].id,!0)}}else{if(a.pilot.unique||null!=a.pilot.max_per_squad&&this.builder.countPilots(a.pilot.canonical_name)>=a.pilot.max_per_squad){if(!(0<(t=function(){for(var t=this.builder.getAvailablePilotsForShipIncluding(a.data.name),e=[],i=0,n=t.length;i<n;i++)(o=t[i]).disabled||e.push(o);return e}.call(this)).length))return;this.setPilotById(t[0].id,!0)}else this.setPilotById(a.pilot.id,!0);for(l={},c=0,f=(x=a.upgrades).length;c<f;c++)null==(null!=(r=x[c])?r.data:void 0)||r.isStandardized()||null!=r.data.standard||r.data.unique||!(null==r.data.max_per_squad||this.builder.countUpgrades(r.data.canonical_name)<r.data.max_per_squad)||(null==l[b=r.slot]&&(l[b]=[]),l[r.slot].push(r));for(e={},u=0,m=(k=this.upgrades).length;u<m;u++)(r=k[u]).isOccupied()||null!=(s=(null!=(y=l[r.slot])?y:[]).shift())&&(r.setById(s.data.id),r.lastSetValid||(e[s.data.id]=r));for(i in e)(r=e[i]).setById(i);for(h=0,_=(w=this.upgrades).length;h<_;h++)(r=w[h]).isOccupied()||null!=(s=(null!=(q=l[r.slot])?q:[]).shift())&&r.setById(s.data.id);this.addStandardizedUpgrades()}return this.updateSelections(),this.builder.container.trigger("xwing:pointsUpdated"),this.builder.current_squad.dirty=!0,this.builder.container.trigger("xwing-backend:squadDirtinessChanged")}},t.prototype.setShipType=function(s){var t,l,e,i,n,a;for(this.pilot_selector.data("select2").container.show(),s!==(null!=(n=this.pilot)?n.ship:void 0)&&(this.builder.isQuickbuild?(n=function(){for(var t=this.builder.getAvailablePilotsForShipIncluding(s),e=[],i=0,n=t.length;i<n;i++)(l=t[i]).disabled||e.push(l.id);return e}.call(this)[0],this.setPilotById(n)):this.setPilot(function(){for(var t,e=this.builder.getAvailablePilotsForShipIncluding(s),i=[],n=0,a=e.length;n<a;n++)l=e[n],null!=exportObj.pilotsById[l.id].restriction_func&&!exportObj.pilotsById[l.id].restriction_func(this)||(t=exportObj.pilotsById[l.id],0<=__indexOf.call(this.builder.uniques_in_use.Pilot,t))||i.push(exportObj.pilotsById[l.id]);return i}.call(this)[0])),this.checkPilotSelectorQueryModal(),e=0,i=(a=this.row.attr("class").split(/\s+/)).length;e<i;e++)0===(t=a[e]).indexOf("ship-")&&this.row.removeClass(t);return this.remove_button.fadeIn("fast"),this.copy_button.fadeIn("fast"),!0===this.builder.show_points_destroyed&&this.points_destroyed_button.fadeIn("fast"),this.builder.container.trigger("xwing:shipUpdated")},t.prototype.setPilotById=function(t,e){var o,r,d,c,i=__iced_k_noop,u=iced.findDeferral(arguments);if(null==e&&(e=!1),!this.builder.isQuickbuild)return i(this.setPilot(exportObj.pilotsById[parseInt(t)],e));var h,p,n=i;t===(p=this).quickbuildId?n():(p.wingmate_selector.parent().hide(),null!=p.wingmates&&0<p.wingmates.length&&p.setWingmates(0),p.quickbuildId=t,p.builder.current_squad.dirty=!0,p.resetPilot(),p.resetAddons(),h=function(){return p.row.removeClass("unsortable"),p.builder.container.trigger("xwing:pointsUpdated"),n(p.builder.container.trigger("xwing-backend:squadDirtinessChanged"))},null!=t&&-1<t?(r=exportObj.quickbuildsById[parseInt(t)],o=exportObj.pilots[r.pilot],p.data=exportObj.ships[r.ship],p.builder.isUpdatingPoints=!0,e=function(){var t,e,i,n,a,s,l;if(p.pilot=o,null!=p.pilot&&p.setupAddons(),p.copy_button.show(),p.setShipType(p.pilot.ship),null!=r.wingmate&&null==p.linkedShip)for(t=0,e=(i=p.builder.ships).length;t<e;t++)if((d=i[t]).quickbuildId===r.linkedId)return d.joinWing(p),p.linkedShip=d,p.primary=!1,p.builder.isUpdatingPoints=!1,p.builder.container.trigger("xwing:pointsUpdated"),void p.builder.container.trigger("xwing-backend:squadDirtinessChanged");n=function(){return p.primary=null==r.wingmate,null!=(null!=r?r.wingleader:void 0)&&(p.wingmate_selector.parent().show(),p.wingmate_selector.val(r.wingmates[0]),p.wingmate_selector.attr("min",r.wingmates[0]),p.wingmate_selector.attr("max",r.wingmates[r.wingmates.length-1]),p.setWingmates(r.wingmates[0])),p.builder.isUpdatingPoints=!1,h(p.builder.container.trigger("xwing:pointsUpdated"))},p.linkedShip?(a=n,null!=r.linkedId?(p.linkedShip.setPilotById(r.linkedId),a(null==r.wingmate?p.linkedShip.primary=!1:void 0)):(s=function(){return a(p.linkedShip=null)},0<(null!=(l=p.linkedShip.wingmates)?l.length:void 0)?s(p.linkedShip.removeFromWing(p)):(p.linkedShip.linkedShip=null,c=new iced.Deferrals(s,{parent:u,funcname:"Ship.setPilotById"}),p.builder.removeShip(p.linkedShip,c.defer({lineno:6288})),c._fulfill()))):n(null!=r.linkedId&&(p.linkedShip=p.builder.ships.slice(-1)[0],null!==p.linkedShip.data?p.linkedShip=p.builder.addShip():p.builder.addShip(),(p.linkedShip.linkedShip=p).linkedShip.setPilotById(r.linkedId),null==r.wingmate)&&(p.linkedShip.primary=!1))},null!=(null!=o?o.unique:void 0)?(c=new iced.Deferrals(e,{parent:u,funcname:"Ship.setPilotById"}),p.builder.container.trigger("xwing:claimUnique",[o,"Pilot",c.defer({lineno:6255})]),c._fulfill()):e()):h(p.copy_button.hide()))},t.prototype.addStandardizedUpgrades=function(){var t,e,i,n,a,s,l,o,r,d,c,u;if(!this.hasFixedUpgrades&&-1<(t=this.builder.standard_list.Ship.indexOf(null!=(r=this.data)?r.name:void 0))){for(e=(n=this.builder.standard_list.Upgrade[t]).restrictions||void 0,a=0,l=(d=this.upgrades).length;a<l;a++)if((null!=(c=(i=d[a]).data)?c.name:void 0)===n.name)return;for(s=0,o=(u=this.upgrades).length;s<o;s++)if(i=u[s],exportObj.slotsMatching(i.slot,this.builder.standard_list.Upgrade[t].slot)&&this.restriction_check(e,i)&&null==i.data)return void i.setData(n)}},t.prototype.addToStandardizedList=function(t){var e=this.builder.standard_list.Ship.indexOf(this.data.name);if(!(-1<e&&(null!=(e=this.builder.standard_list.Upgrade[e])?e.name:void 0)===t.name))return this.builder.standard_list.Upgrade.push(t),this.builder.standard_list.Ship.push(this.data.name)},t.prototype.removeStandardizedList=function(s){var l,o,t,e,i,n,a,r,d=this.builder.standard_list.Ship.indexOf(this.data.name);if(-1<d&&(null!=(i=this.builder.standard_list.Upgrade[d])?i.name:void 0)===s.name){for(this.builder.standard_list.Upgrade.splice(d,1),this.builder.standard_list.Ship.splice(d,1),r=[],t=0,e=(n=this.builder.ships).length;t<e;t++)(null!=(a=(l=n[t]).data)?a.name:void 0)===this.data.name&&l!==this?r.push((()=>{for(var t,e=l.upgrades,i=[],n=0,a=e.length;n<a;n++){if((null!=(t=(o=e[n]).data)?t.name:void 0)===s.name){o.setData(null);break}i.push(void 0)}return i})()):r.push(void 0);return r}},t.prototype.checkStandardizedList=function(t){var e,t=this.builder.standard_list.Ship.indexOf(t);if(-1<t&&null!=(null!=(e=this.builder.standard_list.Upgrade[t])?e.name:void 0))return this.builder.standard_list.Upgrade[t]},t.prototype.setPilot=function(m,_){var b,g,v,x,k,y,w,q,O,S,$,t,e,i,n,a=__iced_k_noop,s=iced.findDeferral(arguments);if(null==_&&(_=!1),m===this.pilot)return a();if(this.builder.current_squad.dirty=!0,w=null!=this.pilot&&(null!=m?m.ship:void 0)===this.pilot.ship,y={},w&&null==this.pilot.upgrades)for(t=0,e=(n=this.upgrades).length;t<e;t++)null!=(null!=(S=n[t])?S.data:void 0)&&(null==y[i=S.slot]&&(y[i]=[]),y[S.slot].push(S.data.id));this.resetPilot(),this.resetAddons();o=j=this;var l,o,j,T=function(){return o.row.removeClass("unsortable"),o.builder.container.trigger("xwing:pointsUpdated"),a(o.builder.container.trigger("xwing-backend:squadDirtinessChanged"))};null==m?T(j.copy_button.hide()):(j.data=exportObj.ships[null!=m?m.ship:void 0],l=function(){var t,e,i,n,a,s,l,o,r,d,c,u,h,p,f;if(j.pilot=m,null!=j.pilot&&j.setupAddons(),j.copy_button.show(),j.setShipType(j.pilot.ship),(null!=j.pilot.autoequip||null!=exportObj.ships[j.pilot.ship].autoequip&&!w)&&!_)for(t=0,n=(g=(null!=(d=j.pilot.autoequip)?d:[]).concat(null!=(d=exportObj.ships[j.pilot.ship].autoequip)?d:[])).length;t<n;t++)for($=g[t],b=exportObj.upgrades[$],e=0,a=(c=j.upgrades).length;e<a;e++)S=c[e],exportObj.slotsMatching(S.slot,b.slot)&&S.setData(b);if(w&&null==j.pilot.upgrades){for(i=1;i<=2;++i){for(v={},o=0,s=(u=j.upgrades).length;o<s;o++)S=u[o],null!=(k=(null!=(h=y[S.slot])?h:[]).shift())&&(S.setById(k),S.lastSetValid||(v[k]=S));for(x in v)(S=v[x]).setById(x)}for(O=j.checkStandardizedList(j.pilot.ship),q=!1,r=0,l=(p=j.upgrades).length;r<l;r++)S=p[r],null!=O&&null!=(null!=S&&null!=(f=S.data)?f.name:void 0)&&S.data.name===O.name&&(q=!0);null!=O&&!1===q&&j.removeStandardizedList(O)}return T()},null!=(null!=m?m.unique:void 0)?(s=new iced.Deferrals(l,{parent:s,funcname:"Ship.setPilot"}),j.builder.container.trigger("xwing:claimUnique",[m,"Pilot",s.defer({lineno:6389})]),s._fulfill()):l())},t.prototype.resetPilot=function(){__iced_k_noop;var t,e,i,n=iced.findDeferral(arguments),a=(t=e=this,function(){return t.pilot=null});null==(null!=(i=e.pilot)?i.unique:void 0)?a():(i=new iced.Deferrals(a,{parent:n,funcname:"Ship.resetPilot"}),e.builder.container.trigger("xwing:releaseUnique",[e.pilot,"Pilot",i.defer({lineno:6434})]),i._fulfill())},t.prototype.setupAddons=function(){var t,e,i,n,a,s,l,o,r,d,c,u,h,p,f,m,_;if(this.builder.isQuickbuild){for(_=[],l=0,d=(p=null!=(h=exportObj.quickbuildsById[this.quickbuildId].upgrades)?h:[]).length;l<d;l++)n=p[l],null==(i=exportObj.upgrades[n])?console.log("Unknown Upgrade: "+n):((e=new exportObj.QuickbuildUpgrade({ship:this,container:this.addon_container,slot:i.slot,upgrade:i})).setData(i),_.push(this.upgrades.push(e)));return _}if(null!=this.pilot.upgrades){for(this.hasFixedUpgrades=!0,f=[],a=0,o=(c=null!=(h=this.pilot.upgrades)?h:[]).length;a<o;a++)n=c[a],null==(i=exportObj.upgrades[n])?console.log("Unknown Upgrade: "+n):((e=new exportObj.QuickbuildUpgrade({ship:this,container:this.addon_container,slot:i.slot,upgrade:i})).setData(i),f.push(this.upgrades.push(e)));return f}for(this.hasFixedUpgrades=!1,m=[],s=0,r=(u=null!=(h=this.builder.isBeta&&null!=this.pilot.slotsbeta?this.pilot.slotsbeta:this.pilot.slots)?h:[]).length;s<r;s++)t=u[s],m.push(this.upgrades.push(new exportObj.Upgrade({ship:this,container:this.addon_container,slot:t})));return m},t.prototype.resetAddons=function(){__iced_k_noop;var t,e=iced.findDeferral(arguments),i=(t=this,function(){return t.upgrades=[]});new iced.Deferrals(i,{parent:e,funcname:"Ship.resetAddons"})._fulfill()},t.prototype.getPoints=function(){var t,e,i;return this.builder.isQuickbuild?(e=exportObj.quickbuildsById[this.quickbuildId],i=this.primary&&null!=(i=null!=e?e.threat:void 0)?i:0,null!=(null!=e?e.wingleader:void 0)&&(i=e.threat[e.wingmates.indexOf(this.wingmates.length)]),this.points_container.find("span").text(i),0<i?this.points_container.fadeTo("fast",1):this.points_container.fadeTo(0,0),i):(i=null!=this.pilot?(t=null!=(e=this.effectiveStats())?e.points:void 0,null!=e?e.loadout:void 0):t=0,this.points_container.find("div").text(""+t),this.points_container.find(".upgrade-points").text(null!=(null!=(e=this.pilot)?e.loadout:void 0)?"("+this.upgrade_points_total+"/"+i+")":""),0<t?this.points_container.fadeTo("fast",1):this.points_container.fadeTo(0,0),t)},t.prototype.setWingmates=function(n){__iced_k_noop;var a,t,e,s,l=iced.findDeferral(arguments);if((null!=(r=this.wingmates)?r.length:void 0)!==n){for(null!=this.wingmates&&0!==this.wingmates.length||(this.wingmates=[]),e=exportObj.quickbuildsById[this.quickbuildId];this.wingmates.length<n;)null!==(t=this.builder.ships.slice(-1)[0]).data?t=this.builder.addShip():this.builder.addShip(),(t.linkedShip=this).wingmates.push(t),t.setPilotById(e.wingmateId),t.primary=!1,this.primary=!0;i=o=this;var i,o,r=function(){return i.wingmate_selector.val(n)},d=function(t){var e=t,i=function(){return iced.trampoline(function(){return d(t)})};if(!(o.wingmates.length>n))return e();(a=o.wingmates.pop()).linkedShip=null,s=new iced.Deferrals(i,{parent:l,funcname:"Ship.setWingmates"}),o.builder.removeShip(a,s.defer({lineno:6542})),s._fulfill()};d(r)}},t.prototype.removeFromWing=function(t){var e;return this.wingmates.removeItem(t),t=exportObj.quickbuildsById[this.quickbuildId],e=this.wingmates.length,0<=__indexOf.call(t.wingmates,e)||this.destroy($.noop),this.wingmate_selector.val(this.wingmates.length)},t.prototype.joinWing=function(t){var e,i;return this.wingmates.push(t),e=exportObj.quickbuildsById[this.quickbuildId],i=this.wingmates.length,0<=__indexOf.call(e.wingmates,i)||(t.destroy($.noop),this.removeFromWing(t)),this.wingmate_selector.val(this.wingmates.length)},t.prototype.updateSelections=function(){var t,e,i,n,a,s,l;if(null==this.pilot)return this.pilot_selector.select2("data",null);for(this.ship_selector.select2("data",{id:this.pilot.ship,text:exportObj.ships[this.pilot.ship].display_name||this.pilot.ship,chassis:exportObj.ships[this.pilot.ship].chassis||"",xws:exportObj.ships[this.pilot.ship].name.canonicalize(),icon:exportObj.ships[this.pilot.ship].icon||exportObj.ships[this.pilot.ship].name.canonicalize()}),this.pilot_selector.select2("data",{id:this.pilot.id,text:(null!=(null!=(a=exportObj.settings)?a.initiative_prefix:void 0)&&exportObj.settings.initiative_prefix?this.pilot.skill+" - ":"")+(this.pilot.display_name||this.pilot.name)+(-1!==this.quickbuildId?exportObj.quickbuildsById[this.quickbuildId].suffix:"")+" ("+(-1!==this.quickbuildId?this.primary?exportObj.quickbuildsById[this.quickbuildId].threat:0:this.builder.isBeta&&null!=this.pilot.pointsbeta?this.pilot.pointsbeta:this.pilot.points)+(-1!==this.quickbuildId||null==this.pilot.loadout?"":this.builder.isBeta&&null!=this.pilot.loadoutbeta?"/"+this.pilot.loadoutbeta:"/"+this.pilot.loadout)+")",chassis:null!=this.pilot.chassis?this.pilot.chassis:""}),this.pilot_selector.data("select2").container.show(),l=[],i=0,n=(s=this.upgrades).length;i<n;i++)t=(e=s[i]).getPoints(),l.push(e.updateSelection(t));return l},t.prototype.checkPilotSelectorQueryModal=function(){return 768<=$(window).width()?this.pilot_query_modal.hide():this.pilot?this.pilot_query_modal.show():void 0},t.prototype.setupUI=function(){var t,e,i,n,a,s,l,o,r,d,c,u,h,p,f,m,_;return this.row=$(document.createElement("DIV")),this.row.addClass("row ship mb-5 mb-sm-0 unsortable"),this.row.insertBefore(this.builder.notes_container),this.row.append($.trim('<div class="col-md-3">\n    <div class="form-group d-flex">\n        <input class="ship-selector-container" type="hidden"></input>\n        <div class="d-block d-md-none input-group-append">\n            <button class="btn btn-secondary ship-query-modal"><i class="fas fa-question"></i></button>\n        </div>\n    <br />\n    </div>\n    <div class="form-group d-flex">\n        <input type="hidden" class="pilot-selector-container"></input>\n        <div class="d-block d-md-none input-group-append">\n            <button class="btn btn-secondary pilot-query-modal"><i class="fas fa-question"></i></button>\n        <br />\n        </div>\n    </div>\n    <label class="wingmate-label">\n    '+this.uitranslation("Wingmates")+': \n        <input type="number" class="wingmate-selector"></input>\n    </label>\n</div>\n<div class="col-md-1 points-display-container">\n     <div></div>\n     <div class="upgrade-points"></div>\n</div>\n<div class="col-md-6 addon-container">  </div>\n<div class="col-md-2 button-container">\n    <button class="btn btn-danger remove-pilot side-button"><span class="d-none d-sm-block" data-toggle="tooltip" title="'+this.uitranslation("Remove Pilot")+'"><i class="fa fa-times"></i></span><span class="d-block d-sm-none"> '+this.uitranslation("Remove Pilot")+'</span></button>\n    <button class="btn btn-light copy-pilot side-button"><span class="d-none d-sm-block" data-toggle="tooltip" title="'+this.uitranslation("Clone Pilot")+'"><i class="far fa-copy"></i></span><span class="d-block d-sm-none"> '+this.uitranslation("Clone Pilot")+'</span></button>\n    <button class="btn btn-light points-destroyed side-button" points-state"><span class="d-none d-sm-block destroyed-type" data-toggle="tooltip" title="'+this.uitranslation("Points Destroyed")+'"><i class="fas fa-circle"></i></i></span><span class="d-block d-sm-none destroyed-type-mobile"> '+this.uitranslation("Undamaged")+"</span></button>\n</div>")),this.row.find(".button-container span").tooltip(),this.ship_selector=$(this.row.find("input.ship-selector-container")),this.pilot_selector=$(this.row.find("input.pilot-selector-container")),this.wingmate_selector=$(this.row.find("input.wingmate-selector")),this.ship_query_modal=$(this.row.find("button.ship-query-modal")),this.pilot_query_modal=$(this.row.find("button.pilot-query-modal")),this.ship_query_modal.click((e=this,function(t){if(e.pilot)return e.builder.showTooltip("Ship",exportObj.ships[e.pilot.ship],null,e.builder.mobile_tooltip_modal,!0),e.builder.mobile_tooltip_modal.modal("show")})),this.pilot_query_modal.click((i=this,function(t){if(i.pilot)return i.builder.showTooltip("Pilot",i.pilot,i.pilot?i:void 0,i.builder.mobile_tooltip_modal,!0),i.builder.mobile_tooltip_modal.modal("show")})),t=function(t,e,i){return'<i class="xwing-miniatures-ship xwing-miniatures-ship-'+t.icon+'"></i> '+t.text},this.ship_selector.select2({width:"100%",placeholder:exportObj.translate("ui","shipSelectorPlaceholder"),query:(a=this,function(t){var e={results:[]};return e.results=a.builder.getAvailableShipsMatching(t.term),t.callback(e)}),minimumResultsForSearch:$.isMobile()?-1:0,formatResultCssClass:(n=this,function(t){var e;return null!=n.builder.collection&&"true"===n.builder.collection.checks.collectioncheck&&(e=!1,null!=n.pilot&&t.id===exportObj.ships[n.pilot.ship].id?n.builder.collection.checkShelf("ship",t.name)||n.builder.collection.checkTable("pilot",t.name)||(e=!0):e=!n.builder.collection.checkShelf("ship",t.name),e)?"select2-result-not-in-collection":""}),formatResult:t,formatSelection:t}),this.ship_selector.on("select2-focus",function(t){if($.isMobile())return $(".select2-container .select2-focusser").remove(),$(".select2-search input").prop("focus",!1).removeClass("select2-focused")}),this.ship_selector.on("change",(s=this,function(t){return s.setShipType(s.ship_selector.val())})),this.ship_selector.data("select2").results.on("mousemove-filtered",(l=this,function(t){t=$(t.target).closest(".select2-result").data("select2-data");if(null!=(null!=t?t.id:void 0))return l.builder.showTooltip("Ship",exportObj.ships[t.id])})),this.ship_selector.data("select2").container.on("mouseover",(o=this,function(t){if(o.pilot)return o.builder.showTooltip("Ship",exportObj.ships[o.pilot.ship])})),this.pilot_selector.select2({width:"100%",placeholder:exportObj.translate("ui","pilotSelectorPlaceholder"),query:(d=this,function(t){var e={results:[]};return e.results=d.builder.getAvailablePilotsForShipIncluding(d.ship_selector.val(),d.builder.isQuickbuild?d.quickbuildId:d.pilot,t.term,!0,d),t.callback(e)}),minimumResultsForSearch:$.isMobile()?-1:0,formatResultCssClass:(r=this,function(t){var e,i,n;return null!=r.builder.collection&&"true"===r.builder.collection.checks.collectioncheck&&(i=!1,e="",e=r.builder.isQuickbuild?null!=(n=null!=(n=exportObj.quickbuildsById[t.id])?n.pilot:void 0)?n:"unknown pilot":t.name,t.id===(null!=(n=r.pilot)?n.id:void 0)?r.builder.collection.checkShelf("pilot",e)||r.builder.collection.checkTable("pilot",e)||(i=!0):i=!r.builder.collection.checkShelf("pilot",e),i)?"select2-result-not-in-collection":""})}),this.pilot_selector.on("select2-focus",function(t){if($.isMobile())return $(".select2-container .select2-focusser").remove(),$(".select2-search input").prop("focus",!1).removeClass("select2-focused")}),this.pilot_selector.on("change",(c=this,function(t){return c.setPilotById(c.pilot_selector.select2("val")),c.builder.current_squad.dirty=!0,c.builder.container.trigger("xwing-backend:squadDirtinessChanged"),c.builder.backend_status.fadeOut("slow")})),this.pilot_selector.data("select2").results.on("mousemove-filtered",(u=this,function(t){var e,t=$(t.target).closest(".select2-result").data("select2-data");if(u.builder.isQuickbuild){if(null!=(null!=t?t.id:void 0))return u.builder.showTooltip("Quickbuild",exportObj.quickbuildsById[t.id],{ship:null!=(e=u.data)?e.name:void 0})}else if(null!=(null!=t?t.id:void 0))return u.builder.showTooltip("Pilot",exportObj.pilotsById[t.id])})),this.pilot_selector.data("select2").container.on("mouseover",(h=this,function(t){if(h.pilot)return h.builder.showTooltip("Pilot",h.pilot,h)})),this.pilot_selector.data("select2").container.hide(),this.builder.isQuickbuild&&(this.wingmate_selector.on("change",(p=this,function(t){return p.setWingmates(parseInt(p.wingmate_selector.val())),p.builder.current_squad.dirty=!0,p.builder.container.trigger("xwing-backend:squadDirtinessChanged"),p.builder.backend_status.fadeOut("slow")})),this.wingmate_selector.on("mousemove-filtered",function(t){})),this.wingmate_selector.parent().hide(),this.points_container=$(this.row.find(".points-display-container")),this.points_container.fadeTo(0,0),this.addon_container=$(this.row.find("div.addon-container")),this.remove_button=$(this.row.find("button.remove-pilot")),this.remove_button.click((f=this,function(t){return t.preventDefault(),f.row.slideUp("fast",function(){var t;return f.builder.removeShip(f),null!=(t=f.backend_status)?t.fadeOut("slow"):void 0})})),this.remove_button.hide(),this.copy_button=$(this.row.find("button.copy-pilot")),this.copy_button.click((m=this,function(t){for(var e,i=m.builder.ships,n=[],a=0,s=i.length;a<s;a++){if((e=i[a]).row.hasClass("unsortable")){e.copyFrom(m);break}n.push(void 0)}return n})),this.copy_button.hide(),this.checkPilotSelectorQueryModal(),this.points_destroyed_button_span=$(this.row.find(".destroyed-type")),this.points_destroyed_button_span_mobile=$(this.row.find(".destroyed-type-mobile")),this.points_destroyed_button=$(this.row.find("button.points-destroyed")),this.points_destroyed_button.click((_=this,function(t){switch(_.destroystate){case 0:_.destroystate++,_.points_destroyed_button.addClass("btn-warning"),_.points_destroyed_button.removeClass("btn-light"),_.points_destroyed_button_span_mobile.text(_.uitranslation("Half Damaged")),_.points_destroyed_button_span.html('<i class="fas fa-adjust"></i>');break;case 1:_.destroystate++,_.points_destroyed_button.addClass("btn-danger"),_.points_destroyed_button.removeClass("btn-warning"),_.points_destroyed_button_span_mobile.text(_.uitranslation("Fully Destroyed")),_.points_destroyed_button_span.html('<i class="far fa-circle"></i>');break;case 2:_.destroystate=0,_.points_destroyed_button.addClass("btn-light"),_.points_destroyed_button.removeClass("btn-danger"),_.points_destroyed_button_span_mobile.text(_.uitranslation("Undamaged")),_.points_destroyed_button_span.html('<i class="fas fa-circle"></i>')}return _.builder.onPointsUpdated()})),this.points_destroyed_button.hide()},t.prototype.teardownUI=function(){return this.row.text(""),this.row.remove()},t.prototype.toString=function(){return null!=this.pilot?this.uitranslation("PilotFlyingShip",this.pilot.display_name||this.pilot.name,this.data.display_name||this.data.name):this.data.display_name||this.data.name},t.prototype.toHTML=function(){var t,e,i,n,a,s,l,o,r,d,c,u,h,p,f,m,_=this.effectiveStats(),b=this.builder.formatActions(_.actions,'<div class="action-separator">&nbsp;&vert;&nbsp;</div>',null!=(b=this.pilot.keyword)?b:[]),g=null!=(g=this.data.attack_icon)?g:"xwing-miniatures-font-frontarc",v=null!=this.pilot.engagement?$.trim('<span class="info-data info-skill">ENG '+this.pilot.engagement+"</span>"):"",g=null!=_.attack?$.trim('<i class="xwing-miniatures-font header-attack '+g+'"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(g=null!=(g=this.pilot.ship_override)?g.attack:void 0)?g:this.data.attack,_,"attack")+"</span>"):"",x=null!=_.attackbull?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-bullseyearc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(x=null!=(x=this.pilot.ship_override)?x.attackbull:void 0)?x:this.data.attackbull,_,"attackbull")+"</span>"):"",k=null!=_.attackb?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-reararc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(k=null!=(k=this.pilot.ship_override)?k.attackb:void 0)?k:this.data.attackb,_,"attackb")+"</span>"):"",y=null!=_.attackf?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-fullfrontarc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(y=null!=(y=this.pilot.ship_override)?y.attackf:void 0)?y:this.data.attackf,_,"attackf")+"</span>"):"",w=null!=_.attackt?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-singleturretarc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(w=null!=(w=this.pilot.ship_override)?w.attackt:void 0)?w:this.data.attackt,_,"attackt")+"</span>"):"",q=null!=_.attackl?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-leftarc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(q=null!=(q=this.pilot.ship_override)?q.attackl:void 0)?q:this.data.attackl,_,"attackl")+"</span>"):"",O=null!=_.attackr?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-rightarc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(O=null!=(O=this.pilot.ship_override)?O.attackr:void 0)?O:this.data.attackr,_,"attackr")+"</span>"):"",S=null!=_.attackdt?$.trim('<i class="xwing-miniatures-font header-attack xwing-miniatures-font-doubleturretarc"></i>\n<span class="info-data info-attack">'+statAndEffectiveStat(null!=(S=null!=(S=this.pilot.ship_override)?S.attackdt:void 0)?S:this.data.attackdt,_,"attackdt")+"</span>"):"",j="";if(null!=this.data.energyrecurr)for(t=0;t<this.data.energyrecurr;)j+='<sup><i class="fas fa-caret-up"></i></sup>',++t;if(h=null!=(null!=(h=this.pilot.ship_override)?h.energy:void 0)||null!=this.data.energy?$.trim('<i class="xwing-miniatures-font header-energy xwing-miniatures-font-energy"></i>\n<span class="info-data info-energy">'+statAndEffectiveStat(null!=(h=null!=(h=this.pilot.ship_override)?h.energy:void 0)?h:this.data.energy,_,"energy")+j+"</span>"):"",null!=_.force)if(j="",null!=_.forcerecurring)for(t=0;t<_.forcerecurring;)j+='<sup><i class="fas fa-caret-up"></i></sup>',++t;else j+='<sup><i class="fas fa-caret-up"></i></sup>';if(p=null!=_.force&&0<_.force?$.trim('<i class="xwing-miniatures-font header-force xwing-miniatures-font-forcecharge"></i>\n<span class="info-data info-force">'+statAndEffectiveStat(null!=(p=null!=(p=null!=(p=this.pilot.ship_override)?p.force:void 0)?p:this.pilot.force)?p:0,_,"force")+j+"</span>"):"",null!=this.pilot.charge){if(j="",null!=this.pilot.recurring)if(0<this.pilot.recurring)for(t=0;t<this.pilot.recurring;)j+='<sup><i class="fas fa-caret-up"></i></sup>',++t;else for(t=this.pilot.recurring;t<0;)j+='<sub><i class="fas fa-caret-down"></i></sub>',++t;f=$.trim('<i class="xwing-miniatures-font header-charge xwing-miniatures-font-charge"></i><span class="info-data info-charge">'+statAndEffectiveStat(null!=(f=null!=(f=this.pilot.ship_override)?f.charge:void 0)?f:this.pilot.charge,_,"charge")+j+"</span>")}else f="";if(s="",null!=this.data.shieldrecurr)for(t=0;t<this.data.shieldrecurr;)s+='<sup><i class="fas fa-caret-up"></i></sup>',++t;if(a="",_.shields){for(r=_.shields;2<=r;r+=-1)a+='<i class="xwing-miniatures-font header-shield xwing-miniatures-font-shield expanded-hull-or-shield"></i>';a+='<i class="xwing-miniatures-font header-shield xwing-miniatures-font-shield"></i>'}if(i="",_.hull){for(d=_.hull;2<=d;d+=-1)i+='<i class="xwing-miniatures-font header-hull xwing-miniatures-font-hull expanded-hull-or-shield"></i>';i+='<i class="xwing-miniatures-font header-hull xwing-miniatures-font-hull"></i>'}if(m=null!=_.shields&&0<_.shields?$.trim('<span class="info-data info-shields">'+statAndEffectiveStat(null!=(m=null!=(m=this.pilot.ship_override)?m.shields:void 0)?m:this.data.shields,_,"shields")+s+"</span>"):"",e=$.trim('<div class="fancy-pilot-header">\n    <div class="pilot-header-text">'+(this.pilot.display_name||this.pilot.name)+' <i class="xwing-miniatures-ship xwing-miniatures-ship-'+this.data.name.canonicalize()+'"></i><span class="fancy-ship-type"> '+(this.data.display_name||this.data.name)+'</span></div>\n    <div class="mask">\n        <div class="outer-circle">\n            <div class="inner-circle pilot-points">'+(-1!==this.quickbuildId?this.primary?this.getPoints():"*":this.builder.isBeta&&null!=this.pilot.pointsbeta?this.pilot.pointsbeta:this.pilot.points)+'</div>\n        </div>\n    </div>\n</div>\n<div class="fancy-pilot-stats">\n    <div class="pilot-stats-content">\n        <span class="info-data info-skill">INI '+statAndEffectiveStat(this.pilot.skill,_,"skill")+"</span>\n        "+v+"\n        "+x+"\n        "+g+"\n        "+k+"\n        "+y+"\n        "+w+"\n        "+q+"\n        "+O+"\n        "+S+'\n        <i class="xwing-miniatures-font header-agility xwing-miniatures-font-agility"></i>\n        <span class="info-data info-agility">'+statAndEffectiveStat(null!=(x=null!=(v=this.pilot.ship_override)?v.agility:void 0)?x:this.data.agility,_,"agility")+"</span>                    \n        "+i+'\n        <span class="info-data info-hull">'+statAndEffectiveStat(null!=(k=null!=(g=this.pilot.ship_override)?g.hull:void 0)?k:this.data.hull,_,"hull")+"</span>\n        "+a+"\n        "+m+"\n        "+h+"\n        "+p+"\n        "+f+'\n        <br />\n        <div class="action-bar">\n            '+b+"\n        </div>\n    </div>\n</div>"),this.pilot.text&&(e+=$.trim('<div class="fancy-pilot-text">'+this.pilot.text+"</div>")),""!==(y=null!=(null!=_?_.chassis:void 0)&&""!==_.chassis?_.chassis:null!=this.data.chassis?this.data.chassis:"")&&(e+=$.trim('<div class="fancy-pilot-chassis"><strong>'+(null!=(q=null!=(w=exportObj.chassis[y])?w.display_name:void 0)?q:y)+":</strong> "+exportObj.chassis[y].text+"</div>")),0<(l=function(){for(var t=this.upgrades,e=[],i=0,n=t.length;i<n;i++)null!=(o=t[i]).data&&e.push(o);return e}.call(this)).length){for(e+=$.trim('<div class="fancy-upgrade-container">'),c=0,u=l.length;c<u;c++)n=(o=l[c]).getPoints(),e+=o.toHTML(n);e+=$.trim("</div>")}return O=Math.floor(this.getPoints()/2),S=Math.floor((_.hull+_.shields)/2),'<div class="fancy-ship">'+(e+=$.trim('<div class="ship-points-total">\n    <strong>'+this.uitranslation("Ship Cost")+": "+this.getPoints()+", "+this.uitranslation("Loadout")+": ("+this.upgrade_points_total+(this.builder.isBeta&&null!=this.pilot.loadoutbeta?"/"+this.pilot.loadoutbeta:null!=this.pilot.loadout?"/"+this.pilot.loadout:"")+"), "+this.uitranslation("Half Points")+": "+O+", "+this.uitranslation("Damage Threshold")+": "+S+"</strong> \n</div>"))+"</div>"},t.prototype.toTableRow=function(){var t,e,i,a,n,s,l=$.trim('<tr class="simple-pilot">\n    <td class="name">'+(this.pilot.display_name||this.pilot.name)+" &mdash; "+(this.data.display_name||this.data.name)+'</td>\n    <td class="points">'+(-1!==this.quickbuildId?this.primary?exportObj.quickbuildsById[this.quickbuildId].threat:0:this.builder.isBeta&&null!=this.pilot.pointsbeta?this.pilot.pointsbeta:this.pilot.points)+"</td>\n</tr>"),o=function(){for(var t=this.upgrades,e=[],i=0,n=t.length;i<n;i++)null!=(a=t[i]).data&&e.push(a);return e}.call(this);if(0<o.length)for(n=0,s=o.length;n<s;n++)e=(a=o[n]).getPoints(),l+=a.toTableRow(e);return l+='<tr class="simple-ship-total"><td colspan="2">'+this.uitranslation("Ship Cost")+": "+this.getPoints()+"</td></tr>",t=Math.floor(this.getPoints()/2),i=Math.floor((this.effectiveStats().hull+this.effectiveStats().shields)/2),l=l+('<tr class="simple-ship-half-points"><td colspan="2">'+this.uitranslation("Loadout")+": ("+this.upgrade_points_total+(this.builder.isBeta&&null!=this.pilot.loadoutbeta?"/"+this.pilot.loadoutbeta:null!=this.pilot.loadout?"/"+this.pilot.loadout:"")+") "+this.uitranslation("Half Points")+": "+t+" "+this.uitranslation("Damage Threshold")+": "+i+"</td></tr>")+"<tr><td>&nbsp;</td><td></td></tr>"},t.prototype.toSimpleCopy=function(){var t,e,i,a,n,s,l,o=this.pilot.display_name+" – "+this.data.display_name+" ("+(-1!==this.quickbuildId?this.primary?exportObj.quickbuildsById[this.quickbuildId].threat:0:this.builder.isBeta&&null!=this.pilot.pointsbeta?this.pilot.pointsbeta:this.pilot.points)+")    \n",r=function(){for(var t=this.upgrades,e=[],i=0,n=t.length;i<n;i++)null!=(a=t[i]).data&&e.push(a);return e}.call(this);if(0<r.length){for(o+="    ",e=[],s=0,l=r.length;s<l;s++)n=(a=r[s]).getPoints(),null!=(n=a.toSimpleCopy(n))&&e.push(n);o=o+e.join("    ")+"    \n"}return t=Math.floor(this.getPoints()/2),i=Math.floor((this.effectiveStats().hull+this.effectiveStats().shields)/2),o+=this.uitranslation("Ship Cost")+": "+this.getPoints()+"  "+this.uitranslation("Loadout")+": ("+this.upgrade_points_total+(this.builder.isBeta&&null!=this.pilot.loadoutbeta?"/"+this.pilot.loadoutbeta:null!=this.pilot.loadout?"/"+this.pilot.loadout:"")+")  "+this.uitranslation("Half Points")+": "+t+"  "+this.uitranslation("Damage Threshold")+": "+i+"    \n    \n"},t.prototype.toRedditText=function(){var t,e,i,a,n,s,l,o="**"+this.pilot.name+" ("+(-1!==this.quickbuildId?this.primary?exportObj.quickbuildsById[this.quickbuildId].threat:0:this.builder.isBeta&&null!=this.pilot.pointsbeta?this.pilot.pointsbeta:this.pilot.points)+")**    \n",r=function(){for(var t=this.upgrades,e=[],i=0,n=t.length;i<n;i++)null!=(a=t[i]).data&&e.push(a);return e}.call(this);if(0<r.length){for(t=Math.floor(this.getPoints()/2),i=Math.floor((this.effectiveStats().hull+this.effectiveStats().shields)/2),o+="    ",e=[],s=0,l=r.length;s<l;s++)n=(a=r[s]).getPoints(),null!=(n=a.toRedditText(n))&&e.push(n);o=(o+=e.join("    "))+("&nbsp;*"+this.uitranslation("Ship Cost")+": "+this.getPoints()+"  "+this.uitranslation("Loadout")+": ("+this.upgrade_points_total+(this.builder.isBeta&&null!=this.pilot.loadoutbeta?"/"+this.pilot.loadoutbeta:null!=this.pilot.loadout?"/"+this.pilot.loadout:"")+")  "+this.uitranslation("Half Points")+": "+t+"  "+this.uitranslation("Damage Threshold")+": "+i+"*    \n")}return o},t.prototype.toTTSText=function(){var a,t,e,i,n=""+exportObj.toTTS(this.pilot.name),s=function(){for(var t=this.upgrades,e=[],i=0,n=t.length;i<n;i++)null!=(a=t[i]).data&&e.push(a);return e}.call(this);if(0<s.length&&null==this.pilot.upgrades)for(e=0,i=s.length;e<i;e++)null!=(t=(a=s[e]).toTTSText())&&(n+=" + "+t);return n+" / "},t.prototype.toSerialized=function(){var s,l,t;return this.builder.isQuickbuild?null==this.wingmates||0===this.wingmates.length?this.quickbuildId+"X":this.quickbuildId+"X"+this.wingmates.length:(t=(""+function(){var t,e,i,n=this.upgrades,a=[];for(s=t=0,e=n.length;t<e;s=++t)l=n[s],a.push(null!=(i=null!=l&&null!=(i=l.data)?i.id:void 0)?i:"");return a}.call(this)).replace(/,/g,"W"),[this.pilot.id,t].join("X"))},t.prototype.fromSerialized=function(t,e){var i,n,a,s,l,o,r,d,c,u,h,p,f,m,_,b,g,v=!0;switch(t){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:console.log("Incorrect Version!"),this.old_version_container.toggleClass("d-none",!1);break;case 9:if(n=(f=e.split("X"))[0],l=(l=f[1]).split("W"),this.setPilotById(parseInt(n),!0),!this.validate)return!1;if(this.builder.isQuickbuild)0<l.length&&0<this.wingmates.length&&this.setWingmates(l[0]);else for(r=1;r<3;++r)t:for(i=d=m=l.length-1;m<=-1?d<-1:-1<d;i=m<=-1?++d:--d)if(s=l[i],null==(a=exportObj.upgradesById[s]))l.splice(i,1),""!==s&&(console.log("Unknown upgrade id "+s+" could not be added. Please report that error"),v=!1);else{for(c=0,h=(_=this.upgrades).length;c<h;c++)if((null!=(o=_[c])&&null!=(b=o.data)?b.name:void 0)===a.name){l.splice(i,1);continue t}for(u=0,p=(g=this.upgrades).length;u<p;u++)if(o=g[u],exportObj.slotsMatching(a.slot,o.slot)&&!o.isOccupied()){o.setById(s),o.lastSetValid&&l.splice(i,1);break}}v&=0===l.length}return this.updateSelections(),v},t.prototype.effectiveStats=function(){var t,e,i,n,a,s,l,o,r,d,c,u,h,p,f={attack:null!=(p=null!=(p=this.pilot.ship_override)?p.attack:void 0)?p:this.data.attack,attackf:null!=(p=null!=(p=this.pilot.ship_override)?p.attackf:void 0)?p:this.data.attackf,attackbull:null!=(p=null!=(p=this.pilot.ship_override)?p.attackbull:void 0)?p:this.data.attackbull,attackb:null!=(p=null!=(p=this.pilot.ship_override)?p.attackb:void 0)?p:this.data.attackb,attackt:null!=(p=null!=(p=this.pilot.ship_override)?p.attackt:void 0)?p:this.data.attackt,attackl:null!=(p=null!=(p=this.pilot.ship_override)?p.attackl:void 0)?p:this.data.attackl,attackr:null!=(p=null!=(p=this.pilot.ship_override)?p.attackr:void 0)?p:this.data.attackr,attackdt:null!=(p=null!=(p=this.pilot.ship_override)?p.attackdt:void 0)?p:this.data.attackdt,energy:null!=(p=null!=(p=this.pilot.ship_override)?p.energy:void 0)?p:this.data.energy,agility:null!=(p=null!=(p=this.pilot.ship_override)?p.agility:void 0)?p:this.data.agility,hull:null!=(p=null!=(p=this.pilot.ship_override)?p.hull:void 0)?p:this.data.hull,shields:null!=(p=null!=(p=this.pilot.ship_override)?p.shields:void 0)?p:this.data.shields,force:null!=(p=null!=(p=null!=(p=this.pilot.ship_override)?p.force:void 0)?p:this.pilot.force)?p:0,forcerecurring:null!=(p=this.pilot.forcerecurring)?p:1,charge:null!=(p=null!=(p=this.pilot.ship_override)?p.charge:void 0)?p:this.pilot.charge,actions:(null!=(p=null!=(p=this.pilot.ship_override)?p.actions:void 0)?p:this.data.actions).slice(0),chassis:null!=(p=null!=(p=this.pilot.chassis)?p:this.data.chassis)?p:"",points:null!=(p=this.pilot.points)?p:0,loadout:null!=(p=this.pilot.loadout)?p:0,skill:null!=(p=this.pilot.skill)?p:0};for(this.builder.isBeta&&(null!=this.pilot.pointsbeta&&(f.points=this.pilot.pointsbeta),null!=this.pilot.loadoutbeta)&&(f.loadout=this.pilot.loadoutbeta),f.maneuvers=[],e=a=0,d=(null!=(p=this.data.maneuvers)?p:[]).length;0<=d?a<d:d<a;e=0<=d?++a:--a)f.maneuvers[e]=this.data.maneuvers[e].slice(0);if(null!=this.pilot.keyword&&0<=__indexOf.call(this.pilot.keyword,"Droid")&&null!=f.actions){for(t=[],s=0,o=(c=f.actions).length;s<o;s++)i=c[s],t.push(i.replace("Focus","Calculate"));f.actions=t}for(l=0,r=(u=this.upgrades).length;l<r;l++)null!=(null!=(n=u[l])&&null!=(h=n.data)?h.chassis:void 0)&&(f.chassis=n.data.chassis),null!=(null!=n&&null!=(h=n.data)?h.modifier_func:void 0)&&n.data.modifier_func(f);return null!=(null!=(p=this.pilot)?p.modifier_func:void 0)&&this.pilot.modifier_func(f),null!=exportObj.chassis[f.chassis]&&null!=exportObj.chassis[f.chassis].modifier_func&&exportObj.chassis[f.chassis].modifier_func(f),f},t.prototype.validate=function(){var t,e,i,n,a,s,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k,y,w,q,O,S,j,T,C,I;if(null==this.pilot)return!0;if(s=!0,this.builder.isEpic){if(null!=this.pilot.slots&&!(0<=__indexOf.call(this.pilot.slots,"Command"))){for(t=!0,d=0,p=(v=this.upgrades).length;d<p;d++)"Command"===(l=v[d]).slot&&this===l.ship&&(t=!1);!0===t&&this.upgrades.push(new exportObj.Upgrade({ship:this,container:this.addon_container,slot:"Command"}))}}else if(!this.builder.isQuickbuild)for(i=c=x=this.upgrades.length-1;x<=-1?c<-1:-1<c;i=x<=-1?++c:--c)"Command"===(l=this.upgrades[i]).slot&&(l.destroy($.noop),this.upgrades.splice(i,1));for(i=u=0;u<32;i=++u){if(r=!0,j=null!=(j=null!=(j=null!=(j=this.pilot)?j.validation_func:void 0)?j:null!=(j=this.pilot)?j.restriction_func:void 0)?j:void 0,a=null!=this.pilot.upgrades,null!=j&&!j(this,this.pilot)||!this.builder.isItemAvailable(this.pilot,!0))return this.builder.removeShip(this),!1;for(e=[],h=this.upgrade_points_total=0,f=(T=this.upgrades).length;h<f;h++){if(l=T[h],n=!0,!a){if(null!=(null!=(C=null!=l&&null!=(C=l.data)?C.validation_func:void 0)?C:void 0)&&(n=n&&(null!=l&&null!=(I=l.data)?I.validation_func(this,l):void 0)),this.builder.isBeta&&null!=(null!=l&&null!=(I=l.data)?I.also_occupies_upgrades_beta:void 0))for(b=0,m=(k=l.data.also_occupies_upgrades_beta).length;b<m;b++)o=k[b],n=n&&l.occupiesAnUpgradeSlot(o);else if(null!=(null!=l&&null!=(w=l.data)?w.also_occupies_upgrades:void 0))for(g=0,_=(y=l.data.also_occupies_upgrades).length;g<_;g++)o=y[g],n=n&&l.occupiesAnUpgradeSlot(o);q=null!=(q=null!=l&&null!=(w=l.data)?w.restrictions:void 0)?q:void 0,n=n&&this.restriction_check(q,l,l.getPoints(),this.upgrade_points_total)}if((!n||null!=(null!=l?l.data:void 0)&&(q=l.data,0<=__indexOf.call(e,q)||null!=l.data.faction&&!this.builder.isOurFaction(l.data.faction,this.pilot.faction)||!this.builder.isItemAvailable(l.data)))&&!a&&!this.builder.isQuickbuild){console.log("Invalid upgrade: "+(null!=l&&null!=(O=l.data)?O.name:void 0)+", check "+(null!=(O=this.pilot)?O.upgrades:void 0)+" on pilot "+(null!=(S=this.pilot)?S.name:void 0)),l.setById(null),s=r=!1;break}null!=(null!=l?l.data:void 0)&&l.data&&e.push(null!=l?l.data:void 0),this.upgrade_points_total+=l.getPoints()}if(r)break}return this.updateSelections(),s},t.prototype.checkUnreleasedContent=function(){var t,e,i,n;if(null!=this.pilot&&!exportObj.isReleased(this.pilot))return!0;for(e=0,i=(n=this.upgrades).length;e<i;e++)if(null!=(null!=(t=n[e])?t.data:void 0)&&!exportObj.isReleased(t.data)&&null==t.data.standard)return!0;return!1},t.prototype.hasAnotherUnoccupiedSlotLike=function(t,e){for(var i,n=this.upgrades,a=0,s=n.length;a<s;a++)if((i=n[a])!==t&&exportObj.slotsMatching(i.slot,e)&&"HardpointShip"!==i.slot&&"VersatileShip"!==i.slot&&!i.isOccupied())return!0;return!1},t.prototype.hasFilledSlotLike=function(t,e){for(var i,n=this.upgrades,a=0,s=n.length;a<s;a++)if((i=n[a])!==t&&exportObj.slotsMatching(i.slot,e)&&i.isOccupied())return!0;return!1},t.prototype.restriction_check=function(t,e,i,n,a){var s,l,o,r,d,c,u,h,p,f,m,_,b,g,v;if(null==i&&(i=0),null==n&&(n=0),null==a&&(a=void 0),d=this.effectiveStats(),null!=this.pilot.loadout&&d.loadout<i+n)return!1;if(null!=t)for(h=0,m=t.length;h<m;h++)switch((c=t[h])[0]){case"FactionOrUnique":if(this.pilot.faction===c[2]||this.checkListForUnique(c[1].toLowerCase().replace(/[^0-9a-z]/gi,"").replace(/\s+/g,"-")))break;return!1;case"Base":for(r=!1,p=0,_=c.length;p<_;p++)if("Base"!==(l=c[p])){switch(o=l.startsWith("Non-")?l.substring(4):l){case"Small":null==this.data.base&&(r=!0);break;case"Standard":null!=this.data.base&&"Huge"===this.data.base||(r=!0);break;default:null!=this.data.base&&this.data.base===o&&(r=!0)}if(!0===(r=l!==o?!r:r))break}if(!1===r)return!1;break;case"Action":if(c[1].startsWith("W-")){if(u=c[1].substring(2),__indexOf.call(d.actions,u)<0)return!1}else{for(r=!1,f=0,b=(g=d.actions).length;f<b;f++)(s=g[f]).includes(c[1])&&!s.includes(">")&&(r=!0);if(!1===r)return!1}break;case"Keyword":if(this.checkKeyword(c[1]))break;return!1;case"Equipped":if(this.doesSlotExist(c[1])&&this.hasFilledSlotLike(e,c[1]))break;return!1;case"Slot":if((this.hasAnotherUnoccupiedSlotLike(e,c[1])||null!=e&&"function"==typeof e.occupiesAnUpgradeSlot&&e.occupiesAnUpgradeSlot(c[1]))&&"HardpointShip"!==e.slot&&"VersatileShip"!==e.slot)break;return!1;case"AttackArc":if(null==this.data.attackb)return!1;break;case"ShieldsGreaterThan":if(this.data.shields>c[1])break;return!1;case"EnergyGreatterThan":if(d.energy>c[1])break;return!1;case"InitiativeGreaterThan":if(this.pilot.skill>c[1])break;return!1;case"InitiativeLessThan":if(this.pilot.skill<c[1])break;return!1;case"HasForce":this.pilot.force,c[1];break;case"AgilityEquals":if(d.agility!==c[1])return!1;break;case"isUnique":if(c[1]!==(null!=this.pilot.unique||null!=this.pilot.max_per_squad))return!1;break;case"Format":switch(c[1]){case"Epic":if(v=this.data.name,0<=__indexOf.call(exportObj.epicExclusionsList,v))break;return!1;case"Standard":if(v=this.data.name,0<=__indexOf.call(exportObj.epicExclusionsList,v))return!1}}return!0},t.prototype.standardized_check=function(t){var e,i,n,a,s,l,o,r,d,c,u,h=!1;if(this.builder.isBeta?null!=t.standardizedbeta&&(h=t.standardizedbeta):null!=t.standardized&&(h=!0),h)for(s=0,o=(d=this.builder.ships).length;s<o;s++)if(null!=(null!=(i=d[s])?i.data:void 0)&&i.data.name===this.data.name&&(this.builder.isBeta&&(null!=t.restrictionsbeta?e=t.restrictionsbeta:null!=t.restrictions&&(e=t.restrictions)),null!=e)&&i.restriction_check(e,t)&&null==(null!=(c=i.pilot)?c.upgrades:void 0)){if(null!=i.pilot.loadout&&t.points+i.upgrade_points_total>i.pilot.loadout)return!1;for(n=!1,l=0,r=(u=i.upgrades).length;l<r;l++)a=u[l],t.slot===a.slot&&null==a.data&&(n=!0);if(!1===n)return!1}return!0},t.prototype.doesSlotExist=function(t){for(var e,i=this.upgrades,n=0,a=i.length;n<a;n++)if(e=i[n],exportObj.slotsMatching(e.slot,t))return!0;return!1},t.prototype.isSlotOccupied=function(t){for(var e,i=this.upgrades,n=0,a=i.length;n<a;n++)if(e=i[n],exportObj.slotsMatching(e.slot,t)&&!e.isOccupied())return!0;return!1},t.prototype.checkKeyword=function(t){var e,i,n,a,s,l,o,r,d,c,u,h,p,f;if(null!=(c=this.data.name)&&c.includes(t))return!0;if(null!=this.pilot.chassis){if(this.pilot.chassis===t)return!0}else if(null!=this.data.chassis&&this.data.chassis===t)return!0;for(e=0,s=(d=null!=(c=this.data.keyword)?c:[]).length;e<s;e++)if(d[e]===t)return!0;for(i=0,l=(u=null!=(c=this.pilot.keyword)?c:[]).length;i<l;i++)if(u[i]===t)return!0;for(n=0,o=(h=this.upgrades).length;n<o;n++){if(null!=(p=h[n]).chassis&&p.chassis===t)return!0;for(a=0,r=(f=null!=(p=null!=p&&null!=(p=p.data)?p.keyword:void 0)?p:[]).length;a<r;a++)if(f[a]===t)return!0}return!1},t.prototype.checkListForUnique=function(t){var e,n,a,i=this.builder.uniques_in_use;for(e in i)if(a=i[e],"Slot"!==e&&0<=__indexOf.call((()=>{for(var t=[],e=0,i=a.length;e<i;e++)n=a[e],t.push(n.canonical_name.getXWSBaseName());return t})(),t))return!0;return!1},t.prototype.toXWS=function(){var t,e,i,n,a,s={id:null!=(s=this.pilot.xws)?s:this.pilot.canonical_name,name:null!=(s=this.pilot.xws)?s:this.pilot.canonical_name,points:this.getPoints(),ship:this.data.name.canonicalize()};if(this.data.multisection&&(s.multisection=this.data.multisection.slice(0)),e={},!this.pilot.upgrades)for(i=0,n=(a=this.upgrades).length;i<n;i++)null!=(null!=(t=a[i])?t.data:void 0)&&t.toXWS(e);return 0<Object.keys(e).length&&(s.upgrades=e),s},t.prototype.getConditions=function(){var t,e,i,n,a,s,l,o,r,d,c,u,h,p;if("undefined"==typeof Set||null===Set)return console.warn("Set not supported in this JS implementation, not implementing conditions"),[];if(e=new Set,null!=(null!=(d=this.pilot)?d.applies_condition:void 0))if(this.pilot.applies_condition instanceof Array)for(n=0,l=(c=this.pilot.applies_condition).length;n<l;n++)t=c[n],e.add(exportObj.conditionsByCanonicalName[t]);else e.add(exportObj.conditionsByCanonicalName[this.pilot.applies_condition]);for(a=0,o=(u=this.upgrades).length;a<o;a++)if(null!=(null!=(i=u[a])&&null!=(h=i.data)?h.applies_condition:void 0))if(i.data.applies_condition instanceof Array)for(s=0,r=(p=i.data.applies_condition).length;s<r;s++)t=p[s],e.add(exportObj.conditionsByCanonicalName[t]);else e.add(exportObj.conditionsByCanonicalName[i.data.applies_condition]);return e},t})(),GenericAddon=(()=>{function t(t){this.ship=t.ship,this.container=$(t.container),this.data=null,this.unadjusted_data=null,this.conferredAddons=[],this.serialization_code="X",this.occupied_by=null,this.occupying=[],this.destroyed=!1,this.type=null,this.dataByName=null,(this.dataById=null)!=t.adjustment_func&&(this.adjustment_func=t.adjustment_func),null!=t.filter_func&&(this.filter_func=t.filter_func),this.placeholderMod_func=null!=t.placeholderMod_func?t.placeholderMod_func:function(t){return t}}return t.prototype.destroy=function(){__iced_k_noop;var n,a,s,t,e,i=iced.findDeferral(arguments),l=arguments[0],o=2<=arguments.length?__slice.call(arguments,1):[];if(this.destroyed)return l(o);s=t=this;var r=function(){var t,e,i;if(s.isStandardized()){for(n=!0,t=0,e=(i=s.ship.builder.ships).length;t<e;t++)null!=(a=i[t]).data&&s.ship.data.name===a.data.name&&s.ship!==a&&(n=!1);!0===n&&s.ship.removeStandardizedList(s.data)}return s.destroyed=!0,s.rescindAddons(),s.deoccupyOtherUpgrades(),s.selector.select2("destroy"),s.selectorwrap.remove(),l(o)};null==(null!=(e=t.data)?e.unique:void 0)?r():(e=new iced.Deferrals(r,{parent:i,funcname:"GenericAddon.destroy"}),t.ship.builder.container.trigger("xwing:releaseUnique",[t.data,t.type,e.defer({lineno:7521})]),e._fulfill())},t.prototype.isStandardized=function(){var t;return this.ship.builder.isBeta&&null!=(null!=(t=this.data)?t.standardizedbeta:void 0)?this.data.standardizedbeta:null!=(null!=(t=this.data)?t.standardized:void 0)},t.prototype.setupSelector=function(t){var n,a,e,i,s,l;return this.selectorwrap=$(document.createElement("div")),this.selectorwrap.addClass("form-group d-flex upgrade-box"),this.selector=$(document.createElement("INPUT")),this.selector.attr("type","hidden"),this.selectorwrap.append(this.selector),this.selectorwrap.append($.trim('<div class="input-group-addon">\n    <button class="btn btn-secondary d-block d-md-none upgrade-query-modal"><i class="fas fa-question"></i></button>\n</div>')),this.upgrade_query_modal=$(this.selectorwrap.find("button.upgrade-query-modal")),this.container.append(this.selectorwrap),$.isMobile()&&(t.minimumResultsForSearch=-1),t.formatResultCssClass=(n=this,function(t){var e,i;return null!=n.ship.builder.collection&&(e=!1,t.id===(null!=(i=n.data)?i.id:void 0)?n.ship.builder.collection.checkShelf(n.type.toLowerCase(),t.name)||n.ship.builder.collection.checkTable(n.type.toLowerCase(),t.name)||(e=!0):e=!n.ship.builder.collection.checkShelf(n.type.toLowerCase(),t.name),e)?"select2-result-not-in-collection":""}),t.formatSelection=(a=this,function(t,e){var i=function(){return("Upgrade"!==this.type?this.type:this.slot).toLowerCase().replace(/[^0-9a-z]/gi,"")}.call(a);i=i.replace("configuration","config").replace("force","forcepower"),$(e).append('<i class="xwing-miniatures-font xwing-miniatures-font-'+i+'"></i> '+t.text)}),this.selector.select2(t),this.upgrade_query_modal.click((e=this,function(t){if(e.data)return console.log(""+e.data.name),e.ship.builder.showTooltip("Addon",e.data,null!=e.data?{addon_type:e.type}:void 0,e.ship.builder.mobile_tooltip_modal,!0),e.ship.builder.mobile_tooltip_modal.modal("show")})),this.selector.on("select2-focus",function(t){if($.isMobile())return $(".select2-container .select2-focusser").remove(),$(".select2-search input").prop("focus",!1).removeClass("select2-focused")}),this.selector.on("change",(i=this,function(t){return i.setById(i.selector.select2("val")),i.ship.builder.current_squad.dirty=!0,i.ship.builder.container.trigger("xwing-backend:squadDirtinessChanged"),i.ship.builder.backend_status.fadeOut("slow")})),this.selector.data("select2").results.on("mousemove-filtered",(s=this,function(t){t=$(t.target).closest(".select2-result").data("select2-data");if(null!=(null!=t?t.id:void 0))return s.ship.builder.showTooltip("Addon",s.dataById[t.id],{addon_type:s.type})})),this.selector.data("select2").container.on("mouseover",(l=this,function(t){if(null!=l.data)return l.ship.builder.showTooltip("Addon",l.data,{addon_type:l.type})}))},t.prototype.setById=function(t){return this.setData(this.dataById[parseInt(t)])},t.prototype.setByName=function(t){return this.setData(this.dataByName[$.trim(t)])},t.prototype.setData=function(i){var n,a=__iced_k_noop,s=iced.findDeferral(arguments);if((null!=i?i.id:void 0)===(null!=(e=this.data)?e.id:void 0))return a();l=e=this;var t,l,e,o=function(){l.isStandardized()&&!l.ship.hasFixedUpgrades&&l.ship.removeStandardizedList(l.data),l.rescindAddons(),l.deoccupyOtherUpgrades();function t(){var t;if(l.data=l.unadjusted_data=i,null!=l.data){if(l.data.superseded_by_id)return l.setById(l.data.superseded_by_id);null!=l.adjustment_func&&(l.data=l.adjustment_func(l.data)),null==(null!=(t=l.ship.pilot)?t.upgrades:void 0)&&(l.unequipOtherUpgrades(),l.occupyOtherUpgrades(),l.conferAddons()),l.isStandardized()&&!l.ship.hasFixedUpgrades&&l.ship.addToStandardizedList(l.data)}else l.deoccupyOtherUpgrades();return l.lastSetValid=l.ship.validate(),a(l.ship.builder.container.trigger("xwing:pointsUpdated"))}if(null!=(null!=i?i.unique:void 0)||null!=(null!=i?i.solitary:void 0)){var e=t;try{n=new iced.Deferrals(e,{parent:s,funcname:"GenericAddon.setData"}),l.ship.builder.container.trigger("xwing:claimUnique",[i,l.type,n.defer({lineno:7630})]),n._fulfill()}catch(t){return void(l.ship.builder.container.trigger("xwing:pointsUpdated"),l.lastSetValid=!1)}}else t()};null==(null!=(t=e.data)?t.unique:void 0)&&null==(null!=(t=e.data)?t.solitary:void 0)?o():(n=new iced.Deferrals(o,{parent:s,funcname:"GenericAddon.setData"}),e.ship.builder.container.trigger("xwing:releaseUnique",[e.unadjusted_data,e.type,n.defer({lineno:7623})]),n._fulfill())},t.prototype.conferAddons=function(){var t,e,i,n,a,s,l,o,r,d;if(null!=this.data.confersAddons&&!this.ship.builder.isQuickbuild&&0<this.data.confersAddons.length)for(n=0,s=(o=this.data.confersAddons).length;n<s;n++){if(i=(t=o[n]).type,e={ship:this.ship,container:this.container},null!=t.slot&&(e.slot=t.slot),null!=t.adjustment_func&&(e.adjustment_func=t.adjustment_func),null!=t.filter_func&&(e.filter_func=t.filter_func),null!=t.auto_equip&&(e.auto_equip=t.auto_equip),null!=t.placeholderMod_func&&(e.placeholderMod_func=t.placeholderMod_func),!((t=new i(e))instanceof exportObj.Upgrade))throw new Error("Unexpected addon type for addon "+t);this.ship.upgrades.push(t),this.conferredAddons.push(t)}if(null!=this.data.chassis&&!this.ship.builder.isQuickbuild&&null!=exportObj.chassis[this.data.chassis].conferredAddons){for(d=[],a=0,l=(r=exportObj.chassis[this.data.chassis].conferredAddons).length;a<l;a++){if(i=(t=r[a]).type,e={ship:this.ship,container:this.container},null!=t.slot&&(e.slot=t.slot),null!=t.adjustment_func&&(e.adjustment_func=t.adjustment_func),null!=t.filter_func&&(e.filter_func=t.filter_func),null!=t.auto_equip&&(e.auto_equip=t.auto_equip),null!=t.placeholderMod_func&&(e.placeholderMod_func=t.placeholderMod_func),!((t=new i(e))instanceof exportObj.Upgrade))throw new Error("Unexpected addon type for addon "+t);this.ship.upgrades.push(t),d.push(this.conferredAddons.push(t))}return d}},t.prototype.rescindAddons=function(){__iced_k_noop;var n,a,t=iced.findDeferral(arguments),e=(a=this,function(){for(var t=a.conferredAddons,e=0,i=t.length;e<i;e++){if(!((n=t[e])instanceof exportObj.Upgrade))throw new Error("Unexpected addon type for addon "+n);a.ship.upgrades.removeItem(n)}return a.conferredAddons=[]});new iced.Deferrals(e,{parent:t,funcname:"GenericAddon.rescindAddons"})._fulfill()},t.prototype.getPoints=function(t,e){var i,n;if(null==t&&(t=this.data),null==e&&(e=this.ship),i=null!=(n=this.ship)&&n.builder.isBeta&&null!=(null!=t?t.pointsbeta:void 0)?t.pointsbeta:null!=(n=null!=t?t.points:void 0)?n:0,!Array.isArray(i))return i;switch(t.variablepoints){case"Agility":return i[e.data.agility];case"Base":if(null==(null!=e?e.data.base:void 0))return i[0];switch(e.data.base){case"Medium":return i[1];case"Large":return i[2];case"Huge":return i[3]}break;case"Initiative":return i[e.pilot.skill];case"Faction":return i[t.faction.indexOf(e.builder.faction)]}},t.prototype.updateSelection=function(t){return null!=this.data?this.selector.select2("data",{id:this.data.id,text:(this.data.display_name||this.data.name)+" ("+t+(this.data.variablepoints?"*":"")+")"}):this.selector.select2("data",null)},t.prototype.toString=function(){return null!=this.data?(this.data.display_name||this.data.name)+" ("+this.getPoints()+")":"No "+this.type},t.prototype.toHTML=function(t){var e,i,n,a,s,l,o,r,d,c,u;if(null==this.data)return"";if(u=null!=this.data.slot&&"HardpointShip"===this.data.slot?"hardpoint":(null!=(u=this.data.slot)?u:this.type).toLowerCase().replace(/[^0-9a-z]/gi,""),c=(c="function"==typeof(c=this.data).text?c.text(match(/(<span.*<\/span>)<br \/><br \/>(.*)/)):void 0)?(d='<div class="card-restriction-container">'+c[1]+"</div>",c[2]):(d="",this.data.text),e="",null!=this.data.range&&(n=null!=this.data.rangebonus?'<span class="upgrade-attack-rangebonus"><i class="xwing-miniatures-font xwing-miniatures-font-rangebonusindicator"></i></span>':"",n=$.trim('<span class="upgrade-attack-range">'+this.data.range+"</span>\n"+n),i=null!=this.data.attack?$.trim('<span class="info-data info-attack">'+this.data.attack+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-frontarc"></i>'):null!=this.data.attackf?$.trim('<span class="info-data info-attack">'+this.data.attackf+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-fullfrontarc"></i>'):null!=this.data.attackb?$.trim('<span class="info-data info-attack">'+this.data.attackb+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-backarc"></i>'):null!=this.data.attackt?$.trim('<span class="info-data info-attack">'+this.data.attackt+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-singleturretarc"></i>'):null!=this.data.attackdt?$.trim('<span class="info-data info-attack">'+this.data.attackdt+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-doubleturretarc"></i>'):null!=this.data.attackl?$.trim('<span class="info-data info-attack">'+this.data.attackl+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-leftarc"></i>'):null!=this.data.attackr?$.trim('<span class="info-data info-attack">'+this.data.attackr+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-rightarc"></i>'):null!=this.data.attackbull?$.trim('<span class="info-data info-attack">'+this.data.attackbull+'</span>\n<i class="xwing-miniatures-font xwing-miniatures-font-bullseyearc"></i>'):"",e=$.trim('<div class="upgrade-attack">\n    '+n+"\n    "+i+"\n</div>")),null!=this.data.charge){if(r="",null!=this.data.recurring)if(0<this.data.recurring)for(s=0;s<this.data.recurring;)r+='<sup><i class="fas fa-caret-up"></i></sup>',++s;else for(s=this.data.recurring;s<0;)r+='<sub><i class="fas fa-caret-down"></i></sub>',++s;a=$.trim('<div class="upgrade-charge">\n    <span class="info-data info-charge">'+this.data.charge+'</span>\n    <i class="xwing-miniatures-font xwing-miniatures-font-charge"></i>'+r+"\n</div>")}else a=$.trim("");if(null!=this.data.force){for(o=1,null!=this.data.forcerecurring&&(o=this.data.forcerecurring),s=0,r="";s<o;)r+='<sup><i class="fas fa-caret-up"></i></sup>',++s;l=$.trim('<div class="upgrade-force">\n    <span class="info-data info-force">'+this.data.force+'</span>\n    <i class="xwing-miniatures-font xwing-miniatures-font-forcecharge"></i>'+r+"\n</div>")}else l=$.trim("");return $.trim('<div class="upgrade-container">\n    <div class="upgrade-stats">\n        <div class="upgrade-name"><i class="xwing-miniatures-font xwing-miniatures-font-'+u+'"></i>'+(this.data.display_name||this.data.name)+'</div>\n        <div class="mask">\n            <div class="outer-circle">\n                <div class="inner-circle upgrade-points">'+t+"</div>\n            </div>\n        </div>\n        "+d+"\n    </div>\n    "+e+"\n    "+a+"\n    "+l+'\n    <div class="upgrade-text">'+c+'</div>\n    <div style="clear: both;"></div>\n</div>')},t.prototype.toTableRow=function(t){return null!=this.data?$.trim('<tr class="simple-addon">\n    <td class="name">'+(this.data.display_name||this.data.name)+'</td>\n    <td class="points">'+t+"</td>\n</tr>"):""},t.prototype.toSimpleCopy=function(t){return null!=this.data?this.data.name+" ("+t+")    \n":null},t.prototype.toRedditText=function(t){return null!=this.data?"*&nbsp;"+this.data.name+" ("+t+")*    \n":null},t.prototype.toTTSText=function(){return null!=this.data?""+exportObj.toTTS(this.data.name):null},t.prototype.toSerialized=function(){var t;return this.serialization_code+"."+(null!=(t=null!=(t=this.data)?t.id:void 0)?t:-1)},t.prototype.unequipOtherUpgrades=function(){for(var a,s,t,e=null!=(t=null!=(t=this.data)?t.unequips_upgrades:void 0)?t:[],i=[],n=0,l=e.length;n<l;n++)a=e[n],i.push(function(){for(var t=this.ship.upgrades,e=[],i=0,n=t.length;i<n;i++)if(s=t[i],exportObj.slotsMatching(s.slot,a)&&s!==this&&s.isOccupied()){s.setData(null);break}return e}.call(this));return i},t.prototype.isOccupied=function(){return null!=this.data||null!=this.occupied_by},t.prototype.occupyOtherUpgrades=function(){var a,s,t,e,i,n,l=[];for(this.ship.builder.isBeta&&null!=(null!=(i=this.data)?i.also_occupies_upgrades_beta:void 0)?l=null!=(i=this.data)?i.also_occupies_upgrades_beta:void 0:null!=(null!=(i=this.data)?i.also_occupies_upgrades:void 0)&&(l=null!=(i=this.data)?i.also_occupies_upgrades:void 0),n=[],t=0,e=l.length;t<e;t++)a=l[t],n.push(function(){for(var t=this.ship.upgrades,e=[],i=0,n=t.length;i<n;i++)if(s=t[i],exportObj.slotsMatching(s.slot,a)&&s!==this&&!s.isOccupied()){this.occupy(s);break}return e}.call(this));return n},t.prototype.deoccupyOtherUpgrades=function(){for(var t,e=this.occupying,i=[],n=0,a=e.length;n<a;n++)t=e[n],i.push(this.deoccupy(t));return i},t.prototype.occupy=function(t){return t.occupied_by=this,t.selector.select2("enable",!1),this.occupying.push(t)},t.prototype.deoccupy=function(t){return t.occupied_by=null,t.selector.select2("enable",!0)},t.prototype.occupiesAnUpgradeSlot=function(t){for(var e,i=this.ship.upgrades,n=0,a=i.length;n<a;n++)if(e=i[n],exportObj.slotsMatching(e.slot,t)&&e!==this&&null==e.data&&null!=e.occupied_by&&e.occupied_by===this)return!0;return!1},t.prototype.toXWS=function(t){var e;return(null!=t[e=null!=(e=exportObj.toXWSUpgrade[this.data.slot])?e:this.data.slot.canonicalize()]?t[e]:t[e]=[]).push(null!=(t=this.data.xws)?t:this.data.canonical_name)},t})(),exportObj.Upgrade=(()=>{function e(t){e.__super__.constructor.call(this,t),this.slot=t.slot,this.type="Upgrade",this.dataById=exportObj.upgradesById,this.dataByName=exportObj.upgrades,this.serialization_code="U",this.setupSelector()}return __extends(e,GenericAddon),e.prototype.setupSelector=function(){return e.__super__.setupSelector.call(this,{width:"100%",placeholder:this.placeholderMod_func(exportObj.translate("ui","upgradePlaceholder",this.slot)),allowClear:!0,query:(i=this,function(t){var e={results:[]};return e.results=i.ship.builder.getAvailableUpgradesIncluding(i.slot,i.data,i.ship,i,t.term,i.filter_func),t.callback(e)})});var i},e})(),exportObj.RestrictedUpgrade=(t=>{function e(t){e.__super__.constructor.call(this,t),this.serialization_code="u",null!=t.auto_equip&&this.setById(t.auto_equip)}return __extends(e,t),e})(exportObj.Upgrade),exportObj.QuickbuildUpgrade=(()=>{function e(t){e.__super__.constructor.call(this,t),this.slot=t.slot,this.type="Upgrade",this.dataById=exportObj.upgradesById,this.dataByName=exportObj.upgrades,this.serialization_code="U",this.upgrade=t.upgrade,this.setupSelector()}return __extends(e,GenericAddon),e.prototype.setupSelector=function(){return e.__super__.setupSelector.call(this,{width:"100%",allowClear:!1,query:(i=this,function(t){var e={results:[{id:i.upgrade.id,text:i.upgrade.display_name||i.upgrade.name,points:0,name:i.upgrade.name,display_name:i.upgrade.display_name}]};return t.callback(e)})});var i},e.prototype.getPoints=function(t){return 0},e.prototype.updateSelection=function(t){return null!=this.data?this.selector.select2("data",{id:this.data.id,text:""+(this.data.display_name||this.data.name)}):this.selector.select2("data",null)},e})(),SERIALIZATION_CODE_TO_CLASS={U:exportObj.Upgrade,u:exportObj.RestrictedUpgrade},(exportObj="undefined"!=typeof exports&&null!==exports?exports:this).fromXWSFaction={rebelalliance:"Rebel Alliance",rebels:"Rebel Alliance",rebel:"Rebel Alliance",galacticempire:"Galactic Empire",imperial:"Galactic Empire",scumandvillainy:"Scum and Villainy",firstorder:"First Order",resistance:"Resistance",galacticrepublic:"Galactic Republic",separatistalliance:"Separatist Alliance"},exportObj.toXWSFaction={"Rebel Alliance":"rebelalliance","Galactic Empire":"galacticempire","Scum and Villainy":"scumandvillainy","First Order":"firstorder",Resistance:"resistance","Galactic Republic":"galacticrepublic","Separatist Alliance":"separatistalliance"},exportObj.toXWSUpgrade={Modification:"modification",Force:"force-power","Tactical Relay":"tactical-relay"},exportObj.fromXWSUpgrade={amd:"Astromech",astromechdroid:"Astromech",ept:"Talent",elitepilottalent:"Talent",system:"Sensor",mod:"Modification","force-power":"Force","tactical-relay":"Tactical Relay"},SPEC_URL="https://github.com/elistevens/xws-spec",SQUAD_TO_XWS_URL="https://squad2xws.herokuapp.com/translate/",exportObj.loadXWSButton=function(i){var e=$(i.find(".xws-import-status")),n=(e.text(exportObj.translate("ui","Loading...")),e),e=function(e){return $(window).trigger("xwing:activateBuilder",[exportObj.fromXWSFaction[e.faction],function(t){return t.current_squad.dirty&&null!=t.backend?(i.modal("hide"),t.backend.warnUnsaved(t,function(){return t.loadFromXWS(e,function(t){if(!t.success)return i.modal("show"),n.text(t.error)})})):t.loadFromXWS(e,function(t){return t.success?i.modal("hide"):n.text(t.error)})}])},a=i.find(".xws-content").val();try{return e(JSON.parse(a))}catch(t){return a=a.split("/").pop(),a=SQUAD_TO_XWS_URL+a,$.getJSON(a,e).catch(function(t){return n.text("Invalid Input")})}};
//# sourceMappingURL=xwing.min.js.map