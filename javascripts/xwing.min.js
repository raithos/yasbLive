var DFL_LANGUAGE,GenericAddon,SERIALIZATION_CODE_TO_CLASS,SHOW_DEBUG_OUT_MISSING_TRANSLATIONS,SPEC_URL,SQUAD_DISPLAY_NAME_MAX_LENGTH,SQUAD_TO_XWS_URL,Ship,TYPES,URL_BASE,all,builders,byName,byPoints,conditionToHTML,getPrimaryFaction,statAndEffectiveStat,indexOf=[].indexOf,hasProp={}.hasOwnProperty,exportObj="undefined"!=typeof exports&&null!==exports?exports:this;exportObj.SquadBuilderBackend=class{constructor(t){var i,e,a;for(this.maybeAuthenticationChanged=this.maybeAuthenticationChanged.bind(this),this.nameCheck=this.nameCheck.bind(this),this.getLanguagePreference=this.getLanguagePreference.bind(this),this.getCollectionCheck=this.getCollectionCheck.bind(this),$.ajaxSetup({dataType:"json",xhrFields:{withCredentials:!0}}),this.server=t.server,this.builders=t.builders,this.login_logout_button=$(t.login_logout_button),this.auth_status=$(t.auth_status),this.authenticated=!1,this.ui_ready=!1,this.oauth_window=null,this.method_metadata={google_oauth2:{icon:"fab fa-google",text:"Google"},twitter:{icon:"fab fa-twitter",text:"Twitter"},discord:{icon:"fab fa-discord",text:"Discord"}},this.squad_display_mode="all",this.show_archived=!1,this.collection_save_timer=null,this.collection_reset_timer=null,this.setupHandlers(),this.setupUI(),this.authenticate(()=>(this.auth_status.hide(),this.login_logout_button.removeClass("d-none"))),i=0,e=(a=this.builders).length;i<e;i++)a[i].setBackend(this);this.updateAuthenticationVisibility()}updateAuthenticationVisibility(){return this.authenticated?($(".show-authenticated").show(),$(".hide-authenticated").hide()):($(".show-authenticated").hide(),$(".hide-authenticated").show())}save(t,i=null,e,a,s={},n){var l;if(""===t)return n({id:null,success:!1,error:"You cannot save an empty squad"});if(""===$.trim(e))return n({id:null,success:!1,error:"Squad name cannot be empty"});if(null==a||""===a)throw"Faction unspecified to save()";return e={name:$.trim(e),faction:$.trim(a),serialized:t,additional_data:s},null!=i?l=this.server+"/squads/"+i:(l=this.server+"/squads/new",e._method="put"),$.post(l,e,(t,i,e)=>n({id:t.id,success:t.success,error:t.error}))}delete(t,a){return $.post(this.server+"/squads/"+t,{_method:"delete"},(t,i,e)=>a({success:t.success,error:t.error}))}archive(t,i,e){return t.additional_data.archived=!0,this.save(t.serialized,t.id,t.name,i,t.additional_data,e)}list(g){var v,x,k,t;return this.squad_list_modal.find(".modal-header .squad-list-header-placeholder").text(exportObj.translate("ui","yourXYsquads",g.faction)),(v=$(this.squad_list_modal.find("ul.squad-list"))).text(""),v.hide(),(x=$(this.squad_list_modal.find("p.squad-list-loading"))).show(),this.show_all_squads_button.click(),this.squad_list_modal.modal("show"),this.number_of_selected_squads_to_be_deleted=0,k=[],t=this.server+"/squads/list",$.get(t,(t,i,e)=>{for(var a,s,n,l,o,r,d,c,u,h,p,f=!1,m=t[g.faction],_=0,b=m.length;_<b;_++){if(d=m[_],(l=$(document.createElement("LI"))).addClass("squad-summary"),l.data("squad",d),l.data("builder",g),l.data("selectedForDeletion",!1),v.append(l),null!=(null!=(r=d.additional_data)?r.tag:void 0)&&""!==(null!=(r=d.additional_data)?r.tag:void 0)&&-1===k.indexOf(d.additional_data.tag))for(a=0,s=(u=null!=(r=d.additional_data)?r.tag.split(","):void 0).length;a<s;a++)h=u[a],k.push(h);null!=(null!=(r=d.additional_data)?r.archived:void 0)?l.hide():f=!0,r=-1!==d.serialized.search(/v\d+Zb/)?' <i class="xwing-miniatures-font xwing-miniatures-font-point"></i>':"",l.append($.trim(`<div class="row">
    <div class="col-md-9">
        <h4>${d.name}${r}</h4>
    </div>
    <div class="col-md-3">
        <h5>${null!=(r=d.additional_data)?r.points:void 0} ${exportObj.translate("ui","Points")}</h5>
    </div>
</div>
<div class="row squad-description">
    <div class="col-md-9">
        ${null!=(r=d.additional_data)?r.description:void 0}
    </div>
    <div class="squad-buttons col-md-3">
        <button class="btn btn-modal convert-squad"><i class="xwing-miniatures-font xwing-miniatures-font-first-player-1"></i></button>
        &nbsp;
        <button class="btn btn-modal load-squad"><i class="fa fa-download"></i></button>
        &nbsp;
        <button class="btn btn-danger delete-squad"><i class="fa fa-times"></i></button>
    </div>
</div>
<div class="row squad-convert-confirm">
    <div class="col-md-9 translated" defaultText="Convert to Extended?">
    </div>
    <div class="squad-buttons col-md-3">
        <button class="btn btn-danger confirm-convert-squad translated" defaultText="Convert"></button>
        &nbsp;
        <button class="btn btn-modal cancel-convert-squad translated" defaultText="Cancel"></button>
    </div>
</div>
<div class="row squad-delete-confirm">
    <div class="col-md-6">
        ${exportObj.translate("ui","reallyDeleteSquadXY",`<em>${d.name}</em>`)}
    </div>
    <div class="col-md-6 btn-group">
        <button class="btn btn-danger confirm-delete-squad translated" defaultText="Delete"></button>
        <button class="btn confirm-archive-squad translated" defaultText="Archive"></button>
        <button class="btn btn-modal cancel-delete-squad translated" defaultText="Unselect"></button>
    </div>
</div>`)),l.find(".squad-convert-confirm").hide(),l.find(".squad-delete-confirm").hide(),-1===d.serialized.search(/v\d+Zh/)&&l.find("button.convert-squad").hide(),l.find("button.convert-squad").click(t=>{var i;return t.preventDefault(),t=$(t.target),l=t.closest("li"),g=l.data("builder"),l.data("selectedToConvert",!0),(i=l).find(".squad-description").fadeOut("fast",function(){return i.find(".squad-convert-confirm").fadeIn("fast")})}),l.find("button.cancel-convert-squad").click(t=>{var i;return t.preventDefault(),t=$(t.target),l=t.closest("li"),g=l.data("builder"),l.data("selectedToConvert",!1),(i=l).find(".squad-convert-confirm").fadeOut("fast",function(){return i.find(".squad-description").fadeIn("fast")})}),l.find("button.confirm-convert-squad").click(t=>{var i;return t.preventDefault(),t=$(t.target),l=t.closest("li"),g=l.data("builder"),l.find(".cancel-convert-squad").fadeOut("fast"),l.find(".confirm-convert-squad").addClass("disabled"),l.find(".confirm-convert-squad").text("Converting..."),i=l.data("squad").serialized.replace("Zh","Zs"),this.save(i,l.data("squad").id,l.data("squad").name,l.data("builder").faction,l.data("squad").additional_data,t=>t.success?(l.data("squad").serialized=i,l.find(".squad-convert-confirm").fadeOut("fast",function(){return l.find(".squad-description").fadeIn("fast"),l.find("button.convert-squad").fadeOut("fast")})):l.html($.trim(`Error converting ${l.data("squad").name}: <em>${t.error}</em>`)))}),l.find("button.load-squad").click(t=>(t.preventDefault(),t=$(t.target),l=t.closest("li"),g=l.data("builder"),this.squad_list_modal.modal("hide"),g.current_squad.dirty?this.warnUnsaved(g,function(){return g.container.trigger("xwing-backend:squadLoadRequested",l.data("squad"))}):g.container.trigger("xwing-backend:squadLoadRequested",l.data("squad")))),l.find("button.delete-squad").click(t=>{t.preventDefault(),t=$(t.target),l=t.closest("li"),g=l.data("builder"),l.data("selectedForDeletion",!0);var i=l;if(i.find(".squad-description").fadeOut("fast",function(){return i.find(".squad-delete-confirm").fadeIn("fast")}),!this.number_of_selected_squads_to_be_deleted)this.squad_list_modal.find("div.delete-multiple-squads").show();return this.number_of_selected_squads_to_be_deleted+=1}),l.find("button.cancel-delete-squad").click(t=>{t.preventDefault(),t=$(t.target),l=t.closest("li"),g=l.data("builder"),l.data("selectedForDeletion",!1),--this.number_of_selected_squads_to_be_deleted;var i=l;if(i.find(".squad-delete-confirm").fadeOut("fast",function(){return i.find(".squad-description").fadeIn("fast")}),!this.number_of_selected_squads_to_be_deleted)return this.squad_list_modal.find("div.delete-multiple-squads").hide()}),l.find("button.confirm-delete-squad").click(t=>(t.preventDefault(),t=$(t.target),l=t.closest("li"),g=l.data("builder"),l.find(".cancel-delete-squad").fadeOut("fast"),l.find(".confirm-delete-squad").addClass("disabled"),l.find(".confirm-delete-squad").text("Deleting..."),this.delete(l.data("squad").id,t=>t.success?(l.slideUp("fast",function(){return $(l).remove()}),--this.number_of_selected_squads_to_be_deleted,this.number_of_selected_squads_to_be_deleted?void 0:this.squad_list_modal.find("div.delete-multiple-squads").hide()):l.html($.trim(`Error deleting ${l.data("squad").name}: <em>${t.error}</em>`))))),l.find("button.confirm-archive-squad").click(t=>(t.preventDefault(),t=$(t.target),l=t.closest("li"),g=l.data("builder"),l.find(".confirm-delete-squad").addClass("disabled"),l.find(".confirm-delete-squad").text(exportObj.translate("ui","Archiving...")),this.archive(l.data("squad"),l.data("builder").faction,t=>t.success?(l.slideUp("fast",function(){return $(l).hide(),$(l).find(".confirm-delete-squad").removeClass("disabled"),$(l).find(".confirm-delete-squad").text(exportObj.translate("ui","Delete")),$(l).data("selectedForDeletion",!1),$(l).find(".squad-delete-confirm").fadeOut("fast",function(){return $(l).find(".squad-description").fadeIn("fast")})}),--this.number_of_selected_squads_to_be_deleted,this.number_of_selected_squads_to_be_deleted?void 0:this.squad_list_modal.find("div.delete-multiple-squads").hide()):l.html($.trim(`Error archiving ${l.data("squad").name}: <em>${t.error}</em>`)))))}for(f||v.append($.trim('<li class="translated" defaultText="No saved squads"></li>')),this.squad_list_tags.empty(),o=0,n=k.length;o<n;o++)p=(c=k[o]).toLowerCase().replace(/[^a-z0-9]/g,"").replace(/\s+/g,"-"),this.squad_list_tags.append($.trim(`<button class="btn ${p}">${c}</button>`)),$(this.squad_list_tags.find("."+p)).click(t=>{var t=$(t.target),n=t.attr("class").replace("btn ","").replace("btn-inverse ","");return this.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),this.squad_list_tags.find(".btn").removeClass("btn-inverse"),t.addClass("btn-inverse"),this.squad_list_modal.find(".squad-list li").each(function(t,i){var e,a,s;if(null==$(i).data().squad.additional_data.tag)return $(i).hide();for(e=!1,s=0,a=(u=$(i).data().squad.additional_data.tag.split(",")).length;s<a;s++)c=u[s],n===c.toLowerCase().replace(/[^a-z0-9]/g,"").replace(/\s+/g,"-")&&(e=!0);return e?$(i).show():$(i).hide()})});return exportObj.translateUIElements(v),x.fadeOut("fast"),v.fadeIn("fast")})}authenticate(a=$.noop){var s;return $(this.auth_status.find(".payload")).text(exportObj.translate("ui","Checking auth status...")),this.auth_status.show(),s=this.authenticated,$.ajax({url:this.server+"/ping",success:t=>(null!=t&&t.success?this.authenticated=!0:this.authenticated=!1,this.maybeAuthenticationChanged(s,a)),error:(t,i,e)=>(this.authenticated=!1,this.maybeAuthenticationChanged(s,a))})}maybeAuthenticationChanged(t,i){return t!==this.authenticated&&$(window).trigger("xwing-backend:authenticationChanged",[this.authenticated,this]),this.oauth_window=null,this.auth_status.hide(),i(this.authenticated),this.authenticated}login(){if(this.ui_ready)return this.login_modal.modal("show")}logout(a=$.noop){return $(this.auth_status.find(".payload")).text(exportObj.translate("ui","Logging out...")),this.auth_status.show(),$.get(this.server+"/auth/logout",(t,i,e)=>(this.authenticated=!1,$(window).trigger("xwing-backend:authenticationChanged",[this.authenticated,this]),this.auth_status.hide(),a()))}showSaveAsModal(t){return this.save_as_modal.data("builder",t),this.save_as_input.val(t.current_squad.name),this.save_as_save_button.addClass("disabled"),this.nameCheck(),this.save_as_modal.modal("show")}showDeleteModal(t){return this.delete_modal.data("builder",t),this.delete_name_container.text(t.current_squad.name),this.delete_modal.modal("show")}nameCheck(){var t;return window.clearInterval(this.save_as_modal.data("timer")),0===(t=$.trim(this.save_as_input.val())).length?(this.name_availability_container.text(""),this.name_availability_container.append($.trim('<i class="fa fa-thumbs-down"></i> '+exportObj.translate("ui","name required")))):$.post(this.server+"/squads/namecheck",{name:t},t=>(this.name_availability_container.text(""),t.available?(this.name_availability_container.append($.trim('<i class="fa fa-thumbs-up"></i> '+exportObj.translate("ui","Name is available"))),this.save_as_save_button.removeClass("disabled")):(this.name_availability_container.append($.trim('<i class="fa fa-thumbs-down"></i> '+exportObj.translate("ui","Name in use"))),this.save_as_save_button.addClass("disabled"))))}warnUnsaved(t,i){return this.unsaved_modal.data("builder",t),this.unsaved_modal.data("callback",i),this.unsaved_modal.modal("show")}setupUI(){var i;return this.auth_status.addClass("disabled"),this.auth_status.click(t=>!1),this.login_modal=$(document.createElement("DIV")),this.login_modal.addClass("modal fade d-print-none"),this.login_modal.tabindex="-1",this.login_modal.role="dialog",$(document.body).append(this.login_modal),this.login_modal.append($.trim(`<div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="translated" defaultText="Log in with OAuth"></h3>
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        </div>
        <div class="modal-body">
            <p>
                <span class="translated" defaultText="select OAuth provider"></span>
                <a class="login-help translated" href="#" defaultText="What's this?"></a>
            </p>
            <div class="well well-small oauth-explanation">
                <span class="translated" defaultText="OAuth explanation"></span>
                <button class="btn btn-modal translated" defaultText="Got it!"></button>
            </div>
            <ul class="login-providers inline"></ul>
            <p class="translated" defaultText="Continue to OAuth provider"></p>
            <p class="translated" defaultText="iOS requires cross-site control"></p>
            <p class="login-in-progress">
                <em class="translated" defaultText="login in progress"></em>
            </p>
        </div>
    </div>
</div>`)),(i=$(this.login_modal.find(".oauth-explanation"))).hide(),this.login_modal.find(".login-in-progress").hide(),this.login_modal.find("a.login-help").click(t=>{if(t.preventDefault(),!i.is(":visible"))return i.slideDown("fast")}),i.find("button").click(t=>(t.preventDefault(),i.slideUp("fast"))),$.get(this.server+"/methods",(t,i,e)=>{for(var a,s,n=$(this.login_modal.find("ul.login-providers")),l=t.methods,o=0,r=l.length;o<r;o++)s=l[o],(a=$(document.createElement("A"))).addClass("btn btn-modal"),a.data("url",this.server+"/auth/"+s),a.append(`<i class="${this.method_metadata[s].icon}"></i>&nbsp;`+this.method_metadata[s].text),a.click(t=>(t.preventDefault(),n.slideUp("fast"),this.login_modal.find(".login-in-progress").slideDown("fast"),this.oauth_window=window.open($(t.target).data("url"),"xwing_login"))),(s=$(document.createElement("LI"))).append(a),n.append(s);return this.ui_ready=!0}),exportObj.translateUIElements(this.login_modal),this.reload_done_modal=$(document.createElement("DIV")),this.reload_done_modal.addClass("modal fade d-print-none"),this.reload_done_modal.tabindex="-1",this.reload_done_modal.role="dialog",$(document.body).append(this.reload_done_modal),this.reload_done_modal.append($.trim(`<div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Reload Done</h3>
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        </div>
        <div class="modal-body">
            <p class="translated" defaultText="Squads reloaded"></p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-modal btn-primary translated" aria-hidden="true" data-dismiss="modal" defaultText="Well done!"></button>
        </div>
    </div>
</div>`)),exportObj.translateUIElements(this.reload_done_modal),this.squad_list_modal=$(document.createElement("DIV")),this.squad_list_modal.addClass("modal fade d-print-none squad-list"),this.squad_list_modal.tabindex="-1",this.squad_list_modal.role="dialog",$(document.body).append(this.squad_list_modal),this.squad_list_modal.append($.trim(`<div class="modal-dialog modal-lg modal-dialog-scrollable modal-dialog-centered" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="squad-list-header-placeholder d-none d-lg-block"></h3>
            <h4 class="squad-list-header-placeholder d-lg-none"></h4>
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        </div>
        <div class="modal-body">
            <ul class="squad-list"></ul>
            <p class="pagination-centered squad-list-loading">
                <i class="fa fa-spinner fa-spin fa-3x"></i>
                <br />
                <span class="translated" defaultText="Fetching squads..."></span>
            </p>
        </div>
        <div class="modal-footer">
            <div class="btn-group delete-multiple-squads full-row">
                <button class="btn btn-modal select-all translated" defaultText="Select All"></button>
                <button class="btn btn-modal archive-selected translated" defaultText="Archive Selected"></button>
                <button class="btn btn-modal btn-danger delete-selected translated" defaultText="Delete Selected"></button>
            </div>
            <div class="btn-group squad-display-mode full-row">
                <button class="btn btn-modal btn-inverse show-all-squads translated" defaultText="All"></button>
                <button class="btn btn-modal show-standard-squads"><span class="d-none d-lg-block translated" defaultText="Standard"></span><span class="d-lg-none"><i class="xwing-miniatures-font xwing-miniatures-font-first-player-1"></i></span></button>
                <button class="btn btn-modal show-extended-squads"><span class="d-none d-lg-block translated" defaultText="Extended"></span><span class="d-lg-none translated" defaultText="Ext"></span></button>
                <button class="btn btn-modal show-xwa-squads"><span class="d-none d-lg-block translated" defaultText="XWA"></span><span class="d-lg-none"><i class="xwing-miniatures-font xwing-miniatures-font-point" title="Energy"></i></span></button>
                <button class="btn btn-modal show-quickbuild-squads"><span class="d-none d-lg-block translated" defaultText="Quickbuild"></span><span class="d-lg-none translated" defaultText="QB"></span></button>
                <button class="btn btn-modal show-epic-squads"><span class="d-none d-lg-block translated" defaultText="Epic"></span><span class="d-lg-none" ><i class="xwing-miniatures-font xwing-miniatures-font-energy" title="Energy"></i></span></button>
                <button class="btn btn-modal show-archived-squads"><span class="d-none d-lg-block translated" defaultText="Archived"></span><span class="d-lg-none translated" defaultText="Arc"></span></button>
                <button class="btn btn-modal reload-all" title="Recalculate Points"><span><i class="xwing-miniatures-font xwing-miniatures-font-calculate" title="Calculate"></i></span></button>
            </div>
            <div class="btn-group tags-display full-row">
            </div>
        </div>
    </div>
</div>`)),this.squad_list_modal.find("ul.squad-list").hide(),this.squad_list_tags=$(this.squad_list_modal.find("div.tags-display")),this.squad_list_modal.find("div.delete-multiple-squads").hide(),exportObj.translateUIElements(this.squad_list_modal),this.delete_selected_button=$(this.squad_list_modal.find("button.delete-selected")),this.delete_selected_button.click(t=>{for(var i,e=this.squad_list_modal.find("ul.squad-list").find("li"),a=[],s=0,n=e.length;s<n;s++)i=e[s],(i=$(i)).data("selectedForDeletion")?a.push((i=>(i.find(".cancel-delete-squad").fadeOut("fast"),i.find(".confirm-delete-squad").addClass("disabled"),i.find(".confirm-delete-squad").text(exportObj.translate("ui","Deleting...")),this.delete(i.data("squad").id,t=>t.success?(i.slideUp("fast",function(){return $(i).remove()}),--this.number_of_selected_squads_to_be_deleted,this.number_of_selected_squads_to_be_deleted?void 0:this.squad_list_modal.find("div.delete-multiple-squads").hide()):i.html($.trim(`Error deleting ${i.data("squad").name}: <em>${t.error}</em>`)))))(i)):a.push(void 0);return a}),this.archive_selected_button=$(this.squad_list_modal.find("button.archive-selected")),this.archive_selected_button.click(t=>{for(var i,e=this.squad_list_modal.find("ul.squad-list").find("li"),a=[],s=0,n=e.length;s<n;s++)i=e[s],(i=$(i)).data("selectedForDeletion")?a.push((i=>(i.find(".confirm-delete-squad").addClass("disabled"),i.find(".confirm-delete-squad").text(exportObj.translate("ui","Archiving...")),this.archive(i.data("squad"),i.data("builder").faction,t=>t.success?(i.slideUp("fast",function(){return $(i).hide(),$(i).find(".confirm-delete-squad").removeClass("disabled"),$(i).find(".confirm-delete-squad").text(exportObj.translate("ui","Delete")),$(i).data("selectedForDeletion",!1),$(i).find(".squad-delete-confirm").fadeOut("fast",function(){return $(i).find(".squad-description").fadeIn("fast")})}),--this.number_of_selected_squads_to_be_deleted,this.number_of_selected_squads_to_be_deleted?void 0:this.squad_list_modal.find("div.delete-multiple-squads").hide()):i.html($.trim(`Error archiving ${i.data("squad").name}: <em>${t.error}</em>`)))))(i)):a.push(void 0);return a}),this.squad_list_modal.find("button.reload-all").click(t=>{for(var i,e,a=this.squad_list_modal.find("ul.squad-list"),s=[()=>this.reload_done_modal.modal("show")],n=[],l=a.find("li"),o=0,r=l.length;o<r;o++)e=l[o],e=$(e),n.push(e.data("squad")),i=e.data("builder"),s.push(()=>{var t=n.pop();return i.container.trigger("xwing-backend:squadLoadRequested",[t,()=>{var t={points:i.total_points,description:i.describeSquad(),cards:i.listCards(),notes:i.notes.val().substr(0,1024),obstacles:i.getObstacles(),tag:i.tag.val().substr(0,1024)};return this.save(i.serialize(),i.current_squad.id,i.current_squad.name,i.faction,t,s.pop())}])});return this.squad_list_modal.modal("hide"),i.current_squad.dirty?this.warnUnsaved(i,s.pop()):s.pop()()}),this.select_all_button=$(this.squad_list_modal.find("button.select-all")),this.select_all_button.click(t=>{for(var i,e=this.squad_list_modal.find("ul.squad-list").find("li"),a=[],s=0,n=e.length;s<n;s++)i=e[s],(i=$(i)).data("selectedForDeletion")?a.push(void 0):(i.data("selectedForDeletion",!0),(t=>t.find(".squad-description").fadeOut("fast",function(){return t.find(".squad-delete-confirm").fadeIn("fast")}))(i),a.push(this.number_of_selected_squads_to_be_deleted+=1));return a}),this.show_all_squads_button=$(this.squad_list_modal.find(".show-all-squads")),this.show_all_squads_button.click(t=>{if("all"!==this.squad_display_mode)return this.squad_display_mode="all",this.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),this.squad_list_tags.find(".btn").removeClass("btn-inverse"),this.show_all_squads_button.addClass("btn-inverse"),this.squad_list_modal.find(".squad-list li").show()}),this.show_extended_squads_button=$(this.squad_list_modal.find(".show-extended-squads")),this.show_extended_squads_button.click(t=>{if("extended"!==this.squad_display_mode)return this.squad_display_mode="extended",this.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),this.squad_list_tags.find(".btn").removeClass("btn-inverse"),this.show_extended_squads_button.addClass("btn-inverse"),this.squad_list_modal.find(".squad-list li").each(function(t,i){return $(i).toggle(-1!==$(i).data().squad.serialized.search(/v\d+Zs/))})}),this.show_epic_squads_button=$(this.squad_list_modal.find(".show-epic-squads")),this.show_epic_squads_button.click(t=>{if("epic"!==this.squad_display_mode)return this.squad_display_mode="epic",this.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),this.squad_list_tags.find(".btn").removeClass("btn-inverse"),this.show_epic_squads_button.addClass("btn-inverse"),this.squad_list_modal.find(".squad-list li").each(function(t,i){return $(i).toggle(-1!==$(i).data().squad.serialized.search(/v\d+Ze/))})}),this.show_standard_squads_button=$(this.squad_list_modal.find(".show-standard-squads")),this.show_standard_squads_button.click(t=>{if("standard"!==this.squad_display_mode)return this.squad_display_mode="standard",this.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),this.squad_list_tags.find(".btn").removeClass("btn-inverse"),this.show_standard_squads_button.addClass("btn-inverse"),this.squad_list_modal.find(".squad-list li").each(function(t,i){return $(i).toggle(-1!==$(i).data().squad.serialized.search(/v\d+Zh/))})}),this.show_xwa_squads_button=$(this.squad_list_modal.find(".show-xwa-squads")),this.show_xwa_squads_button.click(t=>{if("xwa"!==this.squad_display_mode)return this.squad_display_mode="xwa",this.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),this.squad_list_tags.find(".btn").removeClass("btn-inverse"),this.show_xwa_squads_button.addClass("btn-inverse"),this.squad_list_modal.find(".squad-list li").each(function(t,i){return $(i).toggle(-1!==$(i).data().squad.serialized.search(/v\d+Zb/))})}),this.show_quickbuild_squads_button=$(this.squad_list_modal.find(".show-quickbuild-squads")),this.show_quickbuild_squads_button.click(t=>{if("quickbuild"!==this.squad_display_mode)return this.squad_display_mode="quickbuild",this.squad_list_modal.find(".squad-display-mode .btn").removeClass("btn-inverse"),this.squad_list_tags.find(".btn").removeClass("btn-inverse"),this.show_quickbuild_squads_button.addClass("btn-inverse"),this.squad_list_modal.find(".squad-list li").each(function(t,i){return $(i).toggle(-1!==$(i).data().squad.serialized.search(/v\d+Zq/))})}),this.show_archived_squads_button=$(this.squad_list_modal.find(".show-archived-squads")),this.show_archived_squads_button.click(t=>(this.show_archived=!this.show_archived,this.show_archived?this.show_archived_squads_button.addClass("btn-inverse"):this.show_archived_squads_button.removeClass("btn-inverse"),this.squad_list_tags.find(".btn").removeClass("btn-inverse"),this.squad_list_modal.find(".squad-list li").each((t,i)=>$(i).toggle(null!=$(i).data().squad.additional_data.archived===this.show_archived)))),this.save_as_modal=$(document.createElement("DIV")),this.save_as_modal.addClass("modal fade d-print-none"),this.save_as_modal.tabindex="-1",this.save_as_modal.role="dialog",$(document.body).append(this.save_as_modal),this.save_as_modal.append($.trim(`<div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="translated" defaultText="Save Squad As..."></h3>
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        </div>
        <div class="modal-body">
            <label for="xw-be-squad-save-as">
                <span class="translated" defaultText="New Squad Name"></span>
                <input id="xw-be-squad-save-as"></input>
            </label>
            <span class="name-availability"></span>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary save translated" aria-hidden="true" defaultText="Save"></button>
        </div>
    </div>
</div>`)),this.save_as_modal.on("shown",()=>window.setTimeout(()=>(this.save_as_input.focus(),this.save_as_input.select()),100)),this.save_as_save_button=this.save_as_modal.find("button.save"),this.save_as_save_button.click(t=>{var i,e;if(t.preventDefault(),!this.save_as_save_button.hasClass("disabled"))return null!=(t=this.save_as_modal.data("timer"))&&window.clearInterval(t),this.save_as_modal.modal("hide"),t={points:(i=this.save_as_modal.data("builder")).total_points,description:i.describeSquad(),cards:i.listCards(),notes:i.getNotes(),obstacles:i.getObstacles(),tag:i.getTag()},i.backend_save_list_as_button.addClass("disabled"),i.backend_status.html($.trim('<i class="fa fa-sync fa-spin"></i>&nbsp;'+exportObj.translate("ui","Saving squad..."))),i.backend_status.show(),e=$.trim(this.save_as_input.val()),this.save(i.serialize(),null,e,i.faction,t,t=>(t.success?(i.current_squad.id=t.id,i.current_squad.name=e,i.current_squad.dirty=!1,i.container.trigger("xwing-backend:squadNameChanged"),i.container.trigger("xwing-backend:squadDirtinessChanged"),i.backend_status.html($.trim('<i class="fa fa-check"></i>&nbsp;'+exportObj.translate("ui","New squad saved successfully.")))):i.backend_status.html($.trim('<i class="fa fa-exclamation-circle"></i>&nbsp;'+t.error)),i.backend_save_list_as_button.removeClass("disabled")))}),this.save_as_input=$(this.save_as_modal.find("input")),this.save_as_input.keypress(t=>13===t.which?(this.save_as_save_button.click(),!1):(this.name_availability_container.text(""),this.name_availability_container.append($.trim('<i class="fa fa-spin fa-spinner"></i> '+exportObj.translate("ui","Checking name availability..."))),null!=(t=this.save_as_modal.data("timer"))&&window.clearInterval(t),this.save_as_modal.data("timer",window.setInterval(this.nameCheck,500)))),this.name_availability_container=$(this.save_as_modal.find(".name-availability")),exportObj.translateUIElements(this.squad_list_modal),this.delete_modal=$(document.createElement("DIV")),this.delete_modal.addClass("modal fade d-print-none"),this.delete_modal.tabindex="-1",this.delete_modal.role="dialog",$(document.body).append(this.delete_modal),this.delete_modal.append($.trim(`<div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h3><span class="translated" defaultText="Really Delete"></span> <span class="squad-name-placeholder"></span>?</h3>
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        </div>
        <div class="modal-body">
            <p class="translated" defaultText="Sure to delete?"></p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-danger delete" aria-hidden="true"><span class="translated" defaultText="Yes, Delete"></span> <i class="squad-name-placeholder"></i></button>
            <button class="btn btn-modal translated" data-dismiss="modal" aria-hidden="true" defaultText="Never Mind"></button>
        </div>
    </div>
</div>`)),this.delete_name_container=$(this.delete_modal.find(".squad-name-placeholder")),this.delete_button=$(this.delete_modal.find("button.delete")),this.delete_button.click(t=>{var i;return t.preventDefault(),(i=this.delete_modal.data("builder")).backend_status.html($.trim('<i class="fa fa-sync fa-spin"></i>&nbsp;'+exportObj.translate("ui","Deleting squad..."))),i.backend_status.show(),i.backend_delete_list_button.addClass("disabled"),this.delete_modal.modal("hide"),this.delete(i.current_squad.id,t=>t.success?(i.resetCurrentSquad(),i.current_squad.dirty=!0,i.container.trigger("xwing-backend:squadDirtinessChanged"),i.backend_status.html($.trim('<i class="fa fa-check"></i>&nbsp;'+exportObj.translate("ui","Squad deleted.")))):(i.backend_status.html($.trim('<i class="fa fa-exclamation-circle"></i>&nbsp;'+t.error)),i.backend_delete_list_button.removeClass("disabled")))}),exportObj.translateUIElements(this.delete_modal),this.unsaved_modal=$(document.createElement("DIV")),this.unsaved_modal.addClass("modal fade d-print-none"),this.unsaved_modal.tabindex="-1",this.unsaved_modal.role="dialog",$(document.body).append(this.unsaved_modal),this.unsaved_modal.append($.trim(`<div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="translated" defaultText="Unsaved Changes"></h3>
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        </div>
        <div class="modal-body">
            <p class="translated" defaultText="Unsaved Changes Warning"></p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-modal btn-primary translated" aria-hidden="true" data-dismiss="modal" defaultText="Go Back"></button>
            <button class="btn btn-danger discard translated" aria-hidden="true" defaultText="Discard Changes"></button>
        </div>
    </div>
</div>`)),this.unsaved_discard_button=$(this.unsaved_modal.find("button.discard")),this.unsaved_discard_button.click(t=>(t.preventDefault(),this.unsaved_modal.data("builder").current_squad.dirty=!1,this.unsaved_modal.data("callback")(),this.unsaved_modal.modal("hide"))),exportObj.translateUIElements(this.unsaved_modal)}setupHandlers(){return $(window).on("xwing-backend:authenticationChanged",(t,i,e)=>{if(this.updateAuthenticationVisibility(),i)return this.loadCollection()}),this.login_logout_button.click(t=>(t.preventDefault(),this.authenticated?this.logout():this.login())),$(window).on("message",t=>{var i,e=t.originalEvent;return e.origin===this.server?"auth_successful"!==(null!=(i=e.data)?i.command:void 0)?console.log("Unexpected command "+(null!=(i=e.data)?i.command:void 0)):(this.authenticate(),this.login_modal.modal("hide"),this.login_modal.find(".login-in-progress").hide(),this.login_modal.find("ul.login-providers").show(),e.source.close()):(console.log("Message received from unapproved origin "+e.origin),window.last_ev=t)}).on("xwing-collection:changed",(t,i)=>(null!=this.collection_save_timer&&clearTimeout(this.collection_save_timer),this.collection_save_timer=setTimeout(()=>this.saveCollection(i,function(t){if(t)return $(window).trigger("xwing-collection:saved",i)}),1e3))).on("xwing-collection:reset",(t,i)=>(null!=this.collection_save_timer&&clearTimeout(this.collection_save_timer),this.collection_save_timer=setTimeout(()=>this.resetCollection(i,function(t){if(t)return $(window).trigger("xwing-collection:reset",i)}),1e3)))}getSettings(a=$.noop){return $.get(this.server+"/settings").done((t,i,e)=>a(t.settings))}set(t,i,a=$.noop){var e={_method:"PUT"};return e[t]=i,$.post(this.server+"/settings",e).done((t,i,e)=>a(t.set))}deleteSetting(t,a=$.noop){return $.post(this.server+"/settings/"+t,{_method:"DELETE"}).done((t,i,e)=>a(t.deleted))}getHeaders(a=$.noop){return $.get(this.server+"/headers").done((t,i,e)=>a(t.headers))}async getLanguagePreference(t,o=$.noop){return null!=(null!=t?t.language:void 0)?o(t.language,10):this.getHeaders(function(t){var i,e,a,s,n,l;if(null==(null!=t?t.HTTP_ACCEPT_LANGUAGE:void 0))return o("English",-1);for(l=[],i=0,a=(n=t.HTTP_ACCEPT_LANGUAGE.split(",")).length;i<a;i++){[e,s]=n[i].split(";"),"*"===e?o("English",-.5):(e=e.split("-")[0])in exportObj.codeToLanguage?o(exportObj.codeToLanguage[e],8):o("English",-1);break}return l})}getCollectionCheck(t,i=$.noop){return null!=(null!=t?t.collectioncheck:void 0)?i(t.collectioncheck):i(this.collectioncheck=!0)}resetCollection(t,a=$.noop){return $.post(this.server+"/collection",{expansions:{},singletons:{},checks:{}}).done(function(t,i,e){return a(t.success)})}saveCollection(t,a=$.noop){t={expansions:t.expansions,singletons:t.singletons,checks:t.checks};return $.post(this.server+"/collection",t).done(function(t,i,e){return a(t.success)})}loadCollection(){return $.get(this.server+"/collection").done(function(t,i,e){t=t.collection;return new exportObj.Collection({expansions:t.expansions,singletons:t.singletons,checks:t.checks})})}},exportObj="undefined"!=typeof exports&&null!==exports?exports:this,TYPES=["pilots","upgrades","ships","damage"],byName=function(t,i){t=(t.display_name||t.name).toLowerCase().replace(/[^a-zA-Z0-9]/g,""),i=(i.display_name||i.name).toLowerCase().replace(/[^a-zA-Z0-9]/g,"");return t<i?-1:i<t?1:0},byPoints=function(t,i){return t.data.points<i.data.points?-1:i.data.points<t.data.points?1:byName(t,i)},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},exportObj.CardBrowser=class{constructor(t){this.container=$(t.container),this.currently_selected=null,this.language=null!=(t=exportObj.currentLanguage)?t:"English",this.prepareData(),this.setupUI(),this.setupHandlers()}setupUI(){var t,i,e,a,s,n,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k;for(i in this.container.append($.trim(`<div class="container-fluid xwing-card-browser">
    <div class="row">
        <div class="col-md-4">
            <div class="card card-search-container">
            <h5 class="card-title translated" defaultText="Card Search"></h5>
                <div class="advanced-search-container">
                    <div class = "card search-container general-search-container">
                        <h6 class="card-subtitle mb-3 text-muted version translated" defaultText="General"></h6>
                        <label class = "text-search advanced-search-label">
                        <strong class="translated" defaultText="Textsearch:"></strong>
                            <input type="search" placeholder="${exportObj.translate("ui","Placeholder Textsearch Browser")}" class = "card-search-text">
                        </label>
                        <div class= "advanced-search-faction-selection-container">
                            <label class = "advanced-search-label select-available-slots">
                                <strong class="translated" defaultText="Factions:"></strong>
                                <select class="advanced-search-selection faction-selection" multiple="1" data-placeholder="${exportObj.translate("ui","All factions")}"></select>
                            </label>
                        </div>
                        <div class = "advanced-search-point-selection-container">
                            <strong class="translated" defaultText="Point cost:"></strong>
                            <label class = "advanced-search-label set-minimum-points">
                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-point-cost advanced-search-number-input" value="0" /> 
                            </label>
                            <label class = "advanced-search-label set-maximum-points">
                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-point-cost advanced-search-number-input" value="20" /> 
                            </label>
                        </div>
                        <div class = "advanced-search-loadout-selection-container">
                            <strong class="translated" defaultText="Loadout cost:"></strong>
                            <label class = "advanced-search-label set-minimum-loadout">
                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-loadout-cost advanced-search-number-input" value="0" /> 
                            </label>
                            <label class = "advanced-search-label set-maximum-loadout">
                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-loadout-cost advanced-search-number-input" value="99" /> 
                            </label>
                        </div>
                        <div class = "advanced-search-collection-container">
                            <strong class="translated" defaultText="Owned copies:"></strong>
                            <label class = "advanced-search-label set-minimum-owned-copies">
                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-owned-copies advanced-search-number-input" value="0" /> 
                            </label>
                            <label class = "advanced-search-label set-maximum-owened-copies">
                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-owned-copies advanced-search-number-input" value="99" /> 
                            </label>
                        </div>
                        <div class = "advanced-search-misc-container">
                            <strong class="translated" defaultText="Misc:"></strong>
                            <label class = "advanced-search-label toggle-xwa">
                                <input type="checkbox" class="xwa-checkbox advanced-search-checkbox" checked="checked"/> <span class="translated" defaultText="Use XWA points"></span>
                            </label>
                            <label class = "advanced-search-label toggle-unique">
                                <input type="checkbox" class="unique-checkbox advanced-search-checkbox" /> <span class="translated" defaultText="Is unique"></span>
                            </label>
                            <label class = "advanced-search-label toggle-non-unique">
                                <input type="checkbox" class="non-unique-checkbox advanced-search-checkbox" /> <span class="translated" defaultText="Is not unique"></span>
                            </label>
                            <label class = "advanced-search-label toggle-limited">
                                <input type="checkbox" class="limited-checkbox advanced-search-checkbox" /> <span class="translated" defaultText="Is limited"></span>
                            </label>
                            <label class = "advanced-search-label toggle-standard">
                                <input type="checkbox" class="standard-checkbox advanced-search-checkbox" />  <span class="translated" defaultText="Standard legal"></span>
                            </label>
                        </div>
                    </div>
                    <div class = "card search-container ship-search-container">
                        <h6 class="card-subtitle mb-3 text-muted version translated" defaultText="Ships and Pilots"></h6>
                        <div class = "advanced-search-slot-available-container">
                            <label class = "advanced-search-label select-available-slots">
                                <strong class="translated" defaultText="Slots:"></strong>
                                <select class="advanced-search-selection slot-available-selection" multiple="1" data-placeholder="${exportObj.translate("ui","noXYselected","slots")}"></select>
                            </label>
                            <br />
                            <label class = "advanced-search-label toggle-unique">
                                <input type="checkbox" class="duplicate-slots-checkbox advanced-search-checkbox" /> <span class="translated" defaultText="Has multiple of the chosen slots"></span> 
                            </label>
                        </div>
                        <div class = "advanced-search-keyword-available-container">
                            <label class = "advanced-search-label select-available-keywords">
                                <strong class="translated" defaultText="Keywords:"></strong>
                                <select class="advanced-search-selection keyword-available-selection" multiple="1" data-placeholder="${exportObj.translate("ui","noXYselected","keywords")}"></select>
                            </label>
                        </div>
                        <div class = "advanced-search-actions-available-container">
                            <label class = "advanced-search-label select-available-actions">
                                <strong class="translated" defaultText="Actions:"></strong>
                                <select class="advanced-search-selection action-available-selection" multiple="1" data-placeholder="${exportObj.translate("ui","noXYselected","actions")}"></select>
                            </label>
                        </div>
                        <div class = "advanced-search-linkedactions-available-container">
                            <label class = "advanced-search-label select-available-linkedactions">
                                <strong class="translated" defaultText="Linked actions:"></strong>
                                <select class="advanced-search-selection linkedaction-available-selection" multiple="1" data-placeholder="${exportObj.translate("ui","noXYselected","actions")}"></select>
                            </label>
                        </div>
                        <div class = "advanced-search-ini-container">
                            <strong class="translated" defaultText="Initiative:"></strong>
                            <label class = "advanced-search-label set-minimum-ini">
                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-ini advanced-search-number-input" value="0" /> 
                            </label>
                            <label class = "advanced-search-label set-maximum-ini">
                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-ini advanced-search-number-input" value="6" /> 
                            </label>
                        </div>
                        <div class = "advanced-search-hull-container">
                            <strong class="translated" defaultText="Hull:"></strong>
                            <label class = "advanced-search-label set-minimum-hull">
                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-hull advanced-search-number-input" value="0" /> 
                            </label>
                            <label class = "advanced-search-label set-maximum-hull">
                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-hull advanced-search-number-input" value="12" /> 
                            </label>
                        </div>
                        <div class = "advanced-search-shields-container">
                            <strong class="translated" defaultText="Shields:"></strong>
                            <label class = "advanced-search-label set-minimum-shields">
                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-shields advanced-search-number-input" value="0" /> 
                            </label>
                            <label class = "advanced-search-label set-maximum-shields">
                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-shields advanced-search-number-input" value="6" /> 
                            </label>
                        </div>
                        <div class = "advanced-search-agility-container">
                            <strong class="translated" defaultText="Agility:"></strong>
                            <label class = "advanced-search-label set-minimum-agility">
                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-agility advanced-search-number-input" value="0" /> 
                            </label>
                            <label class = "advanced-search-label set-maximum-agility">
                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-agility advanced-search-number-input" value="3" /> 
                            </label>
                        </div>
                        <div class = "advanced-search-base-size-container">
                            <strong class="translated" defaultText="Base size:"></strong>
                            <label class = "advanced-search-label toggle-small-base">
                                <input type="checkbox" class="small-base-checkbox advanced-search-checkbox" checked="checked"/> <span class="translated" defaultText="Small"></span>
                            </label>
                            <label class = "advanced-search-label toggle-medium-base">
                                <input type="checkbox" class="medium-base-checkbox advanced-search-checkbox" checked="checked"/> <span class="translated" defaultText="Medium"></span>
                            </label>
                            <label class = "advanced-search-label toggle-large-base">
                                <input type="checkbox" class="large-base-checkbox advanced-search-checkbox" checked="checked"/> <span class="translated" defaultText="Large"></span>
                            </label>
                            <label class = "advanced-search-label toggle-huge-base">
                                <input type="checkbox" class="huge-base-checkbox advanced-search-checkbox" checked="checked"/> <span class="translated" defaultText="Huge"></span>
                            </label>
                        </div>
                        <div class = "advanced-search-attack-container">
                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-frontarc"></i>:</strong>
                            <label class = "advanced-search-label set-minimum-attack">
                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attack advanced-search-number-input" value="0" /> 
                            </label>
                            <label class = "advanced-search-label set-maximum-attack">
                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attack advanced-search-number-input" value="5" /> 
                            </label>
                        </div>
                        <div class = "advanced-search-attackt-container">
                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-singleturretarc"></i>:</strong>
                            <label class = "advanced-search-label set-minimum-attackt">
                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackt advanced-search-number-input" value="0" /> 
                            </label>
                            <label class = "advanced-search-label set-maximum-attackt">
                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackt advanced-search-number-input" value="5" /> 
                            </label>
                        </div>
                        <div class = "advanced-search-attackdt-container">
                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-doubleturretarc"></i>:</strong>
                            <label class = "advanced-search-label set-minimum-attackdt">
                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackdt advanced-search-number-input" value="0" /> 
                            </label>
                            <label class = "advanced-search-label set-maximum-attackdt">
                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackdt advanced-search-number-input" value="5" /> 
                            </label>
                        </div>
                        <div class = "advanced-search-attackf-container">
                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-fullfrontarc"></i>:</strong>
                            <label class = "advanced-search-label set-minimum-attackf">
                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackf advanced-search-number-input" value="0" /> 
                            </label>
                            <label class = "advanced-search-label set-maximum-attackf">
                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackf advanced-search-number-input" value="5" /> 
                            </label>
                        </div>
                        <div class = "advanced-search-attackb-container">
                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-reararc"></i>:</strong>
                            <label class = "advanced-search-label set-minimum-attackb">
                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackb advanced-search-number-input" value="0" /> 
                            </label>
                            <label class = "advanced-search-label set-maximum-attackb">
                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackb advanced-search-number-input" value="5" /> 
                            </label>
                        </div>
                        <div class = "advanced-search-attackbull-container">
                            <strong><i class="xwing-miniatures-font xwing-miniatures-font-bullseyearc"></i>:</strong>
                            <label class = "advanced-search-label set-minimum-attackbull">
                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-attackbull advanced-search-number-input" value="0" /> 
                            </label>
                            <label class = "advanced-search-label set-maximum-attackbull">
                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-attackbull advanced-search-number-input" value="5" /> 
                            </label>
                        </div>
                    </div>
                    <div class = "card search-container other-stuff-search-container">
                        <h6 class="card-subtitle mb-3 text-muted version translated" defaultText="Other Stuff"></h6>
                        <div class = "advanced-search-slot-used-container">
                            <label class = "advanced-search-label select-used-slots">
                                <strong class="translated" defaultText="Used slot:"></strong>
                                <select class="advanced-search-selection slot-used-selection" multiple="1" data-placeholder="${exportObj.translate("ui","noXYselected","slots")}"></select>
                            </label>
                        </div>
                        <div class = "advanced-search-slot-used-second-slot-container">
                            <label class = "advanced-search-label select-used-second-slots">
                                <strong class="translated" defaultText="Used double-slot:"></strong>
                                <select class="advanced-search-selection slot-used-second-selection" multiple="1" data-placeholder="${exportObj.translate("ui","noXYselected","slots")}"></select>
                            </label>
                            <br />
                            <label class = "advanced-search-label has-a-second-slot">
                                <input type="checkbox" class="advanced-search-checkbox has-a-second-slot-checkbox" /> <span class="translated" defaultText="Only upgrades requiring multiple slots"></span>
                            </label>
                        </div>
                        <div class = "advanced-search-charge-container">
                            <strong class="translated" defaultText="Charges:"></strong>
                            <label class = "advanced-search-label set-minimum-charge">
                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-charge advanced-search-number-input" value="0" /> 
                            </label>
                            <label class = "advanced-search-label set-maximum-charge">
                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-charge advanced-search-number-input" value="5" /> 
                            </label>
                            <br />
                            <label class = "advanced-search-label has-recurring-charge">
                                <input type="checkbox" class="advanced-search-checkbox has-recurring-charge-checkbox" checked="checked"/> <span class="translated" defaultText="Recurring"></span>
                            </label>
                            <label class = "advanced-search-label has-not-recurring-charge">
                                <input type="checkbox" class="advanced-search-checkbox has-not-recurring-charge-checkbox" checked="checked"/> <span class="translated" defaultText="Not recurring"></span>
                            </label>
                        <div class = "advanced-search-force-container">
                            <strong class="translated" defaultText="Force:"></strong>
                            <label class = "advanced-search-label set-minimum-force">
                                <span class="translated" defaultText="from"></span> <input type="number" class="minimum-force advanced-search-number-input" value="0" /> 
                            </label>
                            <label class = "advanced-search-label set-maximum-force">
                                <span class="translated" defaultText="to"></span> <input type="number" class="maximum-force advanced-search-number-input" value="3" /> 
                            </label>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4 card-selecting-area">
            <span class="translate sort-cards-by" defaultText="Sort cards by"></span><span class="translated" defaultText="Sort by">:</span> <select class="sort-by">
                <option value="name" class="translated" defaultText="Name"></option>
                <option value="source" class="translated" defaultText="Source"></option>
                <option value="type-by-points" class="translated" defaultText="Type (by Points)"></option>
                <option value="type-by-name" selected="1" class="translated" defaultText="Type (by Name)" selected="selected">${exportObj.translate("ui","Type (by Name)")}</option>
            </select>
            <div class="card-selector-container">

            </div>
            <br>
            <div class="card-viewer-conditions-container">
            </div>
        </div>
        <div class="col-md-4">
            <div class="card-viewer-container">
            </div>
        </div>
    </div>
</div>`)),this.card_selector_container=$(this.container.find(".xwing-card-browser .card-selector-container")),this.card_viewer_container=$(this.container.find(".xwing-card-browser .card-viewer-container")),this.card_viewer_container.append($.trim(exportObj.builders[7].createInfoContainerUI(!1))),this.card_viewer_container.hide(),this.card_viewer_conditions_container=$(this.container.find(".xwing-card-browser .card-viewer-conditions-container")),this.card_viewer_conditions_container.hide(),this.advanced_search_container=$(this.container.find(".xwing-card-browser .advanced-search-container")),this.sort_selector=$(this.container.find("select.sort-by")),this.sort_selector.select2({minimumResultsForSearch:-1}),this.card_search_text=$(this.container.find(".xwing-card-browser .card-search-text"))[0],this.faction_selection=$(this.container.find(".xwing-card-browser select.faction-selection")),g=exportObj.pilotsByFactionXWS)g[i],(b=$(document.createElement("OPTION"))).val(i),b.text(exportObj.translate("faction",i)),this.faction_selection.append(b);for(k in(e=$(document.createElement("OPTION"))).val("Factionless"),e.text(exportObj.translate("faction","Factionless")),this.faction_selection.append(e),this.faction_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.minimum_point_costs=$(this.container.find(".xwing-card-browser .minimum-point-cost"))[0],this.maximum_point_costs=$(this.container.find(".xwing-card-browser .maximum-point-cost"))[0],this.minimum_loadout_costs=$(this.container.find(".xwing-card-browser .minimum-loadout-cost"))[0],this.maximum_loadout_costs=$(this.container.find(".xwing-card-browser .maximum-loadout-cost"))[0],this.use_xwa_points=$(this.container.find(".xwing-card-browser .xwa-checkbox"))[0],this.standard_checkbox=$(this.container.find(".xwing-card-browser .standard-checkbox"))[0],this.unique_checkbox=$(this.container.find(".xwing-card-browser .unique-checkbox"))[0],this.non_unique_checkbox=$(this.container.find(".xwing-card-browser .non-unique-checkbox"))[0],this.limited_checkbox=$(this.container.find(".xwing-card-browser .limited-checkbox"))[0],this.base_size_checkboxes={Small:$(this.container.find(".xwing-card-browser .small-base-checkbox"))[0],Medium:$(this.container.find(".xwing-card-browser .medium-base-checkbox"))[0],Large:$(this.container.find(".xwing-card-browser .large-base-checkbox"))[0],Huge:$(this.container.find(".xwing-card-browser .huge-base-checkbox"))[0]},this.slot_available_selection=$(this.container.find(".xwing-card-browser select.slot-available-selection")),exportObj.upgradesBySlotCanonicalName)(b=$(document.createElement("OPTION"))).val(k),b.text(exportObj.translate("slot",k)),this.slot_available_selection.append(b);for(r in this.slot_available_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.keyword_available_selection=$(this.container.find(".xwing-card-browser select.keyword-available-selection")),o=[],exportObj.pilotsByKeyword)for(s=0,c=(l=r.split(",")).length;s<c;s++)a=l[s],o.indexOf(a)<0&&"undefined"!==a&&o.push(a);for(o.sort(),d=0,u=o.length;d<u;d++)n=o[d],(b=$(document.createElement("OPTION"))).val(n),b.text(exportObj.translate("keyword",n)),this.keyword_available_selection.append(b);for(this.keyword_available_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.duplicateslots=$(this.container.find(".xwing-card-browser .duplicate-slots-checkbox"))[0],this.action_available_selection=$(this.container.find(".xwing-card-browser select.action-available-selection")),m=0,h=(v=["Evade","Focus","Lock","Boost","Barrel Roll","Calculate","Reinforce","Rotate Arc","Coordinate","Slam","Reload","Jam","Cloak"].sort()).length;m<h;m++)t=v[m],(b=$(document.createElement("OPTION"))).text(exportObj.translate("action",t)),b.val(t),this.action_available_selection.append(b);for(this.action_available_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.linkedaction_available_selection=$(this.container.find(".xwing-card-browser select.linkedaction-available-selection")),_=0,p=(x=["Evade","Focus","Lock","Boost","Barrel Roll","Calculate","Reinforce","Rotate Arc","Coordinate","Slam","Reload","Jam","Cloak"].sort()).length;_<p;_++)f=x[_],(b=$(document.createElement("OPTION"))).text(exportObj.translate("action",f)),b.val(f),this.linkedaction_available_selection.append(b);for(k in this.linkedaction_available_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.slot_used_selection=$(this.container.find(".xwing-card-browser select.slot-used-selection")),exportObj.upgradesBySlotCanonicalName)(b=$(document.createElement("OPTION"))).text(exportObj.translate("slot",k)),b.val(k),this.slot_used_selection.append(b);for(k in this.slot_used_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.slot_used_second_selection=$(this.container.find(".xwing-card-browser select.slot-used-second-selection")),exportObj.upgradesBySlotCanonicalName)(b=$(document.createElement("OPTION"))).text(exportObj.translate("slot",k)),b.val(k),this.slot_used_second_selection.append(b);return this.slot_used_second_selection.select2({minimumResultsForSearch:$.isMobile()?-1:0}),this.minimum_charge=$(this.container.find(".xwing-card-browser .minimum-charge"))[0],this.maximum_charge=$(this.container.find(".xwing-card-browser .maximum-charge"))[0],this.minimum_ini=$(this.container.find(".xwing-card-browser .minimum-ini"))[0],this.maximum_ini=$(this.container.find(".xwing-card-browser .maximum-ini"))[0],this.minimum_force=$(this.container.find(".xwing-card-browser .minimum-force"))[0],this.maximum_force=$(this.container.find(".xwing-card-browser .maximum-force"))[0],this.minimum_hull=$(this.container.find(".xwing-card-browser .minimum-hull"))[0],this.maximum_hull=$(this.container.find(".xwing-card-browser .maximum-hull"))[0],this.minimum_shields=$(this.container.find(".xwing-card-browser .minimum-shields"))[0],this.maximum_shields=$(this.container.find(".xwing-card-browser .maximum-shields"))[0],this.minimum_agility=$(this.container.find(".xwing-card-browser .minimum-agility"))[0],this.maximum_agility=$(this.container.find(".xwing-card-browser .maximum-agility"))[0],this.minimum_attack=$(this.container.find(".xwing-card-browser .minimum-attack"))[0],this.maximum_attack=$(this.container.find(".xwing-card-browser .maximum-attack"))[0],this.minimum_attackt=$(this.container.find(".xwing-card-browser .minimum-attackt"))[0],this.maximum_attackt=$(this.container.find(".xwing-card-browser .maximum-attackt"))[0],this.minimum_attackdt=$(this.container.find(".xwing-card-browser .minimum-attackdt"))[0],this.maximum_attackdt=$(this.container.find(".xwing-card-browser .maximum-attackdt"))[0],this.minimum_attackf=$(this.container.find(".xwing-card-browser .minimum-attackf"))[0],this.maximum_attackf=$(this.container.find(".xwing-card-browser .maximum-attackf"))[0],this.minimum_attackb=$(this.container.find(".xwing-card-browser .minimum-attackb"))[0],this.maximum_attackb=$(this.container.find(".xwing-card-browser .maximum-attackb"))[0],this.minimum_attackbull=$(this.container.find(".xwing-card-browser .minimum-attackbull"))[0],this.maximum_attackbull=$(this.container.find(".xwing-card-browser .maximum-attackbull"))[0],this.hassecondslot=$(this.container.find(".xwing-card-browser .has-a-second-slot-checkbox"))[0],this.recurring_charge=$(this.container.find(".xwing-card-browser .has-recurring-charge-checkbox"))[0],this.not_recurring_charge=$(this.container.find(".xwing-card-browser .has-not-recurring-charge-checkbox"))[0],this.minimum_owned_copies=$(this.container.find(".xwing-card-browser .minimum-owned-copies"))[0],this.maximum_owned_copies=$(this.container.find(".xwing-card-browser .maximum-owned-copies"))[0],exportObj.translateUIElements(this.container)}setupHandlers(){var t,i;for(t in this.sort_selector.change(t=>this.renderList(this.sort_selector.val())),$("#browserTab").on("click",t=>this.renderList(this.sort_selector.val())),$(window).on("xwing:afterLanguageLoad",(t,i,e=$.noop)=>(this.language=i,this.prepareData())).on("xwing-collection:created",(t,i)=>this.collection=i).on("xwing-collection:destroyed",(t,i)=>this.collection=null),this.card_search_text.oninput=()=>this.renderList(this.sort_selector.val()),this.skip_nontext_search=!0,this.faction_selection[0].onchange=()=>this.renderList_advanced(this.sort_selector.val()),i=this.base_size_checkboxes)i[t].onclick=()=>this.renderList_advanced(this.sort_selector.val());return this.minimum_point_costs.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.maximum_point_costs.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.minimum_loadout_costs.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.maximum_loadout_costs.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.standard_checkbox.onclick=()=>this.renderList_advanced(this.sort_selector.val()),this.use_xwa_points.onclick=()=>this.renderList_advanced(this.sort_selector.val()),this.unique_checkbox.onclick=()=>this.renderList_advanced(this.sort_selector.val()),this.non_unique_checkbox.onclick=()=>this.renderList_advanced(this.sort_selector.val()),this.limited_checkbox.onclick=()=>this.renderList_advanced(this.sort_selector.val()),this.slot_available_selection[0].onchange=()=>this.renderList_advanced(this.sort_selector.val()),this.keyword_available_selection[0].onchange=()=>this.renderList_advanced(this.sort_selector.val()),this.duplicateslots.onclick=()=>this.renderList_advanced(this.sort_selector.val()),this.action_available_selection[0].onchange=()=>this.renderList_advanced(this.sort_selector.val()),this.linkedaction_available_selection[0].onchange=()=>this.renderList_advanced(this.sort_selector.val()),this.slot_used_selection[0].onchange=()=>this.renderList_advanced(this.sort_selector.val()),this.slot_used_second_selection[0].onchange=()=>this.renderList_advanced(this.sort_selector.val()),this.not_recurring_charge.onclick=()=>this.renderList_advanced(this.sort_selector.val()),this.recurring_charge.onclick=()=>this.renderList_advanced(this.sort_selector.val()),this.hassecondslot.onclick=()=>this.renderList_advanced(this.sort_selector.val()),this.minimum_charge.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.maximum_charge.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.minimum_ini.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.maximum_ini.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.minimum_hull.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.maximum_hull.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.minimum_force.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.maximum_force.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.minimum_shields.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.maximum_shields.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.minimum_agility.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.maximum_agility.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.minimum_attack.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.maximum_attack.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.minimum_attackt.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.maximum_attackt.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.minimum_attackdt.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.maximum_attackdt.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.minimum_attackf.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.maximum_attackf.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.minimum_attackb.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.maximum_attackb.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.minimum_attackbull.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.maximum_attackbull.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.minimum_owned_copies.oninput=()=>this.renderList_advanced(this.sort_selector.val()),this.maximum_owned_copies.oninput=()=>this.renderList_advanced(this.sort_selector.val())}getPoints(t){return this.use_xwa_points.checked&&null!=t.pointsxwa?t.pointsxwa:t.points}getLoadout(t){return this.use_xwa_points.checked&&null!=t.loadoutxwa?t.loadoutxwa:t.loadout}getSlots(t){return this.use_xwa_points.checked&&null!=t.slotsxwa?t.slotsxwa:t.slots}prepareData(){var s,e,a,t,i,n,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k,w,y,$;for(this.all_cards=[],t=0,n=TYPES.length;t<n;t++)w=TYPES[t],this.all_cards="upgrades"===w?this.all_cards.concat((()=>{var t=exportObj[w],i=[];for(a in t)e=t[a],i.push({name:e.name,display_name:e.display_name,type:exportObj.translate("ui","upgradeHeader",e.slot),data:e,orig_type:e.slot});return i})()):"damage"===w?this.all_cards.concat((()=>{var t=exportObj[w],i=[];for(a in t)e=t[a],i.push({name:e.name,display_name:e.display_name,type:exportObj.translate("ui","damageHeader",e.type),data:e,orig_type:"Damage"});return i})()):this.all_cards.concat((()=>{var t=exportObj[w],i=[];for(a in t)e=t[a],i.push({name:e.name,display_name:e.display_name,type:exportObj.translate("singular",w),data:e,orig_type:exportObj.translateToLang("English","singular",w)});return i})());for(a in this.types=(()=>{for(var t=["Pilot","Ship"],i=[],e=0,a=t.length;e<a;e++)w=t[e],i.push(exportObj.translate("types",w));return i})(),f=exportObj.upgrades)e=f[a],y=exportObj.translate("ui","upgradeHeader",e.slot),indexOf.call(this.types,y)<0&&this.types.push(y);for(a in m=exportObj.damage)e=m[a],y=exportObj.translate("ui","damageHeader",e.type),indexOf.call(this.types,y)<0&&this.types.push(y);for(this.all_cards.sort(byName),this.sources=[],i=0,l=(_=this.all_cards).length;i<l;i++)for(u=0,o=(b=(s=_[i]).data.sources).length;u<o;u++)k=b[u],indexOf.call(this.sources,k)<0&&this.sources.push(k);for(x=this.types.sort(),v=this.sources.sort(),this.cards_by_type_name={},h=0,r=x.length;h<r;h++)w=x[h],this.cards_by_type_name[w]=function(){for(var t=this.all_cards,i=[],e=0,a=t.length;e<a;e++)(s=t[e]).type===w&&i.push(s);return i}.call(this).sort(byName);for(this.cards_by_type_points={},p=0,d=x.length;p<d;p++)w=x[p],this.cards_by_type_points[w]=function(){for(var t=this.all_cards,i=[],e=0,a=t.length;e<a;e++)(s=t[e]).type===w&&i.push(s);return i}.call(this).sort(byPoints);for(this.cards_by_source={},g=[],$=0,c=v.length;$<c;$++)k=v[$],g.push(this.cards_by_source[k]=function(){for(var t=this.all_cards,i=[],e=0,a=t.length;e<a;e++)s=t[e],0<=indexOf.call(s.data.sources,k)&&i.push(s);return i}.call(this).sort(byName));return g}renderList_advanced(t="name"){return this.skip_nontext_search=!1,this.renderList(t)}renderList(t="name"){var i,e,a,s,n,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k,w,y,q,O,S;switch(null!=this.use_xwa_points.checked&&(exportObj.builders[7].isXwa=this.use_xwa_points.checked),null!=this.card_selector?this.card_selector.empty():(this.card_selector=$(document.createElement("SELECT")),this.card_selector.addClass("card-selector"),this.card_selector.attr("size",25),this.card_selector_container.append(this.card_selector)),this.setupSearch(),t){case"type-by-name":for(a=0,n=(_=this.types).length;a<n;a++){for(q=_[a],(f=$(document.createElement("OPTGROUP"))).attr("label",q),e=!1,s=0,l=(b=this.cards_by_type_name[q]).length;s<l;s++)i=b[s],this.checkSearchCriteria(i)&&(this.addCardTo(f,i),e=!0);e&&this.card_selector.append(f)}break;case"type-by-points":for(h=0,o=(g=this.types).length;h<o;h++){for(q=g[h],(f=$(document.createElement("OPTGROUP"))).attr("label",q),e=!1,p=0,r=(v=this.cards_by_type_points[q]).length;p<r;p++)i=v[p],this.checkSearchCriteria(i)&&(this.addCardTo(f,i),e=!0);e&&this.card_selector.append(f)}break;case"source":for(m=0,d=(x=this.sources).length;m<d;m++){for(y=x[m],(f=$(document.createElement("OPTGROUP"))).attr("label",exportObj.translate("sources",y)),e=!1,O=0,c=(k=this.cards_by_source[y]).length;O<c;O++)i=k[O],this.checkSearchCriteria(i)&&(this.addCardTo(f,i),e=!0);e&&this.card_selector.append(f)}break;default:for(S=0,u=(w=this.all_cards).length;S<u;S++)i=w[S],this.checkSearchCriteria(i)&&this.addCardTo(this.card_selector,i)}return this.card_selector.change(t=>this.renderCard($(this.card_selector.find(":selected"))))}renderCard(t){t.data("display_name"),t.data("name");var i,e,a,s,n,l,o=t.data("card"),t=t.data("orig_type");if("Pilot"!==t&&"Ship"!==t&&"Quickbuild"!==t&&"Damage"!==t&&(i={addon_type:t},t="Addon"),"Pilot"===t&&this.card_viewer_container.find("tr.info-faction").show(),this.card_viewer_container.show(),exportObj.builders[7].showTooltip(t,o,null!=i?i:{},this.card_viewer_container),null==(null!=o?o.applies_condition:void 0))return this.card_viewer_conditions_container.hide();if(a=new Set,o.applies_condition instanceof Array)for(s=0,n=(l=o.applies_condition).length;s<n;s++)e=l[s],a.add(exportObj.conditionsByCanonicalName[e]);else a.add(exportObj.conditionsByCanonicalName[o.applies_condition]);return this.card_viewer_conditions_container.text(""),a.forEach(t=>{var i=$(document.createElement("div"));return i.addClass("conditions-container d-flex flex-wrap"),i.append(conditionToHTML(t)),this.card_viewer_conditions_container.append(i)}),this.card_viewer_conditions_container.show()}addCardTo(t,i){var e=$(document.createElement("OPTION"));return e.text(`${i.display_name||i.name} (${null!=this.getPoints(i.data)?this.getPoints(i.data):null!=i.data.quantity?i.data.quantity+"x":"*"}${null!=this.getLoadout(i.data)?"/"+this.getLoadout(i.data):""})`),e.data("name",i.name),e.data("display_name",i.display_name),e.data("type",i.type),e.data("card",i.data),e.data("orig_type",i.orig_type),0===this.getCollectionNumber(i)&&e[0].classList.add("result-not-in-collection"),$(t).append(e)}getCollectionNumber(t){var i,e;if(null==exportObj.builders[7].collection||null==exportObj.builders[7].collection.counts)return-1;switch(i=0,t.orig_type){case"Pilot":i=null!=(e=null!=(e=exportObj.builders[7].collection.counts.pilot)?e[t.name]:void 0)?e:0;break;case"Ship":i=null!=(e=null!=(e=exportObj.builders[7].collection.counts.ship)?e[t.name]:void 0)?e:0;break;default:i=null!=(e=null!=(e=exportObj.builders[7].collection.counts.upgrade)?e[t.name]:void 0)?e:0}return i}setupSearch(){if(this.searchInputs={text:this.card_search_text.value.toLowerCase(),factions:this.faction_selection.val(),required_slots:this.slot_available_selection.val(),required_actions:this.action_available_selection.val(),required_linked_actions:this.linkedaction_available_selection.val(),required_keywords:this.keyword_available_selection.val(),used_slots:this.slot_used_selection.val(),used_second_slots:this.slot_used_second_selection.val()},0<=indexOf.call(this.searchInputs.factions,"Factionless"))return this.searchInputs.factions.push(void 0)}checkSearchCriteria(t){var i,e,a,s,n,l,o,r,E,z,d,c,M,B,N,D,R,F,X,W,G,H,Q,V,Y,Z,J,K,tt,u,h,p,f,m,_,b,it,g,v,x,k,w,et,y,$,q,at,st,nt,lt,ot,rt,dt,O,ct,S,ut,ht,pt,j,T,C,L,I,A,ft,mt,_t,P,U,bt;if(null!=this.searchInputs.text&&!(-1<t.name.toLowerCase().indexOf(this.searchInputs.text)||t.data.text&&-1<t.data.text.toLowerCase().indexOf(this.searchInputs.text)||t.display_name&&-1<t.display_name.toLowerCase().indexOf(this.searchInputs.text))){if(!t.data.ship)return!1;if((T=t.data.ship)instanceof Array){for(ft=!1,l=0,M=T.length;l<M;l++)if(-1<(pt=T[l]).toLowerCase().indexOf(this.searchInputs.text)||exportObj.ships[pt].display_name&&-1<exportObj.ships[pt].display_name.toLowerCase().indexOf(this.searchInputs.text)){ft=!0;break}if(!ft)return!1}else if(!(-1<T.toLowerCase().indexOf(this.searchInputs.text)||exportObj.ships[T].display_name&&-1<exportObj.ships[T].display_name.toLowerCase().indexOf(this.searchInputs.text)))return!1}if(this.skip_nontext_search)return!0;if(C=(()=>{var t=exportObj.pilotsByFactionXWS,i=[];for(a in t)k=t[a],i.push(a);return i})(),0<(j=this.searchInputs.factions).length){if(S=t.data.faction,!(0<=indexOf.call(j,S)||"Ship"===t.orig_type||t.data.faction instanceof Array))return!1;if(t.data.faction instanceof Array){for(s=!1,d=0,B=(at=t.data.faction).length;d<B;d++)if(a=at[d],0<=indexOf.call(j,a)){s=!0;break}if(!s)return!1}if("Ship"===t.orig_type){for(s=!1,u=0,H=(rt=t.data.factions).length;u<H;u++)if(a=rt[u],0<=indexOf.call(j,a)){s=!0;break}if(!s)return!1}}else j=C;if(this.standard_checkbox.checked){for(A=!1,g=0,Q=(dt=null!=t.data.faction?Array.isArray(t.data.faction)?t.data.faction:[t.data.faction]:j).length;g<Q;g++)a=dt[g],indexOf.call(j,a)<0||(A=A||exportObj.standardCheckBrowser(t.data,a,t.orig_type));if(!A)return!1}if(0<(ht=this.searchInputs.required_slots).length)for(I=this.getSlots(t.data),y=0,V=ht.length;y<V;y++){if(!(("Torpedo"===(L=ht[y])||"Missile"===L||"Cannon"===L)&&null!=I&&0<=indexOf.call(I,"HardpointShip")||null!=I&&0<=indexOf.call(I,L)))return!1;if(this.duplicateslots.checked&&0===I.filter(function(t,i,e){return e.indexOf(t)===i&&i!==e.lastIndexOf(t)&&t===L}).length)return!1}if(0<(ut=this.searchInputs.required_keywords).length)for(z=t.data.keyword,U=0,Y=ut.length;U<Y;U++)if(E=ut[U],!(null!=z&&0<=indexOf.call(z,E)))return!1;if(S=this.searchInputs.required_actions,C=this.searchInputs.required_linked_actions,(0<S.length||0<C.length)&&(e=null!=(O=t.data.actions)?O:[],"Pilot"===t.orig_type)&&(e=(e=null!=(O=null!=(O=t.data.ship_override)?O.actions:void 0)?O:exportObj.ships[t.data.ship].actions).concat(null!=(O=null!=(O=t.data.ship_override)?O.actionsred:void 0)?O:exportObj.ships[t.data.ship].actionsred),null!=t.data.keyword)&&0<=indexOf.call(t.data.keyword,"Droid")){for(it=[],bt=0,Z=e.length;bt<Z;bt++)null!=(i=e[bt])&&it.push(i.replace("Focus","Calculate"));e=it}for(n=0,J=(ct=null!=S?S:[]).length;n<J;n++)if(i=ct[n],null==e||!(0<=indexOf.call(e,i)||0<=indexOf.call(e,"F-"+i)||0<=indexOf.call(e,"R-"+i)))return!1;for(o=0,K=(st=null!=C?C:[]).length;o<K;o++)if(i=st[o],!(null!=e&&(0<=indexOf.call(e,"R> "+i)||0<=indexOf.call(e,"> "+i))))return!1;if(0<this.minimum_point_costs.value||this.maximum_point_costs.value<20){if(!(this.getPoints(t.data)>=this.minimum_point_costs.value&&this.getPoints(t.data)<=this.maximum_point_costs.value||null!=t.data.variablepoints))return!1;if(null!=t.data.variablepoints&&(m=!1,P=this.getPoints(t.data),Array.isArray(P))){for(r=0,tt=P.length;r<tt;r++)if((et=P[r])>=this.minimum_point_costs.value&&et<=this.maximum_point_costs.value){m=!0;break}if(!m)return!1}if("Ship"===t.orig_type){for(m=!1,c=0,N=j.length;c<N;c++){for(b in a=j[c],nt=exportObj.pilotsByFactionCanonicalName[a]){for(h=0,D=(w=nt[b]).length;h<D;h++)if((k=w[h]).ship===t.data.name&&this.getPoints(k)>=this.minimum_point_costs.value&&this.getPoints(k)<=this.maximum_point_costs.value){m=!0;break}if(m)break}if(m)break}if(!m)return!1}}if(0<this.minimum_loadout_costs.value||this.maximum_loadout_costs.value<99){if(!(this.getLoadout(t.data)>=this.minimum_loadout_costs.value&&this.getLoadout(t.data)<=this.maximum_loadout_costs.value))return!1;if("Ship"===t.orig_type){for(f=!1,_=0,R=j.length;_<R;_++){for(b in a=j[_],lt=exportObj.pilotsByFactionCanonicalName[a]){for(v=0,F=(w=lt[b]).length;v<F;v++)if((k=w[v]).ship===t.data.name&&this.getLoadout(k)>=this.minimum_loadout_costs.value&&this.getLoadout(k)<=this.maximum_loadout_costs.value){f=!0;break}if(f)break}if(f)break}if(!f)return!1}}if(0<(_t=this.searchInputs.used_slots).length){if(null==t.data.slot)return!1;for(p=!1,x=0,X=_t.length;x<X;x++)if(L=_t[x],t.data.slot===L){p=!0;break}if(!p)return!1}if(0<(mt=this.searchInputs.used_second_slots).length){if(null==t.data.also_occupies_upgrades)return!1;for(p=!1,$=0,W=mt.length;$<W;$++)for(L=mt[$],q=0,G=(ot=t.data.also_occupies_upgrades).length;q<G;q++)if(ot[q]===L){p=!0;break}if(!p)return!1}if(null==t.data.also_occupies_upgrades&&this.hassecondslot.checked)return!1;if(this.unique_checkbox.checked&&!t.data.unique)return!1;if(this.non_unique_checkbox.checked&&t.data.unique)return!1;if(this.limited_checkbox.checked&&!t.data.max_per_squad)return!1;if(!(null!=t.data.charge&&t.data.charge<=this.maximum_charge.value&&t.data.charge>=this.minimum_charge.value||this.minimum_charge.value<=0&&null==t.data.charge))return!1;if(t.data.recurring&&!this.recurring_charge.checked)return!1;if(t.data.charge&&!t.data.recurring&&!this.not_recurring_charge.checked)return!1;if(null!=(null!=(O=exportObj.builders[7].collection)?O.counts:void 0)&&!((S=this.getCollectionNumber(t))>=this.minimum_owned_copies.value&&S<=this.maximum_owned_copies.value))return!1;if(null!=t.data.skill){if(!(t.data.skill>=this.minimum_ini.value&&t.data.skill<=this.maximum_ini.value))return!1}else if(!(this.minimum_ini.value<=0&&6<=this.maximum_ini.value))return!1;if(this.base_size_checkboxes.Small.checked&&this.base_size_checkboxes.Medium.checked&&this.base_size_checkboxes.Large.checked&&this.base_size_checkboxes.Huge.checked||(C=!1,"Ship"===t.orig_type?C=null!=t.data.base?C||this.base_size_checkboxes[t.data.base].checked:C||this.base_size_checkboxes.Small.checked:"Pilot"===t.orig_type&&(C=null!=(T=exportObj.ships[t.data.ship]).base?C||this.base_size_checkboxes[T.base].checked:C||this.base_size_checkboxes.Small.checked),C))return("0"===this.minimum_hull.value&&"12"===this.maximum_hull.value||null!=t.data.hull&&t.data.hull>=this.minimum_hull.value&&t.data.hull<=this.maximum_hull.value||"Pilot"===t.orig_type&&exportObj.ships[t.data.ship].hull>=this.minimum_hull.value&&exportObj.ships[t.data.ship].hull<=this.maximum_hull.value)&&("0"===this.minimum_shields.value&&"6"===this.maximum_shields.value||null!=t.data.shields&&t.data.shields>=this.minimum_shields.value&&t.data.shields<=this.maximum_shields.value||"Pilot"===t.orig_type&&exportObj.ships[t.data.ship].shields>=this.minimum_shields.value&&exportObj.ships[t.data.ship].shields<=this.maximum_shields.value)&&("0"===this.minimum_agility.value&&"3"===this.maximum_agility.value||null!=t.data.agility&&t.data.agility>=this.minimum_agility.value&&t.data.agility<=this.maximum_agility.value||"Pilot"===t.orig_type&&exportObj.ships[t.data.ship].agility>=this.minimum_agility.value&&exportObj.ships[t.data.ship].agility<=this.maximum_agility.value)&&("0"===this.minimum_attack.value&&"5"===this.maximum_attack.value||null!=t.data.attack&&t.data.attack>=this.minimum_attack.value&&t.data.attack<=this.maximum_attack.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attack&&exportObj.ships[t.data.ship].attack>=this.minimum_attack.value&&exportObj.ships[t.data.ship].attack<=this.maximum_attack.value||null==exportObj.ships[t.data.ship].attack&&this.minimum_attack.value<=0)||"Ship"===t.orig_type&&null==t.data.attack&&this.minimum_attack.value<=0)&&("0"===this.minimum_attackt.value&&"5"===this.maximum_attackt.value||null!=t.data.attackt&&t.data.attackt>=this.minimum_attackt.value&&t.data.attackt<=this.maximum_attackt.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attackt&&exportObj.ships[t.data.ship].attackt>=this.minimum_attackt.value&&exportObj.ships[t.data.ship].attackt<=this.maximum_attackt.value||null==exportObj.ships[t.data.ship].attackt&&this.minimum_attackt.value<=0)||"Ship"===t.orig_type&&null==t.data.attackt&&this.minimum_attackt.value<=0)&&("0"===this.minimum_attackdt.value&&"5"===this.maximum_attackdt.value||null!=t.data.attackdt&&t.data.attackdt>=this.minimum_attackdt.value&&t.data.attackdt<=this.maximum_attackdt.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attackdt&&exportObj.ships[t.data.ship].attackdt>=this.minimum_attackdt.value&&exportObj.ships[t.data.ship].attackdt<=this.maximum_attackdt.value||null==exportObj.ships[t.data.ship].attackdt&&this.minimum_attackdt.value<=0)||"Ship"===t.orig_type&&null==t.data.attackdt&&this.minimum_attackdt.value<=0)&&("0"===this.minimum_attackf.value&&"5"===this.maximum_attackf.value||null!=t.data.attackf&&t.data.attackf>=this.minimum_attackf.value&&t.data.attackf<=this.maximum_attackf.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attackf&&exportObj.ships[t.data.ship].attackf>=this.minimum_attackf.value&&exportObj.ships[t.data.ship].attackf<=this.maximum_attackf.value||null==exportObj.ships[t.data.ship].attackf&&this.minimum_attackf.value<=0)||"Ship"===t.orig_type&&null==t.data.attackf&&this.minimum_attackf.value<=0)&&("0"===this.minimum_attackb.value&&"5"===this.maximum_attackb.value||null!=t.data.attackb&&t.data.attackb>=this.minimum_attackb.value&&t.data.attackb<=this.maximum_attackb.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attackb&&exportObj.ships[t.data.ship].attackb>=this.minimum_attackb.value&&exportObj.ships[t.data.ship].attackb<=this.maximum_attackb.value||null==exportObj.ships[t.data.ship].attackb&&this.minimum_attackb.value<=0)||"Ship"===t.orig_type&&null==t.data.attackb&&this.minimum_attackb.value<=0)&&("0"===this.minimum_attackbull.value&&"5"===this.maximum_attackbull.value||null!=t.data.attackbull&&t.data.attackbull>=this.minimum_attackbull.value&&t.data.attackbull<=this.maximum_attackbull.value||"Pilot"===t.orig_type&&(null!=exportObj.ships[t.data.ship].attackbull&&exportObj.ships[t.data.ship].attackbull>=this.minimum_attackbull.value&&exportObj.ships[t.data.ship].attackbull<=this.maximum_attackbull.value||null==exportObj.ships[t.data.ship].attackbull&&this.minimum_attackbull.value<=0)||"Ship"===t.orig_type&&null==t.data.attackbull&&this.minimum_attackbull.value<=0)&&("0"===this.minimum_force.value&&"3"===this.maximum_force.value||null!=t.data.force&&t.data.force>=this.minimum_force.value&&t.data.force<=this.maximum_force.value||"Pilot"===t.orig_type&&exportObj.ships[t.data.ship].force>=this.minimum_force.value&&exportObj.ships[t.data.ship].force<=this.maximum_force.value||null==t.data.force&&"0"===this.minimum_force.value);return!1}},(exportObj="undefined"!=typeof exports&&null!==exports?exports:this).RulesBrowser=class{constructor(t){this.container=$(t.container),this.language=null!=(t=exportObj.currentLanguage)?t:"English",this.prepareRulesData(),this.setupRuleUI(),this.setupRulesHandlers()}setupRuleUI(){var t,i;return this.container.append($.trim(`<div class="container-fluid xwing-rules-browser">
    <div class="row">
        <div class="col-md-4">
            <div class="card card-search-container">
                <h5 class="card-title translated" defaultText="Rules Search"></h5>
                <div class="advanced-search-container">
                    <h6 class="card-subtitle mb-2 text-muted version"><span class="translated" defaultText="Version"></span>: </h6>
                    <label class = "text-search advanced-search-label">
                        <strong class="translated" defaultText="Term:"></strong>
                        <input type="search" placeholder="${exportObj.translate("ui","Search for game term or card")}" class = "rule-search-text">
                    </label>
                </div>
                <div class="rules-container card-selector-container">
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <div class="card card-viewer-container card-search-container">
                <h4 class="card-title info-name"></h4>
                <br />
                <p class="info-text" />
            </div>
        </div>
    </div>
</div>`)),this.versionlabel=$(this.container.find(".xwing-rules-browser .version")),this.rule_selector_container=$(this.container.find(".xwing-rules-browser .rules-container")),this.rule_viewer_container=$(this.container.find(".xwing-rules-browser .card-viewer-container")),this.rule_viewer_container.hide(),this.advanced_search_container=$(this.container.find(".xwing-rules-browser .advanced-search-container")),exportObj.translateUIElements(this.container),i=this.all_rules.version.number,t=this.all_rules.version.date,this.versionlabel.append(i+", "+t),this.rule_search_rules_text=$(this.container.find(".xwing-rules-browser .rule-search-text"))[0]}setupRulesHandlers(){return this.renderRulesList(),$(window).on("xwing:afterLanguageLoad",(t,i,e=$.noop)=>(this.language=i,exportObj.loadRules(i),this.prepareRulesData(),this.renderRulesList())),this.rule_search_rules_text.oninput=()=>this.renderRulesList()}prepareRulesData(){return this.all_rules=exportObj.rulesEntries(),this.ruletype=["glossary","faq"]}renderRulesList(){var t,i,e,a,s,n,l,o,r;for(null!=this.rule_selector&&this.rule_selector.remove(),this.rule_selector=$(document.createElement("SELECT")),this.rule_selector.addClass("card-selector"),this.rule_selector.attr("size",25),this.rule_selector_container.append(this.rule_selector),t=0,i=(a=this.ruletype).length;t<i;t++){for(o in r=a[t],(e=$(document.createElement("OPTGROUP"))).attr("label",exportObj.translate("rulestypes",r)),n=!1,s=this.all_rules[r])l=s[o],this.checkRulesSearchCriteria(l)&&(this.addRulesTo(e,l),n=!0);n&&this.rule_selector.append(e)}return this.rule_selector.change(t=>this.renderRules($(this.rule_selector.find(":selected"))))}renderRules(t){t={name:t.data("name"),text:t.data("text")};return this.rule_viewer_container.show(),exportObj.builders[0].showTooltip("Rules",t,"undefined"!=typeof add_opts&&null!==add_opts?add_opts:{},this.rule_viewer_container)}addRulesTo(t,i){var e=$(document.createElement("OPTION"));return e.text(""+i.name),e.data("name",i.name),e.data("text",exportObj.fixIcons(i)),$(t).append(e)}checkRulesSearchCriteria(t){var i=this.rule_search_rules_text.value.toLowerCase();return-1<t.name.toLowerCase().indexOf(i)||-1<(t.text&&t.text.toLowerCase().indexOf(i))}},SHOW_DEBUG_OUT_MISSING_TRANSLATIONS=!(DFL_LANGUAGE="English"),builders=[],(exportObj="undefined"!=typeof exports&&null!==exports?exports:this).languagePriority=-1;try{(()=>{var t,i,e,a,s;if(!(3<exportObj.languagePriority)&&(exportObj.currentLanguage=DFL_LANGUAGE,-1!==exportObj.languagePriority))for(s=[],t=0,a=(e=[navigator.language].concat(navigator.languages)).length;t<a;t++){if((i=(i=e[t]).split("-")[0])in exportObj.codeToLanguage){exportObj.currentLanguage=exportObj.codeToLanguage[i],exportObj.languagePriority=3;break}s.push(void 0)}})()}catch(t){all=t,exportObj.currentLanguage=DFL_LANGUAGE}exportObj.loadCards=function(t){return exportObj.cardLoaders[t]()},exportObj.loadRules=function(t){return t in exportObj.ruleLoaders?(exportObj.rulesLang!==t&&(exportObj.ruleLoaders[t](),exportObj.rulesLang=t),!0):(exportObj.rulesLang!==DFL_LANGUAGE&&(exportObj.ruleLoaders[DFL_LANGUAGE](),exportObj.rulesLang=DFL_LANGUAGE),!1)},exportObj.translate=function(t,i,...e){return exportObj.translateToLang(exportObj.currentLanguage,t,i,...e)},exportObj.translateToLang=function(t,i,e,...a){var s;try{s=exportObj.translations[t][i][e]}catch(t){all=t,s=void 0}return null!=s?s instanceof Function?s(exportObj.translate,...a):s:t!==DFL_LANGUAGE?(SHOW_DEBUG_OUT_MISSING_TRANSLATIONS&&console.log(t+" translation for "+String(e)+" (category "+String(i)+") missing"),exportObj.translateToLang(DFL_LANGUAGE,i,e,...a)):e},exportObj.setupTranslationSupport=function(){var t,i,h;return h=builders,$(exportObj).on("xwing:languageChanged",async(t,i,e=5,a=$.noop)=>{var s,n,l,o,r,d,c,u;if("reload"!==e){if(e<exportObj.languagePriority)return;exportObj.languagePriority=e,exportObj.currentLanguage=i}if(i in exportObj.translations){for($(".language-placeholder").text(i),l="",n=[],o=0,d=h.length;o<d;o++)l=(s=h[o]).language,n.push(new Promise((t,i)=>s.container.trigger("xwing:beforeLanguageLoad",t)));for(await Promise.all(n),i!==l&&exportObj.loadCards(i),exportObj.translateUIElements(),u=[],r=0,c=h.length;r<c;r++)s=h[r],u.push(s.container.trigger("xwing:afterLanguageLoad",i));return u}}),t=exportObj.basicCardData(),i=exportObj.basicQuickBuilds(),exportObj.canonicalizeShipNames(t),exportObj.ships=t.ships,exportObj.setupCommonCardData(t),exportObj.setupQuickBuilds(i),exportObj.loadCards(DFL_LANGUAGE),exportObj.loadRules(exportObj.currentLanguage),DFL_LANGUAGE!==exportObj.currentLanguage&&exportObj.loadCards(exportObj.currentLanguage),$(exportObj).trigger("xwing:languageChanged",[exportObj.currentLanguage,"reload"])},exportObj.translateUIElements=function(t=void 0){for(var i,e=$(".translated",t),a=[],s=0,n=e.length;s<n;s++)i=e[s],a.push(i.innerHTML=exportObj.translate("ui",i.getAttribute("defaultText")));return a},exportObj.setupTranslationUI=function(t){for(var i,a,e=Object.keys(exportObj.cardLoaders).sort(),s=[],n=0,l=e.length;n<l;n++)i=e[n],(a=$(document.createElement("LI"))).text(i),((i,e)=>{a.click(function(t){return null!=e&&e.set("language",i),$(exportObj).trigger("xwing:languageChanged",[i,100])})})(i,t),s.push($(".language-picker .dropdown-menu").append(a));return s},exportObj.registerBuilderForTranslation=function(t){if(indexOf.call(builders,t)<0)return builders.push(t)},(exportObj="undefined"!=typeof exports&&null!==exports?exports:this).sortHelper=function(t,i){var e,a;return t.points===i.points?(e=t.text.replace(/[^a-z0-9]/gi,""))===(a=i.text.replace(/[^a-z0-9]/gi,""))?0:a<e?1:-1:"string"==typeof t.points||t.points>i.points?1:-1},exportObj.toTTS=function(t){return null==t?null:t.replace(/\(.*\)/g,"").replace("",'"').replace("",'"')},exportObj.slotsMatching=function(t,i){if(t===i)return!0;switch(t){case"HardpointShip":if("Torpedo"===i||"Cannon"===i||"Missile"===i)return!0;break;case"VersatileShip":if("Torpedo"===i||"Missile"===i)return!0}switch(i){case"HardpointShip":if("Torpedo"===t||"Cannon"===t||"Missile"===t)return!0;break;case"VersatileShip":if("Torpedo"===t||"Missile"===t)return!0}return!1},$.isMobile=function(){return!!(navigator.userAgent.match(/(iPhone|iPod|iPad|Android)/i)||1<navigator.maxTouchPoints)},$.randomInt=function(t){return Math.floor(Math.random()*t)},$.isElementInView=function(t,i){var e=$(window).scrollTop(),a=e+$(window).height(),s=null!=(s=$(t))&&null!=(s=s.offset())?s.top:void 0,t=s+$(t).height();return i?e<s&&t<a:s<=a&&e<=t},$.getParameterByName=function(t){return t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),null===(t=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.search))?"":decodeURIComponent(t[1].replace(/\+/g," "))},Array.prototype.intersects=function(t){for(var i,e=0,a=this.length;e<a;e++)if(i=this[e],0<=indexOf.call(t,i))return!0;return!1},Array.prototype.removeItem=function(t){t=this.indexOf(t);return-1!==t&&this.splice(t,1),this},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.getXWSBaseName=function(){return this.split("-")[0]},URL_BASE=window.location.protocol+"//"+window.location.host+window.location.pathname,SQUAD_DISPLAY_NAME_MAX_LENGTH=24,statAndEffectiveStat=function(t,i,e){return null!=t?""+t+(null!=i&&null!=i[e]&&i[e]!==t?` (${i[e]})`:""):null!=i&&null!=i[e]?`0 (${i[e]})`:"0"},getPrimaryFaction=function(t){switch(t){case"Rebel Alliance":return"Rebel Alliance";case"Galactic Empire":return"Galactic Empire";default:return t}},conditionToHTML=function(t){return $.trim(`<div class="condition">
    <div class="name">${t.unique?"&middot;&nbsp;":""}${t.display_name||t.name}</div>
    <div class="text">${t.text}</div>
</div>`)},exportObj.SquadBuilder=function(){class t{constructor(t){this.getPermaLinkParams=this.getPermaLinkParams.bind(this),this.getPermaLink=this.getPermaLink.bind(this),this.updateShipOrder=this.updateShipOrder.bind(this),this.updatePermaLink=this.updatePermaLink.bind(this),this.onNotesUpdated=this.onNotesUpdated.bind(this),this.onGameTypeChanged=this.onGameTypeChanged.bind(this),this.onPointsUpdated=this.onPointsUpdated.bind(this),this.onSquadLoadRequested=this.onSquadLoadRequested.bind(this),this.onSquadDirtinessChanged=this.onSquadDirtinessChanged.bind(this),this.onSquadNameChanged=this.onSquadNameChanged.bind(this),this.updatePrintAndExportTexts=this.updatePrintAndExportTexts.bind(this),this.claimUnique=this.claimUnique.bind(this),this.releaseUnique=this.releaseUnique.bind(this),this._randomizerLoopBody=this._randomizerLoopBody.bind(this),this._makeRandomizerLoopFunc=this._makeRandomizerLoopFunc.bind(this),this.container=$(t.container),this.faction=$.trim(t.faction),this.printable_container=$(t.printable_container),this.tab=$(t.tab),this.show_points_destroyed=!1,this.isCurrentlyLoadingSquad=!1,this.ships=[],this.uniques_in_use={Pilot:[],Upgrade:[],Slot:[]},this.standard_list={Upgrade:[],Ship:[]},this.suppress_automatic_new_ship=!1,this.tooltip_currently_displaying=null,this.randomizer_options={sources:null,points:20,ship_limit:0,collection_only:!0,fill_zero_pts:!1},this.total_points=0,this.isStandard=null!=(t=null!=(t=exportObj.builders[0])?t.isStandard:void 0)&&t,this.isEpic=null!=(t=null!=(t=exportObj.builders[0])?t.isEpic:void 0)&&t,this.isXwa=null==(t=null!=(t=exportObj.builders[0])?t.isXwa:void 0)||t,this.isQuickbuild=null!=(t=null!=(t=exportObj.builders[0])?t.isQuickbuild:void 0)&&t,this.backend=null,this.current_squad={},this.language=null!=(t=exportObj.currentLanguage)?t:"English",this.collection=null,this.current_obstacles=[],this.setupUI(),("All"===this.faction?this.game_type_selector.val("epic"):this.game_type_selector.val((null!=(t=exportObj.builders[0])?t:this).game_type_selector.val())).trigger("change"),this.setupEventHandlers(),window.setInterval(this.updatePermaLink,250),this.isUpdatingPoints=!1,$.getParameterByName("f")===this.faction?(this.resetCurrentSquad(!0),this.loadFromSerialized($.getParameterByName("d"))):(this.resetCurrentSquad(),this.addShip())}resetCurrentSquad(t=!1){var i,e=this.uitranslation("Unnamed Squadron"),a=$.trim(this.squad_name_input.val())||e;return t&&$.trim($.getParameterByName("sn"))&&(a=$.trim($.getParameterByName("sn"))),i=[],t&&$.trim($.getParameterByName("obs"))?(i=$.trim($.getParameterByName("obs")).split(",").slice(0,3),this.updateObstacleSelect(i)):this.current_obstacles&&(i=this.current_obstacles),this.current_squad={id:null,name:a,dirty:!1,additional_data:{points:this.total_points,description:"",cards:[],notes:"",obstacles:i,tag:""},faction:this.faction},0<this.total_points&&(a===e&&(this.current_squad.name=this.uitranslation("Unsaved Squadron")),this.current_squad.dirty=!0),this.old_version_container.toggleClass("d-none",!0),this.container.trigger("xwing-backend:squadNameChanged"),this.container.trigger("xwing-backend:squadDirtinessChanged")}newSquadFromScratch(t=this.uitranslation("New Squadron")){return this.squad_name_input.val(t),this.removeAllShips(),this.suppress_automatic_new_ship||this.addShip(),this.updateObstacleSelect([]),this.resetCurrentSquad(),this.notes.val(""),this.tag.val("")}uitranslation(t,...i){return exportObj.translate("ui",t,i)}setupUI(){var t,i,e,a,s,n;for(this.status_container=$(document.createElement("DIV")),this.status_container.addClass("container-fluid"),this.status_container.append($.trim(`<div class="row squad-name-and-points-row">
    <div class="col-md-3 squad-name-container">
        <div class="display-name">
            <span class="squad-name"></span>
            <i class="far fa-edit"></i>
        </div>
        <div class="input-append">
            <input type="text" maxlength="64" placeholder="${this.uitranslation("Name your squad...")}" />
            <button class="btn save"><i class="fa fa-pen-square"></i></button>
        </div>
        <br class="hide-on-mobile" />
        <select class="game-type-selector">
            <option value="xwa" class="translated" defaultText="XWA" selected="selected">${this.uitranslation("XWA")}</option>
            <option value="standard" class="translated" defaultText="Standard">${this.uitranslation("Standard")}</option>
            <option value="extended" class="translated" defaultText="Extended">${this.uitranslation("Extended")}</option>
            <option value="epic" class="translated" defaultText="Epic">${this.uitranslation("Epic")}</option>
            <option value="quickbuild" class="translated" defaultText="Quickbuild">${this.uitranslation("Standard")}</option>
        </select>
    </div>
    <div class="col-md-4 points-display-container">
        Points: <span class="total-points">0</span> / <input type="number" class="desired-points" value="20">
        <span class="points-remaining-container">(<span class="points-remaining"></span>&nbsp;left) <span class="points-destroyed red"></span></span>
        <span class="content-warning unreleased-content-used d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Unreleased content warning"></span></span>
        <span class="content-warning loading-failed-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Broken squad link warning"></span></span>
        <span class="content-warning old-version-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="This squad was created for an older version of X-Wing."></span></span>
        <span class="content-warning collection-invalid d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Collection warning"></span></span>
        <span class="content-warning ship-number-invalid-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Ship number warning"></span></span>
        <span class="content-warning multi-faction-warning-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Multi-Faction warning"></span></span>
        <span class="content-warning epic-not-legal-container d-none"><br /><i class="fa fa-exclamation-circle"></i>&nbsp;<span class="translated" defaultText="Epic Unofficial"></span></span>
    </div>
    <div class="col-md-5 float-right button-container">
        <div class="btn-group float-right">

            <button class="btn btn-info view-as-text"><span class="d-none d-lg-block"><i class="fa fa-print"></i>&nbsp;<span class="translated" defaultText="Print/Export"></span></span><span class="d-lg-none"><i class="fa fa-print"></i></span></button>
            <a class="btn btn-primary d-none collection"><span class="d-none d-lg-block"><i class="fa fa-folder-open"></i> <span class="translated" defaultText="Your Collection"></span></span><span class="d-lg-none"><i class="fa fa-folder-open"></i></span></a>
            <!-- Randomize button is marked as danger, since it creates a new squad -->
            <button class="btn btn-danger randomize"><span class="d-none d-lg-block"><i class="fa fa-random"></i> <span class="translated" defaultText="Randomize!"></span></span><span class="d-lg-none"><i class="fa fa-random"></i></span></button>
            <button class="btn btn-danger dropdown-toggle" data-toggle="dropdown">
                <span class="caret"></span>
            </button>
             <ul class="dropdown-menu dropdown-menu-right">
                <li><a class="dropdown-item randomize-options translated" defaultText="Randomizer Options"></a></li>
                <li><a class="dropdown-item misc-settings translated" defaultText="Misc Settings"></a></li>
            </ul>
        </div>
    </div>
</div>

<div class="row squad-save-buttons">
    <div class="col-md-12 squad-save-buttons-container">
        <button class="show-authenticated btn btn-primary save-list"><i class="far fa-save"></i>&nbsp;<span class="translated" defaultText="Save"></span></button>
        <button class="show-authenticated btn btn-primary save-list-as"><i class="far fa-file"></i>&nbsp;<span class="translated" defaultText="Save As..."></span></button>
        <button class="show-authenticated btn btn-primary delete-list disabled"><i class="fa fa-trash"></i>&nbsp;<span class="translated" defaultText="Delete"></span></button>
        <button class="show-authenticated btn btn-info backend-list-my-squads show-authenticated"><i class="fa fa-download"></i>&nbsp;<span class = "translated" defaultText="Load Squad"></span></button>
        <button class="btn btn-info import-squad"><i class="fa fa-file-import"></i>&nbsp;<span class="translated" defaultText="Import"></span></button>
        <button class="btn btn-info show-points-destroyed"><i class="fas fa-bullseye"></i>&nbsp;<span class="show-points-destroyed-span translated" defaultText="${this.uitranslation("Show Points Destroyed")}"></span></button>                    
        <button class="btn btn-danger clear-squad"><i class="fa fa-plus-circle"></i>&nbsp;<span class="translated" defaultText="New Squad"></span></button>
        <span class="show-authenticated backend-status"></span>
    </div>
</div>`)),this.container.append(this.status_container),this.xws_import_modal=$(document.createElement("DIV")),this.xws_import_modal.addClass("modal fade import-modal d-print-none"),this.xws_import_modal.tabindex="-1",this.xws_import_modal.role="dialog",this.xws_import_modal.append($.trim(`<div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="translated" defaultText="XWS Import"></h3>
            <button type="button" class="close d-print-none" data-dismiss="modal" aria-hidden="true">&times;</button>
        </div>
        <div class="modal-body">
            <span class="translated" defaultText="XWS Import Dialog"></span>
            <div class="container-fluid">
                <textarea class="xws-content" placeholder='`+this.uitranslation("Paste XWS here")+`'></textarea>
            </div>
        </div>
        <div class="modal-footer d-print-none">
            <span class="xws-import-status"></span>&nbsp;
            <button class="btn btn-danger import-xws translated" defaultText="Import"></button>
        </div>
    </div>
</div>`)),this.from_xws_button=this.container.find("button.import-squad"),this.from_xws_button.click(t=>(t.preventDefault(),this.xws_import_modal.find(".xws-import-status").text(" "),this.xws_import_modal.modal("show"))),this.load_xws_button=$(this.xws_import_modal.find("button.import-xws")),this.load_xws_button.click(t=>(t.preventDefault(),exportObj.loadXWSButton(this.xws_import_modal))),this.container.append(this.xws_import_modal),this.list_modal=$(document.createElement("DIV")),this.list_modal.addClass("modal fade text-list-modal"),this.list_modal.tabindex="-1",this.list_modal.role="dialog",this.container.append(this.list_modal),this.list_modal.append($.trim(`<div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <div class="d-print-none">
                <h4 class="modal-title"><span class="squad-name"></span> <span class="total-points"></span></h4>
            </div>
            <div class="d-none d-print-block">
                <div class="fancy-header">
                    <div class="squad-name"></div>
                    <div class="squad-faction"></div>
                    <div class="mask">
                        <div class="outer-circle">
                            <div class="inner-circle">
                                <span class="total-points"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="fancy-under-header"></div>
            </div>
            <button type="button" class="close d-print-none" data-dismiss="modal" aria-hidden="true">&times;</button>
        </div>
        <div class="modal-body">
            <div class="fancy-list"></div>
            <div class="simple-list"></div>
            <div class="simplecopy-list">
                <span class="translated" defaultText="Copy below simple text"></span>
                <textarea></textarea><button class="btn btn-modal btn-copy translated" defaultText="Copy"></button>
            </div>
            <div class="reddit-list">
                <span class="translated" defaultText="Copy below markdown"></span>
                <textarea></textarea><button class="btn btn-modal btn-copy translated" defaultText="Copy"></button>
            </div>
            <div class="tts-list">
                <span class="translated" defaultText="Copy below TTS"></span>
                <textarea></textarea><button class="btn btn-modal btn-copy translated" defaultText="Copy"></button>
            </div>
            <div class="xws-list">
                <span class="translated" defaultText="Copy below XWS"></span>
                <div class="row full-row">
                    <div class="col d-inline-block d-none d-sm-block"><textarea></textarea><br /><button class="btn btn-modal btn-copy translated" defaultText="Copy"></button></div>
                    <div class="col d-inline-block d-none d-sm-block qrcode-container" id="xws-qrcode-container"></div>
                </div>
            </div>
        </div>
        <div class="container-fluid modal-footer d-print-none">
            <div class="row full-row">
                <div class="col d-inline-block d-none d-sm-block right-col">
                    <label class="color-skip-text-checkbox">
                        <span class="translated" defaultText="Skip Card Text"></span> <input type="checkbox" class="toggle-skip-text-print" />
                    </label><br />
                    <label class="horizontal-space-checkbox">
                        <span class="translated" defaultText="Space for Cards"></span> <input type="checkbox" class="toggle-horizontal-space" />
                    </label><br />
                    <label class="maneuver-print-checkbox">
                        <span class="translated" defaultText="Include Maneuvers Chart"></span> <input type="checkbox" class="toggle-maneuver-print" />
                    </label><br />
                    <label class="expanded-shield-hull-print-checkbox">
                        <span class="translated" defaultText="Expand Shield and Hull"></span> <input type="checkbox" class="toggle-expanded-shield-hull-print" />
                    </label>
                </div>
                <div class="col d-inline-block d-none d-sm-block right-col">
                    <label class="color-print-checkbox">
                        <span class="translated" defaultText="Print Color"></span> <input type="checkbox" class="toggle-color-print" checked="checked" />
                    </label><br />
                    <label class="qrcode-checkbox">
                        <span class="translated" defaultText="Include QR codes"></span> <input type="checkbox" class="toggle-juggler-qrcode" checked="checked" />
                    </label><br />
                    <label class="obstacles-checkbox">
                        <span class="translated" defaultText="Include Obstacle Choices"></span> <input type="checkbox" class="toggle-obstacles" checked="checked" />
                    </label>
                </div>
            </div>
            <div class="row btn-group list-display-mode">
                <button class="btn btn-modal select-simple-view translated" defaultText="Simple"></button>
                <button class="btn btn-modal select-fancy-view translated" defaultText="Fancy"></button>
                <button class="btn btn-modal select-simplecopy-view translated" defaultText="Text"></button>
                <button class="btn btn-modal select-reddit-view translated" defaultText="Reddit"></button>
                <button class="btn btn-modal select-tts-view d-none d-sm-block translated" defaultText="TTS"></button>
                <button class="btn btn-modal select-xws-view translated" defaultText="XWS"></button>
            </div>
            <div class="row btn-group list-display-mode">
                <button class="btn btn-modal copy-url translated" defaultText="Copy URL"></button>
                <button class="btn btn-modal print-list d-sm-block"><span class="d-none d-lg-block"><i class="fa fa-print"></i>&nbsp;<span class="translated" defaultText="Print"></span></span><span class="d-lg-none"><i class="fa fa-print"></i></span></button>
            </div>
        </div>
    </div>
</div>`)),this.fancy_container=$(this.list_modal.find(".fancy-list")),this.fancy_total_points_container=$(this.list_modal.find("div.modal-header .total-points")),this.simple_container=$(this.list_modal.find("div.modal-body .simple-list")),this.reddit_container=$(this.list_modal.find("div.modal-body .reddit-list")),this.reddit_textarea=$(this.reddit_container.find("textarea")),this.reddit_textarea.attr("readonly","readonly"),this.simplecopy_container=$(this.list_modal.find("div.modal-body .simplecopy-list")),this.simplecopy_textarea=$(this.simplecopy_container.find("textarea")),this.simplecopy_textarea.attr("readonly","readonly"),this.tts_container=$(this.list_modal.find("div.modal-body .tts-list")),this.tts_textarea=$(this.tts_container.find("textarea")),this.tts_textarea.attr("readonly","readonly"),this.xws_container=$(this.list_modal.find("div.modal-body .xws-list")),this.xws_textarea=$(this.xws_container.find("textarea")),this.xws_textarea.attr("readonly","readonly"),this.toggle_vertical_space_container=$(this.list_modal.find(".horizontal-space-checkbox")),this.toggle_color_print_container=$(this.list_modal.find(".color-print-checkbox")),this.toggle_color_skip_text=$(this.list_modal.find(".color-skip-text-checkbox")),this.toggle_maneuver_dial_container=$(this.list_modal.find(".maneuver-print-checkbox")),this.toggle_expanded_shield_hull_container=$(this.list_modal.find(".expanded-shield-hull-print-checkbox")),this.toggle_qrcode_container=$(this.list_modal.find(".qrcode-checkbox")),this.toggle_obstacle_container=$(this.list_modal.find(".obstacles-checkbox")),this.btn_print_list=$(this.list_modal.find(".print-list"))[0],this.btn_copy_url=$(this.list_modal.find(".copy-url")),this.btn_copy_url.click(t=>{if(this.success=window.navigator.clipboard.writeText(window.location.href),this.self=$(t.currentTarget),this.success)return this.self.addClass("btn-success"),setTimeout(()=>this.self.removeClass("btn-success"),1e3)}),["fullscreen","standalone","minimal-ui"].some(t=>window.matchMedia("(display-mode: "+t+")").matches)||this.btn_copy_url.hide(),this.list_modal.on("click","button.btn-copy",t=>{if(this.self=$(t.currentTarget),this.self.siblings("textarea").select(),this.success=document.execCommand("copy"),this.success)return this.self.addClass("btn-success"),setTimeout(()=>this.self.removeClass("btn-success"),1e3)}),this.select_simple_view_button=$(this.list_modal.find(".select-simple-view")),this.select_simple_view_button.click(t=>{if(this.select_simple_view_button.blur(),"simple"!==this.list_display_mode)return this.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),this.select_simple_view_button.addClass("btn-inverse"),this.list_display_mode="simple",this.simple_container.show(),this.fancy_container.hide(),this.simplecopy_container.hide(),this.reddit_container.hide(),this.tts_container.hide(),this.xws_container.hide(),this.toggle_vertical_space_container.hide(),this.toggle_color_print_container.hide(),this.toggle_color_skip_text.hide(),this.toggle_maneuver_dial_container.hide(),this.toggle_expanded_shield_hull_container.hide(),this.toggle_qrcode_container.show(),this.toggle_obstacle_container.show(),this.btn_print_list.disabled=!1}),this.select_fancy_view_button=$(this.list_modal.find(".select-fancy-view")),this.select_fancy_view_button.click(t=>{if(this.select_fancy_view_button.blur(),"fancy"!==this.list_display_mode)return this.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),this.select_fancy_view_button.addClass("btn-inverse"),this.list_display_mode="fancy",this.fancy_container.show(),this.simple_container.hide(),this.simplecopy_container.hide(),this.reddit_container.hide(),this.tts_container.hide(),this.xws_container.hide(),this.toggle_vertical_space_container.show(),this.toggle_color_print_container.show(),this.toggle_color_skip_text.show(),this.toggle_maneuver_dial_container.show(),this.toggle_expanded_shield_hull_container.show(),this.toggle_qrcode_container.show(),this.toggle_obstacle_container.show(),this.btn_print_list.disabled=!1}),this.select_reddit_view_button=$(this.list_modal.find(".select-reddit-view")),this.select_reddit_view_button.click(t=>{if(this.select_reddit_view_button.blur(),"reddit"!==this.list_display_mode)return this.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),this.select_reddit_view_button.addClass("btn-inverse"),this.list_display_mode="reddit",this.reddit_container.show(),this.simplecopy_container.hide(),this.tts_container.hide(),this.xws_container.hide(),this.simple_container.hide(),this.fancy_container.hide(),this.reddit_textarea.select(),this.reddit_textarea.focus(),this.toggle_vertical_space_container.hide(),this.toggle_color_print_container.hide(),this.toggle_color_skip_text.hide(),this.toggle_maneuver_dial_container.hide(),this.toggle_expanded_shield_hull_container.hide(),this.toggle_qrcode_container.hide(),this.toggle_obstacle_container.hide(),this.btn_print_list.disabled=!0}),this.select_simplecopy_view_button=$(this.list_modal.find(".select-simplecopy-view")),this.select_simplecopy_view_button.click(t=>{if(this.select_simplecopy_view_button.blur(),"simplecopy"!==this.list_display_mode)return this.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),this.select_simplecopy_view_button.addClass("btn-inverse"),this.list_display_mode="simplecopy",this.reddit_container.hide(),this.simplecopy_container.show(),this.tts_container.hide(),this.xws_container.hide(),this.simple_container.hide(),this.fancy_container.hide(),this.simplecopy_textarea.select(),this.simplecopy_textarea.focus(),this.toggle_vertical_space_container.hide(),this.toggle_color_print_container.hide(),this.toggle_color_skip_text.hide(),this.toggle_maneuver_dial_container.hide(),this.toggle_expanded_shield_hull_container.hide(),this.toggle_qrcode_container.hide(),this.toggle_obstacle_container.hide(),this.btn_print_list.disabled=!0}),this.select_tts_view_button=$(this.list_modal.find(".select-tts-view")),this.select_tts_view_button.click(t=>{if(this.select_tts_view_button.blur(),"tts"!==this.list_display_mode)return this.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),this.select_tts_view_button.addClass("btn-inverse"),this.list_display_mode="tts",this.tts_container.show(),this.xws_container.hide(),this.simple_container.hide(),this.simplecopy_container.hide(),this.reddit_container.hide(),this.fancy_container.hide(),this.tts_textarea.select(),this.tts_textarea.focus(),this.toggle_vertical_space_container.hide(),this.toggle_color_print_container.hide(),this.toggle_color_skip_text.hide(),this.toggle_maneuver_dial_container.hide(),this.toggle_expanded_shield_hull_container.hide(),this.toggle_qrcode_container.hide(),this.toggle_obstacle_container.hide(),this.btn_print_list.disabled=!0}),this.select_xws_view_button=$(this.list_modal.find(".select-xws-view")),this.select_xws_view_button.click(t=>this.select_xws_view()),(768<=$(window).width()?(this.simple_container.hide(),this.select_fancy_view_button):this.select_simple_view_button).click(),this.clear_squad_button=$(this.status_container.find(".clear-squad")),this.clear_squad_button.click(t=>this.current_squad.dirty&&null!=this.backend?this.backend.warnUnsaved(this,()=>this.newSquadFromScratch()):this.newSquadFromScratch()),this.show_points_destroyed_button=$(this.status_container.find(".show-points-destroyed")),this.show_points_destroyed_button_span=$(this.status_container.find(".show-points-destroyed-span")),this.show_points_destroyed_button.click(t=>{var i,e,a,s,n;for(this.show_points_destroyed=!this.show_points_destroyed,!1===this.show_points_destroyed?this.points_destroyed_span.hide():this.points_destroyed_span.show(),s=[],i=0,e=(a=this.ships).length;i<e;i++)null!=(n=a[i]).pilot?!1===this.show_points_destroyed?(this.show_points_destroyed_button_span.text(this.uitranslation("Show Points Destroyed")),s.push(n.points_destroyed_button.hide())):(this.show_points_destroyed_button_span.text(this.uitranslation("Hide Points Destroyed")),s.push(n.points_destroyed_button.show())):s.push(void 0);return s}),this.squad_name_container=$(this.status_container.find("div.squad-name-container")),this.squad_name_display=$(this.container.find(".display-name")),this.squad_name_placeholder=$(this.container.find(".squad-name")),this.squad_name_input=$(this.squad_name_container.find("input")),this.squad_name_save_button=$(this.squad_name_container.find("button.save")),this.squad_name_input.closest("div").hide(),this.points_container=$(this.status_container.find("div.points-display-container")),this.total_points_span=$(this.points_container.find(".total-points")),this.game_type_selector=$(this.status_container.find(".game-type-selector")),this.game_type_selector.select2({minimumResultsForSearch:-1}),this.game_type_selector.change(t=>this.onGameTypeChanged(this.game_type_selector.val())),this.desired_points_input=$(this.points_container.find(".desired-points")),this.desired_points_input.change(t=>this.container.trigger("xwing:pointsUpdated")),this.points_remaining_span=$(this.points_container.find(".points-remaining")),this.points_destroyed_span=$(this.points_container.find(".points-destroyed")),this.points_remaining_container=$(this.points_container.find(".points-remaining-container")),this.unreleased_content_used_container=$(this.points_container.find(".unreleased-content-used")),this.loading_failed_container=$(this.points_container.find(".loading-failed-container")),this.old_version_container=$(this.points_container.find(".old-version-container")),this.ship_number_invalid_container=$(this.points_container.find(".ship-number-invalid-container")),this.multi_faction_warning_container=$(this.points_container.find(".multi-faction-warning-container")),this.epic_not_legal_container=$(this.points_container.find(".epic-not-legal-container")),this.collection_invalid_container=$(this.points_container.find(".collection-invalid")),this.view_list_button=$(this.status_container.find("div.button-container button.view-as-text")),this.randomize_button=$(this.status_container.find("div.button-container button.randomize")),this.customize_randomizer=$(this.status_container.find("div.button-container a.randomize-options")),this.misc_settings=$(this.status_container.find("div.button-container a.misc-settings")),this.backend_status=$(this.status_container.find(".backend-status")),this.backend_status.hide(),this.collection_button=$(this.status_container.find("div.button-container a.collection")),this.collection_button.click(t=>{if(t.preventDefault(),!this.collection_button.prop("disabled"))return this.collection.modal.modal("show")}),this.squad_name_input.keypress(t=>{if(13===t.which)return this.squad_name_save_button.click(),!1}),this.squad_name_input.change(t=>this.backend_status.fadeOut("slow")),this.squad_name_input.blur(t=>(this.squad_name_input.change(),this.squad_name_save_button.click())),this.squad_name_display.click(t=>(t.preventDefault(),this.squad_name_display.hide(),this.squad_name_input.val($.trim(this.current_squad.name)),window.setTimeout(()=>(this.squad_name_input.focus(),this.squad_name_input.select()),100),this.squad_name_input.closest("div").show())),this.squad_name_save_button.click(t=>{if(t.preventDefault(),this.current_squad.dirty=!0,this.container.trigger("xwing-backend:squadDirtinessChanged"),0<(this.current_squad.name=$.trim(this.squad_name_input.val())).length)return this.squad_name_display.show(),this.container.trigger("xwing-backend:squadNameChanged"),this.squad_name_input.closest("div").hide()}),this.randomizer_options_modal=$(document.createElement("DIV")),this.randomizer_options_modal.addClass("modal fade randomizer-modal"),this.randomizer_options_modal.tabindex="-1",this.randomizer_options_modal.role="dialog",$("body").append(this.randomizer_options_modal),this.randomizer_options_modal.append($.trim(`<div class="modal-dialog modal-dialog-scrollable modal-dialog-centered" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="translated" defaultText="Random Squad Builder Options"></h3>
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        </div>
        <div class="modal-body">
            <form>
                <label>
                    <span class="translated" defaultText="Maximum Ship Count"></span>
                    <input type="number" class="randomizer-ship-limit" value="0" placeholder="0" />
                </label><br />
                <label>
                    <input type="checkbox" class="randomizer-collection-only" checked="checked"/> 
                    <span class="translated" defaultText="Limit to collection"></span>
                </label><br />
                <label>
                    <span class="translated" defaultText="Sets and Expansions"></span>
                    <select class="randomizer-sources" multiple="1" data-placeholder='`+this.uitranslation("All sets and expansions")+`'>
                    </select>
                </label><br />
                <label>
                    <input type="checkbox" class="randomizer-fill-zero-pts" /> 
                    <span class="translated" defaultText="Always fill 0-point slots"></span>
                </label><br />
                <label>
                    <span class="translated" defaultText="Maximum Seconds to Spend Randomizing"></span>
                    <input type="number" class="randomizer-timeout" value="4" placeholder="4" />
                </label>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary do-randomize translated" aria-hidden="true" defaultText="Roll!"></button>
            <button class="btn translated" data-dismiss="modal" aria-hidden="true" defaultText="Close"></button>
        </div>
    </div>
</div>`)),exportObj.translateUIElements(this.randomizer_options_modal),this.randomizer_source_selector=$(this.randomizer_options_modal.find("select.randomizer-sources")),i=0,e=(n=exportObj.expansions).length;i<e;i++)t=n[i],(s=$(document.createElement("OPTION"))).text(t),this.randomizer_source_selector.append(s);return this.randomizer_source_selector.select2({width:"100%",minimumResultsForSearch:$.isMobile()?-1:0}),this.randomizer_collection_selector=$(this.randomizer_options_modal.find(".randomizer-collection-only"))[0],this.randomizer_fill_zero_pts=$(this.randomizer_options_modal.find(".randomizer-fill-zero-pts"))[0],this.randomize_button.click(t=>{var i,e;return t.preventDefault(),this.current_squad.dirty&&null!=this.backend?this.backend.warnUnsaved(this,()=>this.randomize_button.click()):(t=parseInt(this.desired_points_input.val()),(isNaN(t)||t<=0)&&(t=20),i=parseInt($(this.randomizer_options_modal.find(".randomizer-ship-limit")).val()),(isNaN(i)||i<0)&&(i=0),e=parseInt($(this.randomizer_options_modal.find(".randomizer-timeout")).val()),(isNaN(e)||e<=0)&&(e=4),this.randomSquad(t,this.randomizer_source_selector.val(),1e3*e,i,this.randomizer_collection_selector.checked,this.randomizer_fill_zero_pts.checked))}),this.randomizer_options_modal.find("button.do-randomize").click(t=>(t.preventDefault(),this.randomizer_options_modal.modal("hide"),this.randomize_button.click())),this.customize_randomizer.click(t=>(t.preventDefault(),this.randomizer_options_modal.modal())),this.misc_settings_modal=$(document.createElement("DIV")),this.misc_settings_modal.addClass("modal fade"),this.misc_settings_modal.tabindex="-1",this.misc_settings_modal.role="dialog",$("body").append(this.misc_settings_modal),this.misc_settings_modal.append($.trim(`<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="translated" defaultText="Miscellaneous Settings"></h3>
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        </div>
        <div class="modal-body">
            <label class = "toggle-initiative-prefix-names misc-settings-label">
                <input type="checkbox" class="initiative-prefix-names-checkbox misc-settings-checkbox" /> <span class="translated" defaultText="Use INI prefix"></span> 
            </label><br />
            <label class = "enable-ban-list misc-settings-label">
                <input type="checkbox" class="enable-ban-list-checkbox misc-settings-checkbox" /> <span class="translated" defaultText="Enable Ban List (Not Standard)"></span> 
            </label><br />
        </div>
        <div class="modal-footer">
            <span class="misc-settings-infoline"></span>
            &nbsp;
            <button class="btn translated" data-dismiss="modal" aria-hidden="true" defaultText="Close"></button>
        </div>
    </div>
</div>`)),this.misc_settings_infoline=$(this.misc_settings_modal.find(".misc-settings-infoline")),this.misc_settings_initiative_prefix=$(this.misc_settings_modal.find(".initiative-prefix-names-checkbox")),this.misc_settings_ban_list=$(this.misc_settings_modal.find(".enable-ban-list-checkbox")),null!=this.backend?this.backend.getSettings(t=>{if(null==exportObj.settings&&(exportObj.settings=[]),exportObj.settings.initiative_prefix=null!=t.showInitiativeInFrontOfPilotName,null!=t.showInitiativeInFrontOfPilotName&&this.misc_settings_initiative_prefix.prop("checked",!0),exportObj.settings.ban_list=null!=t.enableBanList,null!=t.enableBanList)return this.misc_settings_ban_list.prop("checked",!0)}):(null==this.waiting_for_backend&&(this.waiting_for_backend=[]),this.waiting_for_backend.push(()=>this.backend.getSettings(t=>{if(null==exportObj.settings&&(exportObj.settings=[]),exportObj.settings.initiative_prefix=null!=t.showInitiativeInFrontOfPilotName,null!=t.showInitiativeInFrontOfPilotName&&this.misc_settings_initiative_prefix.prop("checked",!0),exportObj.settings.ban_list=null!=t.enableBanList,null!=t.enableBanList)return this.misc_settings_ban_list.prop("checked",!0)}))),this.misc_settings_initiative_prefix.click(t=>{if(null==exportObj.settings&&(exportObj.settings=[]),exportObj.settings.initiative_prefix=this.misc_settings_initiative_prefix.prop("checked"),null!=this.backend)return this.misc_settings_initiative_prefix.prop("checked")?this.backend.set("showInitiativeInFrontOfPilotName","1",t=>(this.misc_settings_infoline.text(this.uitranslation("Changes Saved")),this.misc_settings_infoline.fadeIn(100,()=>this.misc_settings_infoline.fadeOut(3e3)))):this.backend.deleteSetting("showInitiativeInFrontOfPilotName",t=>(this.misc_settings_infoline.text(this.uitranslation("Changes Saved")),this.misc_settings_infoline.fadeIn(100,()=>this.misc_settings_infoline.fadeOut(3e3))))}),this.misc_settings_ban_list.click(t=>{if(null==exportObj.settings&&(exportObj.settings=[]),exportObj.settings.ban_list=this.misc_settings_ban_list.prop("checked"),null!=this.backend)return this.misc_settings_ban_list.prop("checked")?this.backend.set("enableBanList","1",t=>(this.misc_settings_infoline.text(this.uitranslation("Changes Saved")),this.misc_settings_infoline.fadeIn(100,()=>this.misc_settings_infoline.fadeOut(3e3)))):this.backend.deleteSetting("enableBanList",t=>(this.misc_settings_infoline.text(this.uitranslation("Changes Saved")),this.misc_settings_infoline.fadeIn(100,()=>this.misc_settings_infoline.fadeOut(3e3))))}),this.misc_settings.click(t=>(t.preventDefault(),this.misc_settings_modal.modal(),this.misc_settings_initiative_prefix.prop("checked",null!=(null!=(t=exportObj.settings)?t.initiative_prefix:void 0)&&exportObj.settings.initiative_prefix))),exportObj.translateUIElements(this.misc_settings_modal),this.choose_obstacles_modal=$(document.createElement("DIV")),this.choose_obstacles_modal.addClass("modal fade choose-obstacles-modal"),this.choose_obstacles_modal.tabindex="-1",this.choose_obstacles_modal.role="dialog",this.container.append(this.choose_obstacles_modal),this.choose_obstacles_modal.append($.trim(`<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <label class='choose-obstacles-description translated' defaultText="Choose obstacles dialog"></label>
        </div>
        <div class="modal-body row">
            <div class="obstacle-select-container col-md-12">
            </div>
            <div>
                <div class="obstacle-sources-container">
                    <span class="info-header obstacle-sources translated" defaultText="Sources:" style="padding-left: 8px;"></span> <br>
                    <div class="info-data obstacle-sources" style="padding-left: 8px;padding-right:10px;"></div>
                </div>
            </div>
        </div>
        <div class="modal-footer d-print-none">
            <button class="btn btn-danger reset-obstacles translated" defaultText="Reset Obstacles"></button>
            <button class="btn btn-danger close-print-dialog translated" data-dismiss="modal" aria-hidden="true" defaultText="Close"></button>
        </div>
    </div>
</div>`)),this.obstacles_reset=this.choose_obstacles_modal.find(".reset-obstacles"),this.obstacles_select=this.choose_obstacles_modal.find(".obstacle-select-container"),this.obstacles_select_sources=this.choose_obstacles_modal.find(".info-data.obstacle-sources"),a=function(t){return`<img class='obstacle' src='${"images/"+t.id+".png"}' style='height: 100px;' /></br>`+t.text},this.obstacle_data=[{id:"coreasteroid0",text:"Core Asteroid 1"},{id:"coreasteroid1",text:"Core Asteroid 2"},{id:"coreasteroid2",text:"Core Asteroid 3"},{id:"coreasteroid3",text:"Core Asteroid 4"},{id:"coreasteroid4",text:"Core Asteroid 5"},{id:"coreasteroid5",text:"Core Asteroid 6"},{id:"yt2400debris0",text:"YT2400 Debris 1"},{id:"yt2400debris1",text:"YT2400 Debris 2"},{id:"yt2400debris2",text:"YT2400 Debris 3"},{id:"vt49decimatordebris0",text:"VT49 Debris 1"},{id:"vt49decimatordebris1",text:"VT49 Debris 2"},{id:"vt49decimatordebris2",text:"VT49 Debris 3"},{id:"core2asteroid0",text:"FA Asteroid 1"},{id:"core2asteroid1",text:"FA Asteroid 2"},{id:"core2asteroid2",text:"FA Asteroid 3"},{id:"core2asteroid3",text:"FA Asteroid 4"},{id:"core2asteroid4",text:"FA Asteroid 5"},{id:"core2asteroid5",text:"FA Asteroid 6"},{id:"gascloud1",text:"Gas Cloud 1"},{id:"gascloud2",text:"Gas Cloud 2"},{id:"gascloud3",text:"Gas Cloud 3"},{id:"gascloud4",text:"Gas Cloud 4"},{id:"gascloud5",text:"Gas Cloud 5"},{id:"gascloud6",text:"Gas Cloud 6"},{id:"pomasteroid1",text:"PoM Rock 1"},{id:"pomasteroid2",text:"PoM Rock 2"},{id:"pomasteroid3",text:"PoM Rock 3"},{id:"pomdebris1",text:"PoM Debris 1"},{id:"pomdebris2",text:"PoM Debris 2"},{id:"pomdebris3",text:"PoM Debris 3"}],this.obstacles_select.select2({data:this.obstacle_data,width:"90%",multiple:!0,maximumSelectionSize:3,placeholder:"Select an Obstacle",minimumResultsForSearch:$.isMobile()?-1:0,formatResult:a,formatSelection:a}),$.isMobile()&&(this.obstacles_select.select2.minimumResultsForSearch=-1),this.backend_list_squads_button=$(this.container.find("button.backend-list-my-squads")),this.backend_list_squads_button.click(t=>{if(t.preventDefault(),null!=this.backend)return this.backend.list(this)}),this.backend_save_list_button=$(this.container.find("button.save-list")),this.backend_save_list_button.click(async t=>{if(t.preventDefault(),null!=this.backend&&!this.backend_save_list_button.hasClass("disabled"))return t={points:this.total_points,description:this.describeSquad(),cards:this.listCards(),notes:this.notes.val().substr(0,1024),obstacles:this.getObstacles(),tag:this.tag.val().substr(0,1024)},this.backend_status.html($.trim('<i class="fa fa-sync fa-spin"></i>&nbsp;<span class="translated" defaultText="Saving squad..."></span>')),this.backend_status.show(),this.backend_save_list_button.addClass("disabled"),this.backend.save(this.serialize(),this.current_squad.id,this.current_squad.name,this.faction,t,t=>t.success?(this.current_squad.dirty=!1,null!=this.current_squad.id?this.backend_status.html($.trim('<i class="fa fa-check"></i>&nbsp;<span class="translated" defaultText="Squad updated successfully."></span>')):(this.backend_status.html($.trim('<i class="fa fa-check"></i>&nbsp;<span class="translated" defaultText="New squad saved successfully."></span>')),this.current_squad.id=t.id),this.container.trigger("xwing-backend:squadDirtinessChanged")):(this.backend_status.html($.trim('<i class="fa fa-exclamation-circle"></i>&nbsp;'+t.error)),this.backend_save_list_button.removeClass("disabled")))}),this.backend_save_list_as_button=$(this.container.find("button.save-list-as")),this.backend_save_list_as_button.addClass("disabled"),this.backend_save_list_as_button.click(t=>{if(t.preventDefault(),null!=this.backend&&!this.backend_save_list_as_button.hasClass("disabled"))return this.backend.showSaveAsModal(this)}),this.backend_delete_list_button=$(this.container.find("button.delete-list")),this.backend_delete_list_button.click(t=>{if(t.preventDefault(),null!=this.backend&&!this.backend_delete_list_button.hasClass("disabled"))return this.backend.showDeleteModal(this)}),(a=$(document.createElement("DIV"))).addClass("container-fluid"),this.container.append(a),a.append($.trim(`<div class="row">
    <div class="col-md-9 ship-container">
        <label class="unsortable notes-container show-authenticated col-md-10">
            <span class="notes-name translated" defaultText="Squad Notes:"></span>
            <br />
            <textarea class="squad-notes"></textarea>
            <br />
            <span class="tag-name translated" defaultText="Tag:"></span>
            <input type="search" class="squad-tag"></input>
        </label>
        <div class="unsortable obstacles-container">
                <button class="btn btn-info choose-obstacles"><i class="fa fa-cloud"></i>&nbsp;<span class="translated" defaultText="Choose Obstacles"</span></button>
        </div>
    </div>
    <div class="col-md-3 info-container" id="info-container">
    </div>
</div>`)),this.ship_container=$(a.find("div.ship-container")),this.info_container=$(a.find("div.info-container")),this.obstacles_container=a.find(".obstacles-container"),this.notes_container=$(a.find(".notes-container")),this.notes=$(this.notes_container.find("textarea.squad-notes")),this.tag=$(this.notes_container.find("input.squad-tag")),this.ship_container.sortable({cancel:".unsortable"}),this.info_container.append($.trim(this.createInfoContainerUI())),this.info_container.find(".info-well").hide(),this.info_intro=this.info_container.find(".intro"),this.print_list_button=$(this.container.find("button.print-list")),this.container.find("[rel=tooltip]").tooltip(),this.obstacles_button=$(this.container.find("button.choose-obstacles")),this.obstacles_button.click(t=>(t.preventDefault(),this.showChooseObstaclesModal())),this.condition_container=$(document.createElement("div")),this.condition_container.addClass("conditions-container d-flex flex-wrap"),this.container.append(this.condition_container),this.mobile_tooltip_modal=$(document.createElement("DIV")),this.mobile_tooltip_modal.addClass("modal fade choose-obstacles-modal d-print-none"),this.mobile_tooltip_modal.tabindex="-1",this.mobile_tooltip_modal.role="dialog",this.container.append(this.mobile_tooltip_modal),this.mobile_tooltip_modal.append($.trim(`<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
    <div class="modal-content">
        <div class="modal-header">
        </div>
        <div class="modal-body">`+this.createInfoContainerUI(!1)+`        </div>
        <div class="modal-footer">
            <button class="btn btn-danger close-print-dialog translated" data-dismiss="modal" aria-hidden="true" defaultText="Close"></button>
        </div>
    </div>
</div>`)),this.mobile_tooltip_modal.find("intro").hide(),exportObj.translateUIElements(this.container)}createInfoContainerUI(t=!0){t=!0===t?`<div class="card intro translated" defaultText="Intro Card YASB">
</div>`:"";return t+`
<div class="card info-well">
    <div class="info-name"></div>
    <div class="info-type"></div>
    <span class="info-collection"></span>
    <div class="row">
        <div class="col-sm-5">
            <table class="table-sm">
                <tbody>
                    <tr class="info-attack-bullseye">
                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-bullseyearc"></i></td>
                        <td class="info-data info-attack"></td>
                    </tr>
                    <tr class="info-attack">
                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-frontarc"></i></td>
                        <td class="info-data info-attack"></td>
                    </tr>
                    <tr class="info-attack-fullfront">
                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-fullfrontarc"></i></td>
                        <td class="info-data info-attack"></td>
                    </tr>
                    <tr class="info-attack-left">
                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-leftarc"></i></td>
                        <td class="info-data info-attack"></td>
                    </tr>
                    <tr class="info-attack-right">
                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-rightarc"></i></td>
                        <td class="info-data info-attack"></td>
                    </tr>
                    <tr class="info-attack-back">
                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-reararc"></i></td>
                        <td class="info-data info-attack"></td>
                    </tr>
                    <tr class="info-attack-turret">
                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-singleturretarc"></i></td>
                        <td class="info-data info-attack"></td>
                    </tr>
                    <tr class="info-attack-doubleturret">
                        <td class="info-header"><i class="xwing-miniatures-font header-attack xwing-miniatures-font-doubleturretarc"></i></td>
                        <td class="info-data info-attack"></td>
                    </tr>
                    <tr class="info-agility">
                        <td class="info-header"><i class="xwing-miniatures-font header-agility xwing-miniatures-font-agility"></i></td>
                        <td class="info-data info-agility"></td>
                    </tr>
                    <tr class="info-hull">
                        <td class="info-header"><i class="xwing-miniatures-font header-hull xwing-miniatures-font-hull"></i></td>
                        <td class="info-data info-hull"></td>
                    </tr>
                    <tr class="info-shields">
                        <td class="info-header"><i class="xwing-miniatures-font header-shield xwing-miniatures-font-shield"></i></td>
                        <td class="info-data info-shields"></td>
                    </tr>
                    <tr class="info-force">
                        <td class="info-header"><i class="xwing-miniatures-font header-force xwing-miniatures-font-forcecharge"></i></td>
                        <td class="info-data info-force"></td>
                    </tr>
                    <tr class="info-charge">
                        <td class="info-header"><i class="xwing-miniatures-font header-charge xwing-miniatures-font-charge"></i></td>
                        <td class="info-data info-charge"></td>
                    </tr>
                    <tr class="info-energy">
                        <td class="info-header"><i class="xwing-miniatures-font header-energy xwing-miniatures-font-energy"></i></td>
                        <td class="info-data info-energy"></td>
                    </tr>
                    <tr class="info-range">
                        <td class="info-header translated" defaultText="Range"></td>
                        <td class="info-data info-range"></td><td class="info-rangebonus"><i class="xwing-miniatures-font red header-range xwing-miniatures-font-rangebonusindicator"></i></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="col-sm-7">
            <table class="table-sm">
                <tbody>
                    <tr class="info-skill">
                        <td class="info-header translated" defaultText="Initiative"></td>
                        <td class="info-data info-skill"></td>
                    </tr>
                    <tr class="info-engagement">
                        <td class="info-header translated" defaultText="Engagement"></td>
                        <td class="info-data info-engagement"></td>
                    </tr>
                    <tr class="info-faction">
                        <td class="info-header translated" defaultText="Faction"></td>
                        <td class="info-data"></td>
                    </tr>
                    <tr class="info-base">
                        <td class="info-header translated" defaultText="Base"></td>
                        <td class="info-data"></td> 
                    </tr>
                    <tr class="info-points">
                        <td class="info-header translated" defaultText="Points"></td>
                        <td class="info-data info-points"></td>
                    </tr>
                    <tr class="info-loadout">
                        <td class="info-header translated" defaultText="Loadout"></td>
                        <td class="info-data info-loadout"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <table class="table-sm">
        <tbody>
            <tr class="info-ship">
                <td class="info-header translated" defaultText="Ship"></td>
                <td class="info-data"></td>
            </tr>
            <tr class="info-actions">
                <td class="info-header translated" defaultText="Actions"></td>
                <td class="info-data"></td>
            </tr>
            <tr class="info-upgrades">
                <td class="info-header translated" defaultText="Upgrades"></td>
                <td class="info-data"></td>
            </tr>
        </tbody>
    </table>
    <p class="info-restrictions"></p>
    <p class="info-text"></p>
    <p class="info-chassis"></p>
    <p class="info-maneuvers"></p>
    <br />
    <span class="info-header info-sources translated" defaultText="Sources:"></span> 
    <span class="info-data info-sources"></span>
</div>`}setupEventHandlers(){return this.container.on("xwing:claimUnique",(t,i,e,a)=>this.claimUnique(i,e,a)).on("xwing:releaseUnique",(t,i,e,a)=>this.releaseUnique(i,e,a)).on("xwing:pointsUpdated",(t,i=$.noop)=>this.isUpdatingPoints?i():(this.isUpdatingPoints=!0,this.onPointsUpdated(()=>(this.isUpdatingPoints=!1,i())))).on("xwing-backend:squadLoadRequested",(t,i,e=$.noop)=>this.onSquadLoadRequested(i,e)).on("xwing-backend:squadDirtinessChanged",t=>this.onSquadDirtinessChanged()).on("xwing-backend:squadNameChanged",t=>this.onSquadNameChanged()).on("xwing:beforeLanguageLoad",(t,i=$.noop)=>(this.pretranslation_serialized=this.serialize(),i())).on("xwing:afterLanguageLoad",(t,i,e=$.noop)=>{var a,s,n;if(this.language!==i){for(this.language=i,i=this.current_squad.dirty,null!=this.pretranslation_serialized.length&&this.loadFromSerialized(this.pretranslation_serialized),a=0,s=(n=this.ships).length;a<s;a++)n[a].updateSelections();this.current_squad.dirty=i,this.pretranslation_serialized=void 0}return e()}).on("xwing:shipUpdated",(t,i=$.noop)=>{for(var e,a=!0,s=this.ships,n=0,l=s.length;n<l;n++)(e=s[n]).updateSelections(),""===e.ship_selector.val()&&(a=!1);if(a&&!this.suppress_automatic_new_ship)return this.addShip()}),$(window).on("xwing-backend:authenticationChanged",t=>this.resetCurrentSquad()).on("xwing-collection:created",(t,i)=>(this.collection=i,this.checkCollection(),this.collection_button.removeClass("d-none"))).on("xwing-collection:changed",(t,i)=>this.checkCollection()).on("xwing-collection:destroyed",(t,i)=>(this.collection=null,this.collection_button.addClass("d-none"))).on("xwing:pingActiveBuilder",(t,i)=>{if(this.container.is(":visible"))return i(this)}).on("xwing:activateBuilder",(t,i,e)=>{if(i===this.faction)return this.tab.tab("show"),e(this)}).on("xwing:gameTypeChanged",(t,i,e=$.noop)=>{if(this.onGameTypeChanged(i,e),this.game_type_selector.val()!==i)return this.game_type_selector.val(i).trigger("change")}),this.ship_container.on("sortstart",(t,i)=>this.oldIndex=i.item.index()).on("sortstop",(t,i)=>this.updateShipOrder(this.oldIndex,i.item.index())),this.obstacles_reset.click(t=>{if(this.current_obstacles!==[])return this.current_obstacles=[],this.obstacles_select.select2("data",null),this.current_squad.additional_data.obstacles=this.current_obstacles,this.current_squad.dirty=!0,this.container.trigger("xwing-backend:squadDirtinessChanged"),this.container.trigger("xwing:pointsUpdated")}),this.obstacles_select.change(t=>(this.current_obstacles=this.obstacles_select.val().split(","),this.current_squad.additional_data.obstacles=this.current_obstacles,this.current_squad.dirty=!0,this.showObstaclesSelectInfo(),this.container.trigger("xwing-backend:squadDirtinessChanged"),this.container.trigger("xwing:pointsUpdated"))),this.view_list_button.click(t=>(t.preventDefault(),this.showTextListModal())),this.print_list_button.click(t=>{var i,e,a,s,n,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k,w,y,q,O,S,j,T,C;if(t.preventDefault(),this.printable_container.find(".printable-header").html(this.list_modal.find(".modal-header").html()),this.printable_container.find(".printable-body").text(""),"simple"===this.list_display_mode)this.printable_container.find(".printable-body").html(this.simple_container.html());else{for(e=0,s=(_=this.ships).length;e<s;e++)null!=(q=_[e]).pilot&&this.printable_container.find(".printable-body").append(q.toHTML());if(this.list_modal.find(".toggle-horizontal-space").prop("checked")&&this.printable_container.find(".upgrade-container").addClass("wide"),this.printable_container.find(".printable-body").toggleClass("bw",!this.list_modal.find(".toggle-color-print").prop("checked")),this.list_modal.find(".toggle-skip-text-print").prop("checked"))for(a=0,n=(b=this.printable_container.find(".upgrade-text, .fancy-pilot-text")).length;a<n;a++)(O=b[a]).hidden=!0;for(this.list_modal.find(".toggle-maneuver-print").prop("checked")&&this.printable_container.find(".printable-body").append(this.getSquadDialsAsHTML()),i=this.list_modal.find(".toggle-expanded-shield-hull-print").prop("checked"),u=0,l=(g=this.printable_container.find(".expanded-hull-or-shield")).length;u<l;u++)g[u].hidden=!i;for(h=0,o=(v=this.printable_container.find(".simple-hull-or-shield")).length;h<o;h++)v[h].hidden=i;t=function(){switch(this.faction){case"Rebel Alliance":return"rebel";case"Galactic Empire":return"empire";case"Scum and Villainy":return"scum";case"Resistance":return"rebel-outline";case"First Order":return"firstorder";case"Galactic Republic":return"republic";case"Separatist Alliance":return"separatists";case"All":return"first-player-4"}}.call(this),this.list_modal.find(".toggle-color-print").prop("checked")&&this.printable_container.find(".fancy-header").addClass(t),this.list_modal.find(".toggle-color-print").prop("checked")&&this.printable_container.find(".fancy-pilot-header").addClass(t+"-pilot"),this.printable_container.find(".squad-faction").html(`<i class="xwing-miniatures-font xwing-miniatures-font-${t}"></i>`)}if(this.isStandard&&this.printable_container.find(".squad-name").append(' <i class="xwing-miniatures-font xwing-miniatures-font-first-player-1"></i>'),this.isEpic&&this.printable_container.find(".squad-name").append(' <i class="xwing-miniatures-font xwing-miniatures-font-energy"></i>'),this.isXwa&&this.printable_container.find(".squad-name").append(' <i class="xwing-miniatures-font xwing-miniatures-font-point"></i>'),t="09/06/2024",y="AMG",this.isXwa&&(t="R1",y="XWA"),this.printable_container.find(".fancy-under-header").append($.trim(`<div class="version">Points Version: ${y} - ${t}</div>`)),""!==$.trim(this.notes.val())&&(this.printable_container.find(".printable-body").append($.trim(`<h5 class="print-notes translated" defaultText="Notes:"></h5>
<pre class="print-notes"></pre>`)),this.printable_container.find(".printable-body pre.print-notes").text(this.notes.val())),this.printable_container.find(".printable-body").append($.trim('<div class="print-conditions"></div>')),this.printable_container.find(".printable-body .print-conditions").html(this.condition_container.html()),this.list_modal.find(".toggle-obstacles").prop("checked")){for(p="",m=0,r=(f=this.getObstacles()).length;m<r;m++)p+=`<img class="obstacle-silhouettes" src="images/${f[m]}.png" />`;this.printable_container.find(".printable-body").append($.trim(`<div class="obstacles">
    <div>Chosen Obstacles:<br>${p}</div>
</div>`))}for(null!=(y=this.getPermaLinkParams(["sn","obs"]))&&this.list_modal.find(".toggle-juggler-qrcode").prop("checked")&&(this.printable_container.find(".printable-body").append($.trim(`<div class="qrcode-container">
    <div class="permalink-container">
        <div class="qrcode">YASB Link</div>
        <div class="qrcode-text translated" defaultText="Scan QR-Code"></div>
    </div>
    <div class="xws-container">
        <div class="qrcode">XWS Data</div>
        <div class="qrcode-text translated" defaultText="XWS QR-Code"></div>
    </div>
</div>`)),O=JSON.stringify(this.toXWS()),console.log(""+O),this.printable_container.find(".xws-container .qrcode").qrcode({render:"div",ec:"M",size:O.length<144?144:256,text:O}),O="https://yasb.app/"+y,this.printable_container.find(".permalink-container .qrcode").qrcode({render:"div",ec:"M",size:O.length<144?144:256,text:O})),S="while you perform",T=0,d=(x=this.ships).length;T<d;T++)for(null!=(null!=(k=(q=x[T]).pilot)?k.text:void 0)&&-1<q.pilot.text.match(S)&&q.pilot.name,C=0,c=(w=q.upgrades).length;C<c;C++)null!=(j=w[C]).text&&-1<j.text.match(S)&&j.name;return window.print()}),$(window).resize(()=>{var t,i,e,a,s;for($(window).width()<768&&"simple"!==this.list_display_mode&&this.select_simple_view_button.click(),a=[],t=0,i=(e=this.ships).length;t<i;t++)s=e[t],a.push(s.checkPilotSelectorQueryModal());return a}),this.notes.change(this.onNotesUpdated),this.tag.change(this.onNotesUpdated),this.notes.on("keyup",this.onNotesUpdated),this.tag.on("keyup",this.onNotesUpdated)}getPermaLinkParams(t=[]){var i,e,a={};return indexOf.call(t,"f")<0&&(a.f=encodeURI(this.faction)),indexOf.call(t,"d")<0&&(a.d=encodeURI(this.serialize())),indexOf.call(t,"sn")<0&&(a.sn=encodeURIComponent(this.current_squad.name)),indexOf.call(t,"obs")<0&&(a.obs=encodeURI(this.current_squad.additional_data.obstacles||"")),"?"+(()=>{var t=[];for(i in a)e=a[i],t.push(i+"="+e);return t})().join("&")}getPermaLink(t=this.getPermaLinkParams()){return""+URL_BASE+t}updateShipOrder(t,i){var e=this.ships[t];if(this.ships.splice(t,1),this.ships.splice(i,0,e),this.updatePermaLink,t!==i)return this.current_squad.dirty=!0,this.container.trigger("xwing-backend:squadDirtinessChanged")}updatePermaLink(){var t;if(this.container.is(":visible"))return t=this.getPermaLinkParams(),window.location.search!==t?window.history.replaceState(t,"",this.getPermaLink(t)):void 0}onNotesUpdated(){if(0<this.total_points)return this.current_squad.dirty=!0,this.container.trigger("xwing-backend:squadDirtinessChanged")}onGameTypeChanged(t,i=$.noop){var e,a,s,n,l,o=this.isQuickbuild;switch(this.isStandard=!1,this.isXwa=!1,this.isEpic=!1,this.isQuickbuild=!1,this.epic_not_legal_container.toggleClass("d-none",!0),t){case"xwa":this.isXwa=!0,this.desired_points_input.val(20);break;case"extended":this.desired_points_input.val(20);break;case"epic":this.isEpic=!0,this.isXwa=!0,this.desired_points_input.val(20),this.epic_not_legal_container.toggleClass("d-none",!1);break;case"quickbuild":this.isQuickbuild=!0,this.desired_points_input.val(8);break;default:this.isStandard=!0,this.desired_points_input.val(20)}if(o!==this.isQuickbuild)s=this.current_squad.id,this.newSquadFromScratch($.trim(this.current_squad.name)),this.current_squad.id=s;else{for(s=this.current_squad.id,e=0,a=(n=this.ships).length;e<a;e++)null!=(l=n[e]).pilot&&l.setPilotById(null!=(l=l.pilot)?l.id:void 0);this.container.trigger("xwing:pointsUpdated",$.noop),this.container.trigger("xwing:shipUpdated")}return i()}addStandardizedToList(t){return t.addStandardizedUpgrades()}onPointsUpdated(t=$.noop){for(var i,e,a,s,n,l,o,r,d,c,u=0,h=0,p=!1,f=a=o=this.ships.length-1;o<=-1?a<-1:-1<a;f=o<=-1?++a:--a)(d=this.ships[f]).validate(),d&&(this.addStandardizedToList(d),u+=d.getPoints(),1===d.destroystate?h+=Math.floor(d.getPoints()/2):2===d.destroystate&&(h+=d.getPoints()),c=d.checkUnreleasedContent())&&(p=c);if(this.total_points=u,this.points_destroyed=h,this.total_points_span.text(this.total_points),l=parseInt(this.desired_points_input.val())-this.total_points,parseInt(this.total_points),this.points_remaining_span.text(l),this.points_destroyed_span.html(0!==h?'<i class="xwing-miniatures-font xwing-miniatures-font-hit"></i>'+h:""),this.points_remaining_container.toggleClass("red",l<0),this.unreleased_content_used_container.toggleClass("d-none",!p),l=!1===this.isStandard?"(Extended)":"(Standard)",this.isXwa&&(l="(XWA)"),this.isEpic&&(l="(Epic)"),this.fancy_total_points_container.text(`(${this.total_points}) `+l),this.updatePrintAndExportTexts(),this.checkCollection(),"undefined"!=typeof Set&&null!==Set){for(e=new Set,s=0,n=(r=this.ships).length;s<n;s++)(d=r[s]).getConditions().forEach(function(t){return e.add(t)});i=[],e.forEach(function(t){return i.push(t)}),i.sort(function(t,i){return t.name.canonicalize()<i.name.canonicalize()?-1:i.name.canonicalize()>t.name.canonicalize()?1:0}),this.condition_container.text(""),i.forEach(t=>this.condition_container.append(conditionToHTML(t)))}return t(this.total_points)}onSquadLoadRequested(i,e=$.noop){var t,a;return this.current_squad=i,this.backend_delete_list_button.removeClass("disabled"),this.updateObstacleSelect(this.current_squad.additional_data.obstacles),t=()=>{var t;return this.notes.val(null!=(t=i.additional_data.notes)?t:""),this.tag.val(null!=(t=i.additional_data.tag)?t:""),this.backend_status.fadeOut("slow"),this.current_squad.dirty=!1,this.container.trigger("xwing-backend:squadNameChanged"),this.container.trigger("xwing-backend:squadDirtinessChanged"),e()},null!=(null!=(a=i.serialized)?a.length:void 0)&&this.loadFromSerialized(i.serialized,t),{else:t()}}onSquadDirtinessChanged(){return this.backend_save_list_button.toggleClass("disabled",!(this.current_squad.dirty&&0<this.total_points)),this.backend_save_list_as_button.toggleClass("disabled",0===this.total_points),this.backend_delete_list_button.toggleClass("disabled",null==this.current_squad.id),1<this.ships.length?$('meta[property="og:description"]').attr("content",this.uitranslation("X-Wing Squadron by YASB: ")+this.current_squad.name+": "+this.describeSquad()):$('meta[property="og:description"]').attr("content",this.uitranslation("YASB advertisment"))}onSquadNameChanged(){var t=this.current_squad.name.length>SQUAD_DISPLAY_NAME_MAX_LENGTH?this.current_squad.name.substr(0,SQUAD_DISPLAY_NAME_MAX_LENGTH)+"&hellip;":this.current_squad.name;if(this.squad_name_placeholder.text(""),this.squad_name_placeholder.append(t),this.squad_name_input.val(this.current_squad.name),$.getParameterByName("f")===this.faction)return this.current_squad.name!==this.uitranslation("Unnamed Squadron")&&this.current_squad.name!==this.uitranslation("Unsaved Squadron")?document.title!=="YASB - "+this.current_squad.name&&(document.title="YASB - "+this.current_squad.name):document.title="YASB",this.updatePrintAndExportTexts()}updatePrintAndExportTexts(){var t,i,e,a,s,n,l,o,r,d,c,u;for(this.fancy_container.text(""),this.simple_container.html('<table class="simple-table"></table>'),d=[],l=[],u=[],t=0,e=(o=this.ships).length;t<e;t++)null!=(r=o[t]).pilot&&(this.fancy_container.append(r.toHTML()),this.simple_container.find("table").append(r.toTableRow()),d.push(r.toSimpleCopy()),l.push(r.toRedditText()),u.push(r.toTTSText()));if(this.reddit_container.find("textarea").val($.trim(""+l.join("    \n")+`    
**${this.uitranslation("Total")}:** *${this.total_points}*    
    
[${this.uitranslation("View in YASB")}](${this.getPermaLink()})`)),this.simplecopy_container.find("textarea").val($.trim(`${d.join("")}    
${this.uitranslation("Total")}: ${this.total_points}    
    
${this.uitranslation("View in YASB")}: `+this.getPermaLink())),null!=(n=this.getObstacles())&&0<n.length&&0<u.length){for(u[u.length-1]=u[u.length-1].slice(0,-2),c=" |",i=0,a=n.length;i<a;i++)null!=(s=n[i])&&(c+=` ${s} /`);c=c.slice(0,-1),u.push(c)}return this.tts_textarea.val($.trim(""+u.join(""))),this.xws_textarea.val($.trim(JSON.stringify(this.toXWS()))),$("#xws-qrcode-container").text(""),$("#xws-qrcode-container").qrcode({render:"canvas",text:JSON.stringify(this.toMinimalXWS()),ec:"L",size:128})}removeAllShips(){for(;0<this.ships.length;)this.removeShip(this.ships[0]);if(0<this.ships.length)throw new Error(this.uitranslation("Ships not emptied"))}showTextListModal(){return this.list_modal.modal("show")}showXWSModal(t){return this.select_xws_view(),this.showTextListModal()}showChooseObstaclesModal(){return this.obstacles_select.select2("val",this.current_squad.additional_data.obstacles),this.choose_obstacles_modal.modal("show")}showObstaclesSelectInfo(){var t,i,e,a,s,n=this.obstacles_select.val().split(",");if(n===[])return this.obstacles_select_sources.html("");for(e="",t=0,i=n.length;t<i;t++)e+=`<u>${s=n[t]}</u>: ${1<(s=null!=(s=null!=(s=exportObj.obstacles[s])?s.sources:void 0)?s:[]).length||(a=exportObj.translate("sources","Loose Ships"),!(0<=indexOf.call(s,a)))?0<s.length?s.join(", "):exportObj.translate("ui","unreleased"):this.uitranslation("Only available from 1st edition")}</br>`;return this.obstacles_select_sources.html($.trim(e))}updateObstacleSelect(t){return this.current_obstacles=null!=t?t:[],this.obstacles_select.select2("val",t),this.showObstaclesSelectInfo()}serialize(){var s;return`v9Z${function(){switch(this.game_type_selector.val()){case"standard":return"h";case"extended":return"s";case"xwa":return"b";case"epic":return"e";case"quickbuild":return"q"}}.call(this)}Z${$.trim(this.desired_points_input.val())}Z`+function(){for(var t=this.ships,i=[],e=0,a=t.length;e<a;e++)null==(s=t[e]).pilot||this.isQuickbuild&&!s.primary||i.push(s.toSerialized());return i}.call(this).join("Y")}changeGameTypeOnSquadLoad(t){if(this.game_type_selector.val()!==t)return $(window).trigger("xwing:gameTypeChanged",t)}async loadFromSerialized(t,i=$.noop){var e,a,s,n,l,o,r,d,c,u,h,p,f,m;if(this.suppress_automatic_new_ship=!0,this.removeAllShips(),null!=(t=(0<=indexOf.call(t,"Z")?/^v(\d+)Z(.*)/:/^v(\d+)!(.*)/).exec(t))){if(p=7<(m=parseInt(t[1]))?"Y":";",[t,e,u]=7<m?([e,u,d]=t[2].split("Z"),[e,parseInt(u),d]):([t,d]=t[2].split("!"),u=parseInt(t.split("=")[1])?parseInt(t.split("=")[1]):20,[e=t.split("=")[0],u,d]),m<9)return this.old_version_container.toggleClass("d-none",!1),this.suppress_automatic_new_ship=!1,void this.addShip();if(null==u)return this.loading_failed_container.toggleClass("d-none",!1),this.suppress_automatic_new_ship=!1,void this.addShip();switch(this.isCurrentlyLoadingSquad=!0,t){case"s":this.changeGameTypeOnSquadLoad("extended");break;case"h":this.changeGameTypeOnSquadLoad("standard");break;case"b":this.changeGameTypeOnSquadLoad("xwa");break;case"e":this.changeGameTypeOnSquadLoad("epic");break;case"q":this.changeGameTypeOnSquadLoad("quickbuild")}if(this.desired_points_input.val(e),this.desired_points_input.change(),f=[],null!=u.length){for(a=0,n=(r=u.split(p)).length;a<n;a++)""===(c=r[a])||await(o=this.addShip()).fromSerialized(m,c)&&o.pilot||f.push([o,c]);for(s=0,l=f.length;s<l;s++)(h=f[s])[0].pilot||(h[0]=this.addShip()),h[0].fromSerialized(m,h[1])}this.isCurrentlyLoadingSquad=!1}return this.suppress_automatic_new_ship=!1,this.addShip(),this.container.trigger("xwing:pointsUpdated"),i()}select_xws_view(){if(this.select_xws_view_button.blur(),"xws"!==this.list_display_mode)return this.list_modal.find(".list-display-mode .btn").removeClass("btn-inverse"),this.select_xws_view_button.addClass("btn-inverse"),this.list_display_mode="xws",this.xws_container.show(),this.simple_container.hide(),this.simplecopy_container.hide(),this.reddit_container.hide(),this.fancy_container.hide(),this.tts_container.hide(),this.xws_textarea.select(),this.xws_textarea.focus(),this.toggle_vertical_space_container.hide(),this.toggle_color_print_container.hide(),this.toggle_color_skip_text.hide(),this.toggle_maneuver_dial_container.hide(),this.toggle_expanded_shield_hull_container.hide(),this.toggle_qrcode_container.hide(),this.toggle_obstacle_container.hide(),this.btn_print_list.disabled=!0}uniqueIndex(t,i){if(i in this.uniques_in_use)return this.uniques_in_use[i].indexOf(t);throw new Error(`Invalid unique type '${i}'`)}claimUnique(t,i,e){var a,s,n,l,o,r,d;if(!(this.uniqueIndex(t,i)<0))throw new Error(`Unique ${i} '${t.name}' already claimed`);for(a=0,n=(r=exportObj.pilotsByUniqueName[t.canonical_name.getXWSBaseName()]||[]).length;a<n;a++)if(t!==(o=r[a])){if(!(this.uniqueIndex(o,"Pilot")<0))throw new Error(`Unique ${i} '${t.name}' already claimed as pilot`);this.uniques_in_use.Pilot.push(o)}for(s=0,l=(d=exportObj.upgradesByUniqueName[t.canonical_name.getXWSBaseName()]||[]).length;s<l;s++){if(o=d[s],!(this.uniqueIndex(o,"Upgrade")<0))throw new Error(`Unique ${i} '${o.name}' already claimed as pilot`);this.uniques_in_use.Upgrade.push(o)}return null!=t.solitary&&this.uniques_in_use.Slot.push(t.slot),this.uniques_in_use[i].push(t),e()}releaseUnique(t,i,e){var a,s,n,l,o,r,d;if(!(0<=this.uniqueIndex(t,i)))throw new Error(`Unique ${i} '${t.name}' not in use`);for(i in o=this.uniques_in_use)if(d=o[i],"Slot"===i){if(null!=t.solitary)for(this.uniques_in_use[i]=[],a=0,n=d.length;a<n;a++)(r=d[a])!==t.slot&&this.uniques_in_use[i].push(r.slot)}else for(this.uniques_in_use[i]=[],s=0,l=d.length;s<l;s++)(r=d[s]).canonical_name.getXWSBaseName()!==t.canonical_name.getXWSBaseName()&&this.uniques_in_use[i].push(r);return e()}addShip(){var t=new Ship({builder:this,container:this.ship_container});return this.ships.push(t),this.ship_number_invalid_container.toggleClass("d-none",this.ships.length<10&&3<this.ships.length),this.multi_faction_warning_container.toggleClass("d-none","All"!==this.faction),t}async removeShip(e,t=$.noop){return null!=(null!=e?e.destroy:void 0)&&(await new Promise((t,i)=>e.destroy(t)),await new Promise((t,i)=>this.container.trigger("xwing:pointsUpdated",t)),this.current_squad.dirty=!0,this.container.trigger("xwing-backend:squadDirtinessChanged"),this.ship_number_invalid_container.toggleClass("d-none",this.ships.length<10&&3<this.ships.length),this.multi_faction_warning_container.toggleClass("d-none","All"!==this.faction)),t()}matcher(t,i){return 0<=t.toUpperCase().indexOf(i.toUpperCase())}isOurFaction(t,i=""){var e,a,s,n=this.faction;if("All"===this.faction){if(""===i)return!0;n=i}if(t instanceof Array){for(a=0,s=t.length;a<s;a++)if(e=t[a],getPrimaryFaction(e)===n)return!0;return!1}return getPrimaryFaction(t)===n}isItemAvailable(t,i=!1){var e;return!!this.isQuickbuild||(this.isStandard?exportObj.standardCheck(t,this.faction,i):this.isEpic?!(null!=(null!=(e=exportObj.settings)?e.ban_list:void 0)&&exportObj.settings.ban_list&&!exportObj.standardCheck(t,this.faction,i,!0)):!(null!=(null!=(e=exportObj.settings)?e.ban_list:void 0)&&exportObj.settings.ban_list&&!exportObj.standardCheck(t,this.faction,i,!0))&&exportObj.epicExclusions(t))}getAvailableShipsMatching(t="",i=!0,e=!1){var a,s,n=[],l=exportObj.ships;for(s in l)a=l[s],this.isOurFaction(a.factions)&&(this.matcher(a.name,t)||a.display_name&&this.matcher(a.display_name,t))&&this.isItemAvailable(a,!0)&&(!e||null!=this.collection&&"true"===this.collection.checks.collectioncheck&&this.collection.checkShelf("ship",a.name))&&n.push({id:a.name,text:a.display_name||a.name,chassis:a.chassis,name:a.name,display_name:a.display_name,canonical_name:a.canonical_name,xws:a.name.canonicalize(),icon:a.icon||a.name.canonicalize()});return i&&n.sort(exportObj.sortHelper),n}getAvailableShipsMatchingAndCheapEnough(t,i="",e=!1,a=!1){for(var s,n,l=this.getAvailableShipsMatching(i,e,a),o=[],r=0,d=l.length;r<d;r++)n=l[r],(s=this.getAvailablePilotsForShipIncluding(n.name,null,"",!0)).length&&s[0].points<=t&&o.push(n);return o}getAvailablePilotsForShipIncluding(e,i,a="",t=!0,l=null){var o,s,n,r,d,c,u,h,p,f,m,_,b,g,v,x,k,w,y,$,q,O,S,j,T=[];if(this.isQuickbuild){if(k=function(){var t=exportObj.quickbuildsById,i=[];for(r in t)x=t[r],(null==e||x.ship===e)&&this.isOurFaction(x.faction)&&(this.matcher(x.pilot,a)||null!=exportObj.pilots[x.pilot].display_name&&this.matcher(exportObj.pilots[x.pilot].display_name,a))&&i.push(x);return i}.call(this),O=[],null!=i&&-1!==i){if(d=exportObj.quickbuildsById[i],null!=(y=exportObj.pilots[d.pilot]).unique)for(O.push(y),u=0,p=(w=exportObj.pilotsByUniqueName[y.canonical_name.getXWSBaseName()]||[]).length;u<p;u++)null!=(b=w[u])&&O.push(b);for(h=0,f=($=null!=(y=d.upgrades)?y:[]).length;h<f;h++){if(c=$[h],null!=(c=exportObj.upgrades[c]).unique)for(O.push(b),_=0,m=(q=exportObj.pilotsByUniqueName[c.canonical_name.getXWSBaseName()]||[]).length;_<m;_++)null!=(b=q[_])&&O.push(b);null!=c.solitary&&O.push(c.slot)}}o=[],function(){var t,i=[];for(r in k)x=k[r],null!=(null!=(t=exportObj.pilots[x.pilot])?t.unique:void 0)&&(t=exportObj.pilots[x.pilot],0<=indexOf.call(this.uniques_in_use.Pilot,t))&&(t=exportObj.pilots[x.pilot],!(0<=indexOf.call(O,t)))||null!=(null!=(t=exportObj.pilots[x.pilot])?t.max_per_squad:void 0)&&this.countPilots(exportObj.pilots[x.pilot].canonical_name)>=exportObj.pilots[x.pilot].max_per_squad&&(t=exportObj.pilots[x.pilot],!(0<=indexOf.call(O,t)))?o.push(x.id):i.push(null!=x.upgrades?function(){for(var t,i,e=x.upgrades,a=[],s=0,n=e.length;s<n;s++)if(S=e[s],null==(j=exportObj.upgrades[S]))console.log("There was an Issue including the upgrade "+S+" in some quickbuild. Please report that Issue!");else{if(null!=j.unique&&0<=indexOf.call(this.uniques_in_use.Upgrade,j)&&!(0<=indexOf.call(O,j))&&(null===l||!(0<=indexOf.call(exportObj.quickbuildsById[l.quickbuildId].upgrades,S)||l.linkedShip&&0<=indexOf.call(null!=(t=exportObj.quickbuildsById[null!=(t=l.linkedShip)?t.quickbuildId:void 0].upgrades)?t:[],S)))){o.push(x.id);break}if(null!=j.solitary&&(t=j.slot,0<=indexOf.call(this.uniques_in_use.Slot,t))&&(i=j.slot,!(0<=indexOf.call(O,i)))){o.push(x.id);break}a.push(void 0)}return a}.call(this):void 0);return i}.call(this),T=(()=>{for(var t,i=[],e=0,a=k.length;e<a;e++)x=k[e],i.push({id:x.id,text:(null!=(null!=(t=exportObj.settings)?t.initiative_prefix:void 0)&&exportObj.settings.initiative_prefix?exportObj.pilots[x.pilot].skill+" - ":"")+(exportObj.pilots[x.pilot].display_name||x.pilot)+x.suffix+` (${x.threat})`,points:x.threat,ship:x.ship,disabled:(t=x.id,0<=indexOf.call(o,t))});return i})()}else s=function(){var t=exportObj.pilots,i=[];for(v in t)g=t[v],(null==e||g.ship===e)&&this.isOurFaction(g.faction)&&(this.matcher(v,a)||g.display_name&&this.matcher(g.display_name,a))&&this.isItemAvailable(g,!0)&&i.push(g);return i}.call(this),n=function(){var t=[];for(v in s)(null==(g=s[v]).unique||indexOf.call(this.uniques_in_use.Pilot,g)<0||g.canonical_name.getXWSBaseName()===(null!=i?i.canonical_name.getXWSBaseName():void 0))&&(null==g.max_per_squad||this.countPilots(g.canonical_name)<g.max_per_squad||g.canonical_name.getXWSBaseName()===(null!=i?i.canonical_name.getXWSBaseName():void 0))&&(null==g.upgrades||this.standard_restriction_check(g,i))&&(null==g.restriction_func||g.restriction_func({builder:this},g))&&t.push(g);return t}.call(this),null!=i&&null!=i.unique&&(this.matcher(i.name,a)||i.display_name&&this.matcher(i.display_name,a))&&n.push(i),T=function(){for(var t,i=[],e=0,a=s.length;e<a;e++)g=s[e],i.push({id:g.id,text:`${null!=(null!=(t=exportObj.settings)?t.initiative_prefix:void 0)&&exportObj.settings.initiative_prefix?g.skill+" - ":""}${g.display_name||g.name} (${this.isXwa&&null!=g.pointsxwa?g.pointsxwa:g.points}${null!=g.loadout?this.isXwa&&null!=g.loadoutxwa?"/"+g.loadoutxwa:"/"+g.loadout:""})`,points:this.isXwa&&null!=g.pointsxwa?g.pointsxwa:g.points,ship:g.ship,name:g.name,display_name:g.display_name,disabled:indexOf.call(n,g)<0});return i}.call(this);return T=t?T.sort(exportObj.sortHelper):T}standard_restriction_check(t,i){var e,a,s,n,l,o,r,d,c,u,h,p,f,m;if(null!=t.upgrades)for(e=0,s=(r=t.upgrades).length;e<s;e++)if(f=r[e],null!=(m=exportObj.upgrades[f]).unique)for(a=0,n=(d=this.ships).length;a<n;a++)if(null==(null!=(c=(h=d[a]).pilot)?c.name:void 0)||null==(null!=i?i.name:void 0)||h.pilot.name!==i.name)for(o=0,l=(u=h.upgrades).length;o<l;o++)if((null!=(p=u[o])&&null!=(p=p.data)?p.canonical_name:void 0)===m.canonical_name)return!1;return!0}countUpgrades(t){for(var i,e,a,s,n,l,o=0,r=this.ships,d=0,c=r.length;d<c;d++)if(null==(null!=(a=(n=r[d]).pilot)?a.upgrades:void 0))for(i=0,e=(s=n.upgrades).length;i<e;i++)(null!=(l=s[i])&&null!=(l=l.data)?l.canonical_name:void 0)===t&&o++;return o}countPilots(t){for(var i,e=0,a=this.ships,s=0,n=a.length;s<n;s++)(null!=(i=a[s])&&null!=(i=i.pilot)?i.canonical_name.getXWSBaseName():void 0)===t.getXWSBaseName()&&e++;return e}isShip(t,i){var e,a;if(t instanceof Array){for(e=0,a=t.length;e<a;e++)if(t[e]===i)return!0;return!1}return t===i}getAvailableUpgradesIncluding(e,a,s,n,l="",o=this.dfl_filter_func,t=!0){var r,i,d,c,u,h,p,f,m,_,b,g,v=(()=>{for(var t=s.upgrades,i=[],e=0,a=t.length;e<a;e++)b=t[e],i.push(b.data);return i})(),x=function(){var t=exportObj.upgrades,i=[];for(g in t)b=t[g],exportObj.slotsMatching(b.slot,e)&&(this.matcher(g,l)||b.display_name&&this.matcher(b.display_name,l))&&(null==b.ship||this.isShip(b.ship,s.data.name))&&(null==b.faction||this.isOurFaction(b.faction,s.pilot.faction))&&this.isItemAvailable(b)&&null==b.standard&&i.push(b);return i}.call(this);for(o!==this.dfl_filter_func&&(x=(()=>{for(var t=[],i=0,e=x.length;i<e;i++)b=x[i],o(b)&&t.push(b);return t})()),p=s.upgrade_points_total-n.getPoints(a),r=function(){var t,i=[];for(g in x)b=x[g],indexOf.call(this.uniques_in_use.Upgrade,b)<0&&s.standardized_check(b)&&s.restriction_check(s.builder.isXwa&&null!=b.restrictionsxwa?b.restrictionsxwa:b.restrictions||void 0,n,n.getPoints(b),p,b)&&indexOf.call(v,b)<0&&(null==b.max_per_squad||s.builder.countUpgrades(b.canonical_name)<b.max_per_squad)&&(null==b.solitary||(t=b.slot,indexOf.call(this.uniques_in_use.Slot,t)<0)||null!=(null!=a?a.solitary:void 0))&&i.push(b);return i}.call(this),d=0,u=(f=(()=>{for(var t=s.upgrades,i=[],e=0,a=t.length;e<a;e++)null!=(null!=(b=t[e])?b.data:void 0)&&i.push(b.data);return i})()).length;d<u;d++)i=f[d],r.removeItem(i);if(null!=a&&(this.matcher(a.name,l)||a.display_name&&this.matcher(a.display_name,l))&&r.push(a),_=(()=>{for(var t=[],i=0,e=x.length;i<e;i++)b=x[i],t.push({id:b.id,text:`${b.display_name||b.name} (${n.getPoints(b)}${b.variablepoints?"*":""})`,points:n.getPoints(b),name:b.name,display_name:b.display_name,disabled:indexOf.call(r,b)<0});return t})(),t&&(_=_.sort(exportObj.sortHelper)),"function"==typeof n&&n("undefined"!=typeof adjustment_func&&null!==adjustment_func)){for(m=[],c=0,h=_.length;c<h;c++)b=_[c],m.push(n.adjustment_func(b));return m}return _}getSquadDialsAsHTML(){for(var t,i,e,a,s="",n={},l=this.ships,o=0,r=l.length;o<r;o++)null!=(a=l[o]).pilot&&(i=a.data.maneuvers,t=a.effectiveStats().maneuvers,null!=n[a.data.name]&&(e=t.toString(),0<=indexOf.call(n[a.data.name],e))||(n[a.data.name]=(null!=(e=n[a.data.name])?e:[]).concat([t.toString()]),s+='<div class="fancy-dial"><h4 class="ship-name-dial">'+(null!=a.data.display_name?a.data.display_name:a.data.name)+`${t.toString()!==i.toString()?" ("+this.uitranslation("modified")+")":""}</h4>`+this.getManeuverTableHTML(t,i)+"</div>"));return`<div class="print-dials-container">
    ${s}
</div>`}getManeuverTableHTML(a,t){var i,e,s,n,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k,w,y,q,O,S,j,T;if(null==a||0===a.length)return this.uitranslation("Missing maneuver info.");for(s=function(){for(var t=[],i=0,e=a[0].length;0<=e?i<e:e<i;0<=e?i++:i--)t.push(i);return t}.apply(this),d=0,u=a.length;d<u;d++)for(i=c=0,h=(e=a[d]).length;c<h;i=++c)0<e[i]&&s.removeItem(i);for(v="<table><tbody>",O=m=w=a.length-1;w<=0?m<=0:0<=m;O=w<=0?++m:--m){for(o=!1,g=0,p=(y=a[O]).length;g<p;g++)if(0<y[g]){o=!0;break}if(o){for(v+=`<tr><td>${O}</td>`,T=k=0,q=a[O].length;0<=q?k<q:q<k;T=0<=q?++k:--k)if(!(0<=indexOf.call(s,T))){if(v+="<td>",0<a[O][T]){if(l=(()=>{switch(a[O][T]){case 1:return"dodgerblue";case 2:return"white";case 3:return"red";case 4:return"purple"}})(),_=(()=>{switch(a[O][T]){case 1:return"svg-blue-maneuver";case 2:return"svg-white-maneuver";case 3:return"svg-red-maneuver";case 4:return"svg-purple-maneuver"}})(),v+='<svg xmlns="http://www.w3.org/2000/svg" width="30px" height="30px" viewBox="0 0 200 200">',x="black",b="svg-base-maneuver",a[O][T]!==t[O][T]&&(x="DarkSlateGrey",b="svg-modified-maneuver"),0===O&&2===T)v+=`<rect class="svg-maneuver-stop ${_} ${b}" x="50" y="50" width="100" height="100" style="fill:${l}; stroke-width:5; stroke:${x}" />`;else{switch(n=S="",T){case 0:f="M160,180 L160,70 80,70",r="M160,175 L160,70 70,70",j="M80,100 V40 L30,70 Z";break;case 1:f="M150,180 S150,120 80,60",r="M150,175 S150,120 80,60",j="M80,100 V40 L30,70 Z",S="transform='translate(-5 -15) rotate(45 70 90)' ";break;case 2:f="M100,180 L100,100 100,80",r="M100,175 L100,120 100,70",j="M70,80 H130 L100,30 Z";break;case 3:f="M50,180 S50,120 120,60",r="M50,175 S50,120 120,60",j="M120,100 V40 L170,70 Z",S="transform='translate(5 -15) rotate(-45 130 90)' ";break;case 4:f="M40,180 L40,70 120,70",r="M40,175 L40,70 130,70",j="M120,100 V40 L170,70 Z";break;case 5:f="M50,180 L50,100 C50,10 140,10 140,100 L140,120",r="M50,175 L50,100 C50,10 140,10 140,100 L140,130",j="M170,120 H110 L140,180 Z";break;case 6:f="M150,180 S150,120 80,60",r="M150,175 S150,120 85,65",j="M80,100 V40 L30,70 Z",S="transform='translate(0 50)'";break;case 7:f="M50,180 S50,120 120,60",r="M50,175 S50,120 115,65",j="M120,100 V40 L170,70 Z",S="transform='translate(0 50)'";break;case 8:f="M160,180 L160,70 80,70",r="M160,175 L160,70 85,70",j="M60,100 H100 L80,140 Z";break;case 9:f="M40,180 L40,70 120,70",r="M40,175 L40,70 115,70",j="M100,100 H140 L120,140 Z";break;case 10:f="M50,180 S50,120 120,60",r="M50,175 S50,120 120,60",j="M120,100 V40 L170,70 Z",S="transform='translate(5 -15) rotate(-45 130 90)' ",n="backwards";break;case 11:f="M100,180 L100,100 100,80",r="M100,175 L100,100 100,70",j="M70,80 H130 L100,30 Z",n="backwards";break;case 12:f="M150,180 S150,120 80,60",r="M150,175 S150,120 80,60",j="M80,100 V40 L30,70 Z",S="transform='translate(-5 -15) rotate(45 70 90)' ",n="backwards"}v+=$.trim(`<g class="maneuver ${n}">
  <path class = 'svg-maneuver-outer ${_} ${b}' stroke-width='25' fill='none' stroke='${x}' d='${f}' />
  <path class = 'svg-maneuver-triangle ${_} ${b}' d='${j}' fill='${l}' stroke-width='5' stroke='${x}' ${S}/>
  <path class = 'svg-maneuver-inner ${_} ${b}' stroke-width='15' fill='none' stroke='${l}' d='${r}' />
</g>`)}v+="</svg>"}v+="</td>"}v+="</tr>"}}return v+="</tbody></table>"}formatActions(t,i,e=[]){for(var a,s,n,l=[],o=0,r=t.length;o<r;o++)a=t[o],s="",n=i,-1!==(a=0<=indexOf.call(e,"Droid")?a.replace("Focus","Calculate"):a).search("> ")&&(a=a.replace(/> /gi,""),n=' <i class="xwing-miniatures-font xwing-miniatures-font-linked"></i> '),-1!==a.search("F-")&&(s="force ",a=a.replace(/F-/gi,"")),-1!==a.search("W-")?(n="White ",a=a.replace(/W-/gi,"")):-1!==a.search("R-")&&(s="red ",a=a.replace(/R-/gi,"")),a=a.toLowerCase().replace(/[^0-9a-z]/gi,""),l.push(n+`<i class="xwing-miniatures-font ${s}xwing-miniatures-font-${a}"></i>`);return l.join("").replace(i,"")}listStandardUpgrades(t){for(var i="",e=0,a=t.length;e<a;e++)i+=", "+t[e].split(" (")[0];return i.substr(2)}getPilotsMatchingUpgrade(t="",i=!0){var e,a,s,n,l,o,r=[],d=exportObj.pilots;for(n in d)if(null!=(s=d[n]).upgrades)for(e=0,a=(l=s.upgrades).length;e<a;e++)o=l[e],this.matcher(o,t)&&r.push({id:s.name,name:s.name,display_name:s.display_name,chassis:s.chassis,canonical_name:s.canonical_name,xws:s.name.canonicalize(),icon:s.icon||s.name.canonicalize()});return i&&r.sort(exportObj.sortHelper),r}showTooltip(t,n,i,e=this.info_container,a=!1){var s,l,z,o,M,r,d,c,B,u,h,p,N,D,R,F,f,X,m,W,_,b,g,v,x,k,w,y,G,H,Q,V,q,O,S,j,T,C,L,I,A,P,U,E;if(n!==this.tooltip_currently_displaying||a){switch(t){case"Ship":for(C in k=[],x=[],w=[],L={},exportObj.upgradesBySlotCanonicalName)L[C]=-1;for(W in G=exportObj.pilots)if((b=G[W]).ship===n.name&&this.isOurFaction(b.faction)&&(H=b.skill,0<=indexOf.call(k,H)||k.push(b.skill),this.isXwa&&null!=b.pointsxwa?x.push(b.pointsxwa):x.push(b.points),this.isXwa&&null!=b.loadoutxwa?w.push(b.loadoutxwa):null!=b.loadout&&w.push(b.loadout),null!=b.slots))for(C in L)switch(P=L[C],b.slots.filter(t=>t===C).length){case 1:switch(P){case-1:L[C]=1;break;case 0:L[C]=2;break;case 3:L[C]=4}break;case 0:switch(P){case-1:L[C]=0;break;case 1:L[C]=2;break;case 3:case 4:L[C]=5}break;case 2:switch(P){case-1:L[C]=3;break;case 0:case 2:L[C]=5;break;case 1:L[C]=4}break;case 3:L[C]=6}for(k.sort(),e.find(".info-type").text(exportObj.translate("types",t)),e.find(".info-name").html(""+(n.display_name||n.name)+(exportObj.isReleased(n)?"":` (${this.uitranslation("unreleased")})`)),null!=(null!=(A=this.collection)?A.counts:void 0)?(T=null!=(A=null!=(A=this.collection.counts)&&null!=(A=A.ship)?A[n.name]:void 0)?A:0,e.find(".info-collection").text(this.uitranslation("collectionContentShips",T)),e.find(".info-collection").show()):e.find(".info-collection").hide(),r=!0,B=String(k[0]),h=0,N=k.length;h<N;h++)c=k[h],r||(B+=", "+c),r=!1;for(e.find("tr.info-skill td.info-data").text(B),e.find("tr.info-skill").toggle(void 0!==c),A=Math.min(...x)+" - "+Math.max(...x),e.find("tr.info-points td.info-data").text(A),A=Math.min(...w)+" - "+Math.max(...w),e.find("tr.info-loadout td.info-data").text(A),e.find("tr.info-points").toggle(0<x.length),e.find("tr.info-loadout").toggle(0<w.length),e.find("tr.info-engagement").hide(),e.find("tr.info-attack td.info-data").text(n.attack),e.find("tr.info-attack-bullseye td.info-data").text(n.attackbull),e.find("tr.info-attack-fullfront td.info-data").text(n.attackf),e.find("tr.info-attack-left td.info-data").text(n.attackl),e.find("tr.info-attack-right td.info-data").text(n.attackr),e.find("tr.info-attack-back td.info-data").text(n.attackb),e.find("tr.info-attack-turret td.info-data").text(n.attackt),e.find("tr.info-attack-doubleturret td.info-data").text(n.attackdt),e.find("tr.info-attack").toggle(null!=n.attack),e.find("tr.info-attack-bullseye").toggle(null!=n.attackbull),e.find("tr.info-attack-fullfront").toggle(null!=n.attackf),e.find("tr.info-attack-left").toggle(null!=n.attackl),e.find("tr.info-attack-right").toggle(null!=n.attackr),e.find("tr.info-attack-back").toggle(null!=n.attackb),e.find("tr.info-attack-turret").toggle(null!=n.attackt),e.find("tr.info-attack-doubleturret").toggle(null!=n.attackdt),e.find("tr.info-ship").hide(),null!=n.base?e.find("tr.info-base td.info-data").text(exportObj.translate("gameterms",n.base)):e.find("tr.info-base td.info-data").text(exportObj.translate("gameterms","Small")),e.find("tr.info-base").show(),e.find("tr.info-faction td.info-data").text([(()=>{for(var t=n.factions,i=[],e=0,a=t.length;e<a;e++)M=t[e],i.push(exportObj.translate("faction",M));return i})()]),e.find("tr.info-faction").hide(),e.find("p.info-restrictions").hide(),p=0,D=(Q=e.find("tr.info-attack td.info-header i.xwing-miniatures-font")[0].classList).length;p<D;p++)(z=Q[p]).startsWith("xwing-miniatures-font-attack")&&e.find("tr.info-attack td.info-header i.xwing-miniatures-font").removeClass(z);if(e.find("tr.info-attack td.info-header i.xwing-miniatures-font").addClass(null!=(A=n.attack_icon)?A:"xwing-miniatures-font-attack"),e.find("tr.info-range").hide(),e.find("tr.info-agility td.info-data").text(n.agility),e.find("tr.info-agility").toggle(null!=n.agility),e.find("tr.info-hull td.info-data").text(n.hull),e.find("tr.info-hull").toggle(null!=n.hull),y="",null!=n.shieldrecurr)for(o=0;o<n.shieldrecurr;)y+='<sup><i class="fas fa-caret-up"></i></sup>',++o;if(e.find("tr.info-shields td.info-data").html(n.shields+y),e.find("tr.info-shields").toggle(null!=n.shields),y="",null!=n.energyrecurr)for(o=0;o<n.energyrecurr;)y+='<sup><i class="fas fa-caret-up"></i></sup>',++o;e.find("tr.info-energy td.info-data").html(n.energy+y),e.find("tr.info-energy").toggle(null!=n.energy),e.find("tr.info-force").hide(),e.find("tr.info-charge").hide(),e.find("tr.info-actions td.info-data").html(this.formatActions(n.actions,", ",null!=(A=n.keyword)?A:[])),e.find("tr.info-actions").show(),e.find("tr.info-upgrades").show(),e.find("tr.info-upgrades td.info-data").html((()=>{var t=[];for(C in L)P=L[C],t.push(1===P?exportObj.translate("sloticon",C):2===P?"("+exportObj.translate("sloticon",C)+")":3===P?exportObj.translate("sloticon",C)+exportObj.translate("sloticon",C):4===P?exportObj.translate("sloticon",C)+"("+exportObj.translate("sloticon",C)+")":5===P?"("+exportObj.translate("sloticon",C)+exportObj.translate("sloticon",C)+")":6===P?exportObj.translate("sloticon",C)+exportObj.translate("sloticon",C)+exportObj.translate("sloticon",C):void 0);return t})().join(" ")||"None"),e.find("p.info-text").hide(),e.find("p.info-chassis").show(),e.find("p.info-chassis").html(null!=n.chassis?`<strong>${null!=(A=null!=(A=exportObj.chassis[n.chassis])?A.display_name:void 0)?A:n.chassis}:</strong> `+exportObj.chassis[n.chassis].text:""),e.find("p.info-maneuvers").show(),e.find("p.info-maneuvers").html(this.getManeuverTableHTML(n.maneuvers,n.maneuvers)),A=(()=>{for(var t=n.sources,i=[],e=0,a=t.length;e<a;e++)I=t[e],i.push(exportObj.translate("sources",I));return i})().sort(),e.find(".info-sources.info-data").text(1<A.length||(q=exportObj.translate("sources","Loose Ships"),!(0<=indexOf.call(A,q)))?0<A.length?A.join(", "):exportObj.translate("ui","unreleased"):this.uitranslation("Only available from 1st edition")),e.find(".info-sources").show();break;case"Pilot":if(e.find(".info-type").text(exportObj.translate("types",t)),e.find(".info-sources.info-data").text((()=>{for(var t=n.sources,i=[],e=0,a=t.length;e<a;e++)I=t[e],i.push(exportObj.translate("sources",I));return i})().sort().join(", ")),e.find(".info-sources").show(),null!=(null!=(q=this.collection)?q.counts:void 0)?(q=null!=(A=null!=(A=this.collection.counts)&&null!=(q=A.pilot)?q[n.name]:void 0)?A:0,T=null!=(A=null!=(A=this.collection.counts.ship)?A[n.ship]:void 0)?A:0,e.find(".info-collection").text(this.uitranslation("collectionContentShipsAndPilots",T,q)),e.find(".info-collection").show()):e.find(".info-collection").hide(),null!=(null!=i?i.effectiveStats:void 0)&&(O=i.effectiveStats()),null!=n.unique)U="&middot;&nbsp;";else if(null!=n.max_per_squad){for(o=0,U="";o<n.max_per_squad;)U=U.concat("&middot;"),++o;U=U.concat("&nbsp;")}else U="";if(e.find(".info-name").html(""+U+(n.display_name||n.name)+(exportObj.isReleased(n)?"":` (${exportObj.translate("ui","unreleased")})`)),""!==(S=this.restriction_text(n)+this.upgrade_effect(n))&&"Conversion"!==n.ship?(e.find("p.info-restrictions").html(S),e.find("p.info-restrictions").show()):e.find("p.info-restrictions").hide(),e.find("p.info-text").html(null!=(A=n.text)?A:""),e.find("p.info-text").show(),j=exportObj.ships[n.ship],""!==(T=null!=(null!=O?O.chassis:void 0)&&""!==O.chassis?O.chassis:null!=n.chassis?n.chassis:null!=j.chassis?j.chassis:"")?(e.find("p.info-chassis").html(`<strong>${null!=(A=null!=(q=exportObj.chassis[T])?q.display_name:void 0)?A:T}:</strong> `+exportObj.chassis[T].text),e.find("p.info-chassis").show()):e.find("p.info-chassis").hide(),e.find("tr.info-ship td.info-data").text(n.ship),e.find("tr.info-ship").show(),e.find("tr.info-faction td.info-data").text(exportObj.translate("faction",n.faction)),e.find("tr.info-faction").hide(),null!=j.base?e.find("tr.info-base td.info-data").text(exportObj.translate("gameterms",j.base)):e.find("tr.info-base td.info-data").text(exportObj.translate("gameterms","Small")),e.find("tr.info-base").show(),e.find("tr.info-skill td.info-data").text(n.skill),e.find("tr.info-skill").toggle(null!=n.skill),e.find("tr.info-points td.info-data").text(this.isXwa&&null!=n.pointsxwa?n.pointsxwa:n.points),e.find("tr.info-points").show(),e.find("tr.info-loadout td.info-data").text(this.isXwa&&null!=n.loadoutxwa?n.loadoutxwa:n.loadout),null!=n.upgrades?e.find("tr.info-loadout").hide():e.find("tr.info-loadout").show(),null!=n.engagement?(e.find("tr.info-engagement td.info-data").text(n.engagement),e.find("tr.info-engagement").show()):e.find("tr.info-engagement").hide(),e.find("tr.info-attack td.info-header i.xwing-miniatures-font").addClass(null!=(q=j.attack_icon)?q:"xwing-miniatures-font-attack"),e.find("tr.info-attack td.info-data").text(statAndEffectiveStat(null!=(T=null!=(A=n.ship_override)?A.attack:void 0)?T:j.attack,O,"attack")),e.find("tr.info-attack").toggle(0<(null!=(A=null!=(q=n.ship_override)?q.attack:void 0)?A:j.attack)||null!=(null!=O?O.attack:void 0)&&0<(null!=O?O.attack:void 0)),e.find("tr.info-attack-fullfront td.info-data").text(statAndEffectiveStat(null!=(q=null!=(T=n.ship_override)?T.attackf:void 0)?q:j.attackf,O,"attackf")),e.find("tr.info-attack-fullfront").toggle(null!=j.attackf||null!=(null!=O?O.attackf:void 0)),e.find("tr.info-attack-bullseye td.info-data").text(statAndEffectiveStat(null!=(T=null!=(A=n.ship_override)?A.attackbull:void 0)?T:j.attackbull,O,"attackbull")),e.find("tr.info-attack-bullseye").toggle(null!=j.attackbull||null!=(null!=O?O.attackbull:void 0)),e.find("tr.info-attack-left td.info-data").text(statAndEffectiveStat(null!=(A=null!=(q=n.ship_override)?q.attackl:void 0)?A:j.attackl,O,"attackl")),e.find("tr.info-attack-left").toggle(null!=j.attackl||null!=(null!=O?O.attackl:void 0)),e.find("tr.info-attack-right td.info-data").text(statAndEffectiveStat(null!=(q=null!=(T=n.ship_override)?T.attackr:void 0)?q:j.attackr,O,"attackr")),e.find("tr.info-attack-right").toggle(null!=j.attackr||null!=(null!=O?O.attackr:void 0)),e.find("tr.info-attack-back td.info-data").text(statAndEffectiveStat(null!=(T=null!=(A=n.ship_override)?A.attackb:void 0)?T:j.attackb,O,"attackb")),e.find("tr.info-attack-back").toggle(null!=j.attackb||null!=(null!=O?O.attackb:void 0)),e.find("tr.info-attack-turret td.info-data").text(statAndEffectiveStat(null!=(A=null!=(q=n.ship_override)?q.attackt:void 0)?A:j.attackt,O,"attackt")),e.find("tr.info-attack-turret").toggle(null!=(null!=(T=n.ship_override)?T.attackt:void 0)||null!=j.attackt||null!=(null!=O?O.attackt:void 0)),e.find("tr.info-attack-doubleturret td.info-data").text(statAndEffectiveStat(null!=(A=null!=(q=n.ship_override)?q.attackdt:void 0)?A:j.attackdt,O,"attackdt")),e.find("tr.info-attack-doubleturret").toggle(null!=j.attackdt||null!=(null!=O?O.attackdt:void 0)),e.find("tr.info-range").hide(),e.find("td.info-rangebonus").hide(),e.find("tr.info-agility td.info-data").text(statAndEffectiveStat(null!=(q=null!=(T=n.ship_override)?T.agility:void 0)?q:j.agility,O,"agility")),e.find("tr.info-agility").toggle(null!=(null!=(A=n.ship_override)?A.agility:void 0)||null!=j.agility),e.find("tr.info-hull td.info-data").text(statAndEffectiveStat(null!=(q=null!=(T=n.ship_override)?T.hull:void 0)?q:j.hull,O,"hull")),e.find("tr.info-hull").toggle(null!=(null!=(A=n.ship_override)?A.hull:void 0)||null!=j.hull),y="",null!=j.shieldrecurr)for(o=0;o<j.shieldrecurr;)y+='<sup><i class="fas fa-caret-up"></i></sup>',++o;if(e.find("tr.info-shields td.info-data").html(statAndEffectiveStat(null!=(q=null!=(T=n.ship_override)?T.shields:void 0)?q:j.shields,O,"shields")+y),e.find("tr.info-shields").toggle(null!=(null!=(A=n.ship_override)?A.shields:void 0)||null!=j.shields),y="",null!=j.energyrecurr)for(o=0;o<j.energyrecurr;)y+='<sup><i class="fas fa-caret-up"></i></sup>',++o;if(e.find("tr.info-energy td.info-data").html(statAndEffectiveStat(null!=(q=null!=(T=n.ship_override)?T.energy:void 0)?q:j.energy,O,"energy")+y),e.find("tr.info-energy").toggle(null!=(null!=(A=n.ship_override)?A.energy:void 0)||null!=j.energy),null!=(null!=O?O.force:void 0)&&0<O.force||null!=n.force){for(y="",d=1,null!=(null!=O?O.forcerecurring:void 0)?d=O.forcerecurring:null!=n.forcerecurring&&(d=n.forcerecurring),o=0;o<d;)y+='<sup><i class="fas fa-caret-up"></i></sup>',++o;e.find("tr.info-force td.info-data").html(statAndEffectiveStat(null!=(q=null!=(T=n.ship_override)?T.force:void 0)?q:n.force,O,"force")+y),e.find("tr.info-force").show()}else e.find("tr.info-force").hide();if(null!=n.charge){if(y="",null!=n.recurring)if(0<n.recurring)for(o=0;o<n.recurring;)y+='<sup><i class="fas fa-caret-up"></i></sup>',++o;else for(o=n.recurring;o<0;)y+='<sub><i class="fas fa-caret-down"></i></sub>',++o;l=$.trim(""+n.charge+y),e.find("tr.info-charge td.info-data").html(l),e.find("tr.info-charge").show()}else e.find("tr.info-charge").hide();null!=(null!=O?O.actions:void 0)?e.find("tr.info-actions td.info-data").html(this.formatActions(null!=(T=null!=(A=n.ship_override)?A.actions:void 0)?T:O.actions,", ")):e.find("tr.info-actions td.info-data").html(this.formatActions(null!=(A=null!=(q=n.ship_override)?q.actions:void 0)?A:j.actions,", ",null!=(T=n.keyword)?T:[])),e.find("tr.info-actions").show(),this.isQuickbuild?e.find("tr.info-upgrades").hide():(e.find("tr.info-upgrades").show(),this.isXwa&&null!=n.slotsxwa?e.find("tr.info-upgrades td.info-data").html(null!=n.slotsxwa?(()=>{for(var t=n.slotsxwa,i=[],e=0,a=t.length;e<a;e++)C=t[e],i.push(exportObj.translate("sloticon",C));return i})().join(" "):null!=n.upgrades?this.listStandardUpgrades(n.upgrades):"None"):e.find("tr.info-upgrades td.info-data").html(null!=n.slots?(()=>{for(var t=n.slots,i=[],e=0,a=t.length;e<a;e++)C=t[e],i.push(exportObj.translate("sloticon",C));return i})().join(" "):null!=n.upgrades?this.listStandardUpgrades(n.upgrades):"None")),e.find("p.info-maneuvers").show(),T=null!=(A=null!=(q=n.ship_override)?q.maneuvers:void 0)?A:j.maneuvers,e.find("p.info-maneuvers").html(this.getManeuverTableHTML(null!=(q=null!=O?O.maneuvers:void 0)?q:T,T));break;case"Quickbuild":if(e.find(".info-type").text(this.uitranslation("Quickbuild")),e.find(".info-sources").hide(),e.find(".info-collection").hide(),b=exportObj.pilots[n.pilot],j=exportObj.ships[n.ship],null!=b.unique)U="&middot;&nbsp;";else if(null!=b.max_per_squad){for(o=0,U="";o<n.max_per_squad;)U=U.concat("&middot;"),++o;U=U.concat("&nbsp;")}else U="";if(e.find(".info-name").html(""+U+(b.display_name||b.name)+(null!=n.suffix?n.suffix:"")+(exportObj.isReleased(b)?"":` (${exportObj.translate("ui","unreleased")})`)),""!==(S=this.restriction_text(n)+this.upgrade_effect(n))?(e.find("p.info-restrictions").html(null!=S?S:""),e.find("p.info-restrictions").show()):e.find("p.info-restrictions").hide(),e.find("p.info-text").html(null!=(A=b.text)?A:""),e.find("p.info-text").show(),e.find("p.info-chassis").html(null!=b.chassis?`<strong>${null!=(T=null!=(q=exportObj.chassis[b.chassis])?q.display_name:void 0)?T:b.chassis}:</strong> `+exportObj.chassis[b.chassis].text:null!=j.chassis?`<strong>${j.chassis}:</strong> `+exportObj.chassis[j.chassis].text:""),e.find("p.info-chassis").show(),e.find("tr.info-ship td.info-data").text(n.ship),e.find("tr.info-ship").show(),e.find("tr.info-faction td.info-data").text(exportObj.translate("faction",n.faction)),e.find("tr.info-faction").hide(),null!=j.base?e.find("tr.info-base td.info-data").text(exportObj.translate("gameterms",j.base)):e.find("tr.info-base td.info-data").text(exportObj.translate("gameterms","Small")),e.find("tr.info-base").show(),e.find("tr.info-skill td.info-data").text(b.skill),e.find("tr.info-skill").show(),e.find("tr.info-points").hide(),e.find("tr.info-loadout").hide(),e.find("tr.info-engagement td.info-data").text(b.skill),e.find("tr.info-engagement").show(),e.find("tr.info-attack td.info-data").text(null!=(q=null!=(A=b.ship_override)?A.attack:void 0)?q:j.attack),e.find("tr.info-attack").toggle(0<(null!=(A=null!=(T=b.data.ship_override)?T.attack:void 0)?A:j.attack)),e.find("tr.info-attack-fullfront td.info-data").text(j.attackf),e.find("tr.info-attack-fullfront").toggle(null!=j.attackf),e.find("tr.info-attack-bullseye td.info-data").text(j.attackbull),e.find("tr.info-attack-bullseye").toggle(null!=j.attackbull),e.find("tr.info-attack-left td.info-data").text(j.attackl),e.find("tr.info-attack-left").toggle(null!=j.attackl),e.find("tr.info-attack-right td.info-data").text(j.attackr),e.find("tr.info-attack-right").toggle(null!=j.attackr),e.find("tr.info-attack-back td.info-data").text(j.attackb),e.find("tr.info-attack-back").toggle(null!=j.attackb),e.find("tr.info-attack-turret td.info-data").text(j.attackt),e.find("tr.info-attack-turret").toggle(null!=j.attackt),e.find("tr.info-attack-doubleturret td.info-data").text(j.attackdt),e.find("tr.info-attack-doubleturret").toggle(null!=j.attackdt),e.find("tr.info-attack td.info-header i.xwing-miniatures-font").addClass(null!=(q=j.attack_icon)?q:"xwing-miniatures-font-frontarc"),e.find("tr.info-energy td.info-data").text(null!=(A=null!=(T=b.ship_override)?T.energy:void 0)?A:j.energy),e.find("tr.info-energy").toggle(null!=(null!=(q=b.ship_override)?q.energy:void 0)||null!=j.energy),e.find("tr.info-range").hide(),e.find("td.info-rangebonus").hide(),e.find("tr.info-agility td.info-data").text(null!=(A=null!=(T=b.ship_override)?T.agility:void 0)?A:j.agility),e.find("tr.info-agility").show(),e.find("tr.info-hull td.info-data").text(null!=(T=null!=(q=b.ship_override)?q.hull:void 0)?T:j.hull),e.find("tr.info-hull").show(),e.find("tr.info-shields td.info-data").text(null!=(q=null!=(A=b.ship_override)?A.shields:void 0)?q:j.shields),e.find("tr.info-shields").show(),null!=(null!=O?O.force:void 0)||null!=n.force){for(y="",d=1,null!=(null!=O?O.forcerecurring:void 0)&&(d=O.forcerecurring),o=0;o<d;)y+='<sup><i class="fas fa-caret-up"></i></sup>',++o;e.find("tr.info-force td.info-data").html((null!=(A=null!=(T=b.ship_override)?T.force:void 0)?A:b.force)+y),e.find("tr.info-force").show()}else e.find("tr.info-force").hide();if(null!=n.charge){if(y="",null!=n.recurring)if(0<n.recurring)for(o=0;o<n.recurring;)y+='<sup><i class="fas fa-caret-up"></i></sup>',++o;else for(o=n.recurring;o<0;)y+='<sub><i class="fas fa-caret-down"></i></sub>',++o;l=$.trim(""+n.charge+y),e.find("tr.info-charge td.info-data").html(l),e.find("tr.info-charge").show()}else e.find("tr.info-charge").hide();e.find("tr.info-actions td.info-data").html(this.formatActions(null!=(O=null!=(q=b.ship_override)?q.actions:void 0)?O:exportObj.ships[n.ship].actions,", ",null!=(T=b.keyword)?T:[])),e.find("tr.info-actions").show(),e.find("tr.info-upgrades").show(),e.find("tr.info-upgrades td.info-data").html((()=>{for(var t,i=null!=(t=n.upgrades)?t:[],e=[],a=0,s=i.length;a<s;a++)E=i[a],e.push(null!=exportObj.upgrades[E].display_name?exportObj.upgrades[E].display_name:E);return e})().join(", ")||"None"),e.find("p.info-maneuvers").show(),e.find("p.info-maneuvers").html(this.getManeuverTableHTML(j.maneuvers,j.maneuvers));break;case"Addon":if(e.find(".info-type").text(exportObj.translate("slot",i.addon_type)),null!=n.standard?(X=this.getPilotsMatchingUpgrade(n.name,!1),e.find(".info-sources.info-data").text((()=>{for(var t=[],i=0,e=X.length;i<e;i++)b=X[i],t.push(b.display_name);return t})().sort().join(", "))):e.find(".info-sources.info-data").text((()=>{for(var t=n.sources,i=[],e=0,a=t.length;e<a;e++)I=t[e],i.push(exportObj.translate("sources",I));return i})().sort().join(", ")),e.find(".info-sources").show(),null!=n.unique)U="&middot;&nbsp;";else if(null!=n.max_per_squad){for(o=0,U="";o<n.max_per_squad;)U=U.concat("&middot;"),++o;U=U.concat("&nbsp;")}else U="";if(null!=(null!=(A=this.collection)?A.counts:void 0)&&null==n.standard?(s=null!=(T=null!=(q=this.collection.counts)&&null!=(O=q.upgrade)?O[n.name]:void 0)?T:0,e.find(".info-collection").text(this.uitranslation("collectionContentUpgrades",s)),e.find(".info-collection").show()):e.find(".info-collection").hide(),e.find(".info-name").html(""+U+(n.display_name||n.name)+(exportObj.isReleased(n)||null!=n.standard?"":` (${this.uitranslation("unreleased")})`)+(null!=n.standard?" (S)":"")),v=this.isXwa&&null!=n.pointsxwa?n.pointsxwa:n.points,Array.isArray(v)){switch(g="<i>"+this.uitranslation("varPointCostsPoints",v),n.variablepoints){case"Agility":g+=this.uitranslation("varPointCostsConditionAgility",function(){for(var t=[],i=0,e=v.length-1;0<=e?i<=e:e<=i;0<=e?i++:i--)t.push(i);return t}.apply(this));break;case"Initiative":g+=this.uitranslation("varPointCostsConditionIni",function(){for(var t=[],i=0,e=v.length-1;0<=e?i<=e:e<=i;0<=e?i++:i--)t.push(i);return t}.apply(this));break;case"Base":g+=this.uitranslation("varPointCostsConditionBase");break;case"Faction":g+=this.uitranslation("varPointCostsConditionFaction",n.faction)}g+="</i>"}if(S=this.restriction_text(n)+this.upgrade_effect(n),null!=g||""!==S?(null!=g&&""!==S&&(g+="<br/>"),e.find("p.info-restrictions").html((null!=g?g:"")+S),e.find("p.info-restrictions").show()):e.find("p.info-restrictions").hide(),e.find("p.info-text").html(null!=(A=n.text)?A:""),e.find("p.info-text").show(),e.find("p.info-chassis").hide(),e.find("tr.info-ship").hide(),e.find("tr.info-faction").hide(),e.find("tr.info-base").hide(),e.find("tr.info-skill").hide(),e.find("tr.info-points").hide(),e.find("tr.info-loadout").hide(),e.find("tr.info-engagement").hide(),null!=n.energy?(e.find("tr.info-energy td.info-data").text(n.energy),e.find("tr.info-energy").show()):e.find("tr.info-energy").hide(),null!=n.attack?(e.find("tr.info-attack td.info-data").text(n.attack),e.find("tr.info-attack").show()):e.find("tr.info-attack").hide(),null!=n.attackb?(e.find("tr.info-attack-back td.info-data").text(n.attackb),e.find("tr.info-attack-back").show()):e.find("tr.info-attack-back").hide(),null!=n.attackt?(e.find("tr.info-attack-turret td.info-data").text(n.attackt),e.find("tr.info-attack-turret").show()):e.find("tr.info-attack-turret").hide(),null!=n.attackr?(e.find("tr.info-attack-right td.info-data").text(n.attackr),e.find("tr.info-attack-right").show()):e.find("tr.info-attack-right").hide(),null!=n.attackl?(e.find("tr.info-attack-left td.info-data").text(n.attackl),e.find("tr.info-attack-left").show()):e.find("tr.info-attack-left").hide(),null!=n.attackdt?(e.find("tr.info-attack-doubleturret td.info-data").text(n.attackdt),e.find("tr.info-attack-doubleturret").show()):e.find("tr.info-attack-doubleturret").hide(),null!=n.attackbull?(e.find("tr.info-attack-bullseye td.info-data").text(n.attackbull),e.find("tr.info-attack-bullseye").show()):e.find("tr.info-attack-bullseye").hide(),null!=n.attackf?(e.find("tr.info-attack-fullfront td.info-data").text(n.attackf),e.find("tr.info-attack-fullfront").show()):e.find("tr.info-attack-fullfront").hide(),null!=n.charge){if(y="",null!=n.recurring)if(0<n.recurring)for(o=0;o<n.recurring;)y+='<sup><i class="fas fa-caret-up"></i></sup>',++o;else for(o=n.recurring;o<0;)y+='<sub><i class="fas fa-caret-down"></i></sub>',++o;l=$.trim(""+n.charge+y),e.find("tr.info-charge td.info-data").html(l)}if(e.find("tr.info-charge").toggle(null!=n.charge),null!=n.range?(e.find("tr.info-range td.info-data").text(n.range),e.find("tr.info-range").show()):e.find("tr.info-range").hide(),null!=n.rangebonus?e.find("td.info-rangebonus").show():e.find("td.info-rangebonus").hide(),null!=n.force){for(y="",d=1,null!=n.forcerecurring&&(d=n.forcerecurring),o=0;o<d;)y+='<sup><i class="fas fa-caret-up"></i></sup>',++o;e.find("tr.info-force td.info-data").html(n.force+y)}e.find("tr.info-force").toggle(null!=n.force),e.find("tr.info-agility").hide(),e.find("tr.info-hull").hide(),e.find("tr.info-shields").hide(),e.find("tr.info-actions").hide(),e.find("tr.info-upgrades").hide(),e.find("p.info-maneuvers").hide();break;case"Rules":e.find(".info-type").hide(),e.find(".info-sources").hide(),e.find(".info-collection").hide(),e.find(".info-name").html(n.name),e.find(".info-name").show(),e.find("p.info-restrictions").hide(),e.find("p.info-text").html(n.text),e.find("p.info-text").show(),e.find("tr.info-ship").hide(),e.find("tr.info-faction").hide(),e.find("tr.info-base").hide(),e.find("tr.info-skill").hide(),e.find("tr.info-points").hide(),e.find("tr.info-loadout").hide(),e.find("tr.info-agility").hide(),e.find("tr.info-hull").hide(),e.find("tr.info-shields").hide(),e.find("tr.info-actions").hide(),e.find("tr.info-upgrades").hide(),e.find("p.info-maneuvers").hide(),e.find("tr.info-energy").hide(),e.find("tr.info-attack").hide(),e.find("tr.info-attack-turret").hide(),e.find("tr.info-attack-bullseye").hide(),e.find("tr.info-attack-fullfront").hide(),e.find("tr.info-attack-back").hide(),e.find("tr.info-attack-doubleturret").hide(),e.find("tr.info-charge").hide(),e.find("td.info-rangebonus").hide(),e.find("tr.info-range").hide(),e.find("tr.info-force").hide();break;case"MissingStuff":for(e.find(".info-type").text(this.uitranslation("List of Missing items")),e.find(".info-sources").hide(),e.find(".info-collection").hide(),e.find(".info-name").html(this.uitranslation("Missing items")),e.find(".info-name").show(),m=this.uitranslation("Missing Item List:")+"<ul>",f=0,R=n.length;f<R;f++){for(m+=`<li><strong>${null!=(u=n[f]).display_name?u.display_name:u.name}</strong> (`,r=!0,_=0,F=(V=u.sources).length;_<F;_++)r||(m+=", "),m+=I=V[_],r=!1;m+=")</li>"}m+="</ul>",e.find("p.info-restrictions").hide(),e.find("p.info-text").html(m),e.find("p.info-text").show(),e.find("tr.info-ship").hide(),e.find("tr.info-faction").hide(),e.find("tr.info-base").hide(),e.find("tr.info-skill").hide(),e.find("tr.info-points").hide(),e.find("tr.info-loadout").hide(),e.find("tr.info-agility").hide(),e.find("tr.info-hull").hide(),e.find("tr.info-shields").hide(),e.find("tr.info-actions").hide(),e.find("tr.info-upgrades").hide(),e.find("p.info-maneuvers").hide(),e.find("tr.info-energy").hide(),e.find("tr.info-attack").hide(),e.find("tr.info-attack-turret").hide(),e.find("tr.info-attack-bullseye").hide(),e.find("tr.info-attack-fullfront").hide(),e.find("tr.info-attack-back").hide(),e.find("tr.info-attack-doubleturret").hide(),e.find("tr.info-charge").hide(),e.find("td.info-rangebonus").hide(),e.find("tr.info-range").hide(),e.find("tr.info-force").hide();break;case"Damage":e.find(".info-type").text(exportObj.translate("types",n.type)),e.find(".info-sources.info-data").text((()=>{for(var t=n.sources,i=[],e=0,a=t.length;e<a;e++)I=t[e],i.push(exportObj.translate("sources",I));return i})().sort().join(", ")),e.find(".info-sources").show(),null!=(null!=(q=this.collection)?q.counts:void 0)?(s=null!=(S=null!=(O=this.collection.counts)&&null!=(T=O.damage)?T[n.name]:void 0)?S:0,e.find(".info-collection").text(this.uitranslation("collectionContentUpgrades",s)),e.find(".info-collection").show()):e.find(".info-collection").hide(),e.find(".info-name").html(`${n.display_name||n.name} (${n.quantity}x)`),e.find("p.info-restrictions").hide(),e.find("p.info-text").html(null!=(A=n.text)?A:""),e.find("p.info-text").show(),e.find("p.info-chassis").hide(),e.find("tr.info-ship").hide(),e.find("tr.info-faction").hide(),e.find("tr.info-base").hide(),e.find("tr.info-skill").hide(),e.find("tr.info-points").hide(),e.find("tr.info-loadout").hide(),e.find("tr.info-engagement").hide(),e.find("tr.info-energy").hide(),e.find("tr.info-attack").hide(),e.find("tr.info-attack-back").hide(),e.find("tr.info-attack-turret").hide(),e.find("tr.info-attack-right").hide(),e.find("tr.info-attack-left").hide(),e.find("tr.info-attack-doubleturret").hide(),e.find("tr.info-attack-bullseye").hide(),e.find("tr.info-attack-fullfront").hide(),e.find("tr.info-charge").hide(),e.find("tr.info-range").hide(),e.find("td.info-rangebonus").hide(),e.find("tr.info-force").hide(),e.find("tr.info-agility").hide(),e.find("tr.info-hull").hide(),e.find("tr.info-shields").hide(),e.find("tr.info-actions").hide(),e.find("tr.info-upgrades").hide(),e.find("p.info-maneuvers").hide()}if(e!==this.mobile_tooltip_modal&&(e.find(".info-well").show(),e.find(".intro").hide()),this.tooltip_currently_displaying=n,768<=$(window).width())return a=e.find(".info-well"),$.isElementInView(a,!0)?a.css("position","fixed"):a.css("position","static")}}async _randomizerLoopBody(s){var n,t,i,e,a,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k,w;if(s.keep_running){if(this.total_points===s.max_points){if(s.keep_running=!1,this.isQuickbuild)return void(s.keep_running=!1);for(e=0,l=(f=this.ships).length;e<l;e++)if(i=[],null!=(v=f[e]).pilot.loadout&&null==v.pilot.upgrades)for(;v.upgrade_points_total<v.pilot.loadout;){for(k=[],a=0,o=(m=v.upgrades).length;a<o;a++)null!=(w=m[a]).data||null!=w.occupied_by&&null!==w.occupied_by||0<=indexOf.call(i,w)||k.push(w);if(0===k.length)break;n=k[$.randomInt(k.length)],0<(t=function(){for(var t=this.getAvailableUpgradesIncluding(n.slot,null,v,n,"",this.dfl_filter_func,!1),i=[],e=0,a=t.length;e<a;e++)w=t[e],!exportObj.upgradesById[w.id].sources.intersects(s.allowed_sources)||s.collection_only&&!this.collection.checkShelf("upgrade",w.name)||w.disabled||i.push(w);return i}.call(this)).length?(w=t[$.randomInt(t.length)],await n.setById(w.id)):i.push(n)}}else if(this.total_points<s.max_points){if(0<(x=0===(x=this.getAvailableShipsMatchingAndCheapEnough(s.max_points-this.total_points,"",!1,s.collection_only)).length?this.getAvailableShipsMatching("",!1,s.collection_only):x).length&&(this.ships.length<s.ship_limit||0===s.ship_limit)){if(x=x[$.randomInt(x.length)].name,0===(x=this.getAvailablePilotsForShipIncluding(x)).length)return;(x=x[$.randomInt(x.length)]).disabled||!(this.isQuickbuild?exportObj.pilots[exportObj.quickbuildsById[x.id].pilot]:exportObj.pilotsById[x.id]).sources.intersects(s.allowed_sources)||s.collection_only&&!this.collection.checkShelf("pilot",this.isQuickbuild?exportObj.quickbuildsById[x.id]:x.name)||this.addShip().setPilotById(x.id)}}else this.removeShip(this.ships[$.randomInt(this.ships.length)]);return window.setTimeout(this._makeRandomizerLoopFunc(s),0)}for(;this.total_points>s.max_points;)this.removeShip(this.ships[$.randomInt(this.ships.length)]);if(s.fill_zero_pts)for(u=0,r=(_=this.ships).length;u<r;u++)for(h=0,d=(b=(v=_[u]).upgrades).length;h<d;h++)null!=(n=b[h]).data||null!=n.occupied_by&&null!==n.occupied_by||(w=0<(t=function(){for(var t=this.getAvailableUpgradesIncluding(n.slot,null,n.ship,n,"",this.dfl_filter_func,!1),i=[],e=0,a=t.length;e<a;e++)w=t[e],exportObj.upgradesById[w.id].sources.intersects(s.allowed_sources)&&w.points<1&&(!s.collection_only||this.collection.checkShelf("upgrade",w.name))&&i.push(w);return i}.call(this)).length?t[$.randomInt(t.length)]:void 0)&&!w.disabled&&n.setById(w.id);for(window.clearTimeout(s.timer),p=0,c=(g=this.ships).length;p<c;p++)(v=g[p]).updateSelections();return this.suppress_automatic_new_ship=!1,this.addShip()}_makeRandomizerLoopFunc(t){return()=>this._randomizerLoopBody(t)}randomSquad(t=200,i=null,e=1e3,a=0,s=!0,n=!1){var l;for(this.backend_status.fadeOut("slow"),this.suppress_automatic_new_ship=!0,i.length<1&&(i=null);0<this.ships.length;)this.removeShip(this.ships[0]);if(0<this.ships.length)throw new Error("Ships not emptied");return(l={max_points:t,ship_limit:a,keep_running:!0,allowed_sources:null!=i?i:exportObj.expansions,collection_only:null!=this.collection&&"true"===this.collection.checks.collectioncheck&&s,fill_zero_pts:n}).timer=window.setTimeout(()=>l.keep_running=!1,e),window.setTimeout(this._makeRandomizerLoopFunc(l),0),this.resetCurrentSquad(),this.current_squad.name=this.uitranslation("Random Squad"),this.container.trigger("xwing-backend:squadNameChanged")}setBackend(t){var i,e,a,s,n;if(this.backend=t,null!=this.waiting_for_backend){for(n=[],i=0,e=(s=this.waiting_for_backend).length;i<e;i++)a=s[i],n.push(a());return n}}upgrade_effect(t){var i,e,a,s,n,l,o,r,d,c,u=c=e="";if(t.modifier_func&&(t.modifier_func(d={attack:0,attackf:0,attackbull:0,attackb:0,attackt:0,attackl:0,attackr:0,attackdt:0,energy:0,agility:0,hull:0,shields:0,force:0,actions:[],maneuvers:[0,0]}),0!==d.attack&&(c+=e+`%FRONTARC% (${d.attack})`,e=", "),0!==d.attackf&&(c+=e+`%FULLFRONTARC% (${d.attackf})`,e=", "),0!==d.attackbull&&(c+=e+`%BULLSEYEARC% (${d.attackbull})`,e=", "),0!==d.attackb&&(c+=e+`%REARARC% (${d.attackb})`,e=", "),0!==d.attackt&&(c+=e+`%SINGLETURRETARC% (${d.attackt})`,e=", "),0!==d.attackl&&(c+=e+`%LEFTARC% (${d.attackl})`,e=", "),0!==d.attackr&&(c+=e+`%RIGHTARC% (${d.attackr})`,e=", "),0!==d.attackdt&&(c+=e+`%DOUBLETURRETARC% (${d.attackdt})`,e=", "),0!==d.energy&&(c+=e+`%ENERGY% (${d.energy})`,e=", "),0!==d.agility&&(c+=e+`%AGILITY% (${d.agility})`,e=", "),0!==d.hull&&(c+=e+`%HULL% (${d.hull})`,e=", "),0!==d.shields&&(c+=e+`%SHIELD% (${d.shields})`,e=", "),0<d.actions.length)&&(c+=e+this.formatActions(d.actions,", "),e=", "),t.confersAddons)for(a=0,n=(o=t.confersAddons).length;a<n;a++)"Force"===(i=o[a]).slot?c+=e+"%FORCEPOWER%":c+=e+`%${i.slot.toUpperCase().replace(/[^a-z0-9]/gi,"")}%`,e=", ";if(t.unequips_upgrades)for(e="",s=0,l=(r=t.unequips_upgrades).length;s<l;s++)u+=e+`%${r[s].toUpperCase().replace(/[^a-z0-9]/gi,"")}%`,e=", ";return""!==c?(d={text:`</br><b>${this.uitranslation("adds",c)}</b>`},""!==u&&(d.text+=`</br><b>${this.uitranslation("removes",u)}</b>`),exportObj.fixIcons(d)):""}restriction_text(t){var i,e,a,s,n,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x=s=m=v="",k=!1,w=null!=t.standardized;if(this.isXwa&&null!=t.standardizedxwa&&(w=t.standardizedxwa),null!=t.restrictions&&(a=t.restrictions),null!=(a=this.isXwa&&null!=t.restrictionsxwa?t.restrictionsxwa:a))for(o=0,d=a.length;o<d;o++){switch((_=a[o])[0]){case"FactionOrUnique":m+=s+exportObj.translate("faction",""+_[2]),x=exportObj.translate("restrictions"," or Squad Including")+(" "+_[1]);break;case"Base":for(l=r=0,c=_.length;r<c;l=++r)"Base"===(e=_[l])?v+=s:(v+=e+" ",l<_.length-1?v+="or ":v+=exportObj.translate("restrictions","Ship"));break;case"Action":i=[_[1]],v+=s+this.formatActions(i,"",[]);break;case"Equipped":v+=s+`%${_[1].toUpperCase().replace(/[^a-z0-9]/gi,"")}% Equipped`;break;case"Slot":v+=s+exportObj.translate("restrictions","Extra")+` %${_[1].toUpperCase().replace(/[^a-z0-9]/gi,"")}%`;break;case"Keyword":v+=s+exportObj.translate("restrictions",""+_[1]),k=!0;break;case"AttackArc":v+=s+"%REARARC%";break;case"ShieldsGreaterThan":v+=s+("%SHIELD% > "+_[1]);break;case"EnergyGreatterThan":v+=s+("%ENERGY% > "+_[1]);break;case"InitiativeGreaterThan":v+=s+exportObj.translate("restrictions","Initiative")+(" > "+_[1]);break;case"InitiativeLessThan":v+=s+exportObj.translate("restrictions","Initiative")+(" < "+_[1]);break;case"HasForce":v+=s+(_[1]?"":"No ")+"%FORCE%";break;case"AgilityEquals":v+=s+exportObj.translate("restrictions","Agility")+(" = "+_[1]);break;case"isUnique":!0===_[1]?v+=s+exportObj.translate("restrictions","Limited"):v+=s+exportObj.translate("restrictions","Non-Limited");break;case"Format":v+=s+exportObj.translate("restrictions",_[1]+" Ship");break;case"Faction":m+=s+exportObj.translate("faction",""+_[1])}s=", "}if(!t.skill){if(""===m&&t.faction){if(t.faction instanceof Array)for(p=0,u=(b=t.faction).length;p<u;p++)n=b[p],m+=s+exportObj.translate("faction",""+n),s=" or ";else m+=s+exportObj.translate("faction",""+t.faction);s=", "}if(t.ship&&!1===k){if(t.ship instanceof Array)for(f=0,h=(g=t.ship).length;f<h;f++)m+=s+g[f],s=" or ";else m+=s+t.ship;s=", "}t.solitary&&(m+=s+exportObj.translate("gameterms","Solitary"),s=", "),w&&(m+=s+exportObj.translate("gameterms","Standardized"),s=", ")}return""!==(v+=m+x)?(t={text:"<i><b>"+exportObj.translate("restrictions","Restrictions")+":</b> "+v+"</i>"},exportObj.fixIcons(t)):""}describeSquad(){var s;return""===this.getNotes().trim()?function(){for(var t=this.ships,i=[],e=0,a=t.length;e<a;e++)null!=(s=t[e]).pilot&&i.push(s.pilot.name);return i}.call(this).join(", "):this.getNotes()}listCards(){for(var t,i,e,a,s,n={},l=this.ships,o=0,r=l.length;o<r;o++)if(null!=(a=l[o]).pilot)for(n[a.pilot.name]=null,t=0,i=(e=a.upgrades).length;t<i;t++)null!=(s=e[t]).data&&(n[s.data.name]=null);return Object.keys(n).sort()}getNotes(){return this.notes.val()}getTag(){return this.tag.val()}getObstacles(){return this.current_obstacles}isSquadPossibleWithCollection(){var t,i,e,a,s,n,l,o,r,d,c,u,h,p;if(0===Object.keys(null!=(l=null!=(l=this.collection)?l.expansions:void 0)?l:{}).length)return[!0,[]];if("true"!==(null!=(l=this.collection)?l.checks.collectioncheck:void 0))return[!0,[]];for(this.collection.reset(),p=!0,s=[],t=0,e=(o=this.ships).length;t<e;t++)if(null!=(d=o[t]).pilot&&(c=this.collection.use("ship",d.pilot.ship),n=this.collection.use("pilot",d.pilot.name),c&&n||(p=!1),c||s.push(d.data),n||s.push(d.pilot),null==d.pilot.upgrades))for(i=0,a=(r=d.upgrades).length;i<a;i++)null!=(u=r[i]).data&&((h=this.collection.use("upgrade",u.data.name))||null!=u.data.standard||(p=!1),h||null!=u.data.standard||s.push(u.data));return[p,s]}checkCollection(){var i,t;if(null!=this.collection)return[t,i]=this.isSquadPossibleWithCollection(),this.collection_invalid_container.toggleClass("d-none",t),this.collection_invalid_container.on("mouseover",t=>this.showTooltip("MissingStuff",i))}toXWS(){var t,i,e,a,s,n,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k,w,y,$="09/06/2024",q="AMG";for(this.isXwa&&($="R1",q="XWA"),y={description:this.getNotes(),faction:exportObj.toXWSFaction[this.faction],name:this.current_squad.name,pilots:[],points:this.total_points,vendor:{yasb:{builder:"YASB - X-Wing 2.5",builder_url:window.location.href.split("?")[0],link:this.getPermaLink()}},version:$,ruleset:q},i=0,s=(_=this.ships).length;i<s;i++)null!=(x=_[i]).pilot&&y.pilots.push(x.toXWS());for(u={},e=a=0,b=(k=(()=>{for(var t=y.pilots,i=[],e=0,a=t.length;e<a;e++)null!=(f=t[e]).multisection&&i.push(f);return i})()).length**2;(0<=b?e<b:b<e)&&0!==k.length&&(null==(w=k.shift()).multisection_id&&(w.multisection_id=a++),null==u[h=w.multisection_id]&&(u[h]=[w]),0!==k.length);0<=b?++e:--e){for(c=[],r=0,n=k.length;r<n&&(t=k[r],g=w.name,!(0<=indexOf.call(t.multisection,g)&&(c.push(t),w.multisection.removeItem(t.name),t.multisection.removeItem(w.name),t.multisection_id=w.multisection_id,u[t.multisection_id].push(t),0===w.multisection.length)));r++);for(p=0,l=c.length;p<l;p++)0===(d=c[p]).multisection.length&&k.removeItem(d)}for(m=0,o=(v=y.pilots).length;m<o;m++)null!=(f=v[m]).multisection&&delete f.multisection;return null!=($=this.getObstacles())&&0<$.length&&(y.obstacles=$),y}toMinimalXWS(){var t,i,e=this.toXWS();for(t in e)hasProp.call(e,t)&&(e[t],"faction"!==t)&&"pilots"!==t&&"version"!==t&&delete e[t];for(t in i=e.pilots)hasProp.call(i,t)&&(i[t],"id"!==t)&&"upgrades"!==t&&"multisection_id"!==t&&delete e[t];return e}loadFromXWS(s,t){var i,e,a,n,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k,w,y,$,q=null,O=null,S=null!=s.version?(()=>{for(var t=s.version.split("."),i=[],e=0,a=t.length;e<a;e++)y=t[e],i.push(parseInt(y));return i})():[0,2];if(!1==!([0,1]<S||"XWA"===s.ruleset)){if($=exportObj.fromXWSFaction[s.faction],this.faction!==$)throw new Error(`Attempted to load XWS for ${s.faction} but builder is `+this.faction);for(null!=s.name&&(this.current_squad.name=s.name),null!=s.description&&this.notes.val(s.description),null!=s.obstacles&&(this.current_squad.additional_data.obstacles=s.obstacles),this.suppress_automatic_new_ship=!0,this.removeAllShips(),q=!0,O="",i=this.isStandard?"h":this.isEpic?"e":this.isXwa?"b":"s",null!=s.ruleset&&"XWA"===s.ruleset?i="b":null!=s.ruleset&&"AMG"===s.ruleset&&"b"===i&&(i="h"),b="",e=0,l=(p=s.pilots).length;e<l;e++){if(m=p[e],this.addShip(),m.id)c=m.id;else{if(!m.name){q=!1,O="Pilot without identifier";break}c=m.name}if(null!=exportObj.pilotsByFactionXWS[$][c])b+=exportObj.pilotsByFactionXWS[$][c][0].id;else if(exportObj.pilotsByUniqueName[c]&&1===exportObj.pilotsByUniqueName[c].length)b+=exportObj.pilotsByUniqueName[c][0].id;else for(a in f=exportObj.pilotsByUniqueName)for(n=0,o=(h=f[a]).length;n<o;n++)if((u=h[n]).xws&&u.xws===c||!u.xws&&a===c){b+=u.id;break}for(w in exportObj.standardCheck(m,!0)||"h"!==i||(i="s"),b+="X",_=null!=(m=m.upgrades)?m:{})for(d=0,r=(k=_[w]).length;d<r;d++)x=k[d],g=null!=(g=exportObj.fromXWSUpgrade[w])?g:w.capitalize(),null!=x&&(null==(v=null!=(v=exportObj.upgradesBySlotXWSName[g])[x]?v[x]:v[x]=exportObj.upgradesBySlotCanonicalName[g][x])?(console.log("Failed to load xws upgrade: "+x),O+="Skipped upgrade "+x,q=!1):(b=b+v.id+"W",exportObj.standardCheck(v,!0)||"h"!==i||(i="s")));b+="XY"}this.loadFromSerialized(b="v9Z"+i+"Z20Z"+b,()=>(this.current_squad.dirty=!0,this.container.trigger("xwing-backend:squadNameChanged"),this.container.trigger("xwing-backend:squadDirtinessChanged"),t({success:q,error:O})))}else t(q=!1,O="Unsupported XWS version");return t({success:q,error:O})}}return t}.call(this),Ship=class{constructor(t){this.builder=t.builder,this.container=t.container,this.pilot=null,this.data=null,this.quickbuildId=-1,this.linkedShip=null,this.primary=!0,this.upgrades=[],this.upgrade_points_total=0,this.wingmates=[],this.destroystate=0,this.uitranslation=this.builder.uitranslation,this.usesxwaSlots=!1,this.setupUI()}async destroy(t){var i;if(this.resetPilot(),this.resetAddons(),this.teardownUI(),(i=this.builder.ships.indexOf(this))<0)throw new Error("Ship not registered with builder");return this.builder.ships.splice(i,1),0<this.wingmates.length&&this.setWingmates(0),null!==this.linkedShip&&(0<(null!=(i=this.linkedShip.wingmates)?i.length:void 0)&&0<=indexOf.call(this.linkedShip.wingmates,this)?this.linkedShip.removeFromWing(this):(this.linkedShip.linkedShip=null,await new Promise((t,i)=>this.builder.removeShip(this.linkedShip,t)))),t()}async copyFrom(s){var t,i,e,a,n,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k,w,y,$;if(s===this)throw new Error("Cannot copy from self");if(null!=s.pilot&&null!=s.data){if(this.builder.isQuickbuild){if(h=!(s.pilot.unique||null!=s.pilot.max_per_squad&&this.builder.countPilots(s.pilot.canonical_name)>=s.pilot.max_per_squad))for(a=0,l=(b=s.upgrades).length;a<l;a++)(null!=(null!=(g=($=b[a]).data)?g.unique:void 0)&&$.data.unique||null!=(null!=(g=$.data)?g.max_per_squad:void 0)&&this.builder.countUpgrades($.data.canonical_name)>=$.data.max_per_squad||null!=(null!=(g=$.data)?g.solitary:void 0))&&(h=!1);if(h)this.setPilotById(s.quickbuildId);else{if(!(0<(t=function(){for(var t=this.builder.getAvailablePilotsForShipIncluding(s.data.name),i=[],e=0,a=t.length;e<a;e++)(_=t[e]).disabled||i.push(_);return i}.call(this)).length))return;this.setPilotById(t[0].id,!0)}}else{if(s.pilot.unique||null!=s.pilot.max_per_squad&&this.builder.countPilots(s.pilot.canonical_name)>=s.pilot.max_per_squad){if(!(0<(t=function(){for(var t=this.builder.getAvailablePilotsForShipIncluding(s.data.name),i=[],e=0,a=t.length;e<a;e++)(_=t[e]).disabled||i.push(_);return i}.call(this)).length))return;await this.setPilotById(t[0].id,!0)}else await this.setPilotById(s.pilot.id,!0);for(m={},n=0,o=(v=s.upgrades).length;n<o;n++)null==(null!=($=v[n])?$.data:void 0)||$.isStandardized()||null!=$.data.standard||$.data.unique||!(null==$.data.max_per_squad||this.builder.countUpgrades($.data.canonical_name)<$.data.max_per_squad)||(null==m[u=$.slot]&&(m[u]=[]),m[$.slot].push($));for(i={},c=0,r=(x=this.upgrades).length;c<r;c++)($=x[c]).isOccupied()||null!=(f=(null!=(k=m[$.slot])?k:[]).shift())&&(await $.setById(f.data.id),$.lastSetValid||(i[f.data.id]=$));for(e in i)($=i[e]).setById(e);for(p=0,d=(w=this.upgrades).length;p<d;p++)($=w[p]).isOccupied()||null!=(f=(null!=(y=m[$.slot])?y:[]).shift())&&$.setById(f.data.id);this.addStandardizedUpgrades()}return this.updateSelections(),this.builder.container.trigger("xwing:pointsUpdated"),this.builder.current_squad.dirty=!0,this.builder.container.trigger("xwing-backend:squadDirtinessChanged")}}setShipType(n){var t,i,e,a,s,l;for(this.pilot_selector.data("select2").container.show(),n!==(null!=(a=this.pilot)?a.ship:void 0)&&(this.builder.isQuickbuild?(a=function(){for(var t=this.builder.getAvailablePilotsForShipIncluding(n),i=[],e=0,a=t.length;e<a;e++)(l=t[e]).disabled||i.push(l.id);return i}.call(this)[0],this.setPilotById(a)):this.setPilot(function(){for(var t,i=this.builder.getAvailablePilotsForShipIncluding(n),e=[],a=0,s=i.length;a<s;a++)l=i[a],null!=exportObj.pilotsById[l.id].restriction_func&&!exportObj.pilotsById[l.id].restriction_func(this)||(t=exportObj.pilotsById[l.id],0<=indexOf.call(this.builder.uniques_in_use.Pilot,t))||e.push(exportObj.pilotsById[l.id]);return e}.call(this)[0])),this.checkPilotSelectorQueryModal(),i=0,e=(s=this.row.attr("class").split(/\s+/)).length;i<e;i++)0===(t=s[i]).indexOf("ship-")&&this.row.removeClass(t);return this.remove_button.fadeIn("fast"),this.copy_button.fadeIn("fast"),!0===this.builder.show_points_destroyed&&this.points_destroyed_button.fadeIn("fast"),this.builder.container.trigger("xwing:shipUpdated")}async setPilotById(t,i=!1){var e,a,s,n,l,o;if(!this.builder.isQuickbuild)return this.setPilot(exportObj.pilotsById[parseInt(t)],i);if(t!==this.quickbuildId){if(this.wingmate_selector.parent().hide(),null!=this.wingmates&&0<this.wingmates.length&&this.setWingmates(0),this.quickbuildId=t,this.builder.current_squad.dirty=!0,this.resetPilot(),this.resetAddons(),null!=t&&-1<t){if(n=exportObj.quickbuildsById[parseInt(t)],s=exportObj.pilots[n.pilot],this.data=exportObj.ships[n.ship],this.builder.isUpdatingPoints=!0,null!=(null!=s?s.unique:void 0)&&await new Promise((t,i)=>this.builder.container.trigger("xwing:claimUnique",[s,"Pilot",t])),this.pilot=s,null!=this.pilot&&this.setupAddons(),this.copy_button.show(),this.setShipType(this.pilot.ship),null!=n.wingmate&&null==this.linkedShip)for(e=0,a=(l=this.builder.ships).length;e<a;e++)if((o=l[e]).quickbuildId===n.linkedId)return o.joinWing(this),this.linkedShip=o,this.primary=!1,this.builder.isUpdatingPoints=!1,this.builder.container.trigger("xwing:pointsUpdated"),void this.builder.container.trigger("xwing-backend:squadDirtinessChanged");this.linkedShip?null!=n.linkedId?(this.linkedShip.setPilotById(n.linkedId),null==n.wingmate&&(this.linkedShip.primary=!1)):(0<(null!=(i=this.linkedShip.wingmates)?i.length:void 0)?this.linkedShip.removeFromWing(this):(this.linkedShip.linkedShip=null,await new Promise((t,i)=>this.builder.removeShip(this.linkedShip,t))),this.linkedShip=null):null!=n.linkedId&&(this.linkedShip=this.builder.ships.slice(-1)[0],null!==this.linkedShip.data?this.linkedShip=this.builder.addShip():this.builder.addShip(),(this.linkedShip.linkedShip=this).linkedShip.setPilotById(n.linkedId),null==n.wingmate)&&(this.linkedShip.primary=!1),this.primary=null==n.wingmate,null!=(null!=n?n.wingleader:void 0)&&(this.wingmate_selector.parent().show(),this.wingmate_selector.val(n.wingmates[0]),this.wingmate_selector.attr("min",n.wingmates[0]),this.wingmate_selector.attr("max",n.wingmates[n.wingmates.length-1]),this.setWingmates(n.wingmates[0])),this.builder.isUpdatingPoints=!1,this.builder.container.trigger("xwing:pointsUpdated")}else this.copy_button.hide();return this.row.removeClass("unsortable"),this.builder.container.trigger("xwing:pointsUpdated"),this.builder.container.trigger("xwing-backend:squadDirtinessChanged")}}addStandardizedUpgrades(){var t,i,e,a,s,n,l,o,r,d,c,u;if(!this.hasFixedUpgrades&&-1<(t=this.builder.standard_list.Ship.indexOf(null!=(n=this.data)?n.name:void 0))){for(d=(u=this.builder.standard_list.Upgrade[t]).restrictions||void 0,i=0,a=(l=this.upgrades).length;i<a;i++)if((null!=(o=(c=l[i]).data)?o.name:void 0)===u.name)return;for(e=0,s=(r=this.upgrades).length;e<s;e++)if(c=r[e],exportObj.slotsMatching(c.slot,this.builder.standard_list.Upgrade[t].slot)&&this.restriction_check(d,c)&&null==c.data)return void c.setData(u)}}addToStandardizedList(t){var i=this.builder.standard_list.Ship.indexOf(this.data.name);if(!(-1<i&&(null!=(i=this.builder.standard_list.Upgrade[i])?i.name:void 0)===t.name))return this.builder.standard_list.Upgrade.push(t),this.builder.standard_list.Ship.push(this.data.name)}removeStandardizedList(n){var t,i,e,a,s,l,o,r,d=this.builder.standard_list.Ship.indexOf(this.data.name);if(-1<d&&(null!=(e=this.builder.standard_list.Upgrade[d])?e.name:void 0)===n.name){for(this.builder.standard_list.Upgrade.splice(d,1),this.builder.standard_list.Ship.splice(d,1),l=[],t=0,i=(a=this.builder.ships).length;t<i;t++)(null!=(s=(o=a[t]).data)?s.name:void 0)===this.data.name&&o!==this?l.push((()=>{for(var t,i=o.upgrades,e=[],a=0,s=i.length;a<s;a++){if((null!=(t=(r=i[a]).data)?t.name:void 0)===n.name){r.setData(null);break}e.push(void 0)}return e})()):l.push(void 0);return l}}checkStandardizedList(t){var i,t=this.builder.standard_list.Ship.indexOf(t);if(-1<t&&null!=(null!=(i=this.builder.standard_list.Upgrade[t])?i.name:void 0))return this.builder.standard_list.Upgrade[t]}async setPilot(e,t=!1){var i,a,s,n,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k,w,y,$,q,O,S,j,T;if(e!==this.pilot||this.builder.isXwa&&!this.usesxwaSlots&&null!=this.pilot.slotsxwa||this.usesxwaSlots&&!this.builder.isXwa){if(this.builder.current_squad.dirty=!0,_={},($=null!=this.pilot&&(null!=e?e.ship:void 0)===this.pilot.ship)&&null==this.pilot.upgrades)for(l=0,r=(g=this.upgrades).length;l<r;l++)null!=(null!=(S=g[l])?S.data:void 0)&&(null==_[f=S.slot]&&(_[f]=[]),_[S.slot].push(S.data.id));if(await this.resetPilot(),await this.resetAddons(),null!=e){if(this.data=exportObj.ships[null!=e?e.ship:void 0],null!=(null!=e?e.unique:void 0)&&await new Promise((t,i)=>this.builder.container.trigger("xwing:claimUnique",[e,"Pilot",t])),this.pilot=e,null!=this.pilot&&this.setupAddons(),this.copy_button.show(),this.setShipType(this.pilot.ship),(null!=this.pilot.autoequip||null!=exportObj.ships[this.pilot.ship].autoequip&&!$)&&!t)for(o=0,d=(a=(null!=(t=this.pilot.autoequip)?t:[]).concat(null!=(t=exportObj.ships[this.pilot.ship].autoequip)?t:[])).length;o<d;o++)for(j=a[o],i=exportObj.upgrades[j],p=0,c=(v=this.upgrades).length;p<c;p++)S=v[p],exportObj.slotsMatching(S.slot,i.slot)&&S.setData(i);if($&&null==this.pilot.upgrades){for(m=1;m<=2;++m){for(s={},b=0,u=(x=this.upgrades).length;b<u;b++)null!=(k=(null!=(k=_[(S=x[b]).slot])?k:[]).shift())&&(await S.setById(k),S.lastSetValid||(s[k]=S));for(n in s)(S=s[n]).setById(n)}for(O=this.checkStandardizedList(this.pilot.ship),q=!1,T=0,h=(w=this.upgrades).length;T<h;T++)S=w[T],null!=O&&null!=(null!=S&&null!=(y=S.data)?y.name:void 0)&&S.data.name===O.name&&(q=!0);null!=O&&!1===q&&this.removeStandardizedList(O)}}else this.copy_button.hide();return this.row.removeClass("unsortable"),this.builder.container.trigger("xwing:pointsUpdated"),this.builder.container.trigger("xwing-backend:squadDirtinessChanged")}}async resetPilot(){var t;return null!=(null!=(t=this.pilot)?t.unique:void 0)&&await new Promise((t,i)=>this.builder.container.trigger("xwing:releaseUnique",[this.pilot,"Pilot",t])),this.pilot=null}setupAddons(){var t,i,e,a,s,n,l,o,r,d,c,u,h,p,f,m,_,b;if(this.builder.isQuickbuild){for(p=[],n=0,s=(c=null!=(d=exportObj.quickbuildsById[this.quickbuildId].upgrades)?d:[]).length;n<s;n++)b=c[n],null==(_=exportObj.upgrades[b])?console.log("Unknown Upgrade: "+b):((m=new exportObj.QuickbuildUpgrade({ship:this,container:this.addon_container,slot:_.slot,upgrade:_})).setData(_),p.push(this.upgrades.push(m)));return p}if(null!=this.pilot.upgrades){for(this.hasFixedUpgrades=!0,this.usesxwaSlots=!1,u=[],t=0,e=(o=null!=(d=this.pilot.upgrades)?d:[]).length;t<e;t++)b=o[t],null==(_=exportObj.upgrades[b])?console.log("Unknown Upgrade: "+b):((m=new exportObj.QuickbuildUpgrade({ship:this,container:this.addon_container,slot:_.slot,upgrade:_})).setData(_),u.push(this.upgrades.push(m)));return u}for(this.hasFixedUpgrades=!1,this.builder.isXwa&&null!=this.pilot.slotsxwa?(l=this.pilot.slotsxwa,this.usesxwaSlots=!0):(this.usesxwaSlots=!1,l=this.pilot.slots),h=[],i=0,a=(r=null!=l?l:[]).length;i<a;i++)f=r[i],h.push(this.upgrades.push(new exportObj.Upgrade({ship:this,container:this.addon_container,slot:f})));return h}resetAddons(){for(var e,t=[],i=this.upgrades,a=0,s=i.length;a<s;a++)null!=(e=i[a])&&t.push(new Promise((t,i)=>e.destroy(t)));return Promise.all(t).then(this.upgrades=[])}getPoints(){var t,i,e;return this.builder.isQuickbuild?(i=exportObj.quickbuildsById[this.quickbuildId],e=this.primary&&null!=(e=null!=i?i.threat:void 0)?e:0,null!=(null!=i?i.wingleader:void 0)&&(e=i.threat[i.wingmates.indexOf(this.wingmates.length)]),this.points_container.find("span").text(e),0<e?this.points_container.fadeTo("fast",1):this.points_container.fadeTo(0,0),e):(e=null!=this.pilot?(t=null!=(i=this.effectiveStats())?i.points:void 0,null!=i?i.loadout:void 0):t=0,this.points_container.find("div").text(""+t),this.points_container.find(".upgrade-points").text(null!=(null!=(i=this.pilot)?i.loadout:void 0)?`(${this.upgrade_points_total}/${e})`:""),0<t?this.points_container.fadeTo("fast",1):this.points_container.fadeTo(0,0),t)}async setWingmates(t){var e,i,a,s;if((null!=(s=this.wingmates)?s.length:void 0)!==t){for(null!=this.wingmates&&0!==this.wingmates.length||(this.wingmates=[]),a=exportObj.quickbuildsById[this.quickbuildId];this.wingmates.length<t;)null!==(i=this.builder.ships.slice(-1)[0]).data?i=this.builder.addShip():this.builder.addShip(),(i.linkedShip=this).wingmates.push(i),i.setPilotById(a.wingmateId),i.primary=!1,this.primary=!0;for(;this.wingmates.length>t;)(e=this.wingmates.pop()).linkedShip=null,await new Promise((t,i)=>this.builder.removeShip(e,t));return this.wingmate_selector.val(t)}}removeFromWing(t){var i;return this.wingmates.removeItem(t),t=exportObj.quickbuildsById[this.quickbuildId],i=this.wingmates.length,0<=indexOf.call(t.wingmates,i)||this.destroy($.noop),this.wingmate_selector.val(this.wingmates.length)}joinWing(t){var i,e;return this.wingmates.push(t),i=exportObj.quickbuildsById[this.quickbuildId],e=this.wingmates.length,0<=indexOf.call(i.wingmates,e)||(t.destroy($.noop),this.removeFromWing(t)),this.wingmate_selector.val(this.wingmates.length)}updateSelections(){var t,i,e,a,s,n,l;if(null==this.pilot)return this.pilot_selector.select2("data",null);for(this.ship_selector.select2("data",{id:this.pilot.ship,text:exportObj.ships[this.pilot.ship].display_name||this.pilot.ship,chassis:exportObj.ships[this.pilot.ship].chassis||"",xws:exportObj.ships[this.pilot.ship].name.canonicalize(),icon:exportObj.ships[this.pilot.ship].icon||exportObj.ships[this.pilot.ship].name.canonicalize()}),this.pilot_selector.select2("data",{id:this.pilot.id,text:`${null!=(null!=(a=exportObj.settings)?a.initiative_prefix:void 0)&&exportObj.settings.initiative_prefix?this.pilot.skill+" - ":""}${this.pilot.display_name||this.pilot.name}${-1!==this.quickbuildId?exportObj.quickbuildsById[this.quickbuildId].suffix:""} (${-1!==this.quickbuildId?this.primary?exportObj.quickbuildsById[this.quickbuildId].threat:0:this.builder.isXwa&&null!=this.pilot.pointsxwa?this.pilot.pointsxwa:this.pilot.points}${-1!==this.quickbuildId||null==this.pilot.loadout?"":this.builder.isXwa&&null!=this.pilot.loadoutxwa?"/"+this.pilot.loadoutxwa:"/"+this.pilot.loadout})`,chassis:null!=this.pilot.chassis?this.pilot.chassis:""}),this.pilot_selector.data("select2").container.show(),n=[],t=0,i=(s=this.upgrades).length;t<i;t++)e=(l=s[t]).getPoints(),n.push(l.updateSelection(e));return n}checkPilotSelectorQueryModal(){return 768<=$(window).width()?this.pilot_query_modal.hide():this.pilot?this.pilot_query_modal.show():void 0}setupUI(){var t;return this.row=$(document.createElement("DIV")),this.row.addClass("row ship mb-5 mb-sm-0 unsortable"),this.row.insertBefore(this.builder.notes_container),this.row.append($.trim(`<div class="col-md-3">
    <div class="form-group d-flex">
        <input class="ship-selector-container" type="hidden"></input>
        <div class="d-block d-md-none input-group-append">
            <button class="btn btn-secondary ship-query-modal"><i class="fas fa-question"></i></button>
        </div>
    <br />
    </div>
    <div class="form-group d-flex">
        <input type="hidden" class="pilot-selector-container"></input>
        <div class="d-block d-md-none input-group-append">
            <button class="btn btn-secondary pilot-query-modal"><i class="fas fa-question"></i></button>
        <br />
        </div>
    </div>
    <label class="wingmate-label">
    ${this.uitranslation("Wingmates")}: 
        <input type="number" class="wingmate-selector"></input>
    </label>
</div>
<div class="col-md-1 points-display-container">
     <div></div>
     <div class="upgrade-points"></div>
</div>
<div class="col-md-6 addon-container">  </div>
<div class="col-md-2 button-container">
    <button class="btn btn-danger remove-pilot side-button"><span class="d-none d-sm-block" data-toggle="tooltip" title="${this.uitranslation("Remove Pilot")}"><i class="fa fa-times"></i></span><span class="d-block d-sm-none"> ${this.uitranslation("Remove Pilot")}</span></button>
    <button class="btn btn-light copy-pilot side-button"><span class="d-none d-sm-block" data-toggle="tooltip" title="${this.uitranslation("Clone Pilot")}"><i class="far fa-copy"></i></span><span class="d-block d-sm-none"> ${this.uitranslation("Clone Pilot")}</span></button>
    <button class="btn btn-light points-destroyed side-button" points-state"><span class="d-none d-sm-block destroyed-type" data-toggle="tooltip" title="${this.uitranslation("Points Destroyed")}"><i class="fas fa-circle"></i></i></span><span class="d-block d-sm-none destroyed-type-mobile"> ${this.uitranslation("Undamaged")}</span></button>
</div>`)),this.row.find(".button-container span").tooltip(),this.ship_selector=$(this.row.find("input.ship-selector-container")),this.pilot_selector=$(this.row.find("input.pilot-selector-container")),this.wingmate_selector=$(this.row.find("input.wingmate-selector")),this.ship_query_modal=$(this.row.find("button.ship-query-modal")),this.pilot_query_modal=$(this.row.find("button.pilot-query-modal")),this.ship_query_modal.click(t=>{if(this.pilot)return this.builder.showTooltip("Ship",exportObj.ships[this.pilot.ship],null,this.builder.mobile_tooltip_modal,!0),this.builder.mobile_tooltip_modal.modal("show")}),this.pilot_query_modal.click(t=>{if(this.pilot)return this.builder.showTooltip("Pilot",this.pilot,this.pilot?this:void 0,this.builder.mobile_tooltip_modal,!0),this.builder.mobile_tooltip_modal.modal("show")}),t=function(t,i,e){return`<i class="xwing-miniatures-ship xwing-miniatures-ship-${t.icon}"></i> `+t.text},this.ship_selector.select2({width:"100%",placeholder:exportObj.translate("ui","shipSelectorPlaceholder"),query:t=>{var i={results:[]};return i.results=this.builder.getAvailableShipsMatching(t.term),t.callback(i)},minimumResultsForSearch:$.isMobile()?-1:0,formatResultCssClass:t=>{var i;return null!=this.builder.collection&&"true"===this.builder.collection.checks.collectioncheck&&(i=!1,null!=this.pilot&&t.id===exportObj.ships[this.pilot.ship].id?this.builder.collection.checkShelf("ship",t.name)||this.builder.collection.checkTable("pilot",t.name)||(i=!0):i=!this.builder.collection.checkShelf("ship",t.name),i)?"select2-result-not-in-collection":""},formatResult:t,formatSelection:t}),this.ship_selector.on("select2-focus",t=>{if($.isMobile())return $(".select2-container .select2-focusser").remove(),$(".select2-search input").prop("focus",!1).removeClass("select2-focused")}),this.ship_selector.on("change",t=>this.setShipType(this.ship_selector.val())),this.ship_selector.data("select2").results.on("mousemove-filtered",t=>{t=$(t.target).closest(".select2-result").data("select2-data");if(null!=(null!=t?t.id:void 0))return this.builder.showTooltip("Ship",exportObj.ships[t.id])}),this.ship_selector.data("select2").container.on("mouseover",t=>{if(this.pilot)return this.builder.showTooltip("Ship",exportObj.ships[this.pilot.ship])}),this.pilot_selector.select2({width:"100%",placeholder:exportObj.translate("ui","pilotSelectorPlaceholder"),query:t=>{var i={results:[]};return i.results=this.builder.getAvailablePilotsForShipIncluding(this.ship_selector.val(),this.builder.isQuickbuild?this.quickbuildId:this.pilot,t.term,!0,this),t.callback(i)},minimumResultsForSearch:$.isMobile()?-1:0,formatResultCssClass:t=>{var i,e,a;return null!=this.builder.collection&&"true"===this.builder.collection.checks.collectioncheck&&(e=!1,i="",i=this.builder.isQuickbuild?null!=(a=null!=(a=exportObj.quickbuildsById[t.id])?a.pilot:void 0)?a:"unknown pilot":t.name,t.id===(null!=(a=this.pilot)?a.id:void 0)?this.builder.collection.checkShelf("pilot",i)||this.builder.collection.checkTable("pilot",i)||(e=!0):e=!this.builder.collection.checkShelf("pilot",i),e)?"select2-result-not-in-collection":""}}),this.pilot_selector.on("select2-focus",t=>{if($.isMobile())return $(".select2-container .select2-focusser").remove(),$(".select2-search input").prop("focus",!1).removeClass("select2-focused")}),this.pilot_selector.on("change",t=>(this.setPilotById(this.pilot_selector.select2("val")),this.builder.current_squad.dirty=!0,this.builder.container.trigger("xwing-backend:squadDirtinessChanged"),this.builder.backend_status.fadeOut("slow"))),this.pilot_selector.data("select2").results.on("mousemove-filtered",t=>{var i,t=$(t.target).closest(".select2-result").data("select2-data");if(this.builder.isQuickbuild){if(null!=(null!=t?t.id:void 0))return this.builder.showTooltip("Quickbuild",exportObj.quickbuildsById[t.id],{ship:null!=(i=this.data)?i.name:void 0})}else if(null!=(null!=t?t.id:void 0))return this.builder.showTooltip("Pilot",exportObj.pilotsById[t.id])}),this.pilot_selector.data("select2").container.on("mouseover",t=>{if(this.pilot)return this.builder.showTooltip("Pilot",this.pilot,this)}),this.pilot_selector.data("select2").container.hide(),this.builder.isQuickbuild&&(this.wingmate_selector.on("change",t=>(this.setWingmates(parseInt(this.wingmate_selector.val())),this.builder.current_squad.dirty=!0,this.builder.container.trigger("xwing-backend:squadDirtinessChanged"),this.builder.backend_status.fadeOut("slow"))),this.wingmate_selector.on("mousemove-filtered",t=>{})),this.wingmate_selector.parent().hide(),this.points_container=$(this.row.find(".points-display-container")),this.points_container.fadeTo(0,0),this.addon_container=$(this.row.find("div.addon-container")),this.remove_button=$(this.row.find("button.remove-pilot")),this.remove_button.click(t=>(t.preventDefault(),this.row.slideUp("fast",()=>{var t;return this.builder.removeShip(this),null!=(t=this.backend_status)?t.fadeOut("slow"):void 0}))),this.remove_button.hide(),this.copy_button=$(this.row.find("button.copy-pilot")),this.copy_button.click(t=>{for(var i,e=this.builder.ships,a=[],s=0,n=e.length;s<n;s++){if((i=e[s]).row.hasClass("unsortable")){i.copyFrom(this);break}a.push(void 0)}return a}),this.copy_button.hide(),this.checkPilotSelectorQueryModal(),this.points_destroyed_button_span=$(this.row.find(".destroyed-type")),this.points_destroyed_button_span_mobile=$(this.row.find(".destroyed-type-mobile")),this.points_destroyed_button=$(this.row.find("button.points-destroyed")),this.points_destroyed_button.click(t=>{switch(this.destroystate){case 0:this.destroystate++,this.points_destroyed_button.addClass("btn-warning"),this.points_destroyed_button.removeClass("btn-light"),this.points_destroyed_button_span_mobile.text(this.uitranslation("Half Damaged")),this.points_destroyed_button_span.html('<i class="fas fa-adjust"></i>');break;case 1:this.destroystate++,this.points_destroyed_button.addClass("btn-danger"),this.points_destroyed_button.removeClass("btn-warning"),this.points_destroyed_button_span_mobile.text(this.uitranslation("Fully Destroyed")),this.points_destroyed_button_span.html('<i class="far fa-circle"></i>');break;case 2:this.destroystate=0,this.points_destroyed_button.addClass("btn-light"),this.points_destroyed_button.removeClass("btn-danger"),this.points_destroyed_button_span_mobile.text(this.uitranslation("Undamaged")),this.points_destroyed_button_span.html('<i class="fas fa-circle"></i>')}return this.builder.container.trigger("xwing:pointsUpdated")}),this.points_destroyed_button.hide()}teardownUI(){return this.row.text(""),this.row.remove()}toString(){return null!=this.pilot?this.uitranslation("PilotFlyingShip",this.pilot.display_name||this.pilot.name,this.data.display_name||this.data.name):this.data.display_name||this.data.name}toHTML(){var t,i,e,a,s,n,l,o,r,d,c,u,h,p,f,m,_=this.effectiveStats(),b=this.builder.formatActions(_.actions,'<div class="action-separator">&nbsp;&vert;&nbsp;</div>',null!=(b=this.pilot.keyword)?b:[]),g=null!=(g=this.data.attack_icon)?g:"xwing-miniatures-font-frontarc",v=null!=this.pilot.engagement?$.trim(`<span class="info-data info-skill">ENG ${this.pilot.engagement}</span>`):"",g=null!=_.attack?$.trim(`<i class="xwing-miniatures-font header-attack ${g}"></i>
<span class="info-data info-attack">${statAndEffectiveStat(null!=(g=null!=(g=this.pilot.ship_override)?g.attack:void 0)?g:this.data.attack,_,"attack")}</span>`):"",x=null!=_.attackbull?$.trim(`<i class="xwing-miniatures-font header-attack xwing-miniatures-font-bullseyearc"></i>
<span class="info-data info-attack">${statAndEffectiveStat(null!=(x=null!=(x=this.pilot.ship_override)?x.attackbull:void 0)?x:this.data.attackbull,_,"attackbull")}</span>`):"",k=null!=_.attackb?$.trim(`<i class="xwing-miniatures-font header-attack xwing-miniatures-font-reararc"></i>
<span class="info-data info-attack">${statAndEffectiveStat(null!=(k=null!=(k=this.pilot.ship_override)?k.attackb:void 0)?k:this.data.attackb,_,"attackb")}</span>`):"",w=null!=_.attackf?$.trim(`<i class="xwing-miniatures-font header-attack xwing-miniatures-font-fullfrontarc"></i>
<span class="info-data info-attack">${statAndEffectiveStat(null!=(w=null!=(w=this.pilot.ship_override)?w.attackf:void 0)?w:this.data.attackf,_,"attackf")}</span>`):"",y=null!=_.attackt?$.trim(`<i class="xwing-miniatures-font header-attack xwing-miniatures-font-singleturretarc"></i>
<span class="info-data info-attack">${statAndEffectiveStat(null!=(y=null!=(y=this.pilot.ship_override)?y.attackt:void 0)?y:this.data.attackt,_,"attackt")}</span>`):"",q=null!=_.attackl?$.trim(`<i class="xwing-miniatures-font header-attack xwing-miniatures-font-leftarc"></i>
<span class="info-data info-attack">${statAndEffectiveStat(null!=(q=null!=(q=this.pilot.ship_override)?q.attackl:void 0)?q:this.data.attackl,_,"attackl")}</span>`):"",O=null!=_.attackr?$.trim(`<i class="xwing-miniatures-font header-attack xwing-miniatures-font-rightarc"></i>
<span class="info-data info-attack">${statAndEffectiveStat(null!=(O=null!=(O=this.pilot.ship_override)?O.attackr:void 0)?O:this.data.attackr,_,"attackr")}</span>`):"",S=null!=_.attackdt?$.trim(`<i class="xwing-miniatures-font header-attack xwing-miniatures-font-doubleturretarc"></i>
<span class="info-data info-attack">${statAndEffectiveStat(null!=(S=null!=(S=this.pilot.ship_override)?S.attackdt:void 0)?S:this.data.attackdt,_,"attackdt")}</span>`):"",j="";if(null!=this.data.energyrecurr)for(t=0;t<this.data.energyrecurr;)j+='<sup><i class="fas fa-caret-up"></i></sup>',++t;if(r=null!=(null!=(r=this.pilot.ship_override)?r.energy:void 0)||null!=this.data.energy?$.trim(`<i class="xwing-miniatures-font header-energy xwing-miniatures-font-energy"></i>
<span class="info-data info-energy">${statAndEffectiveStat(null!=(r=null!=(r=this.pilot.ship_override)?r.energy:void 0)?r:this.data.energy,_,"energy")}${j}</span>`):"",null!=_.force)if(j="",null!=_.forcerecurring)for(t=0;t<_.forcerecurring;)j+='<sup><i class="fas fa-caret-up"></i></sup>',++t;else j+='<sup><i class="fas fa-caret-up"></i></sup>';if(d=null!=_.force&&0<_.force?$.trim(`<i class="xwing-miniatures-font header-force xwing-miniatures-font-forcecharge"></i>
<span class="info-data info-force">${statAndEffectiveStat(null!=(d=null!=(d=null!=(d=this.pilot.ship_override)?d.force:void 0)?d:this.pilot.force)?d:0,_,"force")}${j}</span>`):"",null!=this.pilot.charge){if(j="",null!=this.pilot.recurring)if(0<this.pilot.recurring)for(t=0;t<this.pilot.recurring;)j+='<sup><i class="fas fa-caret-up"></i></sup>',++t;else for(t=this.pilot.recurring;t<0;)j+='<sub><i class="fas fa-caret-down"></i></sub>',++t;c=$.trim(`<i class="xwing-miniatures-font header-charge xwing-miniatures-font-charge"></i><span class="info-data info-charge">${statAndEffectiveStat(null!=(c=null!=(c=this.pilot.ship_override)?c.charge:void 0)?c:this.pilot.charge,_,"charge")}${j}</span>`)}else c="";if(p="",null!=this.data.shieldrecurr)for(t=0;t<this.data.shieldrecurr;)p+='<sup><i class="fas fa-caret-up"></i></sup>',++t;if(h="",_.shields){for(a=_.shields;2<=a;a+=-1)h+='<i class="xwing-miniatures-font header-shield xwing-miniatures-font-shield expanded-hull-or-shield"></i>';h+='<i class="xwing-miniatures-font header-shield xwing-miniatures-font-shield"></i>'}if(e="",_.hull){for(s=_.hull;2<=s;s+=-1)e+='<i class="xwing-miniatures-font header-hull xwing-miniatures-font-hull expanded-hull-or-shield"></i>';e+='<i class="xwing-miniatures-font header-hull xwing-miniatures-font-hull"></i>'}if(u=null!=_.shields&&0<_.shields?$.trim(`<span class="info-data info-shields">${statAndEffectiveStat(null!=(u=null!=(u=this.pilot.ship_override)?u.shields:void 0)?u:this.data.shields,_,"shields")}${p}</span>`):"",i=$.trim(`<div class="fancy-pilot-header">
    <div class="pilot-header-text">${this.pilot.display_name||this.pilot.name} <i class="xwing-miniatures-ship xwing-miniatures-ship-${this.data.name.canonicalize()}"></i><span class="fancy-ship-type"> ${this.data.display_name||this.data.name}</span></div>
    <div class="mask">
        <div class="outer-circle">
            <div class="inner-circle pilot-points">${-1!==this.quickbuildId?this.primary?this.getPoints():"*":this.builder.isXwa&&null!=this.pilot.pointsxwa?this.pilot.pointsxwa:this.pilot.points}</div>
        </div>
    </div>
</div>
<div class="fancy-pilot-stats">
    <div class="pilot-stats-content">
        <span class="info-data info-skill">INI ${statAndEffectiveStat(this.pilot.skill,_,"skill")}</span>
        ${v}
        ${x}
        ${g}
        ${k}
        ${w}
        ${y}
        ${q}
        ${O}
        ${S}
        <i class="xwing-miniatures-font header-agility xwing-miniatures-font-agility"></i>
        <span class="info-data info-agility">${statAndEffectiveStat(null!=(x=null!=(v=this.pilot.ship_override)?v.agility:void 0)?x:this.data.agility,_,"agility")}</span>                    
        ${e}
        <span class="info-data info-hull">${statAndEffectiveStat(null!=(k=null!=(g=this.pilot.ship_override)?g.hull:void 0)?k:this.data.hull,_,"hull")}</span>
        ${h}
        ${u}
        ${r}
        ${d}
        ${c}
        <br />
        <div class="action-bar">
            ${b}
        </div>
    </div>
</div>`),this.pilot.text&&(i+=$.trim(`<div class="fancy-pilot-text">${this.pilot.text}</div>`)),""!==(w=null!=(null!=_?_.chassis:void 0)&&""!==_.chassis?_.chassis:null!=this.data.chassis?this.data.chassis:"")&&(i+=$.trim(`<div class="fancy-pilot-chassis"><strong>${null!=(q=null!=(y=exportObj.chassis[w])?y.display_name:void 0)?q:w}:</strong> ${exportObj.chassis[w].text}</div>`)),0<(f=function(){for(var t=this.upgrades,i=[],e=0,a=t.length;e<a;e++)null!=(m=t[e]).data&&i.push(m);return i}.call(this)).length){for(i+=$.trim('<div class="fancy-upgrade-container">'),l=0,n=f.length;l<n;l++)o=(m=f[l]).getPoints(),i+=m.toHTML(o);i+=$.trim("</div>")}return O=Math.floor(this.getPoints()/2),S=Math.floor((_.hull+_.shields)/2),`<div class="fancy-ship">${i+=$.trim(`<div class="ship-points-total">
    <strong>${this.uitranslation("Ship Cost")}: ${this.getPoints()}, ${this.uitranslation("Loadout")}: (${this.upgrade_points_total}${this.builder.isXwa&&null!=this.pilot.loadoutxwa?"/"+this.pilot.loadoutxwa:null!=this.pilot.loadout?"/"+this.pilot.loadout:""}), ${this.uitranslation("Half Points")}: ${O}, ${this.uitranslation("Damage Threshold")}: ${S}</strong> 
</div>`)}</div>`}toTableRow(){var t,i,e,a,s,n,l=$.trim(`<tr class="simple-pilot">
    <td class="name">${this.pilot.display_name||this.pilot.name} &mdash; ${this.data.display_name||this.data.name}</td>
    <td class="points">${-1!==this.quickbuildId?this.primary?exportObj.quickbuildsById[this.quickbuildId].threat:0:this.builder.isXwa&&null!=this.pilot.pointsxwa?this.pilot.pointsxwa:this.pilot.points}</td>
</tr>`),o=function(){for(var t=this.upgrades,i=[],e=0,a=t.length;e<a;e++)null!=(n=t[e]).data&&i.push(n);return i}.call(this);if(0<o.length)for(i=0,e=o.length;i<e;i++)a=(n=o[i]).getPoints(),l+=n.toTableRow(a);return l+=`<tr class="simple-ship-total"><td colspan="2">${this.uitranslation("Ship Cost")}: ${this.getPoints()}</td></tr>`,t=Math.floor(this.getPoints()/2),s=Math.floor((this.effectiveStats().hull+this.effectiveStats().shields)/2),l=l+`<tr class="simple-ship-half-points"><td colspan="2">${this.uitranslation("Loadout")}: (${this.upgrade_points_total}${this.builder.isXwa&&null!=this.pilot.loadoutxwa?"/"+this.pilot.loadoutxwa:null!=this.pilot.loadout?"/"+this.pilot.loadout:""}) ${this.uitranslation("Half Points")}: ${t} ${this.uitranslation("Damage Threshold")}: ${s}</td></tr>`+"<tr><td>&nbsp;</td><td></td></tr>"}toSimpleCopy(){var t,i,e,a,s,n,l,o=`${this.pilot.display_name}  ${this.data.display_name} (${-1!==this.quickbuildId?this.primary?exportObj.quickbuildsById[this.quickbuildId].threat:0:this.builder.isXwa&&null!=this.pilot.pointsxwa?this.pilot.pointsxwa:this.pilot.points})    \n`,r=function(){for(var t=this.upgrades,i=[],e=0,a=t.length;e<a;e++)null!=(n=t[e]).data&&i.push(n);return i}.call(this);if(0<r.length){for(o+="    ",a=[],i=0,e=r.length;i<e;i++)l=(n=r[i]).getPoints(),null!=(l=n.toSimpleCopy(l))&&a.push(l);o=o+a.join("    ")+`    
`}return t=Math.floor(this.getPoints()/2),s=Math.floor((this.effectiveStats().hull+this.effectiveStats().shields)/2),o+=""+this.uitranslation("Ship Cost")+`: ${this.getPoints()}  ${this.uitranslation("Loadout")}: (${this.upgrade_points_total}${this.builder.isXwa&&null!=this.pilot.loadoutxwa?"/"+this.pilot.loadoutxwa:null!=this.pilot.loadout?"/"+this.pilot.loadout:""})  ${this.uitranslation("Half Points")}: ${t}  ${this.uitranslation("Damage Threshold")}: ${s}    
    
`}toRedditText(){var t,i,e,a,s,n,l,o=`**${this.pilot.name} (${-1!==this.quickbuildId?this.primary?exportObj.quickbuildsById[this.quickbuildId].threat:0:this.builder.isXwa&&null!=this.pilot.pointsxwa?this.pilot.pointsxwa:this.pilot.points})**    
`,r=function(){for(var t=this.upgrades,i=[],e=0,a=t.length;e<a;e++)null!=(n=t[e]).data&&i.push(n);return i}.call(this);if(0<r.length){for(t=Math.floor(this.getPoints()/2),s=Math.floor((this.effectiveStats().hull+this.effectiveStats().shields)/2),o+="    ",a=[],i=0,e=r.length;i<e;i++)l=(n=r[i]).getPoints(),null!=(l=n.toRedditText(l))&&a.push(l);o=(o+=a.join("    "))+`&nbsp;*${this.uitranslation("Ship Cost")}: ${this.getPoints()}  ${this.uitranslation("Loadout")}: (${this.upgrade_points_total}${this.builder.isXwa&&null!=this.pilot.loadoutxwa?"/"+this.pilot.loadoutxwa:null!=this.pilot.loadout?"/"+this.pilot.loadout:""})  ${this.uitranslation("Half Points")}: ${t}  ${this.uitranslation("Damage Threshold")}: ${s}*    
`}return o}toTTSText(){var t,i,s,e,a=""+exportObj.toTTS(this.pilot.name),n=function(){for(var t=this.upgrades,i=[],e=0,a=t.length;e<a;e++)null!=(s=t[e]).data&&i.push(s);return i}.call(this);if(0<n.length&&null==this.pilot.upgrades)for(t=0,i=n.length;t<i;t++)null!=(e=(s=n[t]).toTTSText())&&(a+=" + "+e);return a+" / "}toSerialized(){var n,l,t;return this.builder.isQuickbuild?null==this.wingmates||0===this.wingmates.length?this.quickbuildId+"X":this.quickbuildId+"X"+this.wingmates.length:(t=(""+function(){var t,i,e,a=this.upgrades,s=[];for(n=t=0,i=a.length;t<i;n=++t)l=a[n],s.push(null!=(e=null!=l&&null!=(e=l.data)?e.id:void 0)?e:"");return s}.call(this)).replace(/,/g,"W"),[this.pilot.id,t].join("X"))}async fromSerialized(t,i){var e,a,s,n,l,o,r,d,c,u,h,p,f,m,_,b,g,v=!0;switch(t){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:console.log("Incorrect Version!"),this.old_version_container.toggleClass("d-none",!1);break;case 9:if([c,b,e]=i.split("X"),b=b.split("W"),await this.setPilotById(parseInt(c),!0),!this.validate)return!1;if(this.builder.isQuickbuild)0<b.length&&0<this.wingmates.length&&this.setWingmates(b[0]);else for(s=1;s<3;++s)t:for(a=n=u=b.length-1;u<=-1?n<-1:-1<n;a=u<=-1?++n:--n)if(_=b[a],null==(m=exportObj.upgradesById[_]))b.splice(a,1),""!==_&&(console.log("Unknown upgrade id "+_+" could not be added. Please report that error"),v=!1);else{for(r=0,l=(h=this.upgrades).length;r<l;r++)if((null!=(g=h[r])&&null!=(p=g.data)?p.name:void 0)===m.name){b.splice(a,1);continue t}for(d=0,o=(f=this.upgrades).length;d<o;d++)if(g=f[d],exportObj.slotsMatching(m.slot,g.slot)&&!g.isOccupied()){await g.setById(_),g.lastSetValid&&b.splice(a,1);break}}v&=0===b.length}return this.updateSelections(),v}effectiveStats(){var t,i,e,a,s,n,l,o,r,d,c,u,h,p,f,m={attack:null!=(u=null!=(u=this.pilot.ship_override)?u.attack:void 0)?u:this.data.attack,attackf:null!=(u=null!=(u=this.pilot.ship_override)?u.attackf:void 0)?u:this.data.attackf,attackbull:null!=(u=null!=(u=this.pilot.ship_override)?u.attackbull:void 0)?u:this.data.attackbull,attackb:null!=(u=null!=(u=this.pilot.ship_override)?u.attackb:void 0)?u:this.data.attackb,attackt:null!=(u=null!=(u=this.pilot.ship_override)?u.attackt:void 0)?u:this.data.attackt,attackl:null!=(u=null!=(u=this.pilot.ship_override)?u.attackl:void 0)?u:this.data.attackl,attackr:null!=(u=null!=(u=this.pilot.ship_override)?u.attackr:void 0)?u:this.data.attackr,attackdt:null!=(u=null!=(u=this.pilot.ship_override)?u.attackdt:void 0)?u:this.data.attackdt,energy:null!=(u=null!=(u=this.pilot.ship_override)?u.energy:void 0)?u:this.data.energy,agility:null!=(u=null!=(u=this.pilot.ship_override)?u.agility:void 0)?u:this.data.agility,hull:null!=(u=null!=(u=this.pilot.ship_override)?u.hull:void 0)?u:this.data.hull,shields:null!=(u=null!=(u=this.pilot.ship_override)?u.shields:void 0)?u:this.data.shields,force:null!=(u=null!=(u=null!=(u=this.pilot.ship_override)?u.force:void 0)?u:this.pilot.force)?u:0,forcerecurring:null!=(u=this.pilot.forcerecurring)?u:1,charge:null!=(u=null!=(u=this.pilot.ship_override)?u.charge:void 0)?u:this.pilot.charge,actions:(null!=(u=null!=(u=this.pilot.ship_override)?u.actions:void 0)?u:this.data.actions).slice(0),chassis:null!=(u=null!=(u=this.pilot.chassis)?u:this.data.chassis)?u:"",points:null!=(u=this.pilot.points)?u:0,loadout:null!=(u=this.pilot.loadout)?u:0,skill:null!=(u=this.pilot.skill)?u:0};for(this.builder.isXwa&&(null!=this.pilot.pointsxwa&&(m.points=this.pilot.pointsxwa),null!=this.pilot.loadoutxwa)&&(m.loadout=this.pilot.loadoutxwa),n=null!=(u=null!=(u=this.pilot.ship_override)?u.maneuvers:void 0)?u:this.data.maneuvers,m.maneuvers=[],h=t=0,o=(null!=n?n:[]).length;0<=o?t<o:o<t;h=0<=o?++t:--t)m.maneuvers[h]=n[h].slice(0);if(null!=this.pilot.keyword&&0<=indexOf.call(this.pilot.keyword,"Droid")&&null!=m.actions){for(l=[],i=0,e=(r=m.actions).length;i<e;i++)p=r[i],l.push(p.replace("Focus","Calculate"));m.actions=l}for(s=0,a=(d=this.upgrades).length;s<a;s++)null!=(null!=(f=d[s])&&null!=(c=f.data)?c.chassis:void 0)&&(m.chassis=f.data.chassis),null!=(null!=f&&null!=(c=f.data)?c.modifier_func:void 0)&&f.data.modifier_func(m);return null!=(null!=(u=this.pilot)?u.modifier_func:void 0)&&this.pilot.modifier_func(m),null!=exportObj.chassis[m.chassis]&&null!=exportObj.chassis[m.chassis].modifier_func&&exportObj.chassis[m.chassis].modifier_func(m),m}async validate(){var t,i,e,a,s,n,l,o,r,d,c,u,h,p,f,m,_,b,g,v,x,k,w,y,q,O,S,j,T,C,L,I;if(this.builder.isCurrentlyLoadingSquad)return!0;if(null==this.pilot)return!0;if(j=!0,this.builder.isEpic){if(null!=this.pilot.slots&&!(0<=indexOf.call(this.pilot.slots,"Command"))){for(t=!0,a=0,n=(f=this.upgrades).length;a<n;a++)"Command"===(T=f[a]).slot&&this===T.ship&&(t=!1);!0===t&&this.upgrades.push(new exportObj.Upgrade({ship:this,container:this.addon_container,slot:"Command"}))}}else if(!this.builder.isQuickbuild)for(e=s=m=this.upgrades.length-1;m<=-1?s<-1:-1<s;e=m<=-1?++s:--s)"Command"===(T=this.upgrades[e]).slot&&(T.destroy($.noop),this.upgrades.splice(e,1));for(e=d=0,0;d<8;e=++d){if(L=!0,y=null!=(y=null!=(y=null!=(y=this.pilot)?y.validation_func:void 0)?y:null!=(y=this.pilot)?y.restriction_func:void 0)?y:void 0,h=null!=this.pilot.upgrades,null!=y&&!y(this,this.pilot)||!this.builder.isItemAvailable(this.pilot,!0))return this.builder.removeShip(this),!1;for(i=[],u=this.upgrade_points_total=0,l=(q=this.upgrades).length;u<l;u++){if(T=q[u],c=!0,!h){if(null!=(null!=(O=null!=T&&null!=(O=T.data)?O.validation_func:void 0)?O:void 0)&&(c=c&&(null!=T&&null!=(_=T.data)?_.validation_func(this,T):void 0)),this.builder.isXwa&&null!=(null!=T&&null!=(_=T.data)?_.also_occupies_upgrades_xwa:void 0))for(p=0,o=(b=T.data.also_occupies_upgrades_xwa).length;p<o;p++)C=b[p],c=c&&T.occupiesAnUpgradeSlot(C);else if(null!=(null!=T&&null!=(v=T.data)?v.also_occupies_upgrades:void 0))for(I=0,r=(g=T.data.also_occupies_upgrades).length;I<r;I++)C=g[I],c=c&&T.occupiesAnUpgradeSlot(C);S=null!=(null!=T&&null!=(v=T.data)?v.restrictionsxwa:void 0)&&this.builder.isXwa?null!=T&&null!=(x=T.data)?x.restrictionsxwa:void 0:null!=(S=null!=T&&null!=(x=T.data)?x.restrictions:void 0)?S:void 0,c=c&&this.restriction_check(S,T,T.getPoints(),this.upgrade_points_total)}if((!c||null!=(null!=T?T.data:void 0)&&(k=T.data,0<=indexOf.call(i,k)||null!=T.data.faction&&!this.builder.isOurFaction(T.data.faction,this.pilot.faction)||!this.builder.isItemAvailable(T.data)))&&!h&&!this.builder.isQuickbuild){console.log(`Invalid upgrade: ${null!=T&&null!=(k=T.data)?k.name:void 0} on pilot `+(null!=(w=this.pilot)?w.name:void 0)),await T.setById(null),j=L=!1;break}null!=(null!=T?T.data:void 0)&&T.data&&i.push(null!=T?T.data:void 0),this.upgrade_points_total+=T.getPoints()}if(L)break}return this.updateSelections(),j}checkUnreleasedContent(){var t,i,e,a;if(null!=this.pilot&&!exportObj.isReleased(this.pilot))return!0;for(t=0,i=(e=this.upgrades).length;t<i;t++)if(null!=(null!=(a=e[t])?a.data:void 0)&&!exportObj.isReleased(a.data)&&null==a.data.standard)return!0;return!1}hasAnotherUnoccupiedSlotLike(t,i){for(var e,a=this.upgrades,s=0,n=a.length;s<n;s++)if((e=a[s])!==t&&exportObj.slotsMatching(e.slot,i)&&"HardpointShip"!==e.slot&&"VersatileShip"!==e.slot&&!e.isOccupied())return!0;return!1}hasFilledSlotLike(t,i){for(var e,a=this.upgrades,s=0,n=a.length;s<n;s++)if((e=a[s])!==t&&exportObj.slotsMatching(e.slot,i)&&e.isOccupied())return!0;return!1}restriction_check(t,i,e=0,a=0,s){var n,l,o,r,d,c,u,h,p,f,m,_,b,g,v=this.effectiveStats();if(null!=this.pilot.loadout&&v.loadout<e+a)return!1;if(null!=t)for(d=0,u=t.length;d<u;d++)switch((m=t[d])[0]){case"FactionOrUnique":if(this.pilot.faction===m[2]||this.checkListForUnique(m[1].toLowerCase().replace(/[^0-9a-z]/gi,"").replace(/\s+/g,"-")))break;return!1;case"Base":for(r=!1,c=0,h=m.length;c<h;c++)if("Base"!==(l=m[c])){switch(o=l.startsWith("Non-")?l.substring(4):l){case"Small":null==this.data.base&&(r=!0);break;case"Standard":null!=this.data.base&&"Huge"===this.data.base||(r=!0);break;default:null!=this.data.base&&this.data.base===o&&(r=!0)}if(!0===(r=l!==o?!r:r))break}if(!1===r)return!1;break;case"Action":if(m[1].startsWith("W-")){if(g=m[1].substring(2),indexOf.call(v.actions,g)<0)return!1}else{for(r=!1,f=0,p=(_=v.actions).length;f<p;f++)(n=_[f]).includes(m[1])&&!n.includes(">")&&(r=!0);if(!1===r)return!1}break;case"Keyword":if(this.checkKeyword(m[1]))break;return!1;case"Equipped":if(this.doesSlotExist(m[1])&&this.hasFilledSlotLike(i,m[1]))break;return!1;case"Slot":if((this.hasAnotherUnoccupiedSlotLike(i,m[1])||null!=i&&"function"==typeof i.occupiesAnUpgradeSlot&&i.occupiesAnUpgradeSlot(m[1]))&&"HardpointShip"!==i.slot&&"VersatileShip"!==i.slot)break;return!1;case"AttackArc":if(null==this.data.attackb)return!1;break;case"ShieldsGreaterThan":if(this.data.shields>m[1])break;return!1;case"EnergyGreatterThan":if(v.energy>m[1])break;return!1;case"InitiativeGreaterThan":if(this.pilot.skill>m[1])break;return!1;case"InitiativeLessThan":if(this.pilot.skill<m[1])break;return!1;case"HasForce":this.pilot.force,m[1];break;case"AgilityEquals":if(v.agility!==m[1])return!1;break;case"isUnique":if(m[1]!==(null!=this.pilot.unique||null!=this.pilot.max_per_squad))return!1;break;case"Format":switch(m[1]){case"Epic":if(b=this.data.name,0<=indexOf.call(exportObj.epicExclusionsList,b))break;return!1;case"Standard":if(b=this.data.name,0<=indexOf.call(exportObj.epicExclusionsList,b))return!1}}return!0}standardized_check(t){var i,e,a,s,n,l,o,r,d,c,u,h=!1;if(this.builder.isXwa?null!=t.standardizedxwa&&(h=t.standardizedxwa):null!=t.standardized&&(h=!0),h)for(i=0,a=(n=this.builder.ships).length;i<a;i++)if(null!=(null!=(d=n[i])?d.data:void 0)&&d.data.name===this.data.name&&(this.builder.isXwa&&(null!=t.restrictionsxwa?r=t.restrictionsxwa:null!=t.restrictions&&(r=t.restrictions)),null!=r)&&d.restriction_check(r,t)&&null==(null!=(l=d.pilot)?l.upgrades:void 0)){if(null!=d.pilot.loadout&&t.points+d.upgrade_points_total>d.pilot.loadout)return!1;for(c=!1,e=0,s=(o=d.upgrades).length;e<s;e++)u=o[e],t.slot===u.slot&&null==u.data&&(c=!0);if(!1===c)return!1}return!0}doesSlotExist(t){for(var i,e=this.upgrades,a=0,s=e.length;a<s;a++)if(i=e[a],exportObj.slotsMatching(i.slot,t))return!0;return!1}isSlotOccupied(t){for(var i,e=this.upgrades,a=0,s=e.length;a<s;a++)if(i=e[a],exportObj.slotsMatching(i.slot,t)&&!i.isOccupied())return!0;return!1}checkKeyword(t){var i,e,a,s,n,l,o,r,d,c,u,h,p,f;if(null!=(c=this.data.name)&&c.includes(t))return!0;if(null!=this.pilot.chassis){if(this.pilot.chassis===t)return!0}else if(null!=this.data.chassis&&this.data.chassis===t)return!0;for(i=0,a=(d=null!=(c=this.data.keyword)?c:[]).length;i<a;i++)if(d[i]===t)return!0;for(e=0,s=(u=null!=(c=this.pilot.keyword)?c:[]).length;e<s;e++)if(u[e]===t)return!0;for(o=0,n=(h=this.upgrades).length;o<n;o++){if(null!=(f=h[o]).chassis&&f.chassis===t)return!0;for(r=0,l=(p=null!=(f=null!=f&&null!=(f=f.data)?f.keyword:void 0)?f:[]).length;r<l;r++)if(p[r]===t)return!0}return!1}checkListForUnique(t){var i,a,s,e=this.builder.uniques_in_use;for(i in e)if(s=e[i],"Slot"!==i&&0<=indexOf.call((()=>{for(var t=[],i=0,e=s.length;i<e;i++)a=s[i],t.push(a.canonical_name.getXWSBaseName());return t})(),t))return!0;return!1}toXWS(){var t,i,e,a,s,n={id:null!=(n=this.pilot.xws)?n:this.pilot.canonical_name,name:null!=(n=this.pilot.xws)?n:this.pilot.canonical_name,points:this.getPoints(),ship:this.data.name.canonicalize()};if(this.data.multisection&&(n.multisection=this.data.multisection.slice(0)),s={},!this.pilot.upgrades)for(t=0,i=(e=this.upgrades).length;t<i;t++)null!=(null!=(a=e[t])?a.data:void 0)&&a.toXWS(s);return 0<Object.keys(s).length&&(n.upgrades=s),n}getConditions(){var t,i,e,a,s,n,l,o,r,d,c,u,h,p;if("undefined"==typeof Set||null===Set)return console.warn("Set not supported in this JS implementation, not implementing conditions"),[];if(i=new Set,null!=(null!=(r=this.pilot)?r.applies_condition:void 0))if(this.pilot.applies_condition instanceof Array)for(e=0,s=(d=this.pilot.applies_condition).length;e<s;e++)t=d[e],i.add(exportObj.conditionsByCanonicalName[t]);else i.add(exportObj.conditionsByCanonicalName[this.pilot.applies_condition]);for(a=0,n=(c=this.upgrades).length;a<n;a++)if(null!=(null!=(p=c[a])&&null!=(u=p.data)?u.applies_condition:void 0))if(p.data.applies_condition instanceof Array)for(o=0,l=(h=p.data.applies_condition).length;o<l;o++)t=h[o],i.add(exportObj.conditionsByCanonicalName[t]);else i.add(exportObj.conditionsByCanonicalName[p.data.applies_condition]);return i}},GenericAddon=class{constructor(t){this.ship=t.ship,this.container=$(t.container),this.data=null,this.unadjusted_data=null,this.conferredAddons=[],this.serialization_code="X",this.occupied_by=null,this.occupying=[],this.destroyed=!1,this.type=null,this.dataByName=null,(this.dataById=null)!=t.adjustment_func&&(this.adjustment_func=t.adjustment_func),null!=t.filter_func&&(this.filter_func=t.filter_func),this.placeholderMod_func=null!=t.placeholderMod_func?t.placeholderMod_func:t=>t}async destroy(t,...i){var e,a,s,n,l,o;if(!this.destroyed){if(null!=(null!=(n=this.data)?n.unique:void 0)&&await new Promise((t,i)=>this.ship.builder.container.trigger("xwing:releaseUnique",[this.data,this.type,t])),this.isStandardized()){for(e=!0,a=0,s=(l=this.ship.builder.ships).length;a<s;a++)null!=(o=l[a]).data&&this.ship.data.name===o.data.name&&this.ship!==o&&(e=!1);!0===e&&this.ship.removeStandardizedList(this.data)}this.destroyed=!0,this.rescindAddons(),this.deoccupyOtherUpgrades(),this.selector.select2("destroy"),this.selectorwrap.remove()}return t(i)}isStandardized(){var t;return this.ship.builder.isXwa&&null!=(null!=(t=this.data)?t.standardizedxwa:void 0)?this.data.standardizedxwa:null!=(null!=(t=this.data)?t.standardized:void 0)}setupSelector(t){return this.selectorwrap=$(document.createElement("div")),this.selectorwrap.addClass("form-group d-flex upgrade-box"),this.selector=$(document.createElement("INPUT")),this.selector.attr("type","hidden"),this.selectorwrap.append(this.selector),this.selectorwrap.append($.trim(`<div class="input-group-addon">
    <button class="btn btn-secondary d-block d-md-none upgrade-query-modal"><i class="fas fa-question"></i></button>
</div>`)),this.upgrade_query_modal=$(this.selectorwrap.find("button.upgrade-query-modal")),this.container.append(this.selectorwrap),$.isMobile()&&(t.minimumResultsForSearch=-1),t.formatResultCssClass=t=>{var i,e;return null!=this.ship.builder.collection&&(i=!1,t.id===(null!=(e=this.data)?e.id:void 0)?this.ship.builder.collection.checkShelf(this.type.toLowerCase(),t.name)||this.ship.builder.collection.checkTable(this.type.toLowerCase(),t.name)||(i=!0):i=!this.ship.builder.collection.checkShelf(this.type.toLowerCase(),t.name),i)?"select2-result-not-in-collection":""},t.formatSelection=(t,i)=>{var e=function(){return("Upgrade"!==this.type?this.type:this.slot).toLowerCase().replace(/[^0-9a-z]/gi,"")}.call(this);e=e.replace("configuration","config").replace("force","forcepower"),$(i).append(`<i class="xwing-miniatures-font xwing-miniatures-font-${e}"></i> `+t.text)},this.selector.select2(t),this.upgrade_query_modal.click(t=>{if(this.data)return console.log(""+this.data.name),this.ship.builder.showTooltip("Addon",this.data,null!=this.data?{addon_type:this.type}:void 0,this.ship.builder.mobile_tooltip_modal,!0),this.ship.builder.mobile_tooltip_modal.modal("show")}),this.selector.on("select2-focus",t=>{if($.isMobile())return $(".select2-container .select2-focusser").remove(),$(".select2-search input").prop("focus",!1).removeClass("select2-focused")}),this.selector.on("change",t=>(this.setById(this.selector.select2("val")),this.ship.builder.current_squad.dirty=!0,this.ship.builder.container.trigger("xwing-backend:squadDirtinessChanged"),this.ship.builder.backend_status.fadeOut("slow"))),this.selector.data("select2").results.on("mousemove-filtered",t=>{t=$(t.target).closest(".select2-result").data("select2-data");if(null!=(null!=t?t.id:void 0))return this.ship.builder.showTooltip("Addon",this.dataById[t.id],{addon_type:this.type})}),this.selector.data("select2").container.on("mouseover",t=>{if(null!=this.data)return this.ship.builder.showTooltip("Addon",this.data,{addon_type:this.type})})}setById(t){return this.setData(this.dataById[parseInt(t)])}setByName(t){return this.setData(this.dataByName[$.trim(t)])}async setData(e){var t;if((null!=e?e.id:void 0)!==(null!=(t=this.data)?t.id:void 0)){if(null==(null!=(t=this.data)?t.unique:void 0)&&null==(null!=(t=this.data)?t.solitary:void 0)||await new Promise((t,i)=>this.ship.builder.container.trigger("xwing:releaseUnique",[this.unadjusted_data,this.type,t])),this.isStandardized()&&!this.ship.hasFixedUpgrades&&this.ship.removeStandardizedList(this.data),await this.rescindAddons(),this.deoccupyOtherUpgrades(),null!=(null!=e?e.unique:void 0)||null!=(null!=e?e.solitary:void 0))try{await new Promise((t,i)=>this.ship.builder.container.trigger("xwing:claimUnique",[e,this.type,t]))}catch(t){return this.ship.builder.container.trigger("xwing:pointsUpdated"),void(this.lastSetValid=!1)}if(this.data=this.unadjusted_data=e,null!=this.data){if(this.data.superseded_by_id)return this.setById(this.data.superseded_by_id);null!=this.adjustment_func&&(this.data=this.adjustment_func(this.data)),null==(null!=(t=this.ship.pilot)?t.upgrades:void 0)&&(this.unequipOtherUpgrades(),this.occupyOtherUpgrades(),this.conferAddons()),this.isStandardized()&&!this.ship.hasFixedUpgrades&&this.ship.addToStandardizedList(this.data)}else this.deoccupyOtherUpgrades();return await(this.lastSetValid=this.ship.validate()),this.ship.builder.container.trigger("xwing:pointsUpdated")}}conferAddons(){var t,i,e,a,s,n,l,o,r,d;if(null!=this.data.confersAddons&&!this.ship.builder.isQuickbuild&&0<this.data.confersAddons.length)for(a=0,n=(o=this.data.confersAddons).length;a<n;a++){if(e=(t=o[a]).type,i={ship:this.ship,container:this.container},null!=t.slot&&(i.slot=t.slot),null!=t.adjustment_func&&(i.adjustment_func=t.adjustment_func),null!=t.filter_func&&(i.filter_func=t.filter_func),null!=t.auto_equip&&(i.auto_equip=t.auto_equip),null!=t.placeholderMod_func&&(i.placeholderMod_func=t.placeholderMod_func),!((t=new e(i))instanceof exportObj.Upgrade))throw new Error("Unexpected addon type for addon "+t);this.ship.upgrades.push(t),this.conferredAddons.push(t)}if(null!=this.data.chassis&&!this.ship.builder.isQuickbuild&&null!=exportObj.chassis[this.data.chassis].conferredAddons){for(d=[],s=0,l=(r=exportObj.chassis[this.data.chassis].conferredAddons).length;s<l;s++){if(e=(t=r[s]).type,i={ship:this.ship,container:this.container},null!=t.slot&&(i.slot=t.slot),null!=t.adjustment_func&&(i.adjustment_func=t.adjustment_func),null!=t.filter_func&&(i.filter_func=t.filter_func),null!=t.auto_equip&&(i.auto_equip=t.auto_equip),null!=t.placeholderMod_func&&(i.placeholderMod_func=t.placeholderMod_func),!((t=new e(i))instanceof exportObj.Upgrade))throw new Error("Unexpected addon type for addon "+t);this.ship.upgrades.push(t),d.push(this.conferredAddons.push(t))}return d}}async rescindAddons(){for(var e,t,i,a,s=[],n=this.conferredAddons,l=0,o=n.length;l<o;l++)e=n[l],s.push(new Promise((t,i)=>e.destroy(t)));for(await Promise.all(s),t=0,i=(a=this.conferredAddons).length;t<i;t++){if(!((e=a[t])instanceof exportObj.Upgrade))throw new Error("Unexpected addon type for addon "+e);this.ship.upgrades.removeItem(e)}return this.conferredAddons=[]}getPoints(t=this.data,i=this.ship){var e,a=null!=(e=this.ship)&&e.builder.isXwa&&null!=(null!=t?t.pointsxwa:void 0)?t.pointsxwa:null!=(e=null!=t?t.points:void 0)?e:0;if(!Array.isArray(a))return a;switch(t.variablepoints){case"Agility":return a[i.data.agility];case"Base":if(null==(null!=i?i.data.base:void 0))return a[0];switch(i.data.base){case"Medium":return a[1];case"Large":return a[2];case"Huge":return a[3]}break;case"Initiative":return a[i.pilot.skill];case"Faction":return a[t.faction.indexOf(i.builder.faction)]}}updateSelection(t){return null!=this.data?this.selector.select2("data",{id:this.data.id,text:`${this.data.display_name||this.data.name} (${t}${this.data.variablepoints?"*":""})`}):this.selector.select2("data",null)}toString(){return null!=this.data?`${this.data.display_name||this.data.name} (${this.getPoints()})`:"No "+this.type}toHTML(t){var i,e,a,s,n,l,o,r,d,c,u;if(null==this.data)return"";if(u=null!=this.data.slot&&"HardpointShip"===this.data.slot?"hardpoint":(null!=(u=this.data.slot)?u:this.type).toLowerCase().replace(/[^0-9a-z]/gi,""),c=(c="function"==typeof(c=this.data).text?c.text(match(/(<span.*<\/span>)<br \/><br \/>(.*)/)):void 0)?(d='<div class="card-restriction-container">'+c[1]+"</div>",c[2]):(d="",this.data.text),i="",null!=this.data.range&&(a=null!=this.data.rangebonus?'<span class="upgrade-attack-rangebonus"><i class="xwing-miniatures-font xwing-miniatures-font-rangebonusindicator"></i></span>':"",a=$.trim(`<span class="upgrade-attack-range">${this.data.range}</span>
`+a),e=null!=this.data.attack?$.trim(`<span class="info-data info-attack">${this.data.attack}</span>
<i class="xwing-miniatures-font xwing-miniatures-font-frontarc"></i>`):null!=this.data.attackf?$.trim(`<span class="info-data info-attack">${this.data.attackf}</span>
<i class="xwing-miniatures-font xwing-miniatures-font-fullfrontarc"></i>`):null!=this.data.attackb?$.trim(`<span class="info-data info-attack">${this.data.attackb}</span>
<i class="xwing-miniatures-font xwing-miniatures-font-backarc"></i>`):null!=this.data.attackt?$.trim(`<span class="info-data info-attack">${this.data.attackt}</span>
<i class="xwing-miniatures-font xwing-miniatures-font-singleturretarc"></i>`):null!=this.data.attackdt?$.trim(`<span class="info-data info-attack">${this.data.attackdt}</span>
<i class="xwing-miniatures-font xwing-miniatures-font-doubleturretarc"></i>`):null!=this.data.attackl?$.trim(`<span class="info-data info-attack">${this.data.attackl}</span>
<i class="xwing-miniatures-font xwing-miniatures-font-leftarc"></i>`):null!=this.data.attackr?$.trim(`<span class="info-data info-attack">${this.data.attackr}</span>
<i class="xwing-miniatures-font xwing-miniatures-font-rightarc"></i>`):null!=this.data.attackbull?$.trim(`<span class="info-data info-attack">${this.data.attackbull}</span>
<i class="xwing-miniatures-font xwing-miniatures-font-bullseyearc"></i>`):"",i=$.trim(`<div class="upgrade-attack">
    ${a}
    ${e}
</div>`)),null!=this.data.charge){if(r="",null!=this.data.recurring)if(0<this.data.recurring)for(n=0;n<this.data.recurring;)r+='<sup><i class="fas fa-caret-up"></i></sup>',++n;else for(n=this.data.recurring;n<0;)r+='<sub><i class="fas fa-caret-down"></i></sub>',++n;s=$.trim(`<div class="upgrade-charge">
    <span class="info-data info-charge">${this.data.charge}</span>
    <i class="xwing-miniatures-font xwing-miniatures-font-charge"></i>${r}
</div>`)}else s=$.trim("");if(null!=this.data.force){for(o=1,null!=this.data.forcerecurring&&(o=this.data.forcerecurring),n=0,r="";n<o;)r+='<sup><i class="fas fa-caret-up"></i></sup>',++n;l=$.trim(`<div class="upgrade-force">
    <span class="info-data info-force">${this.data.force}</span>
    <i class="xwing-miniatures-font xwing-miniatures-font-forcecharge"></i>${r}
</div>`)}else l=$.trim("");return $.trim(`<div class="upgrade-container">
    <div class="upgrade-stats">
        <div class="upgrade-name"><i class="xwing-miniatures-font xwing-miniatures-font-${u}"></i>${this.data.display_name||this.data.name}</div>
        <div class="mask">
            <div class="outer-circle">
                <div class="inner-circle upgrade-points">${t}</div>
            </div>
        </div>
        ${d}
    </div>
    ${i}
    ${s}
    ${l}
    <div class="upgrade-text">${c}</div>
    <div style="clear: both;"></div>
</div>`)}toTableRow(t){return null!=this.data?$.trim(`<tr class="simple-addon">
    <td class="name">${this.data.display_name||this.data.name}</td>
    <td class="points">${t}</td>
</tr>`):""}toSimpleCopy(t){return null!=this.data?this.data.name+` (${t})    
`:null}toRedditText(t){return null!=this.data?`*&nbsp;${this.data.name} (${t})*    
`:null}toTTSText(){return null!=this.data?""+exportObj.toTTS(this.data.name):null}toSerialized(){var t;return this.serialization_code+"."+(null!=(t=null!=(t=this.data)?t.id:void 0)?t:-1)}unequipOtherUpgrades(){for(var t,s,n,i=null!=(t=null!=(t=this.data)?t.unequips_upgrades:void 0)?t:[],e=[],a=0,l=i.length;a<l;a++)s=i[a],e.push(function(){for(var t=this.ship.upgrades,i=[],e=0,a=t.length;e<a;e++)if(n=t[e],exportObj.slotsMatching(n.slot,s)&&n!==this&&n.isOccupied()){n.setData(null);break}return i}.call(this));return e}isOccupied(){return null!=this.data||null!=this.occupied_by}occupyOtherUpgrades(){var t,i,e,a,s,n,l=[];for(this.ship.builder.isXwa&&null!=(null!=(e=this.data)?e.also_occupies_upgrades_xwa:void 0)?l=null!=(e=this.data)?e.also_occupies_upgrades_xwa:void 0:null!=(null!=(e=this.data)?e.also_occupies_upgrades:void 0)&&(l=null!=(e=this.data)?e.also_occupies_upgrades:void 0),a=[],t=0,i=l.length;t<i;t++)s=l[t],a.push(function(){for(var t=this.ship.upgrades,i=[],e=0,a=t.length;e<a;e++)if(n=t[e],exportObj.slotsMatching(n.slot,s)&&n!==this&&!n.isOccupied()){this.occupy(n);break}return i}.call(this));return a}deoccupyOtherUpgrades(){for(var t,i=this.occupying,e=[],a=0,s=i.length;a<s;a++)t=i[a],e.push(this.deoccupy(t));return e}occupy(t){return t.occupied_by=this,t.selector.select2("enable",!1),this.occupying.push(t)}deoccupy(t){return t.occupied_by=null,t.selector.select2("enable",!0)}occupiesAnUpgradeSlot(t){for(var i,e=this.ship.upgrades,a=0,s=e.length;a<s;a++)if(i=e[a],exportObj.slotsMatching(i.slot,t)&&i!==this&&null==i.data&&null!=i.occupied_by&&i.occupied_by===this)return!0;return!1}toXWS(t){var i;return(null!=t[i=null!=(i=exportObj.toXWSUpgrade[this.data.slot])?i:this.data.slot.canonicalize()]?t[i]:t[i]=[]).push(null!=(t=this.data.xws)?t:this.data.canonical_name)}},exportObj.Upgrade=class extends GenericAddon{constructor(t){super(t),this.slot=t.slot,this.type="Upgrade",this.dataById=exportObj.upgradesById,this.dataByName=exportObj.upgrades,this.serialization_code="U",this.setupSelector()}setupSelector(){return super.setupSelector({width:"100%",placeholder:this.placeholderMod_func(exportObj.translate("ui","upgradePlaceholder",this.slot)),allowClear:!0,query:t=>{var i={results:[]};return i.results=this.ship.builder.getAvailableUpgradesIncluding(this.slot,this.data,this.ship,this,t.term,this.filter_func),t.callback(i)}})}},exportObj.RestrictedUpgrade=class extends exportObj.Upgrade{constructor(t){super(t),this.serialization_code="u",null!=t.auto_equip&&this.setById(t.auto_equip)}},exportObj.QuickbuildUpgrade=class extends GenericAddon{constructor(t){super(t),this.slot=t.slot,this.type="Upgrade",this.dataById=exportObj.upgradesById,this.dataByName=exportObj.upgrades,this.serialization_code="U",this.upgrade=t.upgrade,this.setupSelector()}setupSelector(){return super.setupSelector({width:"100%",allowClear:!1,query:t=>{var i={results:[{id:this.upgrade.id,text:this.upgrade.display_name||this.upgrade.name,points:0,name:this.upgrade.name,display_name:this.upgrade.display_name}]};return t.callback(i)}})}getPoints(t){return 0}updateSelection(t){return null!=this.data?this.selector.select2("data",{id:this.data.id,text:""+(this.data.display_name||this.data.name)}):this.selector.select2("data",null)}},SERIALIZATION_CODE_TO_CLASS={U:exportObj.Upgrade,u:exportObj.RestrictedUpgrade},(exportObj="undefined"!=typeof exports&&null!==exports?exports:this).fromXWSFaction={rebelalliance:"Rebel Alliance",rebels:"Rebel Alliance",rebel:"Rebel Alliance",galacticempire:"Galactic Empire",imperial:"Galactic Empire",scumandvillainy:"Scum and Villainy",firstorder:"First Order",resistance:"Resistance",galacticrepublic:"Galactic Republic",separatistalliance:"Separatist Alliance"},exportObj.toXWSFaction={"Rebel Alliance":"rebelalliance","Galactic Empire":"galacticempire","Scum and Villainy":"scumandvillainy","First Order":"firstorder",Resistance:"resistance","Galactic Republic":"galacticrepublic","Separatist Alliance":"separatistalliance"},exportObj.toXWSUpgrade={Modification:"modification",Force:"force-power","Tactical Relay":"tactical-relay"},exportObj.fromXWSUpgrade={amd:"Astromech",astromechdroid:"Astromech",ept:"Talent",elitepilottalent:"Talent",system:"Sensor",mod:"Modification","force-power":"Force","tactical-relay":"Tactical Relay"},SPEC_URL="https://github.com/elistevens/xws-spec",SQUAD_TO_XWS_URL="https://squad2xws.herokuapp.com/translate/",exportObj.loadXWSButton=function(e){var i=$(e.find(".xws-import-status")),a=(i.text(exportObj.translate("ui","Loading...")),i),i=i=>$(window).trigger("xwing:activateBuilder",[exportObj.fromXWSFaction[i.faction],t=>t.current_squad.dirty&&null!=t.backend?(e.modal("hide"),t.backend.warnUnsaved(t,()=>t.loadFromXWS(i,t=>{if(!t.success)return e.modal("show"),a.text(t.error)}))):t.loadFromXWS(i,t=>t.success?e.modal("hide"):a.text(t.error))]),s=e.find(".xws-content").val();try{return i(JSON.parse(s))}catch(t){return s=s.split("/").pop(),s=SQUAD_TO_XWS_URL+s,$.getJSON(s,i).catch(t=>a.text("Invalid Input"))}};
//# sourceMappingURL=xwing.min.js.map